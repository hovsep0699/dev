{"ast":null,"code":"import _classCallCheck from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _get from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/get\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\nimport RegisterHandlerBase from './RegisterHandlerBase';\nimport AJAX from '../../../infrastructure/AJAX';\nimport RegisterRequest from '../RegisterRequest';\n\nvar AjaxRegisterHandler = /*#__PURE__*/function (_RegisterHandlerBase) {\n  _inherits(AjaxRegisterHandler, _RegisterHandlerBase);\n\n  var _super = _createSuper(AjaxRegisterHandler);\n\n  function AjaxRegisterHandler(successCallback) {\n    var _this;\n\n    _classCallCheck(this, AjaxRegisterHandler);\n\n    _this = _super.call(this);\n    _this._successCallback = successCallback;\n    return _this;\n  }\n\n  _createClass(AjaxRegisterHandler, [{\n    key: \"register\",\n    value: function register(request) {\n      var _this2 = this;\n\n      _get(_getPrototypeOf(AjaxRegisterHandler.prototype), \"register\", this).call(this, request);\n\n      if (this.canHandle(request)) {\n        var url = '/front/employee/registration';\n        var formData = new FormData();\n        formData.append('company', request.ogrn);\n        formData.append('email', request.email);\n        formData.append('person[surname]', request.surname);\n\n        if (request.name) {\n          formData.append('person[name]', request.name);\n        }\n\n        if (request.patronymic) {\n          formData.append('person[patronymic]', request.patronymic);\n        }\n\n        formData.append('position', request.position);\n        formData.append('password', request.password);\n        formData.append('captcha', request.captcha);\n\n        var successHandler = function successHandler(res) {\n          if (res.data.success) {\n            _this2._successCallback();\n\n            return _this2.doNextHandler(request);\n          }\n\n          var errorResultRequest = RegisterRequest.clone(request);\n          errorResultRequest.error = _get(_getPrototypeOf(AjaxRegisterHandler.prototype), \"createRegisterError\", _this2).call(_this2, \"\\u0417\\u0430\\u043F\\u0440\\u043E\\u0441 \".concat(url), null, res.messages);\n          return _this2.doNextHandler(errorResultRequest);\n        };\n\n        var failHandler = function failHandler(error) {\n          var errorRequest = RegisterRequest.clone(request);\n          errorRequest.error = _get(_getPrototypeOf(AjaxRegisterHandler.prototype), \"createRegisterError\", _this2).call(_this2, \"\\u0417\\u0430\\u043F\\u0440\\u043E\\u0441 \".concat(url), error);\n          return _this2.doNextHandler(errorRequest);\n        };\n\n        return AJAX.postFormData(url, formData).then(successHandler).catch(failHandler);\n      }\n\n      return this.doNextHandler(request);\n    }\n  }, {\n    key: \"canHandle\",\n    value: function canHandle(request) {\n      _get(_getPrototypeOf(AjaxRegisterHandler.prototype), \"canHandle\", this).call(this, request);\n\n      return request.ogrn && request.email && request.surname && request.name && request.position && request.password && request.captcha;\n    }\n  }]);\n\n  return AjaxRegisterHandler;\n}(RegisterHandlerBase);\n\nexport default AjaxRegisterHandler;","map":{"version":3,"sources":["../../../../src/application/register/handlers/AjaxRegisterHandler.js"],"names":[],"mappings":";;;;;;AAAA,OAAO,mBAAP,MAAgC,uBAAhC;AACA,OAAO,IAAP,MAAiB,8BAAjB;AACA,OAAO,eAAP,MAA4B,oBAA5B;;IAEM,mB;;;;;AACJ,+BAAY,eAAZ,EAA2B;AAAA;;AAAA;;AACzB;AACA,UAAK,gBAAL,GAAwB,eAAxB;AAFyB;AAG1B;;;;6BAEQ,O,EAAO;AAAA;;AACd,wFAAe,OAAf;;AACA,UAAI,KAAK,SAAL,CAAe,OAAf,CAAJ,EAA6B;AAC3B,YAAM,GAAG,GAAG,8BAAZ;AACA,YAAM,QAAQ,GAAG,IAAI,QAAJ,EAAjB;AACA,QAAA,QAAQ,CAAC,MAAT,CAAgB,SAAhB,EAA2B,OAAO,CAAC,IAAnC;AACA,QAAA,QAAQ,CAAC,MAAT,CAAgB,OAAhB,EAAyB,OAAO,CAAC,KAAjC;AACA,QAAA,QAAQ,CAAC,MAAT,CAAgB,iBAAhB,EAAmC,OAAO,CAAC,OAA3C;;AACA,YAAI,OAAO,CAAC,IAAZ,EAAkB;AAChB,UAAA,QAAQ,CAAC,MAAT,CAAgB,cAAhB,EAAgC,OAAO,CAAC,IAAxC;AACD;;AACD,YAAI,OAAO,CAAC,UAAZ,EAAwB;AACtB,UAAA,QAAQ,CAAC,MAAT,CAAgB,oBAAhB,EAAsC,OAAO,CAAC,UAA9C;AACD;;AACD,QAAA,QAAQ,CAAC,MAAT,CAAgB,UAAhB,EAA4B,OAAO,CAAC,QAApC;AACA,QAAA,QAAQ,CAAC,MAAT,CAAgB,UAAhB,EAA4B,OAAO,CAAC,QAApC;AACA,QAAA,QAAQ,CAAC,MAAT,CAAgB,SAAhB,EAA2B,OAAO,CAAC,OAAnC;;AAEA,YAAM,cAAc,GAAG,SAAjB,cAAiB,CAAC,GAAD,EAAQ;AAC7B,cAAI,GAAG,CAAC,IAAJ,CAAS,OAAb,EAAsB;AACpB,YAAA,MAAI,CAAC,gBAAL;;AACA,mBAAO,MAAI,CAAC,aAAL,CAAmB,OAAnB,CAAP;AACD;;AACD,cAAM,kBAAkB,GAAG,eAAe,CAAC,KAAhB,CAAsB,OAAtB,CAA3B;AACA,UAAA,kBAAkB,CAAC,KAAnB,mJAA+D,GAA/D,GAAsE,IAAtE,EAA4E,GAAG,CAAC,QAAhF;AACA,iBAAO,MAAI,CAAC,aAAL,CAAmB,kBAAnB,CAAP;AACD,SARD;;AAUA,YAAM,WAAW,GAAG,SAAd,WAAc,CAAC,KAAD,EAAU;AAC5B,cAAM,YAAY,GAAG,eAAe,CAAC,KAAhB,CAAsB,OAAtB,CAArB;AACA,UAAA,YAAY,CAAC,KAAb,mJAAyD,GAAzD,GAAgE,KAAhE;AACA,iBAAO,MAAI,CAAC,aAAL,CAAmB,YAAnB,CAAP;AACD,SAJD;;AAMA,eAAO,IAAI,CAAC,YAAL,CAAkB,GAAlB,EAAuB,QAAvB,EAAiC,IAAjC,CAAsC,cAAtC,EAAsD,KAAtD,CAA4D,WAA5D,CAAP;AACD;;AACD,aAAO,KAAK,aAAL,CAAmB,OAAnB,CAAP;AACD;;;8BAES,O,EAAO;AACf,yFAAgB,OAAhB;;AACA,aAAO,OAAO,CAAC,IAAR,IACH,OAAO,CAAC,KADL,IAEH,OAAO,CAAC,OAFL,IAGH,OAAO,CAAC,IAHL,IAIH,OAAO,CAAC,QAJL,IAKH,OAAO,CAAC,QALL,IAMH,OAAO,CAAC,OANZ;AAOD;;;;EAtD+B,mB;;AAyDlC,eAAe,mBAAf","sourceRoot":"","sourcesContent":["import RegisterHandlerBase from './RegisterHandlerBase';\r\nimport AJAX from '../../../infrastructure/AJAX';\r\nimport RegisterRequest from '../RegisterRequest';\r\nclass AjaxRegisterHandler extends RegisterHandlerBase {\r\n    constructor(successCallback) {\r\n        super();\r\n        this._successCallback = successCallback;\r\n    }\r\n    register(request) {\r\n        super.register(request);\r\n        if (this.canHandle(request)) {\r\n            const url = '/front/employee/registration';\r\n            const formData = new FormData();\r\n            formData.append('company', request.ogrn);\r\n            formData.append('email', request.email);\r\n            formData.append('person[surname]', request.surname);\r\n            if (request.name) {\r\n                formData.append('person[name]', request.name);\r\n            }\r\n            if (request.patronymic) {\r\n                formData.append('person[patronymic]', request.patronymic);\r\n            }\r\n            formData.append('position', request.position);\r\n            formData.append('password', request.password);\r\n            formData.append('captcha', request.captcha);\r\n            const successHandler = (res) => {\r\n                if (res.data.success) {\r\n                    this._successCallback();\r\n                    return this.doNextHandler(request);\r\n                }\r\n                const errorResultRequest = RegisterRequest.clone(request);\r\n                errorResultRequest.error = super.createRegisterError(`Запрос ${url}`, null, res.messages);\r\n                return this.doNextHandler(errorResultRequest);\r\n            };\r\n            const failHandler = (error) => {\r\n                const errorRequest = RegisterRequest.clone(request);\r\n                errorRequest.error = super.createRegisterError(`Запрос ${url}`, error);\r\n                return this.doNextHandler(errorRequest);\r\n            };\r\n            return AJAX.postFormData(url, formData).then(successHandler).catch(failHandler);\r\n        }\r\n        return this.doNextHandler(request);\r\n    }\r\n    canHandle(request) {\r\n        super.canHandle(request);\r\n        return request.ogrn\r\n            && request.email\r\n            && request.surname\r\n            && request.name\r\n            && request.position\r\n            && request.password\r\n            && request.captcha;\r\n    }\r\n}\r\nexport default AjaxRegisterHandler;\r\n//# sourceMappingURL=AjaxRegisterHandler.js.map"]},"metadata":{},"sourceType":"module"}