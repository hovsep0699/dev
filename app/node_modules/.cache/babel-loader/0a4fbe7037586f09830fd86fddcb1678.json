{"ast":null,"code":"import _classCallCheck from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React from\"react\";import{state}from\"@distate/app/src/pages/POA/MCHD_ROOT/presentation/presenter/BasicState\";import{SectionPresenterState}from\"@distate/app/src/pages/POA/MCHD_ROOT/presentation/pages/Sections/presenter/SectionPresenterState\";function isState(state){return state&&typeof state.compare==='function';}var ObservableComponent=/*#__PURE__*/function(_React$Component){_inherits(ObservableComponent,_React$Component);var _super=_createSuper(ObservableComponent);function ObservableComponent(props){var _this;_classCallCheck(this,ObservableComponent);_this=_super.call(this,props);// Initialize state\n// Initialize the presenter\n_this.presenter=void 0;_this.defaultBuildWhen=function(oldState,newState){console.log(\"-----------------------::: \",oldState instanceof SectionPresenterState,newState instanceof SectionPresenterState);return!oldState.compare(newState);};_this.handleStateChange=function(){var oldState=_this.state;var newState=_this.presenter.getState();if(isState(oldState)&&isState(newState)){if(_this.props.buildWhen){if(_this.props.buildWhen(oldState,newState))_this.setState(newState);}else if(_this.defaultBuildWhen(oldState,newState))_this.setState(newState);}else{_this.setState(newState);}};_this.presenter=props.create();var state=_this.presenter.getState();if(isState(state)){_this.state=state;}else{throw new Error(\"Unknown state: \".concat(JSON.stringify(state)));// this.state = new T();\n}// Subscribe to presenter state changes\n_this.presenter.addObserver({update:_this.handleStateChange});return _this;}_createClass(ObservableComponent,[{key:\"componentWillUnmount\",value:function componentWillUnmount(){// Clean up the listener when the component unmounts\nthis.presenter.removeObserver(this.handleStateChange);}// by default rerender when presenter state changes\n},{key:\"render\",value:function render(){var _this$props=this.props,builder=_this$props.builder,children=_this$props.children;var presenter=this.presenter;// Use the builder function to render the component\nreturn builder(presenter.getState(),children!==null&&children!==void 0?children:/*#__PURE__*/React.createElement(React.Fragment,null));}}]);return ObservableComponent;}(React.Component);export default ObservableComponent;","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/POA/MCHD_ROOT/presentation/observableComponent/observableComponent.tsx"],"names":["React","state","SectionPresenterState","isState","compare","ObservableComponent","props","presenter","defaultBuildWhen","oldState","newState","console","log","handleStateChange","getState","buildWhen","setState","create","Error","JSON","stringify","addObserver","update","removeObserver","builder","children","Component"],"mappings":"4pBAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CAEA,OAAQC,KAAR,KAAoB,wEAApB,CACA,OAAQC,qBAAR,KAAoC,kGAApC,CASA,QAASC,CAAAA,OAAT,CAAoBF,KAApB,CAA4C,CACxC,MAAOA,CAAAA,KAAK,EAAI,MAAOA,CAAAA,KAAK,CAACG,OAAb,GAAyB,UAAzC,CACH,C,GAEKC,CAAAA,mB,sIAGF,6BAAYC,KAAZ,CAAsD,qDAClD,uBAAMA,KAAN,EAEA;AAGA;AANkD,MAF5CC,SAE4C,cA4B9CC,gBA5B8C,CA4B3B,SAACC,QAAD,CAAcC,QAAd,CAA8B,CACrDC,OAAO,CAACC,GAAR,CAAY,6BAAZ,CAA2CH,QAAQ,WAAYP,CAAAA,qBAA/D,CAAsFQ,QAAQ,WAAYR,CAAAA,qBAA1G,EACA,MAAO,CAACO,QAAQ,CAACL,OAAT,CAAiBM,QAAjB,CAAR,CACH,CA/BqD,OAiC9CG,iBAjC8C,CAiC1B,UAAM,CAC9B,GAAMJ,CAAAA,QAAQ,CAAG,MAAKR,KAAtB,CACA,GAAMS,CAAAA,QAAQ,CAAG,MAAKH,SAAL,CAAeO,QAAf,EAAjB,CAEA,GAAIX,OAAO,CAAIM,QAAJ,CAAP,EAAwBN,OAAO,CAAIO,QAAJ,CAAnC,CAAkD,CAC9C,GAAI,MAAKJ,KAAL,CAAWS,SAAf,CAA0B,CACtB,GAAI,MAAKT,KAAL,CAAWS,SAAX,CAAqBN,QAArB,CAAoCC,QAApC,CAAJ,CACI,MAAKM,QAAL,CAAcN,QAAd,EACP,CAHD,IAIK,IAAI,MAAKF,gBAAL,CAAsBC,QAAtB,CAAgCC,QAAhC,CAAJ,CACD,MAAKM,QAAL,CAAcN,QAAd,EACP,CAPD,IAQK,CACD,MAAKM,QAAL,CAAcN,QAAd,EACH,CAEJ,CAjDqD,CAOlD,MAAKH,SAAL,CAAiBD,KAAK,CAACW,MAAN,EAAjB,CACA,GAAMhB,CAAAA,KAAK,CAAI,MAAKM,SAAN,CAAsBO,QAAtB,EAAd,CACA,GAAIX,OAAO,CAAIF,KAAJ,CAAX,CAAuB,CACnB,MAAKA,KAAL,CAAaA,KAAb,CACH,CAFD,IAGK,CACD,KAAM,IAAIiB,CAAAA,KAAJ,0BAA4BC,IAAI,CAACC,SAAL,CAAenB,KAAf,CAA5B,EAAN,CACA;AACH,CAED;AAEA,MAAKM,SAAL,CAAec,WAAf,CAA2B,CAACC,MAAM,CAAE,MAAKT,iBAAd,CAA3B,EAnBkD,aAoBrD,C,mGAEsB,CACnB;AACA,KAAKN,SAAL,CAAegB,cAAf,CAA8B,KAAKV,iBAAnC,EACH,CAED;uCAwBS,iBACyB,KAAKP,KAD9B,CACGkB,OADH,aACGA,OADH,CACYC,QADZ,aACYA,QADZ,IAEGlB,CAAAA,SAFH,CAEiB,IAFjB,CAEGA,SAFH,CAIL;AACA,MAAOiB,CAAAA,OAAO,CAACjB,SAAS,CAACO,QAAV,EAAD,CAA4BW,QAA5B,SAA4BA,QAA5B,UAA4BA,QAA5B,cAAwC,wCAAxC,CAAd,CACH,C,iCA5DkFzB,KAAK,CAAC0B,S,EAmE7F,cAAerB,CAAAA,mBAAf","sourcesContent":["import React from \"react\";\r\nimport {Presenter} from \"@distate/app/src/pages/POA/MCHD_ROOT/presentation/presenter/presenter\";\r\nimport {state} from \"@distate/app/src/pages/POA/MCHD_ROOT/presentation/presenter/BasicState\";\r\nimport {SectionPresenterState} from \"@distate/app/src/pages/POA/MCHD_ROOT/presentation/pages/Sections/presenter/SectionPresenterState\";\r\n\r\ninterface ObservableComponentProps<K, T extends state<T, K>, P extends Presenter<K, T>> {\r\n    builder: (state: T, child?: React.ReactNode) => React.ReactNode;\r\n    buildWhen?: null | ((oldState: T, newState: T) => boolean);\r\n    create: () => P;\r\n    children?: React.ReactNode;\r\n}\r\n\r\nfunction isState<T>(state: any): state is T {\r\n    return state && typeof state.compare === 'function';\r\n}\r\n\r\nclass ObservableComponent<K, T extends state<T, K>, P extends Presenter<K, T>> extends React.Component<ObservableComponentProps<K, T, P>, T> {\r\n    protected presenter: P;\r\n\r\n    constructor(props: ObservableComponentProps<K, T, P>) {\r\n        super(props);\r\n\r\n        // Initialize state\r\n\r\n\r\n        // Initialize the presenter\r\n        this.presenter = props.create();\r\n        const state = (this.presenter as P).getState() as T\r\n        if (isState<T>(state)) {\r\n            this.state = state;\r\n        }\r\n        else {\r\n            throw new Error(`Unknown state: ${JSON.stringify(state)}`);\r\n            // this.state = new T();\r\n        }\r\n\r\n        // Subscribe to presenter state changes\r\n\r\n        this.presenter.addObserver({update: this.handleStateChange});\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        // Clean up the listener when the component unmounts\r\n        this.presenter.removeObserver(this.handleStateChange);\r\n    }\r\n\r\n    // by default rerender when presenter state changes\r\n    private defaultBuildWhen = (oldState: T, newState: T) => {\r\n        console.log(\"-----------------------::: \", oldState instanceof SectionPresenterState, newState instanceof SectionPresenterState);\r\n        return !oldState.compare(newState);\r\n    }\r\n    // Handle state changes from the presenter\r\n    private handleStateChange = () => {\r\n        const oldState = this.state as T;\r\n        const newState = this.presenter.getState() as T;\r\n\r\n        if (isState<T>(oldState) && isState<T>(newState)) {\r\n            if (this.props.buildWhen) {\r\n                if (this.props.buildWhen(oldState as T, newState))\r\n                    this.setState(newState);\r\n            }\r\n            else if (this.defaultBuildWhen(oldState, newState))\r\n                this.setState(newState);\r\n        }\r\n        else {\r\n            this.setState(newState);\r\n        }\r\n\r\n    };\r\n\r\n    render() {\r\n        const { builder, children } = this.props;\r\n        const { presenter } = this;\r\n\r\n        // Use the builder function to render the component\r\n        return builder(presenter.getState() as T, children ?? <></>);\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\nexport default ObservableComponent;"]},"metadata":{},"sourceType":"module"}