{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _objectSpread from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import _applyDecoratedDescriptor from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/applyDecoratedDescriptor\";var _class;import React from'react';import FormBase from'../../../common/form/FormBase';import FormBuilder from'../../../common/form/documents/DocumentFormBuilder';import Invoice from'@distate/core/dist/domain/documents/upd/vo/Invoice';import DateInvoice from'@distate/core/dist/domain/documents/upd/vo/invoice/Date';import NumInvoice from'@distate/core/dist/domain/documents/upd/vo/invoice/Num';import Correct from'@distate/core/dist/domain/documents/upd/vo/Correct';import DateCorrect from'@distate/core/dist/domain/documents/upd/vo/correct/Date';import NumberCorrect from'@distate/core/dist/domain/documents/upd/vo/correct/Number';import Currency from'@distate/core/dist/domain/documents/upd/vo/Currency';import Recipient from'@distate/core/dist/domain/documents/upd/vo/recipient/Recipient';import EconomicSubjectName from'@distate/core/dist/domain/documents/upd/vo/EconomicSubjectName';import ExchangeRate from'@distate/core/dist/domain/documents/upd/vo/currency/ExchangeRate';import Flash from'../../../common/flash/Flash';import Core from'@distate/core/dist/application/Core';import AutocompleteService from'@distate/core/dist/application/autocomplete/AutocompleteService';import{SAVE,SUCCESS_SAVE_FORM}from'../../../common/Lbl';import PaymentDocument from'@distate/core/dist/domain/documents/upd/vo/invoice/payment_document/PaymentDocument';import CargoFrom from'@distate/core/dist/domain/documents/upd/vo/invoice/CargoFrom';import CargoTo from'@distate/core/dist/domain/documents/upd/vo/invoice/CargoTo';import Purpose from'@distate/core/dist/domain/documents/upd/vo/Purpose';import InvoicePurpose from'@distate/core/dist/domain/documents/upd/vo/purpose/Invoice';import WaybillPurpose from'@distate/core/dist/domain/documents/upd/vo/purpose/Waybill';import InvoiceWaybillPurpose from'@distate/core/dist/domain/documents/upd/vo/purpose/InvoiceWaybill';import Carrier from'@distate/core/dist/domain/documents/upd/vo/transfer/carrier/Carrier';import Name from'@distate/core/dist/domain/documents/upd/vo/Name';import InformationBasisType from'@distate/core/dist/domain/documents/upd/vo/invoice/InformationBasisType';import ShipmentDocuments from'@distate/core/dist/domain/documents/upd/vo/invoice/ShipmentDocuments';import BasisDocName from'@distate/core/dist/domain/documents/upd/standard_element/basis/DocName';import BasisDocNumber from'@distate/core/dist/domain/documents/upd/standard_element/basis/DocNumber';import BasisDocDate from'@distate/core/dist/domain/documents/upd/standard_element/basis/DocDate';import BasisInformation from'@distate/core/dist/domain/documents/upd/standard_element/basis/Information';import BasisDocId from'@distate/core/dist/domain/documents/upd/standard_element/basis/DocId';import BasisDocNameEmptyOption from'@distate/core/dist/domain/documents/upd/standard_element/basis/DocNameEmptyOption';import InfoFieldFact1 from'@distate/core/dist/domain/documents/upd/vo/invoice/InfoFieldFact1';import BasisName from'@distate/core/dist/domain/documents/upd/vo/BasisName';import styles from'../../../common/form/documents/DocumentFormBuilder.module.css';import{TOP}from'../../../common/Placement';import Behavior from'../../../common/form/parameters/Behavior';import Appearance from'../../../common/form/parameters/Appearance';import createError from'@distate/core/dist/application/error/ErrorFactory';import autobind from'autobind-decorator';import{DOCUMENT_VIEW}from'../../../common/Url';import{DOCUMENT as DOCUMENT_ERROR}from'@distate/core/dist/application/error/Error';import PropTypes from'prop-types';import UPDService from'@distate/core/dist/application/documents/upd/UPDService';import get from'get-value';import set from'set-value';import setObject from'object-path';import{set as setImmutable,wrap}from'object-path-immutable';import{clone,removeEmpty}from'../../../utils/ObjectUtil';import{Loading}from'@distate/components';import ParticipantForm from'../fields/ParticipantForm';import Factor from'@distate/core/dist/domain/documents/upd/vo/factor/Factor';import InvoiceTableForm from'../../../common/form/InvoiceTableForm';import ArrayGroup from'./ArrayGroup';import PassedByForm from'./PassedByForm';import TransportationAndCargoModal from'./TransportationAndCargoModal';import TransportationAndCargo from'@distate/core/dist/domain/documents/upd/vo/transfer/TransportationAndCargo';import skipArgs from'../../../utils/skipArgs';import Environment from'@distate/core/dist/application/Environment';import DivisionSelect from'./DivisionSelect';import Division from'@distate/core/dist/domain/documents/upd/vo/Division';var UPDForm=(_class=/*#__PURE__*/function(_FormBase){_inherits(UPDForm,_FormBase);var _super=_createSuper(UPDForm);function UPDForm(props){var _this;_classCallCheck(this,UPDForm);_this=_super.call(this,props);_this.state=_objectSpread(_objectSpread(_objectSpread({},_this.state),{},{redirectUrl:'',document:null,isLoading:!!props.id,isError:false,showSaveDocumentModal:false,errors:null},_this.getDocumentTypeState(InvoicePurpose.value)),{},{paymentDocuments:[],infoFields:[],isExchangeRateFieldHidden:true,divisions:[],selectedDivision:null,transferDetails:null});_this.isDocumentDuplicate=false;_this.responsePathEntry=null;_this.responcePathFirstSegment=null;return _this;}_createClass(UPDForm,[{key:\"createForm\",value:function createForm(){var _this2=this,_builder$buildGroup,_builder$buildGroup2,_builder$buildGroup3,_builder$buildGroup4,_builder$buildGroup5,_builder$buildGroup6,_Core$company,_Core$company$inn,_Core$company2,_Core$company2$inn,_Core$company3,_Core$company3$kpp,_Core$company4,_Core$company4$kpp,_Core$company5,_basisBehaviors,_basisAppearances,_builder$buildGroup7,_builder$buildGroup8;var BASE_WIDTH=460;var MARGIN=6;var defaultBehavior=new Behavior();var defaultAppearance=new Appearance({width:BASE_WIDTH+MARGIN});var builder=new FormBuilder(this,defaultBehavior,defaultAppearance);var requiredBehavior=new Behavior({isRequired:true});var serverResponse=this.state.document;this.getCustomData(builder,serverResponse);this.getCustomGoodsData(builder,serverResponse);var getErrors=function getErrors(errorsObjPath){return clone(get(builder._component,\"state.errors.\".concat(errorsObjPath)));};var clearFieldError=function clearFieldError(path){var errors=get(builder._component,\"state.errors.\".concat(path));if(Array.isArray(errors)&&errors.length){setObject(errors,\"state.errors.\".concat(path),[]);builder._component.setState({errors:errors});}if(typeof errors==='string'){errors=get(builder._component,\"state.errors\");var updatedErrors=setImmutable(errors,path,'');builder._component.setState({errors:updatedErrors});}};var getBehavior=function getBehavior(defaultBehavior,path){var scope=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';return serverResponse?Behavior.mixin(defaultBehavior,{initialFieldDomain:{value:scope?set({},scope,get(serverResponse,path)):get(serverResponse,path)}}):defaultBehavior;};var handleArrayGroupErrorsChange=function handleArrayGroupErrorsChange(path){return function(newErrors){var allErrors=clone(_this2.state.errors)||{};var updatedComponentStateErrors=set(allErrors,path,newErrors);_this2.setState({errors:updatedComponentStateErrors});};};builder.buildGroup(Invoice,(_builder$buildGroup={},_defineProperty(_builder$buildGroup,NumInvoice.field,builder.buildInput),_defineProperty(_builder$buildGroup,DateInvoice.field,builder.buildDateInput),_builder$buildGroup),getBehavior(defaultBehavior,\"\".concat(this.responsePathEntry,\".invoice\")),defaultAppearance,(_builder$buildGroup2={},_defineProperty(_builder$buildGroup2,NumInvoice.field,getBehavior(requiredBehavior,\"\".concat(this.responsePathEntry,\".invoice.number\"))),_defineProperty(_builder$buildGroup2,DateInvoice.field,getBehavior(requiredBehavior,\"\".concat(this.responsePathEntry,\".invoice.date\"))),_builder$buildGroup2),(_builder$buildGroup3={},_defineProperty(_builder$buildGroup3,NumInvoice.field,new Appearance({width:BASE_WIDTH-120,align:TOP})),_defineProperty(_builder$buildGroup3,DateInvoice.field,new Appearance({width:120,customClasses:\"ds-input \".concat(styles.width100),align:TOP})),_builder$buildGroup3));builder.buildGroup(Correct,(_builder$buildGroup4={},_defineProperty(_builder$buildGroup4,NumberCorrect.field,builder.buildInput),_defineProperty(_builder$buildGroup4,DateCorrect.field,builder.buildDateInput),_builder$buildGroup4),getBehavior(defaultBehavior,\"\".concat(this.responsePathEntry,\".invoice.correction\")),defaultAppearance,(_builder$buildGroup5={},_defineProperty(_builder$buildGroup5,NumberCorrect.field,getBehavior(defaultBehavior,\"\".concat(this.responsePathEntry,\".invoice.correction.number\"))),_defineProperty(_builder$buildGroup5,DateCorrect.field,getBehavior(defaultBehavior,\"\".concat(this.responsePathEntry,\".invoice.correction.date\"))),_builder$buildGroup5),(_builder$buildGroup6={},_defineProperty(_builder$buildGroup6,NumberCorrect.field,new Appearance({width:BASE_WIDTH-120,align:TOP})),_defineProperty(_builder$buildGroup6,DateCorrect.field,new Appearance({width:120,customClasses:\"ds-input \".concat(styles.width100),align:TOP})),_builder$buildGroup6));var getPurpose=function getPurpose(){if(serverResponse){switch(get(serverResponse,\"\".concat(_this2.responcePathFirstSegment,\".purpose\"))){case InvoicePurpose.value:return InvoicePurpose;case WaybillPurpose.value:return WaybillPurpose;case InvoiceWaybillPurpose.value:return InvoiceWaybillPurpose;default:return InvoicePurpose;}}else{return InvoicePurpose;}};var onPurposeChange=function onPurposeChange(purpose){_this2.setState(_this2.getDocumentTypeState(purpose));};var purposeBehavior=new Behavior({initialFieldDomain:getPurpose(),onChange:onPurposeChange,isRequired:true});builder.buildSelect(Purpose,purposeBehavior);builder.content.push(function(){return/*#__PURE__*/React.createElement(ArrayGroup,{domainVO:PaymentDocument,initialValues:_this2.state.paymentDocuments,returnState:function returnState(paymentDocuments){return _this2.setState({paymentDocuments:paymentDocuments});},hasFixedWidthFields:true,inputGroupWidth:\"466px\",errors:getErrors(PaymentDocument.field),handleErrorsChange:handleArrayGroupErrorsChange(PaymentDocument.field)});});var companyINN=((_Core$company=Core.company)===null||_Core$company===void 0?void 0:(_Core$company$inn=_Core$company.inn)===null||_Core$company$inn===void 0?void 0:_Core$company$inn.value)?\", \\u0418\\u041D\\u041D: \".concat((_Core$company2=Core.company)===null||_Core$company2===void 0?void 0:(_Core$company2$inn=_Core$company2.inn)===null||_Core$company2$inn===void 0?void 0:_Core$company2$inn.value):'';var companyKPP=((_Core$company3=Core.company)===null||_Core$company3===void 0?void 0:(_Core$company3$kpp=_Core$company3.kpp)===null||_Core$company3$kpp===void 0?void 0:_Core$company3$kpp.value)?\", \\u041A\\u041F\\u041F: \".concat((_Core$company4=Core.company)===null||_Core$company4===void 0?void 0:(_Core$company4$kpp=_Core$company4.kpp)===null||_Core$company4$kpp===void 0?void 0:_Core$company4$kpp.value):'';var economicSubjectNameInitialValue=serverResponse?get(serverResponse,\"\".concat(this.responsePathEntry,\".economicSubjectName\")):\"\".concat((_Core$company5=Core.company)===null||_Core$company5===void 0?void 0:_Core$company5.name).concat(companyINN).concat(companyKPP);var economicSubjectNameBehavior=new Behavior({initialFieldDomain:{value:economicSubjectNameInitialValue},isRequired:true});var hasDivisions=this.state.divisions.length>1;builder.content.push(function(){return/*#__PURE__*/React.createElement(DivisionSelect,{DomainVO:Division,options:_this2.state.divisions,selected:_this2.state.selectedDivision,returnState:function returnState(selectedDivision){return _this2.setState({selectedDivision:selectedDivision});},isVisible:hasDivisions});});builder.buildInfo(EconomicSubjectName,economicSubjectNameBehavior,undefined,hasDivisions);var filterLegalEntities=function filterLegalEntities(res){return res.filter(function(item){return item.type==='division';});};builder.buildAutocomplete.apply(builder,[Recipient,getBehavior(new Behavior({isRequired:true,onChange:function onChange(){return clearFieldError(Recipient.field);}}),\"\".concat(Recipient.field,\".title\"))].concat(_toConsumableArray(skipArgs(2)),[filterLegalEntities]));var setDataToFormState=function setDataToFormState(path){return function(data){set(builder.formState,\"values.\".concat(path),data,{merge:true});};};builder.content.push(function(){return/*#__PURE__*/React.createElement(ParticipantForm,{DomainVO:Factor,setDataToFormState:setDataToFormState('information'),initialValues:{factor:get(serverResponse,\"\".concat(_this2.responsePathEntry,\".invoice.information.factor\"))},errors:{factor:getErrors('information.factor')},clearFieldError:clearFieldError});});var cargoFromInitialValues=get(serverResponse,\"\".concat(this.responsePathEntry,\".invoice.cargoFrom\"));builder.content.push(function(){return/*#__PURE__*/React.createElement(ParticipantForm,{DomainVO:CargoFrom,setDataToFormState:setDataToFormState('invoice.cargoFrom'),scope:'consignor',initialValues:_this2.isDocumentDuplicate?cargoFromInitialValues[0]:cargoFromInitialValues,errors:getErrors('invoice.cargoFrom'),clearFieldError:clearFieldError});});var consigneeInitialValues=get(serverResponse,\"\".concat(this.responsePathEntry,\".invoice.consignee\").concat(this.isDocumentDuplicate?'s':''));builder.content.push(function(){return/*#__PURE__*/React.createElement(ParticipantForm,{DomainVO:CargoTo,setDataToFormState:setDataToFormState('invoice'),scope:'consignee',initialValues:{consignee:_this2.isDocumentDuplicate?consigneeInitialValues[0]:consigneeInitialValues},errors:{consignee:getErrors('consignee')},clearFieldError:clearFieldError});});builder.content.push(function(){return/*#__PURE__*/React.createElement(ParticipantForm,{DomainVO:Carrier,setDataToFormState:setDataToFormState('transferDetails.transportation'),customClasses:_this2.state.isInvoice?styles.hiddenAndZeroHeight:'',initialValues:{carrier:get(serverResponse,\"\".concat(_this2.responsePathEntry,\".waybill.transferDetails.transportation.carrier\"))},errors:{carrier:getErrors('transferDetails.transportation.carrier')},clearFieldError:clearFieldError});});builder.content.push(function(){return/*#__PURE__*/React.createElement(PassedByForm,{setDataToFormState:setDataToFormState('transferDetails'),customClasses:_this2.state.isInvoice?styles.hiddenAndZeroHeight:'',initialValues:{passedBy:get(serverResponse,\"\".concat(_this2.responsePathEntry,\".waybill.transferDetails.passedBy\"))},errors:{passedBy:getErrors('transferDetails.passedBy')},clearFieldError:clearFieldError});});var clearTransportationAndCargoModalState=function clearTransportationAndCargoModalState(){var updatedDocument=wrap(_this2.state.document).set('formData.document.waybill.transferDetails.operationInformation',null).set('formData.document.waybill.transferDetails.basis',null).value();_this2.setState({document:updatedDocument,transferDetails:null});};// setDataToFormState('transferDetails')\n// setDataToFormState={transferDetails =>\n//   this.setState({\n//     transferDetails\n//   })\n// }\nbuilder.content.push(function(){var _this2$state$errors,_this2$state$errors2;return/*#__PURE__*/React.createElement(TransportationAndCargoModal,{DomainVO:TransportationAndCargo,setDataToFormState:function setDataToFormState(transferDetails){return _this2.setState({transferDetails:transferDetails});},customClasses:_this2.state.isInvoice?styles.hiddenAndZeroHeight:'',initialValues:{operationInformation:get(serverResponse,\"\".concat(_this2.responsePathEntry,\".waybill.transferDetails.operationInformation\")),basis:get(serverResponse,\"\".concat(_this2.responsePathEntry,\".waybill.transferDetails.basis\"))},errors:(_this2$state$errors=_this2.state.errors)===null||_this2$state$errors===void 0?void 0:_this2$state$errors.transferDetails,waybillError:(_this2$state$errors2=_this2.state.errors)===null||_this2$state$errors2===void 0?void 0:_this2$state$errors2.waybill,clearFieldError:clearFieldError,clearParentState:clearTransportationAndCargoModalState});});var handleCurrencyChange=function handleCurrencyChange(_ref){var letter_code=_ref.letter_code;clearFieldError(Currency.field);_this2.setState({isExchangeRateFieldHidden:letter_code===Currency.initialValue.letterCode.value});};var behaviorCurrency=new Behavior({initialFieldDomain:serverResponse&&serverResponse.currency||Currency.initialValue,isRequired:true,onChange:handleCurrencyChange});builder.buildAutocomplete(Currency,behaviorCurrency);builder.buildInput(ExchangeRate,getBehavior(defaultBehavior,\"\".concat(this.responsePathEntry,\".invoice.information.currencyExchangeRate\")),new Appearance(_objectSpread(_objectSpread({},defaultAppearance),{},{customClasses:this.state.isExchangeRateFieldHidden?styles.hiddenAndZeroHeight:''})));builder.buildInput(Name,getBehavior(defaultBehavior,\"\".concat(this.responsePathEntry,\".name\")),new Appearance(_objectSpread(_objectSpread({},defaultAppearance),{},{customClasses:!this.state.isWaybill?styles.hiddenAndZeroHeight:'',withRequiredView:true})));var DATE_WIDTH=120;var basisBehaviors=(_basisBehaviors={},_defineProperty(_basisBehaviors,BasisDocName.field,defaultBehavior),_defineProperty(_basisBehaviors,BasisDocNumber.field,defaultBehavior),_defineProperty(_basisBehaviors,BasisDocDate.field,defaultBehavior),_defineProperty(_basisBehaviors,BasisInformation.field,defaultBehavior),_defineProperty(_basisBehaviors,BasisDocId.field,defaultBehavior),_basisBehaviors);var basisFieldsAppearance=new Appearance({width:(2*BASE_WIDTH-DATE_WIDTH-3*MARGIN)/4,align:TOP,customClasses:\"ds-input \".concat(styles.width100)});var basisAppearances=(_basisAppearances={},_defineProperty(_basisAppearances,BasisDocName.field,basisFieldsAppearance),_defineProperty(_basisAppearances,BasisDocNumber.field,basisFieldsAppearance),_defineProperty(_basisAppearances,BasisDocDate.field,new Appearance({width:DATE_WIDTH,align:TOP,customClasses:\"ds-input \".concat(styles.width100)})),_defineProperty(_basisAppearances,BasisInformation.field,basisFieldsAppearance),_defineProperty(_basisAppearances,BasisDocId.field,basisFieldsAppearance),_basisAppearances);builder.content.push(function(){return/*#__PURE__*/React.createElement(ArrayGroup,{domainVO:InfoFieldFact1,initialValues:_this2.state.infoFields,returnState:function returnState(infoFields){return _this2.setState({infoFields:infoFields});},hasFixedWidthFields:true,inputGroupWidth:\"466px\",errors:getErrors(InfoFieldFact1.field),handleErrorsChange:handleArrayGroupErrorsChange(InfoFieldFact1.field)});});builder.buildInput(BasisName,getBehavior(defaultBehavior,\"\".concat(this.responsePathEntry,\".basisName\")),defaultAppearance);builder.buildGroup(InformationBasisType,(_builder$buildGroup7={},_defineProperty(_builder$buildGroup7,BasisDocName.field,builder.buildInput),_defineProperty(_builder$buildGroup7,BasisDocNumber.field,builder.buildInput),_defineProperty(_builder$buildGroup7,BasisDocDate.field,builder.buildDateInput),_defineProperty(_builder$buildGroup7,BasisInformation.field,builder.buildInput),_defineProperty(_builder$buildGroup7,BasisDocId.field,builder.buildInput),_builder$buildGroup7),getBehavior(defaultBehavior,\"\".concat(this.responsePathEntry,\".invoice.information.basis\")),defaultAppearance,basisBehaviors,basisAppearances);/** Документ об отгрузке */builder.buildGroup(ShipmentDocuments,(_builder$buildGroup8={},_defineProperty(_builder$buildGroup8,BasisDocName.field,builder.buildInput),_defineProperty(_builder$buildGroup8,BasisDocNumber.field,builder.buildInput),_defineProperty(_builder$buildGroup8,BasisDocDate.field,builder.buildDateInput),_builder$buildGroup8),getBehavior(defaultBehavior,\"\".concat(this.responsePathEntry,\".shipmentDocuments\")),defaultAppearance,basisBehaviors,basisAppearances);InvoiceTableForm.build(builder,serverResponse,this.responsePathEntry);builder.buildLoader();builder.buildSubmit(SAVE,null,getErrors('global'));builder.buildForm();return builder.getForm();}},{key:\"showServerErrorsInForm\",value:function showServerErrorsInForm(data){var errorCb=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(data[0]){Flash.error(data[0]);}if(errorCb)errorCb(data);}},{key:\"makeSubmitRequest\",value:function makeSubmitRequest(data){return this.state.document&&this.props.isEdit?UPDService.edit(this.state.document.id,data):UPDService.create(data);}},{key:\"handleError\",value:function handleError(data){var errors={};var document='messages.document';var invoice='messages.document.invoice';var consignee='messages.document.invoice.consignee';var consignor='messages.document.invoice.cargoFrom.consignor';var goods='messages.document.table.goods';var waybill='messages.document.waybill';var purposeError=get(data,\"messages.purpose.errors\");if(purposeError)errors.purpose=purposeError[0];var toError=get(data,\"messages.to.errors\");if(toError)errors.recipient=toError[0];var economicSubjectNameError=get(data,\"\".concat(document,\".economicSubjectName.errors\"));if(economicSubjectNameError)errors.economicSubjectName=economicSubjectNameError[0];var signorPositionError=get(data,\"\".concat(document,\".signor.position.errors\"));if(signorPositionError){signorPositionError.unshift('Заполните поле Должность в разделе Кабинет');this.showServerErrorsInForm(signorPositionError);errors.global=signorPositionError[0];}var nameError=get(data,\"\".concat(document,\".name.errors\"));if(nameError)errors.name=nameError[0];var numberError=get(data,\"\".concat(invoice,\".number.errors\"));if(numberError)errors.number=numberError[0];var dateError=get(data,\"\".concat(invoice,\".date.errors\"));if(dateError)errors.date=dateError[0];var paymentDocumentsError=get(data,\"\".concat(invoice,\".paymentDocuments.errors\"));if(paymentDocumentsError){set(errors,'invoice.paymentDocuments',paymentDocumentsError[0]);}var paymentDocumentsElementsErrors=get(data,\"\".concat(invoice,\".paymentDocuments\"));if(paymentDocumentsElementsErrors){set(errors,'invoice.paymentDocuments',paymentDocumentsElementsErrors);}var consignorErrors=get(data,consignor);if(consignorErrors){set(errors,'cargoFrom.consignor',consignorErrors);}var consigneeErrors=get(data,consignee);if(consigneeErrors){set(errors,'consignee',consigneeErrors);}var factorErrors=get(data,\"\".concat(invoice,\".information.factor\"));if(factorErrors){set(errors,'information.factor',factorErrors);}var currencyCodeError=get(data,\"\".concat(invoice,\".currencyCode.errors\"));if(currencyCodeError)errors.currency=currencyCodeError[0];var currencyNameError=get(data,\"\".concat(invoice,\".information.currencyName.errors\"));if(currencyNameError)errors.currency=currencyNameError[0];var exchangeRateError=get(data,\"\".concat(invoice,\".information.currencyExchangeRate.errors\"));if(exchangeRateError)errors.exchangeRate=exchangeRateError[0];var informationFieldsElementsErrors=get(data,\"\".concat(invoice,\".informationField.attributeValues\"));if(informationFieldsElementsErrors){if(errors.invoice){errors.invoice.informationField={attributeValues:informationFieldsElementsErrors};}else{errors.invoice={};errors.invoice.informationField={attributeValues:informationFieldsElementsErrors};}}var waybillError=get(data,\"\".concat(waybill,\".errors\"));if(waybillError)errors.waybill=waybillError[0];var operationInformationError=get(data,\"\".concat(waybill,\".transferDetails.operationInformation.errors\"));if(operationInformationError)errors.operationInformation=operationInformationError[0];var transferDetailsBasisError=get(data,\"\".concat(waybill,\".transferDetails.basis\"));if(transferDetailsBasisError){set(errors,'transferDetails.basis',transferDetailsBasisError);}var transferDetailsOperationInformationError=get(data,\"\".concat(waybill,\".transferDetails.operationInformation\"));if(transferDetailsOperationInformationError){set(errors,'transferDetails.operationInformation',transferDetailsOperationInformationError);}var passedByErrors=get(data,\"\".concat(waybill,\".transferDetails.passedBy\"));if(passedByErrors){set(errors,'transferDetails.passedBy',passedByErrors);}var carrierErrors=get(data,\"\".concat(waybill,\".transferDetails.transportation.carrier\"));if(carrierErrors){set(errors,'transferDetails.transportation.carrier.',carrierErrors);}var informationBasisError=get(data,\"\".concat(invoice,\".information.basis.errors\"));if(informationBasisError){set(errors,'information.basis',informationBasisError[0]);}var goodsErrors=get(data,\"\".concat(goods));if(goodsErrors){for(var item in goodsErrors){if(goodsErrors[item].measurementCode){goodsErrors[item].measurement=goodsErrors[item].measurementCode;}}errors.goods=goodsErrors;}this.setState({showSaveDocumentModal:true,errors:errors});}},{key:\"handleSubmitSuccess\",value:function handleSubmitSuccess(res){if(res.data&&res.data.success){var redirectUrl=DOCUMENT_VIEW.replace(':id',res.data.id);this.setState({isFormSentSuccessfully:true,isBusy:false,redirectUrl:redirectUrl,errors:null,showSaveDocumentModal:false});}}},{key:\"getAutocompleteValue\",value:function getAutocompleteValue(DomainVO,formData){var value=formData[DomainVO.field];if(!value)return Promise.resolve(null);if(this.fieldValueIsNotChosenFromDropdown(value)){return AutocompleteService[DomainVO.field].request(value).then(AutocompleteService.handleUserInput(DomainVO));}else{return Promise.resolve(new DomainVO(value));}}},{key:\"sortArrayGroupData\",value:function sortArrayGroupData(data){var sortedState=[];var sortedData=Object.values(data).reduce(function(itemsStore,item,index){itemsStore[index]=item;sortedState.push(item);return itemsStore;},{});return{sortedData:sortedData,sortedState:sortedState};}},{key:\"formatBasisTypeFields\",value:function formatBasisTypeFields(basisTypeFields){if(!basisTypeFields){return{0:_defineProperty({},BasisDocName.field,BasisDocNameEmptyOption.title)};}var formattedBasisTypeFields=[];Object.values(basisTypeFields).forEach(function(el){if(!el[BasisDocName.field]){formattedBasisTypeFields.push(_defineProperty({},BasisDocName.field,BasisDocNameEmptyOption.title));}else{formattedBasisTypeFields.push(el);}});return formattedBasisTypeFields;}},{key:\"processFormData\",value:function(){var _processFormData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(rawFormData){var _this$state$selectedD,paymentDocumentsSorted,infoFieldsSorted,formData,outputObj,division,recipient,invoice,information,shipmentDocuments,currency,informationBasis,goods,total,waybill;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;delete rawFormData.paymentDocuments;paymentDocumentsSorted=this.sortArrayGroupData(this.state.paymentDocuments);set(rawFormData,'invoice.paymentDocuments',paymentDocumentsSorted.sortedData);this.setState({paymentDocuments:paymentDocumentsSorted.sortedState});delete rawFormData.infoFields;infoFieldsSorted=this.sortArrayGroupData(this.state.infoFields);set(rawFormData,'invoice.informationField.attributeValues',infoFieldsSorted.sortedData);this.setState({infoFields:infoFieldsSorted.sortedState});formData=removeEmpty(rawFormData);outputObj={};outputObj.purpose=formData.purpose;outputObj.force=formData.force;outputObj.from={division:(_this$state$selectedD=this.state.selectedDivision.id)!==null&&_this$state$selectedD!==void 0?_this$state$selectedD:Core.company.mainDepartment.id};if(!formData.recipient){_context.next=24;break;}division=undefined;if(!(typeof formData.recipient==='string')){_context.next=22;break;}console.log('string recipient ',formData.recipient);_context.next=20;return this.getRecipientByTitle(formData.recipient);case 20:recipient=_context.sent;if(recipient){division=Number(recipient.id);}case 22:if(typeof formData.recipient==='object'&&formData.recipient.id){console.log('object recipient ',formData.recipient);division=Number(formData.recipient.id);}if(division){outputObj.to={division:division};}case 24:outputObj.document={economicSubjectName:formData.economicSubjectName,basisName:formData.basisName};invoice=formData.invoice||{};information=formData.information||{};shipmentDocuments=formData.shipmentDocuments;_context.prev=28;_context.next=31;return this.getAutocompleteValue(Currency,formData);case 31:currency=_context.sent;if(currency){invoice.currencyCode=currency.code.value;information.currencyName=currency.title;if(formData.exchangeRate&&!this.state.isExchangeRateFieldHidden){information.currencyExchangeRate=formData.exchangeRate;}}_context.next=38;break;case 35:_context.prev=35;_context.t0=_context[\"catch\"](28);console.log(_context.t0);case 38:if(shipmentDocuments){invoice.shipmentDocuments=[shipmentDocuments];}informationBasis=information===null||information===void 0?void 0:information.basis;if(informationBasis){information.basis=this.formatBasisTypeFields(informationBasis);}if(Object.keys(information).length)invoice.information=information;outputObj.document.invoice=invoice;goods=formData.goods;goods.forEach(function(good){if(good.measurementCode&&(!good.information||!good.information.measurementTitle)){if(!good.information){good.information={};}good.information.measurementTitle=good.measurementCode;good.measurementCode='0000';}});if(goods){total={};total.totalCostBeforeTax=formData.totalCostBeforeTax;total.totalCostAfterTax=formData.totalCostAfterTax;total.totalAmountOfTax=formData.totalAmountOfTax;outputObj.document.table={goods:goods,total:total};}if(formData.purpose!==InvoicePurpose.value&&(this.state.transferDetails||formData.operationInformation)){waybill={transferDetails:{}};if(this.state.transferDetails){waybill.transferDetails=this.state.transferDetails;waybill.transferDetails.basis=this.formatBasisTypeFields(this.state.transferDetails.basis);}outputObj.document.waybill=waybill;}if(formData.purpose===WaybillPurpose.value&&formData.name){outputObj.document.name=formData.name;}return _context.abrupt(\"return\",outputObj);case 51:_context.prev=51;_context.t1=_context[\"catch\"](0);throw createError(DOCUMENT_ERROR,'Ошибка processFormData для формы создания УПД.',_context.t1);case 54:case\"end\":return _context.stop();}}},_callee,this,[[0,51],[28,35]]);}));function processFormData(_x){return _processFormData.apply(this,arguments);}return processFormData;}()},{key:\"renderRedirect\",value:function renderRedirect(url){window.location=url;}},{key:\"showSuccessMsg\",value:function showSuccessMsg(){Flash.success(SUCCESS_SAVE_FORM);}},{key:\"decorateCurrency\",value:function(){var _decorateCurrency=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(serverResponse){var invoice,currencyCode,serverResponseCurrency;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:invoice=this.isDocumentDuplicate?serverResponse.parameters.invoice:serverResponse.formData.document.invoice;currencyCode=invoice.currencyCode;if(!currencyCode){_context2.next=7;break;}_context2.next=5;return AutocompleteService.currencyByCode.request(currencyCode);case 5:serverResponseCurrency=_context2.sent;if(serverResponseCurrency.rows.length===1){serverResponse.currency=new Currency(serverResponseCurrency.rows[0]);}case 7:case\"end\":return _context2.stop();}}},_callee2,this);}));function decorateCurrency(_x2){return _decorateCurrency.apply(this,arguments);}return decorateCurrency;}()},{key:\"getRecipientByTitle\",value:function(){var _getRecipientByTitle=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(title){var recipient;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(title){_context3.next=2;break;}return _context3.abrupt(\"return\",Promise.resolve(null));case 2:_context3.next=4;return AutocompleteService.recipient.request(title).then(function(recipients){return recipients.rows.filter(function(item){return item.title.toLowerCase().includes(title.toLowerCase());});}).then(function(filteredRecipients){if(filteredRecipients.length===1)return filteredRecipients[0];var exactMatch=filteredRecipients.find(function(item){return item.title.toLowerCase()===title.toLowerCase();});return exactMatch||null;});case 4:recipient=_context3.sent;return _context3.abrupt(\"return\",recipient);case 6:case\"end\":return _context3.stop();}}},_callee3);}));function getRecipientByTitle(_x3){return _getRecipientByTitle.apply(this,arguments);}return getRecipientByTitle;}()},{key:\"decorateRecipient\",value:function(){var _decorateRecipient=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(serverResponse){var _serverResponse$this$,_serverResponse$param,_serverResponse$param2,resArr,_ref2,name,inn,recipients,_recipients$rows,rows,division,_recipients;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;if((_serverResponse$this$=serverResponse[this.responcePathFirstSegment])===null||_serverResponse$this$===void 0?void 0:_serverResponse$this$.to){_context4.next=3;break;}return _context4.abrupt(\"return\");case 3:if(!this.isDocumentDuplicate){_context4.next=13;break;}// TODO check buyers\nresArr=(serverResponse===null||serverResponse===void 0?void 0:(_serverResponse$param=serverResponse.parameters)===null||_serverResponse$param===void 0?void 0:(_serverResponse$param2=_serverResponse$param.invoice)===null||_serverResponse$param2===void 0?void 0:_serverResponse$param2.buyers)||[];_ref2=resArr[0]||{},name=_ref2.name,inn=_ref2.inn;_context4.next=8;return AutocompleteService.recipient.request();case 8:recipients=_context4.sent;_recipients$rows=recipients.rows,rows=_recipients$rows===void 0?[]:_recipients$rows;serverResponse[Recipient.field]=rows.find(function(value){return value.title.includes(name)||value.title.includes(inn);});_context4.next=19;break;case 13:// TODO process person\ndivision=serverResponse.formData.to.division;if(!division){_context4.next=19;break;}_context4.next=17;return AutocompleteService.recipient.request();case 17:_recipients=_context4.sent;serverResponse[Recipient.field]=_recipients.rows.find(function(value){return value.id===division;});case 19:_context4.next=24;break;case 21:_context4.prev=21;_context4.t0=_context4[\"catch\"](0);console.log('err',_context4.t0);case 24:case\"end\":return _context4.stop();}}},_callee4,this,[[0,21]]);}));function decorateRecipient(_x4){return _decorateRecipient.apply(this,arguments);}return decorateRecipient;}()},{key:\"decorateMeasurement\",value:function(){var _decorateMeasurement=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(serverResponse){var _this3=this;var goods,newServerResponse;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:goods=get(serverResponse,\"\".concat(this.responsePathEntry,\".table.goods\"));if(goods){_context5.next=3;break;}return _context5.abrupt(\"return\");case 3:newServerResponse=serverResponse;goods.forEach(function(good,index){var measurementTitle=get(good,'information.measurementTitle');newServerResponse=setImmutable(newServerResponse,\"\".concat(_this3.responsePathEntry,\".table.goods.\").concat(index,\".measurementCode\"),measurementTitle);});return _context5.abrupt(\"return\",newServerResponse);case 6:case\"end\":return _context5.stop();}}},_callee5,this);}));function decorateMeasurement(_x5){return _decorateMeasurement.apply(this,arguments);}return decorateMeasurement;}()},{key:\"getCustomGoodsData\",value:function getCustomGoodsData(builder,serverResponse){var _this4=this;var serverResponseGoods=get(serverResponse,\"\".concat(this.responsePathEntry,\".table.goods\"));var localStateGoods=get(builder._component.state,'goods');if(serverResponseGoods&&!localStateGoods){var newValuesForState={};serverResponseGoods.forEach(function(good,index){var measurementTitle=get(builder._component.state,\"goods.\".concat(index,\".information.measurementTitle\"));if(!measurementTitle){var newMeasurementTitle=get(good,'information.measurementTitle');if(newMeasurementTitle){var newMeasurementData={information:{measurementTitle:newMeasurementTitle},measurementCode:get(_this4.serverResponse,\"\".concat(_this4.responsePathEntry,\".table.goods.\").concat(index,\".measurementCode\"))};newValuesForState=setImmutable(newValuesForState,\"goods.\".concat(index),newMeasurementData);}}var currentInfoFields=get(builder._component.state,\"goods.\".concat(index,\".infoFields\"));if(!currentInfoFields||!Object.entries(currentInfoFields).length){var newInfoFields=get(good,\"infoFields\");if(newInfoFields&&newInfoFields.length){newValuesForState=setImmutable(newValuesForState,\"goods.\".concat(index,\".infoFields\"),newInfoFields);}}var currentInformation=get(builder._component.state,\"goods.\".concat(index,\".information\"));if(!currentInformation||!Object.entries(currentInformation).length){var newInformation=get(good,\"information\");if(newInformation){newValuesForState=setImmutable(newValuesForState,\"goods.\".concat(index,\".information\"),newInformation);}}var currentIdentificationNumbers=get(builder._component.state,\"goods.\".concat(index,\".information.identificationNumbers\"));if(!currentIdentificationNumbers||!Object.entries(currentIdentificationNumbers).length){var newIdentificationNumbers=get(good,\"information.identificationNumbers\");if(newIdentificationNumbers&&newIdentificationNumbers.length){newValuesForState=setImmutable(newValuesForState,\"goods.\".concat(index,\".information.identificationNumbers\"),newIdentificationNumbers);}}var currentTracking=get(builder._component.state,\"goods.\".concat(index,\".information.tracking\"));if(!currentTracking||!Object.entries(currentTracking).length){var newTracking=get(good,\"information.tracking\");if(newTracking&&newTracking.length){newValuesForState=setImmutable(newValuesForState,\"goods.\".concat(index,\".information.tracking\"),newTracking);}}});if(Object.entries(newValuesForState).length){builder.setDataToComponentState(_objectSpread({},newValuesForState));}}}},{key:\"getCustomData\",value:function getCustomData(builder,serverResponse){var newValuesForState={};var paymentDocuments=get(serverResponse,\"\".concat(this.responsePathEntry,\".invoice.paymentDocuments\"));if(paymentDocuments)paymentDocuments=Object.entries(paymentDocuments);if(paymentDocuments&&paymentDocuments.length&&Object.entries(this.state.paymentDocuments).length===0){newValuesForState.paymentDocuments=paymentDocuments;}var infoFields=get(serverResponse,\"\".concat(this.responsePathEntry,\".invoice.informationField.attributeValues\"));if(infoFields)infoFields=Object.entries(infoFields);if(infoFields&&infoFields.length&&Object.entries(this.state.infoFields).length===0){newValuesForState.infoFields=infoFields;}if(Object.keys(newValuesForState).length){this.setState(_objectSpread({},newValuesForState));}}},{key:\"getDocumentTypeState\",value:function getDocumentTypeState(purpose){return{isInvoice:purpose===InvoicePurpose.value,isWaybill:purpose===WaybillPurpose.value,isInvoiceWaybill:purpose===InvoiceWaybillPurpose.value};}},{key:\"getData\",value:function(){var _getData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var _this5=this;var _this$serverResponse,_this$serverResponse$,_this$serverResponse$2,document,formattedDivisions,_formattedDivisions$f,_formattedDivisions$f2,selectedDivision;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;_context6.next=3;return UPDService.get(this.props.id);case 3:this.serverResponse=_context6.sent;if(this.serverResponse.formData===null)this.isDocumentDuplicate=true;this.responsePathEntry=this.isDocumentDuplicate?'parameters':'formData.document';this.responcePathFirstSegment=this.isDocumentDuplicate?'parameters':'formData';_context6.next=9;return this.decorateCurrency(this.serverResponse);case 9:_context6.next=11;return this.decorateRecipient(this.serverResponse);case 11:_context6.next=13;return this.decorateMeasurement(this.serverResponse);case 13:document=_context6.sent;_context6.next=16;return this.getDivisions();case 16:formattedDivisions=_context6.sent;_formattedDivisions$f=formattedDivisions.filter(function(division){return division.id===get(_this5.serverResponse,'formData.from.division');}),_formattedDivisions$f2=_slicedToArray(_formattedDivisions$f,1),selectedDivision=_formattedDivisions$f2[0];this.setState(_objectSpread(_objectSpread({isLoading:false,isError:false,document:document},this.getDocumentTypeState(this.serverResponse[this.responcePathFirstSegment].purpose)),{},{paymentDocuments:get(this.serverResponse,\"\".concat(this.responsePathEntry,\".invoice.paymentDocuments\")),infoFields:get(this.serverResponse,\"\".concat(this.responsePathEntry,\".invoice.informationField.attributeValues\")),isExchangeRateFieldHidden:((_this$serverResponse=this.serverResponse)===null||_this$serverResponse===void 0?void 0:(_this$serverResponse$=_this$serverResponse.currency)===null||_this$serverResponse$===void 0?void 0:(_this$serverResponse$2=_this$serverResponse$.letterCode)===null||_this$serverResponse$2===void 0?void 0:_this$serverResponse$2.value)===Currency.initialValue.letterCode.value,divisions:formattedDivisions,selectedDivision:selectedDivision}));_context6.next=25;break;case 21:_context6.prev=21;_context6.t0=_context6[\"catch\"](0);console.log('error',_context6.t0);this.setState({isLoading:false,isError:true});case 25:case\"end\":return _context6.stop();}}},_callee6,this,[[0,21]]);}));function getData(){return _getData.apply(this,arguments);}return getData;}()},{key:\"getDivisions\",value:function(){var _getDivisions=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(isNewDoc){var divisions,formattedDivisions;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.prev=0;_context7.next=3;return Environment.getCompanyGateway().getDivisions();case 3:divisions=_context7.sent;formattedDivisions=divisions.rows.map(function(division){return{id:division.id,title:division.title};});formattedDivisions.forEach(function(item){if(item.id===Core.company.mainDepartment.id){formattedDivisions.splice(formattedDivisions.indexOf(item),1);formattedDivisions.splice(0,0,item);}});if(isNewDoc){this.setState(function(){return{divisions:formattedDivisions!==null&&formattedDivisions!==void 0?formattedDivisions:[],selectedDivision:formattedDivisions[0]};});}return _context7.abrupt(\"return\",formattedDivisions);case 10:_context7.prev=10;_context7.t0=_context7[\"catch\"](0);console.error(_context7.t0);case 13:case\"end\":return _context7.stop();}}},_callee7,this,[[0,10]]);}));function getDivisions(_x6){return _getDivisions.apply(this,arguments);}return getDivisions;}()},{key:\"componentDidMount\",value:function componentDidMount(){if(this.props.id){this.getData();}else{this.getDivisions(true);}}},{key:\"componentDidCatch\",value:function componentDidCatch(error,errorInfo){console.log('React error:',error);}},{key:\"shouldComponentUpdate\",value:function shouldComponentUpdate(nextProps,nextState){// TODO optimize performance\nreturn true;}},{key:\"render\",value:function render(){if(this.state.redirectUrl){return this.renderRedirect(this.state.redirectUrl);}if(this.state.isLoading)return/*#__PURE__*/React.createElement(Loading,{height:\"75vh\"});if(this.state.isError)return/*#__PURE__*/React.createElement(\"span\",null,\"\\u0412\\u043E\\u0437\\u043D\\u0438\\u043A\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430\");return this.createForm();}}]);return UPDForm;}(FormBase),(_applyDecoratedDescriptor(_class.prototype,\"showServerErrorsInForm\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"showServerErrorsInForm\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"handleError\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"handleError\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"handleSubmitSuccess\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"handleSubmitSuccess\"),_class.prototype)),_class);UPDForm.defaultValues={id:null};UPDForm.propsTypes={id:PropTypes.string};export default UPDForm;","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/upd/forms/UPDForm.js"],"names":["React","FormBase","FormBuilder","Invoice","DateInvoice","NumInvoice","Correct","DateCorrect","NumberCorrect","Currency","Recipient","EconomicSubjectName","ExchangeRate","Flash","Core","AutocompleteService","SAVE","SUCCESS_SAVE_FORM","PaymentDocument","CargoFrom","CargoTo","Purpose","InvoicePurpose","WaybillPurpose","InvoiceWaybillPurpose","Carrier","Name","InformationBasisType","ShipmentDocuments","BasisDocName","BasisDocNumber","BasisDocDate","BasisInformation","BasisDocId","BasisDocNameEmptyOption","InfoFieldFact1","BasisName","styles","TOP","Behavior","Appearance","createError","autobind","DOCUMENT_VIEW","DOCUMENT","DOCUMENT_ERROR","PropTypes","UPDService","get","set","setObject","setImmutable","wrap","clone","removeEmpty","Loading","ParticipantForm","Factor","InvoiceTableForm","ArrayGroup","PassedByForm","TransportationAndCargoModal","TransportationAndCargo","skipArgs","Environment","DivisionSelect","Division","UPDForm","props","state","redirectUrl","document","isLoading","id","isError","showSaveDocumentModal","errors","getDocumentTypeState","value","paymentDocuments","infoFields","isExchangeRateFieldHidden","divisions","selectedDivision","transferDetails","isDocumentDuplicate","responsePathEntry","responcePathFirstSegment","BASE_WIDTH","MARGIN","defaultBehavior","defaultAppearance","width","builder","requiredBehavior","isRequired","serverResponse","getCustomData","getCustomGoodsData","getErrors","errorsObjPath","_component","clearFieldError","path","Array","isArray","length","setState","updatedErrors","getBehavior","scope","mixin","initialFieldDomain","handleArrayGroupErrorsChange","newErrors","allErrors","updatedComponentStateErrors","buildGroup","field","buildInput","buildDateInput","align","customClasses","width100","getPurpose","onPurposeChange","purpose","purposeBehavior","onChange","buildSelect","content","push","companyINN","company","inn","companyKPP","kpp","economicSubjectNameInitialValue","name","economicSubjectNameBehavior","hasDivisions","buildInfo","undefined","filterLegalEntities","res","filter","item","type","buildAutocomplete","setDataToFormState","data","formState","merge","factor","cargoFromInitialValues","consigneeInitialValues","consignee","isInvoice","hiddenAndZeroHeight","carrier","passedBy","clearTransportationAndCargoModalState","updatedDocument","operationInformation","basis","waybill","handleCurrencyChange","letter_code","initialValue","letterCode","behaviorCurrency","currency","isWaybill","withRequiredView","DATE_WIDTH","basisBehaviors","basisFieldsAppearance","basisAppearances","build","buildLoader","buildSubmit","buildForm","getForm","errorCb","error","isEdit","edit","create","invoice","consignor","goods","purposeError","toError","recipient","economicSubjectNameError","economicSubjectName","signorPositionError","unshift","showServerErrorsInForm","global","nameError","numberError","number","dateError","date","paymentDocumentsError","paymentDocumentsElementsErrors","consignorErrors","consigneeErrors","factorErrors","currencyCodeError","currencyNameError","exchangeRateError","exchangeRate","informationFieldsElementsErrors","informationField","attributeValues","waybillError","operationInformationError","transferDetailsBasisError","transferDetailsOperationInformationError","passedByErrors","carrierErrors","informationBasisError","goodsErrors","measurementCode","measurement","success","replace","isFormSentSuccessfully","isBusy","DomainVO","formData","Promise","resolve","fieldValueIsNotChosenFromDropdown","request","then","handleUserInput","sortedState","sortedData","Object","values","reduce","itemsStore","index","basisTypeFields","title","formattedBasisTypeFields","forEach","el","rawFormData","paymentDocumentsSorted","sortArrayGroupData","infoFieldsSorted","outputObj","force","from","division","mainDepartment","console","log","getRecipientByTitle","Number","to","basisName","information","shipmentDocuments","getAutocompleteValue","currencyCode","code","currencyName","currencyExchangeRate","informationBasis","formatBasisTypeFields","keys","good","measurementTitle","total","totalCostBeforeTax","totalCostAfterTax","totalAmountOfTax","table","url","window","location","parameters","currencyByCode","serverResponseCurrency","rows","recipients","toLowerCase","includes","filteredRecipients","exactMatch","find","resArr","buyers","newServerResponse","serverResponseGoods","localStateGoods","newValuesForState","newMeasurementTitle","newMeasurementData","currentInfoFields","entries","newInfoFields","currentInformation","newInformation","currentIdentificationNumbers","newIdentificationNumbers","currentTracking","newTracking","setDataToComponentState","isInvoiceWaybill","decorateCurrency","decorateRecipient","decorateMeasurement","getDivisions","formattedDivisions","isNewDoc","getCompanyGateway","map","splice","indexOf","getData","errorInfo","nextProps","nextState","renderRedirect","createForm","defaultValues","propsTypes","string"],"mappings":"g3DAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,QAAP,KAAqB,+BAArB,CACA,MAAOC,CAAAA,WAAP,KAAwB,oDAAxB,CAEA,MAAOC,CAAAA,OAAP,KAAoB,oDAApB,CACA,MAAOC,CAAAA,WAAP,KAAwB,yDAAxB,CACA,MAAOC,CAAAA,UAAP,KAAuB,wDAAvB,CAEA,MAAOC,CAAAA,OAAP,KAAoB,oDAApB,CACA,MAAOC,CAAAA,WAAP,KAAwB,yDAAxB,CACA,MAAOC,CAAAA,aAAP,KAA0B,2DAA1B,CAEA,MAAOC,CAAAA,QAAP,KAAqB,qDAArB,CACA,MAAOC,CAAAA,SAAP,KAAsB,gEAAtB,CACA,MAAOC,CAAAA,mBAAP,KAAgC,gEAAhC,CACA,MAAOC,CAAAA,YAAP,KAAyB,kEAAzB,CAEA,MAAOC,CAAAA,KAAP,KAAkB,6BAAlB,CACA,MAAOC,CAAAA,IAAP,KAAiB,qCAAjB,CACA,MAAOC,CAAAA,mBAAP,KAAgC,iEAAhC,CACA,OAASC,IAAT,CAAeC,iBAAf,KAAwC,qBAAxC,CAEA,MAAOC,CAAAA,eAAP,KAA4B,qFAA5B,CACA,MAAOC,CAAAA,SAAP,KAAsB,8DAAtB,CACA,MAAOC,CAAAA,OAAP,KAAoB,4DAApB,CACA,MAAOC,CAAAA,OAAP,KAAoB,oDAApB,CACA,MAAOC,CAAAA,cAAP,KAA2B,4DAA3B,CACA,MAAOC,CAAAA,cAAP,KAA2B,4DAA3B,CACA,MAAOC,CAAAA,qBAAP,KAAkC,mEAAlC,CAEA,MAAOC,CAAAA,OAAP,KAAoB,qEAApB,CACA,MAAOC,CAAAA,IAAP,KAAiB,iDAAjB,CAEA,MAAOC,CAAAA,oBAAP,KAAiC,yEAAjC,CACA,MAAOC,CAAAA,iBAAP,KAA8B,sEAA9B,CACA,MAAOC,CAAAA,YAAP,KAAyB,wEAAzB,CACA,MAAOC,CAAAA,cAAP,KAA2B,0EAA3B,CACA,MAAOC,CAAAA,YAAP,KAAyB,wEAAzB,CACA,MAAOC,CAAAA,gBAAP,KAA6B,4EAA7B,CACA,MAAOC,CAAAA,UAAP,KAAuB,sEAAvB,CACA,MAAOC,CAAAA,uBAAP,KAAoC,mFAApC,CAEA,MAAOC,CAAAA,cAAP,KAA2B,mEAA3B,CAEA,MAAOC,CAAAA,SAAP,KAAsB,sDAAtB,CAEA,MAAOC,CAAAA,MAAP,KAAmB,+DAAnB,CACA,OAASC,GAAT,KAAoB,2BAApB,CACA,MAAOC,CAAAA,QAAP,KAAqB,0CAArB,CACA,MAAOC,CAAAA,UAAP,KAAuB,4CAAvB,CACA,MAAOC,CAAAA,WAAP,KAAwB,mDAAxB,CACA,MAAOC,CAAAA,QAAP,KAAqB,oBAArB,CACA,OAASC,aAAT,KAA8B,qBAA9B,CACA,OAASC,QAAQ,GAAIC,CAAAA,cAArB,KAA2C,4CAA3C,CACA,MAAOC,CAAAA,SAAP,KAAsB,YAAtB,CACA,MAAOC,CAAAA,UAAP,KAAuB,yDAAvB,CACA,MAAOC,CAAAA,GAAP,KAAgB,WAAhB,CACA,MAAOC,CAAAA,GAAP,KAAgB,WAAhB,CACA,MAAOC,CAAAA,SAAP,KAAsB,aAAtB,CACA,OAASD,GAAG,GAAIE,CAAAA,YAAhB,CAA8BC,IAA9B,KAA0C,uBAA1C,CACA,OAASC,KAAT,CAAgBC,WAAhB,KAAmC,2BAAnC,CACA,OAASC,OAAT,KAAwB,qBAAxB,CACA,MAAOC,CAAAA,eAAP,KAA4B,2BAA5B,CACA,MAAOC,CAAAA,MAAP,KAAmB,0DAAnB,CACA,MAAOC,CAAAA,gBAAP,KAA6B,uCAA7B,CACA,MAAOC,CAAAA,UAAP,KAAuB,cAAvB,CACA,MAAOC,CAAAA,YAAP,KAAyB,gBAAzB,CACA,MAAOC,CAAAA,2BAAP,KAAwC,+BAAxC,CACA,MAAOC,CAAAA,sBAAP,KAAmC,4EAAnC,CACA,MAAOC,CAAAA,QAAP,KAAqB,yBAArB,CAEA,MAAOC,CAAAA,WAAP,KAAwB,4CAAxB,CACA,MAAOC,CAAAA,cAAP,KAA2B,kBAA3B,CACA,MAAOC,CAAAA,QAAP,KAAqB,qDAArB,C,GAEMC,CAAAA,O,wGACJ,iBAAYC,KAAZ,CAAmB,yCACjB,uBAAMA,KAAN,EACA,MAAKC,KAAL,8CACK,MAAKA,KADV,MAEEC,WAAW,CAAE,EAFf,CAGEC,QAAQ,CAAE,IAHZ,CAIEC,SAAS,CAAE,CAAC,CAACJ,KAAK,CAACK,EAJrB,CAKEC,OAAO,CAAE,KALX,CAMEC,qBAAqB,CAAE,KANzB,CAOEC,MAAM,CAAE,IAPV,EAQK,MAAKC,oBAAL,CAA0BvD,cAAc,CAACwD,KAAzC,CARL,MASEC,gBAAgB,CAAE,EATpB,CAUEC,UAAU,CAAE,EAVd,CAWEC,yBAAyB,CAAE,IAX7B,CAYEC,SAAS,CAAE,EAZb,CAaEC,gBAAgB,CAAE,IAbpB,CAcEC,eAAe,CAAE,IAdnB,GAiBA,MAAKC,mBAAL,CAA2B,KAA3B,CACA,MAAKC,iBAAL,CAAyB,IAAzB,CACA,MAAKC,wBAAL,CAAgC,IAAhC,CArBiB,aAsBlB,C,mEAEY,+WACX,GAAMC,CAAAA,UAAU,CAAG,GAAnB,CACA,GAAMC,CAAAA,MAAM,CAAG,CAAf,CACA,GAAMC,CAAAA,eAAe,CAAG,GAAInD,CAAAA,QAAJ,EAAxB,CACA,GAAMoD,CAAAA,iBAAiB,CAAG,GAAInD,CAAAA,UAAJ,CAAe,CAAEoD,KAAK,CAAEJ,UAAU,CAAGC,MAAtB,CAAf,CAA1B,CAEA,GAAMI,CAAAA,OAAO,CAAG,GAAI3F,CAAAA,WAAJ,CAAgB,IAAhB,CAAsBwF,eAAtB,CAAuCC,iBAAvC,CAAhB,CAEA,GAAMG,CAAAA,gBAAgB,CAAG,GAAIvD,CAAAA,QAAJ,CAAa,CAAEwD,UAAU,CAAE,IAAd,CAAb,CAAzB,CAEA,GAAMC,CAAAA,cAAc,CAAG,KAAK3B,KAAL,CAAWE,QAAlC,CAEA,KAAK0B,aAAL,CAAmBJ,OAAnB,CAA4BG,cAA5B,EACA,KAAKE,kBAAL,CAAwBL,OAAxB,CAAiCG,cAAjC,EACA,GAAMG,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,CAAAC,aAAa,CAAI,CACjC,MAAO/C,CAAAA,KAAK,CAACL,GAAG,CAAC6C,OAAO,CAACQ,UAAT,wBAAqCD,aAArC,EAAJ,CAAZ,CACD,CAFD,CAGA,GAAME,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAAAC,IAAI,CAAI,CAC9B,GAAI3B,CAAAA,MAAM,CAAG5B,GAAG,CAAC6C,OAAO,CAACQ,UAAT,wBAAqCE,IAArC,EAAhB,CACA,GAAIC,KAAK,CAACC,OAAN,CAAc7B,MAAd,GAAyBA,MAAM,CAAC8B,MAApC,CAA4C,CAC1CxD,SAAS,CAAC0B,MAAD,wBAAyB2B,IAAzB,EAAiC,EAAjC,CAAT,CACAV,OAAO,CAACQ,UAAR,CAAmBM,QAAnB,CAA4B,CAAE/B,MAAM,CAANA,MAAF,CAA5B,EACD,CACD,GAAI,MAAOA,CAAAA,MAAP,GAAkB,QAAtB,CAAgC,CAC9BA,MAAM,CAAG5B,GAAG,CAAC6C,OAAO,CAACQ,UAAT,gBAAZ,CACA,GAAMO,CAAAA,aAAa,CAAGzD,YAAY,CAACyB,MAAD,CAAS2B,IAAT,CAAe,EAAf,CAAlC,CACAV,OAAO,CAACQ,UAAR,CAAmBM,QAAnB,CAA4B,CAAE/B,MAAM,CAAEgC,aAAV,CAA5B,EACD,CACF,CAXD,CAaA,GAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACnB,eAAD,CAAkBa,IAAlB,CAAuC,IAAfO,CAAAA,KAAe,2DAAP,EAAO,CACzD,MAAOd,CAAAA,cAAc,CACjBzD,QAAQ,CAACwE,KAAT,CAAerB,eAAf,CAAgC,CAC9BsB,kBAAkB,CAAE,CAClBlC,KAAK,CAAEgC,KAAK,CAAG7D,GAAG,CAAC,EAAD,CAAK6D,KAAL,CAAY9D,GAAG,CAACgD,cAAD,CAAiBO,IAAjB,CAAf,CAAN,CAA+CvD,GAAG,CAACgD,cAAD,CAAiBO,IAAjB,CAD5C,CADU,CAAhC,CADiB,CAMjBb,eANJ,CAOD,CARD,CAUA,GAAMuB,CAAAA,4BAA4B,CAAG,QAA/BA,CAAAA,4BAA+B,CAAAV,IAAI,QAAI,UAAAW,SAAS,CAAI,CACxD,GAAMC,CAAAA,SAAS,CAAG9D,KAAK,CAAC,MAAI,CAACgB,KAAL,CAAWO,MAAZ,CAAL,EAA4B,EAA9C,CACA,GAAMwC,CAAAA,2BAA2B,CAAGnE,GAAG,CAACkE,SAAD,CAAYZ,IAAZ,CAAkBW,SAAlB,CAAvC,CACA,MAAI,CAACP,QAAL,CAAc,CAAE/B,MAAM,CAAEwC,2BAAV,CAAd,EACD,CAJwC,EAAzC,CAMAvB,OAAO,CAACwB,UAAR,CACElH,OADF,6DAGKE,UAAU,CAACiH,KAHhB,CAGwBzB,OAAO,CAAC0B,UAHhC,sCAIKnH,WAAW,CAACkH,KAJjB,CAIyBzB,OAAO,CAAC2B,cAJjC,uBAMEX,WAAW,CAACnB,eAAD,WAAqB,KAAKJ,iBAA1B,aANb,CAOEK,iBAPF,+DASKtF,UAAU,CAACiH,KAThB,CASwBT,WAAW,CAC7Bf,gBAD6B,WAE1B,KAAKR,iBAFqB,oBATnC,uCAaKlF,WAAW,CAACkH,KAbjB,CAayBT,WAAW,CAACf,gBAAD,WAAsB,KAAKR,iBAA3B,kBAbpC,sFAgBKjF,UAAU,CAACiH,KAhBhB,CAgBwB,GAAI9E,CAAAA,UAAJ,CAAe,CACjCoD,KAAK,CAAEJ,UAAU,CAAG,GADa,CAEjCiC,KAAK,CAAEnF,GAF0B,CAAf,CAhBxB,uCAoBKlC,WAAW,CAACkH,KApBjB,CAoByB,GAAI9E,CAAAA,UAAJ,CAAe,CAClCoD,KAAK,CAAE,GAD2B,CAElC8B,aAAa,oBAAcrF,MAAM,CAACsF,QAArB,CAFqB,CAGlCF,KAAK,CAAEnF,GAH2B,CAAf,CApBzB,yBA4BAuD,OAAO,CAACwB,UAAR,CACE/G,OADF,+DAGKE,aAAa,CAAC8G,KAHnB,CAG2BzB,OAAO,CAAC0B,UAHnC,uCAIKhH,WAAW,CAAC+G,KAJjB,CAIyBzB,OAAO,CAAC2B,cAJjC,wBAMEX,WAAW,CAACnB,eAAD,WAAqB,KAAKJ,iBAA1B,wBANb,CAOEK,iBAPF,+DASKnF,aAAa,CAAC8G,KATnB,CAS2BT,WAAW,CAChCnB,eADgC,WAE7B,KAAKJ,iBAFwB,+BATtC,uCAaK/E,WAAW,CAAC+G,KAbjB,CAayBT,WAAW,CAC9BnB,eAD8B,WAE3B,KAAKJ,iBAFsB,6BAbpC,sFAmBK9E,aAAa,CAAC8G,KAnBnB,CAmB2B,GAAI9E,CAAAA,UAAJ,CAAe,CACpCoD,KAAK,CAAEJ,UAAU,CAAG,GADgB,CAEpCiC,KAAK,CAAEnF,GAF6B,CAAf,CAnB3B,uCAuBK/B,WAAW,CAAC+G,KAvBjB,CAuByB,GAAI9E,CAAAA,UAAJ,CAAe,CAClCoD,KAAK,CAAE,GAD2B,CAElC8B,aAAa,oBAAcrF,MAAM,CAACsF,QAArB,CAFqB,CAGlCF,KAAK,CAAEnF,GAH2B,CAAf,CAvBzB,yBA+BA,GAAMsF,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAAM,CACvB,GAAI5B,cAAJ,CAAoB,CAClB,OAAQhD,GAAG,CAACgD,cAAD,WAAoB,MAAI,CAACT,wBAAzB,aAAX,EACE,IAAKjE,CAAAA,cAAc,CAACwD,KAApB,CACE,MAAOxD,CAAAA,cAAP,CACF,IAAKC,CAAAA,cAAc,CAACuD,KAApB,CACE,MAAOvD,CAAAA,cAAP,CACF,IAAKC,CAAAA,qBAAqB,CAACsD,KAA3B,CACE,MAAOtD,CAAAA,qBAAP,CACF,QACE,MAAOF,CAAAA,cAAP,CARJ,CAUD,CAXD,IAWO,CACL,MAAOA,CAAAA,cAAP,CACD,CACF,CAfD,CAiBA,GAAMuG,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAAAC,OAAO,CAAI,CACjC,MAAI,CAACnB,QAAL,CAAc,MAAI,CAAC9B,oBAAL,CAA0BiD,OAA1B,CAAd,EACD,CAFD,CAGA,GAAMC,CAAAA,eAAe,CAAG,GAAIxF,CAAAA,QAAJ,CAAa,CACnCyE,kBAAkB,CAAEY,UAAU,EADK,CAEnCI,QAAQ,CAAEH,eAFyB,CAGnC9B,UAAU,CAAE,IAHuB,CAAb,CAAxB,CAKAF,OAAO,CAACoC,WAAR,CAAoB5G,OAApB,CAA6B0G,eAA7B,EAEAlC,OAAO,CAACqC,OAAR,CAAgBC,IAAhB,CAAqB,8BACnB,oBAAC,UAAD,EACE,QAAQ,CAAEjH,eADZ,CAEE,aAAa,CAAE,MAAI,CAACmD,KAAL,CAAWU,gBAF5B,CAGE,WAAW,CAAE,qBAAAA,gBAAgB,QAAI,CAAA,MAAI,CAAC4B,QAAL,CAAc,CAAE5B,gBAAgB,CAAhBA,gBAAF,CAAd,CAAJ,EAH/B,CAIE,mBAAmB,KAJrB,CAKE,eAAe,CAAC,OALlB,CAME,MAAM,CAAEoB,SAAS,CAACjF,eAAe,CAACoG,KAAjB,CANnB,CAOE,kBAAkB,CAAEL,4BAA4B,CAAC/F,eAAe,CAACoG,KAAjB,CAPlD,EADmB,EAArB,EAYA,GAAMc,CAAAA,UAAU,CAAG,gBAAAtH,IAAI,CAACuH,OAAL,yEAAcC,GAAd,8DAAmBxD,KAAnB,kDAAqChE,IAAI,CAACuH,OAA1C,6DAAqC,eAAcC,GAAnD,6CAAqC,mBAAmBxD,KAAxD,EAAkE,EAArF,CACA,GAAMyD,CAAAA,UAAU,CAAG,iBAAAzH,IAAI,CAACuH,OAAL,4EAAcG,GAAd,gEAAmB1D,KAAnB,kDAAqChE,IAAI,CAACuH,OAA1C,6DAAqC,eAAcG,GAAnD,6CAAqC,mBAAmB1D,KAAxD,EAAkE,EAArF,CACA,GAAM2D,CAAAA,+BAA+B,CAAGzC,cAAc,CAClDhD,GAAG,CAACgD,cAAD,WAAoB,KAAKV,iBAAzB,yBAD+C,2BAE/CxE,IAAI,CAACuH,OAF0C,yCAE/C,eAAcK,IAFiC,SAE1BN,UAF0B,SAEbG,UAFa,CAAtD,CAIA,GAAMI,CAAAA,2BAA2B,CAAG,GAAIpG,CAAAA,QAAJ,CAAa,CAC/CyE,kBAAkB,CAAE,CAClBlC,KAAK,CAAE2D,+BADW,CAD2B,CAI/C1C,UAAU,CAAE,IAJmC,CAAb,CAApC,CAOA,GAAM6C,CAAAA,YAAY,CAAG,KAAKvE,KAAL,CAAWa,SAAX,CAAqBwB,MAArB,CAA8B,CAAnD,CAEAb,OAAO,CAACqC,OAAR,CAAgBC,IAAhB,CAAqB,8BACnB,oBAAC,cAAD,EACE,QAAQ,CAAEjE,QADZ,CAEE,OAAO,CAAE,MAAI,CAACG,KAAL,CAAWa,SAFtB,CAGE,QAAQ,CAAE,MAAI,CAACb,KAAL,CAAWc,gBAHvB,CAIE,WAAW,CAAE,qBAAAA,gBAAgB,QAAI,CAAA,MAAI,CAACwB,QAAL,CAAc,CAAExB,gBAAgB,CAAhBA,gBAAF,CAAd,CAAJ,EAJ/B,CAKE,SAAS,CAAEyD,YALb,EADmB,EAArB,EAUA/C,OAAO,CAACgD,SAAR,CAAkBlI,mBAAlB,CAAuCgI,2BAAvC,CAAoEG,SAApE,CAA+EF,YAA/E,EAEA,GAAMG,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,CAAAC,GAAG,QAAIA,CAAAA,GAAG,CAACC,MAAJ,CAAW,SAAAC,IAAI,QAAIA,CAAAA,IAAI,CAACC,IAAL,GAAc,UAAlB,EAAf,CAAJ,EAA/B,CACAtD,OAAO,CAACuD,iBAAR,OAAAvD,OAAO,EACLnF,SADK,CAELmG,WAAW,CACT,GAAItE,CAAAA,QAAJ,CAAa,CAAEwD,UAAU,CAAE,IAAd,CAAoBiC,QAAQ,CAAE,0BAAM1B,CAAAA,eAAe,CAAC5F,SAAS,CAAC4G,KAAX,CAArB,EAA9B,CAAb,CADS,WAEN5G,SAAS,CAAC4G,KAFJ,WAFN,4BAMFvD,QAAQ,CAAC,CAAD,CANN,GAOLgF,mBAPK,GAAP,CAUA,GAAMM,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAAA9C,IAAI,QAAI,UAAA+C,IAAI,CAAI,CACzCrG,GAAG,CAAC4C,OAAO,CAAC0D,SAAT,kBAA8BhD,IAA9B,EAAsC+C,IAAtC,CAA4C,CAAEE,KAAK,CAAE,IAAT,CAA5C,CAAH,CACD,CAF8B,EAA/B,CAIA3D,OAAO,CAACqC,OAAR,CAAgBC,IAAhB,CAAqB,8BACnB,oBAAC,eAAD,EACE,QAAQ,CAAE1E,MADZ,CAEE,kBAAkB,CAAE4F,kBAAkB,CAAC,aAAD,CAFxC,CAGE,aAAa,CAAE,CACbI,MAAM,CAAEzG,GAAG,CAACgD,cAAD,WAAoB,MAAI,CAACV,iBAAzB,gCADE,CAHjB,CAME,MAAM,CAAE,CAAEmE,MAAM,CAAEtD,SAAS,CAAC,oBAAD,CAAnB,CANV,CAOE,eAAe,CAAEG,eAPnB,EADmB,EAArB,EAYA,GAAMoD,CAAAA,sBAAsB,CAAG1G,GAAG,CAChCgD,cADgC,WAE7B,KAAKV,iBAFwB,uBAAlC,CAIAO,OAAO,CAACqC,OAAR,CAAgBC,IAAhB,CAAqB,8BACnB,oBAAC,eAAD,EACE,QAAQ,CAAEhH,SADZ,CAEE,kBAAkB,CAAEkI,kBAAkB,CAAC,mBAAD,CAFxC,CAGE,KAAK,CAAE,WAHT,CAIE,aAAa,CACX,MAAI,CAAChE,mBAAL,CAA2BqE,sBAAsB,CAAC,CAAD,CAAjD,CAAuDA,sBAL3D,CAOE,MAAM,CAAEvD,SAAS,CAAC,mBAAD,CAPnB,CAQE,eAAe,CAAEG,eARnB,EADmB,EAArB,EAaA,GAAMqD,CAAAA,sBAAsB,CAAG3G,GAAG,CAChCgD,cADgC,WAE7B,KAAKV,iBAFwB,8BAEc,KAAKD,mBAAL,CAA2B,GAA3B,CAAiC,EAF/C,EAAlC,CAIAQ,OAAO,CAACqC,OAAR,CAAgBC,IAAhB,CAAqB,8BACnB,oBAAC,eAAD,EACE,QAAQ,CAAE/G,OADZ,CAEE,kBAAkB,CAAEiI,kBAAkB,CAAC,SAAD,CAFxC,CAGE,KAAK,CAAE,WAHT,CAIE,aAAa,CAAE,CACbO,SAAS,CAAE,MAAI,CAACvE,mBAAL,CAA2BsE,sBAAsB,CAAC,CAAD,CAAjD,CAAuDA,sBADrD,CAJjB,CAOE,MAAM,CAAE,CAAEC,SAAS,CAAEzD,SAAS,CAAC,WAAD,CAAtB,CAPV,CAQE,eAAe,CAAEG,eARnB,EADmB,EAArB,EAaAT,OAAO,CAACqC,OAAR,CAAgBC,IAAhB,CAAqB,8BACnB,oBAAC,eAAD,EACE,QAAQ,CAAE1G,OADZ,CAEE,kBAAkB,CAAE4H,kBAAkB,CAAC,gCAAD,CAFxC,CAGE,aAAa,CAAE,MAAI,CAAChF,KAAL,CAAWwF,SAAX,CAAuBxH,MAAM,CAACyH,mBAA9B,CAAoD,EAHrE,CAIE,aAAa,CAAE,CACbC,OAAO,CAAE/G,GAAG,CACVgD,cADU,WAEP,MAAI,CAACV,iBAFE,oDADC,CAJjB,CAUE,MAAM,CAAE,CAAEyE,OAAO,CAAE5D,SAAS,CAAC,wCAAD,CAApB,CAVV,CAWE,eAAe,CAAEG,eAXnB,EADmB,EAArB,EAgBAT,OAAO,CAACqC,OAAR,CAAgBC,IAAhB,CAAqB,8BACnB,oBAAC,YAAD,EACE,kBAAkB,CAAEkB,kBAAkB,CAAC,iBAAD,CADxC,CAEE,aAAa,CAAE,MAAI,CAAChF,KAAL,CAAWwF,SAAX,CAAuBxH,MAAM,CAACyH,mBAA9B,CAAoD,EAFrE,CAGE,aAAa,CAAE,CACbE,QAAQ,CAAEhH,GAAG,CACXgD,cADW,WAER,MAAI,CAACV,iBAFG,sCADA,CAHjB,CASE,MAAM,CAAE,CAAE0E,QAAQ,CAAE7D,SAAS,CAAC,0BAAD,CAArB,CATV,CAUE,eAAe,CAAEG,eAVnB,EADmB,EAArB,EAeA,GAAM2D,CAAAA,qCAAqC,CAAG,QAAxCA,CAAAA,qCAAwC,EAAM,CAClD,GAAMC,CAAAA,eAAe,CAAG9G,IAAI,CAAC,MAAI,CAACiB,KAAL,CAAWE,QAAZ,CAAJ,CACrBtB,GADqB,CACjB,gEADiB,CACiD,IADjD,EAErBA,GAFqB,CAEjB,iDAFiB,CAEkC,IAFlC,EAGrB6B,KAHqB,EAAxB,CAKA,MAAI,CAAC6B,QAAL,CAAc,CACZpC,QAAQ,CAAE2F,eADE,CAEZ9E,eAAe,CAAE,IAFL,CAAd,EAID,CAVD,CAYA;AACA;AACA;AACA;AACA;AACA;AAEAS,OAAO,CAACqC,OAAR,CAAgBC,IAAhB,CAAqB,2EACnB,oBAAC,2BAAD,EACE,QAAQ,CAAErE,sBADZ,CAEE,kBAAkB,CAAE,4BAAAsB,eAAe,QACjC,CAAA,MAAI,CAACuB,QAAL,CAAc,CACZvB,eAAe,CAAfA,eADY,CAAd,CADiC,EAFrC,CAOE,aAAa,CAAE,MAAI,CAACf,KAAL,CAAWwF,SAAX,CAAuBxH,MAAM,CAACyH,mBAA9B,CAAoD,EAPrE,CAQE,aAAa,CAAE,CACbK,oBAAoB,CAAEnH,GAAG,CACvBgD,cADuB,WAEpB,MAAI,CAACV,iBAFe,kDADZ,CAKb8E,KAAK,CAAEpH,GAAG,CAACgD,cAAD,WAAoB,MAAI,CAACV,iBAAzB,mCALG,CARjB,CAeE,MAAM,sBAAE,MAAI,CAACjB,KAAL,CAAWO,MAAb,8CAAE,oBAAmBQ,eAf7B,CAgBE,YAAY,uBAAE,MAAI,CAACf,KAAL,CAAWO,MAAb,+CAAE,qBAAmByF,OAhBnC,CAiBE,eAAe,CAAE/D,eAjBnB,CAkBE,gBAAgB,CAAE2D,qCAlBpB,EADmB,EAArB,EAuBA,GAAMK,CAAAA,oBAAoB,CAAG,QAAvBA,CAAAA,oBAAuB,MAAqB,IAAlBC,CAAAA,WAAkB,MAAlBA,WAAkB,CAChDjE,eAAe,CAAC7F,QAAQ,CAAC6G,KAAV,CAAf,CACA,MAAI,CAACX,QAAL,CAAc,CACZ1B,yBAAyB,CAAEsF,WAAW,GAAK9J,QAAQ,CAAC+J,YAAT,CAAsBC,UAAtB,CAAiC3F,KADhE,CAAd,EAGD,CALD,CAMA,GAAM4F,CAAAA,gBAAgB,CAAG,GAAInI,CAAAA,QAAJ,CAAa,CACpCyE,kBAAkB,CAAGhB,cAAc,EAAIA,cAAc,CAAC2E,QAAlC,EAA+ClK,QAAQ,CAAC+J,YADxC,CAEpCzE,UAAU,CAAE,IAFwB,CAGpCiC,QAAQ,CAAEsC,oBAH0B,CAAb,CAAzB,CAKAzE,OAAO,CAACuD,iBAAR,CAA0B3I,QAA1B,CAAoCiK,gBAApC,EAEA7E,OAAO,CAAC0B,UAAR,CACE3G,YADF,CAEEiG,WAAW,CACTnB,eADS,WAEN,KAAKJ,iBAFC,8CAFb,CAME,GAAI9C,CAAAA,UAAJ,gCACKmD,iBADL,MAEE+B,aAAa,CAAE,KAAKrD,KAAL,CAAWY,yBAAX,CAAuC5C,MAAM,CAACyH,mBAA9C,CAAoE,EAFrF,GANF,EAYAjE,OAAO,CAAC0B,UAAR,CACE7F,IADF,CAEEmF,WAAW,CAACnB,eAAD,WAAqB,KAAKJ,iBAA1B,UAFb,CAGE,GAAI9C,CAAAA,UAAJ,gCACKmD,iBADL,MAEE+B,aAAa,CAAE,CAAC,KAAKrD,KAAL,CAAWuG,SAAZ,CAAwBvI,MAAM,CAACyH,mBAA/B,CAAqD,EAFtE,CAGEe,gBAAgB,CAAE,IAHpB,GAHF,EAUA,GAAMC,CAAAA,UAAU,CAAG,GAAnB,CACA,GAAMC,CAAAA,cAAc,qDACjBlJ,YAAY,CAACyF,KADI,CACI5B,eADJ,kCAEjB5D,cAAc,CAACwF,KAFE,CAEM5B,eAFN,kCAGjB3D,YAAY,CAACuF,KAHI,CAGI5B,eAHJ,kCAIjB1D,gBAAgB,CAACsF,KAJA,CAIQ5B,eAJR,kCAKjBzD,UAAU,CAACqF,KALM,CAKE5B,eALF,kBAApB,CAOA,GAAMsF,CAAAA,qBAAqB,CAAG,GAAIxI,CAAAA,UAAJ,CAAe,CAC3CoD,KAAK,CAAE,CAAC,EAAIJ,UAAJ,CAAiBsF,UAAjB,CAA8B,EAAIrF,MAAnC,EAA6C,CADT,CAE3CgC,KAAK,CAAEnF,GAFoC,CAG3CoF,aAAa,oBAAcrF,MAAM,CAACsF,QAArB,CAH8B,CAAf,CAA9B,CAKA,GAAMsD,CAAAA,gBAAgB,yDACnBpJ,YAAY,CAACyF,KADM,CACE0D,qBADF,oCAEnBlJ,cAAc,CAACwF,KAFI,CAEI0D,qBAFJ,oCAGnBjJ,YAAY,CAACuF,KAHM,CAGE,GAAI9E,CAAAA,UAAJ,CAAe,CACnCoD,KAAK,CAAEkF,UAD4B,CAEnCrD,KAAK,CAAEnF,GAF4B,CAGnCoF,aAAa,oBAAcrF,MAAM,CAACsF,QAArB,CAHsB,CAAf,CAHF,oCAQnB3F,gBAAgB,CAACsF,KARE,CAQM0D,qBARN,oCASnB/I,UAAU,CAACqF,KATQ,CASA0D,qBATA,oBAAtB,CAYAnF,OAAO,CAACqC,OAAR,CAAgBC,IAAhB,CAAqB,8BACnB,oBAAC,UAAD,EACE,QAAQ,CAAEhG,cADZ,CAEE,aAAa,CAAE,MAAI,CAACkC,KAAL,CAAWW,UAF5B,CAGE,WAAW,CAAE,qBAAAA,UAAU,QAAI,CAAA,MAAI,CAAC2B,QAAL,CAAc,CAAE3B,UAAU,CAAVA,UAAF,CAAd,CAAJ,EAHzB,CAIE,mBAAmB,KAJrB,CAKE,eAAe,CAAC,OALlB,CAME,MAAM,CAAEmB,SAAS,CAAChE,cAAc,CAACmF,KAAhB,CANnB,CAOE,kBAAkB,CAAEL,4BAA4B,CAAC9E,cAAc,CAACmF,KAAhB,CAPlD,EADmB,EAArB,EAYAzB,OAAO,CAAC0B,UAAR,CACEnF,SADF,CAEEyE,WAAW,CAACnB,eAAD,WAAqB,KAAKJ,iBAA1B,eAFb,CAGEK,iBAHF,EAMAE,OAAO,CAACwB,UAAR,CACE1F,oBADF,+DAGKE,YAAY,CAACyF,KAHlB,CAG0BzB,OAAO,CAAC0B,UAHlC,uCAIKzF,cAAc,CAACwF,KAJpB,CAI4BzB,OAAO,CAAC0B,UAJpC,uCAKKxF,YAAY,CAACuF,KALlB,CAK0BzB,OAAO,CAAC2B,cALlC,uCAMKxF,gBAAgB,CAACsF,KANtB,CAM8BzB,OAAO,CAAC0B,UANtC,uCAOKtF,UAAU,CAACqF,KAPhB,CAOwBzB,OAAO,CAAC0B,UAPhC,wBASEV,WAAW,CAACnB,eAAD,WAAqB,KAAKJ,iBAA1B,+BATb,CAUEK,iBAVF,CAWEoF,cAXF,CAYEE,gBAZF,EAeA,2BACApF,OAAO,CAACwB,UAAR,CACEzF,iBADF,+DAGKC,YAAY,CAACyF,KAHlB,CAG0BzB,OAAO,CAAC0B,UAHlC,uCAIKzF,cAAc,CAACwF,KAJpB,CAI4BzB,OAAO,CAAC0B,UAJpC,uCAKKxF,YAAY,CAACuF,KALlB,CAK0BzB,OAAO,CAAC2B,cALlC,wBAOEX,WAAW,CAACnB,eAAD,WAAqB,KAAKJ,iBAA1B,uBAPb,CAQEK,iBARF,CASEoF,cATF,CAUEE,gBAVF,EAaAvH,gBAAgB,CAACwH,KAAjB,CAAuBrF,OAAvB,CAAgCG,cAAhC,CAAgD,KAAKV,iBAArD,EACAO,OAAO,CAACsF,WAAR,GACAtF,OAAO,CAACuF,WAAR,CAAoBpK,IAApB,CAA0B,IAA1B,CAAgCmF,SAAS,CAAC,QAAD,CAAzC,EACAN,OAAO,CAACwF,SAAR,GAEA,MAAOxF,CAAAA,OAAO,CAACyF,OAAR,EAAP,CACD,C,sEAGsBhC,I,CAAsB,IAAhBiC,CAAAA,OAAgB,2DAAN,IAAM,CAC3C,GAAIjC,IAAI,CAAC,CAAD,CAAR,CAAa,CACXzI,KAAK,CAAC2K,KAAN,CAAYlC,IAAI,CAAC,CAAD,CAAhB,EACD,CACD,GAAIiC,OAAJ,CAAaA,OAAO,CAACjC,IAAD,CAAP,CACd,C,4DAEiBA,I,CAAM,CACtB,MAAO,MAAKjF,KAAL,CAAWE,QAAX,EAAuB,KAAKH,KAAL,CAAWqH,MAAlC,CACH1I,UAAU,CAAC2I,IAAX,CAAgB,KAAKrH,KAAL,CAAWE,QAAX,CAAoBE,EAApC,CAAwC6E,IAAxC,CADG,CAEHvG,UAAU,CAAC4I,MAAX,CAAkBrC,IAAlB,CAFJ,CAGD,C,gDAGWA,I,CAAM,CAChB,GAAM1E,CAAAA,MAAM,CAAG,EAAf,CACA,GAAML,CAAAA,QAAQ,CAAG,mBAAjB,CACA,GAAMqH,CAAAA,OAAO,CAAG,2BAAhB,CACA,GAAMhC,CAAAA,SAAS,CAAG,qCAAlB,CACA,GAAMiC,CAAAA,SAAS,CAAG,+CAAlB,CACA,GAAMC,CAAAA,KAAK,CAAG,+BAAd,CACA,GAAMzB,CAAAA,OAAO,CAAG,2BAAhB,CAEA,GAAM0B,CAAAA,YAAY,CAAG/I,GAAG,CAACsG,IAAD,2BAAxB,CACA,GAAIyC,YAAJ,CAAkBnH,MAAM,CAACkD,OAAP,CAAiBiE,YAAY,CAAC,CAAD,CAA7B,CAElB,GAAMC,CAAAA,OAAO,CAAGhJ,GAAG,CAACsG,IAAD,sBAAnB,CACA,GAAI0C,OAAJ,CAAapH,MAAM,CAACqH,SAAP,CAAmBD,OAAO,CAAC,CAAD,CAA1B,CAEb,GAAME,CAAAA,wBAAwB,CAAGlJ,GAAG,CAACsG,IAAD,WAAU/E,QAAV,gCAApC,CACA,GAAI2H,wBAAJ,CAA8BtH,MAAM,CAACuH,mBAAP,CAA6BD,wBAAwB,CAAC,CAAD,CAArD,CAE9B,GAAME,CAAAA,mBAAmB,CAAGpJ,GAAG,CAACsG,IAAD,WAAU/E,QAAV,4BAA/B,CACA,GAAI6H,mBAAJ,CAAyB,CACvBA,mBAAmB,CAACC,OAApB,CAA4B,4CAA5B,EACA,KAAKC,sBAAL,CAA4BF,mBAA5B,EACAxH,MAAM,CAAC2H,MAAP,CAAgBH,mBAAmB,CAAC,CAAD,CAAnC,CACD,CAED,GAAMI,CAAAA,SAAS,CAAGxJ,GAAG,CAACsG,IAAD,WAAU/E,QAAV,iBAArB,CACA,GAAIiI,SAAJ,CAAe5H,MAAM,CAAC8D,IAAP,CAAc8D,SAAS,CAAC,CAAD,CAAvB,CAEf,GAAMC,CAAAA,WAAW,CAAGzJ,GAAG,CAACsG,IAAD,WAAUsC,OAAV,mBAAvB,CACA,GAAIa,WAAJ,CAAiB7H,MAAM,CAAC8H,MAAP,CAAgBD,WAAW,CAAC,CAAD,CAA3B,CAEjB,GAAME,CAAAA,SAAS,CAAG3J,GAAG,CAACsG,IAAD,WAAUsC,OAAV,iBAArB,CACA,GAAIe,SAAJ,CAAe/H,MAAM,CAACgI,IAAP,CAAcD,SAAS,CAAC,CAAD,CAAvB,CAEf,GAAME,CAAAA,qBAAqB,CAAG7J,GAAG,CAACsG,IAAD,WAAUsC,OAAV,6BAAjC,CACA,GAAIiB,qBAAJ,CAA2B,CACzB5J,GAAG,CAAC2B,MAAD,CAAS,0BAAT,CAAqCiI,qBAAqB,CAAC,CAAD,CAA1D,CAAH,CACD,CAED,GAAMC,CAAAA,8BAA8B,CAAG9J,GAAG,CAACsG,IAAD,WAAUsC,OAAV,sBAA1C,CACA,GAAIkB,8BAAJ,CAAoC,CAClC7J,GAAG,CAAC2B,MAAD,CAAS,0BAAT,CAAqCkI,8BAArC,CAAH,CACD,CAED,GAAMC,CAAAA,eAAe,CAAG/J,GAAG,CAACsG,IAAD,CAAOuC,SAAP,CAA3B,CACA,GAAIkB,eAAJ,CAAqB,CACnB9J,GAAG,CAAC2B,MAAD,CAAS,qBAAT,CAAgCmI,eAAhC,CAAH,CACD,CAED,GAAMC,CAAAA,eAAe,CAAGhK,GAAG,CAACsG,IAAD,CAAOM,SAAP,CAA3B,CACA,GAAIoD,eAAJ,CAAqB,CACnB/J,GAAG,CAAC2B,MAAD,CAAS,WAAT,CAAsBoI,eAAtB,CAAH,CACD,CAED,GAAMC,CAAAA,YAAY,CAAGjK,GAAG,CAACsG,IAAD,WAAUsC,OAAV,wBAAxB,CACA,GAAIqB,YAAJ,CAAkB,CAChBhK,GAAG,CAAC2B,MAAD,CAAS,oBAAT,CAA+BqI,YAA/B,CAAH,CACD,CAED,GAAMC,CAAAA,iBAAiB,CAAGlK,GAAG,CAACsG,IAAD,WAAUsC,OAAV,yBAA7B,CACA,GAAIsB,iBAAJ,CAAuBtI,MAAM,CAAC+F,QAAP,CAAkBuC,iBAAiB,CAAC,CAAD,CAAnC,CAEvB,GAAMC,CAAAA,iBAAiB,CAAGnK,GAAG,CAACsG,IAAD,WAAUsC,OAAV,qCAA7B,CACA,GAAIuB,iBAAJ,CAAuBvI,MAAM,CAAC+F,QAAP,CAAkBwC,iBAAiB,CAAC,CAAD,CAAnC,CAEvB,GAAMC,CAAAA,iBAAiB,CAAGpK,GAAG,CAACsG,IAAD,WAAUsC,OAAV,6CAA7B,CACA,GAAIwB,iBAAJ,CAAuBxI,MAAM,CAACyI,YAAP,CAAsBD,iBAAiB,CAAC,CAAD,CAAvC,CAEvB,GAAME,CAAAA,+BAA+B,CAAGtK,GAAG,CACzCsG,IADyC,WAEtCsC,OAFsC,sCAA3C,CAKA,GAAI0B,+BAAJ,CAAqC,CACnC,GAAI1I,MAAM,CAACgH,OAAX,CAAoB,CAClBhH,MAAM,CAACgH,OAAP,CAAe2B,gBAAf,CAAkC,CAChCC,eAAe,CAAEF,+BADe,CAAlC,CAGD,CAJD,IAIO,CACL1I,MAAM,CAACgH,OAAP,CAAiB,EAAjB,CACAhH,MAAM,CAACgH,OAAP,CAAe2B,gBAAf,CAAkC,CAChCC,eAAe,CAAEF,+BADe,CAAlC,CAGD,CACF,CAED,GAAMG,CAAAA,YAAY,CAAGzK,GAAG,CAACsG,IAAD,WAAUe,OAAV,YAAxB,CACA,GAAIoD,YAAJ,CAAkB7I,MAAM,CAACyF,OAAP,CAAiBoD,YAAY,CAAC,CAAD,CAA7B,CAElB,GAAMC,CAAAA,yBAAyB,CAAG1K,GAAG,CACnCsG,IADmC,WAEhCe,OAFgC,iDAArC,CAIA,GAAIqD,yBAAJ,CAA+B9I,MAAM,CAACuF,oBAAP,CAA8BuD,yBAAyB,CAAC,CAAD,CAAvD,CAE/B,GAAMC,CAAAA,yBAAyB,CAAG3K,GAAG,CAACsG,IAAD,WAAUe,OAAV,2BAArC,CACA,GAAIsD,yBAAJ,CAA+B,CAC7B1K,GAAG,CAAC2B,MAAD,CAAS,uBAAT,CAAkC+I,yBAAlC,CAAH,CACD,CACD,GAAMC,CAAAA,wCAAwC,CAAG5K,GAAG,CAClDsG,IADkD,WAE/Ce,OAF+C,0CAApD,CAIA,GAAIuD,wCAAJ,CAA8C,CAC5C3K,GAAG,CAAC2B,MAAD,CAAS,sCAAT,CAAiDgJ,wCAAjD,CAAH,CACD,CACD,GAAMC,CAAAA,cAAc,CAAG7K,GAAG,CAACsG,IAAD,WAAUe,OAAV,8BAA1B,CACA,GAAIwD,cAAJ,CAAoB,CAClB5K,GAAG,CAAC2B,MAAD,CAAS,0BAAT,CAAqCiJ,cAArC,CAAH,CACD,CACD,GAAMC,CAAAA,aAAa,CAAG9K,GAAG,CAACsG,IAAD,WAAUe,OAAV,4CAAzB,CACA,GAAIyD,aAAJ,CAAmB,CACjB7K,GAAG,CAAC2B,MAAD,CAAS,yCAAT,CAAoDkJ,aAApD,CAAH,CACD,CAED,GAAMC,CAAAA,qBAAqB,CAAG/K,GAAG,CAACsG,IAAD,WAAUsC,OAAV,8BAAjC,CACA,GAAImC,qBAAJ,CAA2B,CACzB9K,GAAG,CAAC2B,MAAD,CAAS,mBAAT,CAA8BmJ,qBAAqB,CAAC,CAAD,CAAnD,CAAH,CACD,CAED,GAAMC,CAAAA,WAAW,CAAGhL,GAAG,CAACsG,IAAD,WAAUwC,KAAV,EAAvB,CACA,GAAIkC,WAAJ,CAAiB,CACf,IAAK,GAAI9E,CAAAA,IAAT,GAAiB8E,CAAAA,WAAjB,CAA8B,CAC5B,GAAIA,WAAW,CAAC9E,IAAD,CAAX,CAAkB+E,eAAtB,CAAuC,CACrCD,WAAW,CAAC9E,IAAD,CAAX,CAAkBgF,WAAlB,CAAgCF,WAAW,CAAC9E,IAAD,CAAX,CAAkB+E,eAAlD,CACD,CACF,CACDrJ,MAAM,CAACkH,KAAP,CAAekC,WAAf,CACD,CACD,KAAKrH,QAAL,CAAc,CAAEhC,qBAAqB,CAAE,IAAzB,CAA+BC,MAAM,CAANA,MAA/B,CAAd,EACD,C,gEAGmBoE,G,CAAK,CACvB,GAAIA,GAAG,CAACM,IAAJ,EAAYN,GAAG,CAACM,IAAJ,CAAS6E,OAAzB,CAAkC,CAChC,GAAM7J,CAAAA,WAAW,CAAG3B,aAAa,CAACyL,OAAd,CAAsB,KAAtB,CAA6BpF,GAAG,CAACM,IAAJ,CAAS7E,EAAtC,CAApB,CACA,KAAKkC,QAAL,CAAc,CACZ0H,sBAAsB,CAAE,IADZ,CAEZC,MAAM,CAAE,KAFI,CAGZhK,WAAW,CAAXA,WAHY,CAIZM,MAAM,CAAE,IAJI,CAKZD,qBAAqB,CAAE,KALX,CAAd,EAOD,CACF,C,kEAEoB4J,Q,CAAUC,Q,CAAU,CACvC,GAAM1J,CAAAA,KAAK,CAAG0J,QAAQ,CAACD,QAAQ,CAACjH,KAAV,CAAtB,CACA,GAAI,CAACxC,KAAL,CAAY,MAAO2J,CAAAA,OAAO,CAACC,OAAR,CAAgB,IAAhB,CAAP,CACZ,GAAI,KAAKC,iCAAL,CAAuC7J,KAAvC,CAAJ,CAAmD,CACjD,MAAO/D,CAAAA,mBAAmB,CAACwN,QAAQ,CAACjH,KAAV,CAAnB,CACJsH,OADI,CACI9J,KADJ,EAEJ+J,IAFI,CAEC9N,mBAAmB,CAAC+N,eAApB,CAAoCP,QAApC,CAFD,CAAP,CAGD,CAJD,IAIO,CACL,MAAOE,CAAAA,OAAO,CAACC,OAAR,CAAgB,GAAIH,CAAAA,QAAJ,CAAazJ,KAAb,CAAhB,CAAP,CACD,CACF,C,8DAEkBwE,I,CAAM,CACvB,GAAMyF,CAAAA,WAAW,CAAG,EAApB,CACA,GAAMC,CAAAA,UAAU,CAAGC,MAAM,CAACC,MAAP,CAAc5F,IAAd,EAAoB6F,MAApB,CAA2B,SAACC,UAAD,CAAalG,IAAb,CAAmBmG,KAAnB,CAA6B,CACzED,UAAU,CAACC,KAAD,CAAV,CAAoBnG,IAApB,CACA6F,WAAW,CAAC5G,IAAZ,CAAiBe,IAAjB,EACA,MAAOkG,CAAAA,UAAP,CACD,CAJkB,CAIhB,EAJgB,CAAnB,CAKA,MAAO,CAAEJ,UAAU,CAAVA,UAAF,CAAcD,WAAW,CAAXA,WAAd,CAAP,CACD,C,oEAEqBO,e,CAAiB,CACrC,GAAI,CAACA,eAAL,CAAsB,CACpB,MAAO,CACL,qBACGzN,YAAY,CAACyF,KADhB,CACwBpF,uBAAuB,CAACqN,KADhD,CADK,CAAP,CAKD,CAED,GAAMC,CAAAA,wBAAwB,CAAG,EAAjC,CAEAP,MAAM,CAACC,MAAP,CAAcI,eAAd,EAA+BG,OAA/B,CAAuC,SAAAC,EAAE,CAAI,CAC3C,GAAI,CAACA,EAAE,CAAC7N,YAAY,CAACyF,KAAd,CAAP,CAA6B,CAC3BkI,wBAAwB,CAACrH,IAAzB,oBACGtG,YAAY,CAACyF,KADhB,CACwBpF,uBAAuB,CAACqN,KADhD,GAGD,CAJD,IAIO,CACLC,wBAAwB,CAACrH,IAAzB,CAA8BuH,EAA9B,EACD,CACF,CARD,EAUA,MAAOF,CAAAA,wBAAP,CACD,C,wIAEqBG,W,8TAElB,MAAOA,CAAAA,WAAW,CAAC5K,gBAAnB,CACM6K,sB,CAAyB,KAAKC,kBAAL,CAAwB,KAAKxL,KAAL,CAAWU,gBAAnC,C,CAC/B9B,GAAG,CAAC0M,WAAD,CAAc,0BAAd,CAA0CC,sBAAsB,CAACZ,UAAjE,CAAH,CACA,KAAKrI,QAAL,CAAc,CAAE5B,gBAAgB,CAAE6K,sBAAsB,CAACb,WAA3C,CAAd,EAEA,MAAOY,CAAAA,WAAW,CAAC3K,UAAnB,CACM8K,gB,CAAmB,KAAKD,kBAAL,CAAwB,KAAKxL,KAAL,CAAWW,UAAnC,C,CACzB/B,GAAG,CAAC0M,WAAD,CAAc,0CAAd,CAA0DG,gBAAgB,CAACd,UAA3E,CAAH,CACA,KAAKrI,QAAL,CAAc,CAAE3B,UAAU,CAAE8K,gBAAgB,CAACf,WAA/B,CAAd,EAEMP,Q,CAAWlL,WAAW,CAACqM,WAAD,C,CACtBI,S,CAAY,E,CAElBA,SAAS,CAACjI,OAAV,CAAoB0G,QAAQ,CAAC1G,OAA7B,CACAiI,SAAS,CAACC,KAAV,CAAkBxB,QAAQ,CAACwB,KAA3B,CACAD,SAAS,CAACE,IAAV,CAAiB,CACfC,QAAQ,wBAAE,KAAK7L,KAAL,CAAWc,gBAAX,CAA4BV,EAA9B,+DAAoC3D,IAAI,CAACuH,OAAL,CAAa8H,cAAb,CAA4B1L,EADzD,CAAjB,C,IAII+J,QAAQ,CAACvC,S,0BACPiE,Q,CAAWpH,S,MACX,MAAO0F,CAAAA,QAAQ,CAACvC,SAAhB,GAA8B,Q,2BAChCmE,OAAO,CAACC,GAAR,CAAY,mBAAZ,CAAiC7B,QAAQ,CAACvC,SAA1C,E,uBACwB,MAAKqE,mBAAL,CAAyB9B,QAAQ,CAACvC,SAAlC,C,SAAlBA,S,eACN,GAAIA,SAAJ,CAAe,CACbiE,QAAQ,CAAGK,MAAM,CAACtE,SAAS,CAACxH,EAAX,CAAjB,CACD,C,QAEH,GAAI,MAAO+J,CAAAA,QAAQ,CAACvC,SAAhB,GAA8B,QAA9B,EAA0CuC,QAAQ,CAACvC,SAAT,CAAmBxH,EAAjE,CAAqE,CACnE2L,OAAO,CAACC,GAAR,CAAY,mBAAZ,CAAiC7B,QAAQ,CAACvC,SAA1C,EACAiE,QAAQ,CAAGK,MAAM,CAAC/B,QAAQ,CAACvC,SAAT,CAAmBxH,EAApB,CAAjB,CACD,CACD,GAAIyL,QAAJ,CAAc,CACZH,SAAS,CAACS,EAAV,CAAe,CAAEN,QAAQ,CAARA,QAAF,CAAf,CACD,C,QAGHH,SAAS,CAACxL,QAAV,CAAqB,CACnB4H,mBAAmB,CAAEqC,QAAQ,CAACrC,mBADX,CAEnBsE,SAAS,CAAEjC,QAAQ,CAACiC,SAFD,CAArB,CAKM7E,O,CAAU4C,QAAQ,CAAC5C,OAAT,EAAoB,E,CAE9B8E,W,CAAclC,QAAQ,CAACkC,WAAT,EAAwB,E,CAEtCC,iB,CAAoBnC,QAAQ,CAACmC,iB,yCAIV,MAAKC,oBAAL,CAA0BnQ,QAA1B,CAAoC+N,QAApC,C,SAAjB7D,Q,eACN,GAAIA,QAAJ,CAAc,CACZiB,OAAO,CAACiF,YAAR,CAAuBlG,QAAQ,CAACmG,IAAT,CAAchM,KAArC,CACA4L,WAAW,CAACK,YAAZ,CAA2BpG,QAAQ,CAAC4E,KAApC,CACA,GAAIf,QAAQ,CAACnB,YAAT,EAAyB,CAAC,KAAKhJ,KAAL,CAAWY,yBAAzC,CAAoE,CAClEyL,WAAW,CAACM,oBAAZ,CAAmCxC,QAAQ,CAACnB,YAA5C,CACD,CACF,C,kFAED+C,OAAO,CAACC,GAAR,c,QAGF,GAAIM,iBAAJ,CAAuB,CACrB/E,OAAO,CAAC+E,iBAAR,CAA4B,CAACA,iBAAD,CAA5B,CACD,CAEKM,gB,CAAmBP,W,SAAAA,W,iBAAAA,WAAW,CAAEtG,K,CAEtC,GAAI6G,gBAAJ,CAAsB,CACpBP,WAAW,CAACtG,KAAZ,CAAoB,KAAK8G,qBAAL,CAA2BD,gBAA3B,CAApB,CACD,CAED,GAAIhC,MAAM,CAACkC,IAAP,CAAYT,WAAZ,EAAyBhK,MAA7B,CAAqCkF,OAAO,CAAC8E,WAAR,CAAsBA,WAAtB,CAErCX,SAAS,CAACxL,QAAV,CAAmBqH,OAAnB,CAA6BA,OAA7B,CAGME,K,CAAQ0C,QAAQ,CAAC1C,K,CAEvBA,KAAK,CAAC2D,OAAN,CAAc,SAAS2B,IAAT,CAAe,CAC3B,GAAIA,IAAI,CAACnD,eAAL,GAAyB,CAACmD,IAAI,CAACV,WAAN,EAAqB,CAACU,IAAI,CAACV,WAAL,CAAiBW,gBAAhE,CAAJ,CAAuF,CACrF,GAAI,CAACD,IAAI,CAACV,WAAV,CAAuB,CACrBU,IAAI,CAACV,WAAL,CAAmB,EAAnB,CACD,CACDU,IAAI,CAACV,WAAL,CAAiBW,gBAAjB,CAAoCD,IAAI,CAACnD,eAAzC,CACAmD,IAAI,CAACnD,eAAL,CAAuB,MAAvB,CACD,CACF,CARD,EAUA,GAAInC,KAAJ,CAAW,CACHwF,KADG,CACK,EADL,CAETA,KAAK,CAACC,kBAAN,CAA2B/C,QAAQ,CAAC+C,kBAApC,CACAD,KAAK,CAACE,iBAAN,CAA0BhD,QAAQ,CAACgD,iBAAnC,CACAF,KAAK,CAACG,gBAAN,CAAyBjD,QAAQ,CAACiD,gBAAlC,CACA1B,SAAS,CAACxL,QAAV,CAAmBmN,KAAnB,CAA2B,CAAE5F,KAAK,CAALA,KAAF,CAASwF,KAAK,CAALA,KAAT,CAA3B,CACD,CAED,GACE9C,QAAQ,CAAC1G,OAAT,GAAqBxG,cAAc,CAACwD,KAApC,GACC,KAAKT,KAAL,CAAWe,eAAX,EAA8BoJ,QAAQ,CAACrE,oBADxC,CADF,CAGE,CACME,OADN,CACgB,CACdjF,eAAe,CAAE,EADH,CADhB,CAKA,GAAI,KAAKf,KAAL,CAAWe,eAAf,CAAgC,CAC9BiF,OAAO,CAACjF,eAAR,CAA0B,KAAKf,KAAL,CAAWe,eAArC,CACAiF,OAAO,CAACjF,eAAR,CAAwBgF,KAAxB,CAAgC,KAAK8G,qBAAL,CAC9B,KAAK7M,KAAL,CAAWe,eAAX,CAA2BgF,KADG,CAAhC,CAGD,CAED2F,SAAS,CAACxL,QAAV,CAAmB8F,OAAnB,CAA6BA,OAA7B,CACD,CACD,GAAImE,QAAQ,CAAC1G,OAAT,GAAqBvG,cAAc,CAACuD,KAApC,EAA6C0J,QAAQ,CAAC9F,IAA1D,CAAgE,CAC9DqH,SAAS,CAACxL,QAAV,CAAmBmE,IAAnB,CAA0B8F,QAAQ,CAAC9F,IAAnC,CACD,C,gCAEMqH,S,iEAEDtN,CAAAA,WAAW,CAACI,cAAD,CAAiB,gDAAjB,a,6OAIN8O,G,CAAK,CAClBC,MAAM,CAACC,QAAP,CAAkBF,GAAlB,CACD,C,uDAEgB,CACf9Q,KAAK,CAACsN,OAAN,CAAclN,iBAAd,EACD,C,2IAEsB+E,c,sKACf4F,O,CAAU,KAAKvG,mBAAL,CACZW,cAAc,CAAC8L,UAAf,CAA0BlG,OADd,CAEZ5F,cAAc,CAACwI,QAAf,CAAwBjK,QAAxB,CAAiCqH,O,CAC/BiF,Y,CAAejF,OAAO,CAACiF,Y,KAEzBA,Y,iDACiC9P,CAAAA,mBAAmB,CAACgR,cAApB,CAAmCnD,OAAnC,CAA2CiC,YAA3C,C,QAA/BmB,sB,gBACJ,GAAIA,sBAAsB,CAACC,IAAvB,CAA4BvL,MAA5B,GAAuC,CAA3C,CAA8C,CAC5CV,cAAc,CAAC2E,QAAf,CAA0B,GAAIlK,CAAAA,QAAJ,CAAauR,sBAAsB,CAACC,IAAvB,CAA4B,CAA5B,CAAb,CAA1B,CACD,C,2TAIqB1C,K,uIACnBA,K,2DAAcd,OAAO,CAACC,OAAR,CAAgB,IAAhB,C,gCACK3N,CAAAA,mBAAmB,CAACkL,SAApB,CACrB2C,OADqB,CACbW,KADa,EAErBV,IAFqB,CAEhB,SAAAqD,UAAU,CAAI,CAClB,MAAOA,CAAAA,UAAU,CAACD,IAAX,CAAgBhJ,MAAhB,CAAuB,SAAAC,IAAI,QAChCA,CAAAA,IAAI,CAACqG,KAAL,CAAW4C,WAAX,GAAyBC,QAAzB,CAAkC7C,KAAK,CAAC4C,WAAN,EAAlC,CADgC,EAA3B,CAAP,CAGD,CANqB,EAOrBtD,IAPqB,CAOhB,SAAAwD,kBAAkB,CAAI,CAC1B,GAAIA,kBAAkB,CAAC3L,MAAnB,GAA8B,CAAlC,CAAqC,MAAO2L,CAAAA,kBAAkB,CAAC,CAAD,CAAzB,CACrC,GAAMC,CAAAA,UAAU,CAAGD,kBAAkB,CAACE,IAAnB,CACjB,SAAArJ,IAAI,QAAIA,CAAAA,IAAI,CAACqG,KAAL,CAAW4C,WAAX,KAA6B5C,KAAK,CAAC4C,WAAN,EAAjC,EADa,CAAnB,CAGA,MAAOG,CAAAA,UAAU,EAAI,IAArB,CACD,CAbqB,C,QAAlBrG,S,iDAcCA,S,6TAGejG,c,oTAEfA,cAAc,CAAC,KAAKT,wBAAN,C,gDAAd,sBAA+CiL,E,uEAEhD,KAAKnL,mB,2BACP;AACMmN,M,CAAQ,CAAAxM,cAAc,OAAd,EAAAA,cAAc,SAAd,+BAAAA,cAAc,CAAE8L,UAAhB,8FAA4BlG,OAA5B,wEAAqC6G,MAArC,GAA+C,E,OACvCD,MAAM,CAAC,CAAD,CAAN,EAAa,E,CAA3B9J,I,OAAAA,I,CAAMJ,G,OAAAA,G,wBACWvH,CAAAA,mBAAmB,CAACkL,SAApB,CAA8B2C,OAA9B,E,QAAnBsD,U,iCACcA,U,CAAbD,I,CAAAA,I,2BAAO,E,kBACdjM,cAAc,CAACtF,SAAS,CAAC4G,KAAX,CAAd,CAAkC2K,IAAI,CAACM,IAAL,CAChC,SAAAzN,KAAK,QAAIA,CAAAA,KAAK,CAACyK,KAAN,CAAY6C,QAAZ,CAAqB1J,IAArB,GAA8B5D,KAAK,CAACyK,KAAN,CAAY6C,QAAZ,CAAqB9J,GAArB,CAAlC,EAD2B,CAAlC,C,gCAIA;AACQ4H,Q,CAAalK,cAAc,CAACwI,QAAf,CAAwBgC,E,CAArCN,Q,KACJA,Q,mDACuBnP,CAAAA,mBAAmB,CAACkL,SAApB,CAA8B2C,OAA9B,E,SAAnBsD,W,gBACNlM,cAAc,CAACtF,SAAS,CAAC4G,KAAX,CAAd,CAAkC4K,WAAU,CAACD,IAAX,CAAgBM,IAAhB,CAAqB,SAAAzN,KAAK,QAAIA,CAAAA,KAAK,CAACL,EAAN,GAAayL,QAAjB,EAA1B,CAAlC,C,6FAKJE,OAAO,CAACC,GAAR,CAAY,KAAZ,e,wUAKsBrK,c,kKAClB8F,K,CAAQ9I,GAAG,CAACgD,cAAD,WAAoB,KAAKV,iBAAzB,iB,IACZwG,K,mEACD4G,iB,CAAoB1M,c,CACxB8F,KAAK,CAAC2D,OAAN,CAAc,SAAC2B,IAAD,CAAO/B,KAAP,CAAiB,CAC7B,GAAMgC,CAAAA,gBAAgB,CAAGrO,GAAG,CAACoO,IAAD,CAAO,8BAAP,CAA5B,CACAsB,iBAAiB,CAAGvP,YAAY,CAC9BuP,iBAD8B,WAE3B,MAAI,CAACpN,iBAFsB,yBAEW+J,KAFX,qBAG9BgC,gBAH8B,CAAhC,CAKD,CAPD,E,iCAQOqB,iB,mPAGU7M,O,CAASG,c,CAAgB,iBAC1C,GAAM2M,CAAAA,mBAAmB,CAAG3P,GAAG,CAACgD,cAAD,WAAoB,KAAKV,iBAAzB,iBAA/B,CACA,GAAMsN,CAAAA,eAAe,CAAG5P,GAAG,CAAC6C,OAAO,CAACQ,UAAR,CAAmBhC,KAApB,CAA2B,OAA3B,CAA3B,CACA,GAAIsO,mBAAmB,EAAI,CAACC,eAA5B,CAA6C,CAC3C,GAAIC,CAAAA,iBAAiB,CAAG,EAAxB,CACAF,mBAAmB,CAAClD,OAApB,CAA4B,SAAC2B,IAAD,CAAO/B,KAAP,CAAiB,CAC3C,GAAMgC,CAAAA,gBAAgB,CAAGrO,GAAG,CAC1B6C,OAAO,CAACQ,UAAR,CAAmBhC,KADO,iBAEjBgL,KAFiB,kCAA5B,CAIA,GAAI,CAACgC,gBAAL,CAAuB,CACrB,GAAMyB,CAAAA,mBAAmB,CAAG9P,GAAG,CAACoO,IAAD,CAAO,8BAAP,CAA/B,CACA,GAAI0B,mBAAJ,CAAyB,CACvB,GAAMC,CAAAA,kBAAkB,CAAG,CACzBrC,WAAW,CAAE,CACXW,gBAAgB,CAAEyB,mBADP,CADY,CAIzB7E,eAAe,CAAEjL,GAAG,CAClB,MAAI,CAACgD,cADa,WAEf,MAAI,CAACV,iBAFU,yBAEuB+J,KAFvB,qBAJK,CAA3B,CASAwD,iBAAiB,CAAG1P,YAAY,CAC9B0P,iBAD8B,iBAErBxD,KAFqB,EAG9B0D,kBAH8B,CAAhC,CAKD,CACF,CAED,GAAMC,CAAAA,iBAAiB,CAAGhQ,GAAG,CAAC6C,OAAO,CAACQ,UAAR,CAAmBhC,KAApB,iBAAoCgL,KAApC,gBAA7B,CACA,GAAI,CAAC2D,iBAAD,EAAsB,CAAC/D,MAAM,CAACgE,OAAP,CAAeD,iBAAf,EAAkCtM,MAA7D,CAAqE,CACnE,GAAMwM,CAAAA,aAAa,CAAGlQ,GAAG,CAACoO,IAAD,cAAzB,CACA,GAAI8B,aAAa,EAAIA,aAAa,CAACxM,MAAnC,CAA2C,CACzCmM,iBAAiB,CAAG1P,YAAY,CAC9B0P,iBAD8B,iBAErBxD,KAFqB,gBAG9B6D,aAH8B,CAAhC,CAKD,CACF,CAED,GAAMC,CAAAA,kBAAkB,CAAGnQ,GAAG,CAAC6C,OAAO,CAACQ,UAAR,CAAmBhC,KAApB,iBAAoCgL,KAApC,iBAA9B,CACA,GAAI,CAAC8D,kBAAD,EAAuB,CAAClE,MAAM,CAACgE,OAAP,CAAeE,kBAAf,EAAmCzM,MAA/D,CAAuE,CACrE,GAAM0M,CAAAA,cAAc,CAAGpQ,GAAG,CAACoO,IAAD,eAA1B,CACA,GAAIgC,cAAJ,CAAoB,CAClBP,iBAAiB,CAAG1P,YAAY,CAC9B0P,iBAD8B,iBAErBxD,KAFqB,iBAG9B+D,cAH8B,CAAhC,CAKD,CACF,CAED,GAAMC,CAAAA,4BAA4B,CAAGrQ,GAAG,CACtC6C,OAAO,CAACQ,UAAR,CAAmBhC,KADmB,iBAE7BgL,KAF6B,uCAAxC,CAIA,GAAI,CAACgE,4BAAD,EAAiC,CAACpE,MAAM,CAACgE,OAAP,CAAeI,4BAAf,EAA6C3M,MAAnF,CAA2F,CACzF,GAAM4M,CAAAA,wBAAwB,CAAGtQ,GAAG,CAACoO,IAAD,qCAApC,CACA,GAAIkC,wBAAwB,EAAIA,wBAAwB,CAAC5M,MAAzD,CAAiE,CAC/DmM,iBAAiB,CAAG1P,YAAY,CAC9B0P,iBAD8B,iBAErBxD,KAFqB,uCAG9BiE,wBAH8B,CAAhC,CAKD,CACF,CAED,GAAMC,CAAAA,eAAe,CAAGvQ,GAAG,CACzB6C,OAAO,CAACQ,UAAR,CAAmBhC,KADM,iBAEhBgL,KAFgB,0BAA3B,CAIA,GAAI,CAACkE,eAAD,EAAoB,CAACtE,MAAM,CAACgE,OAAP,CAAeM,eAAf,EAAgC7M,MAAzD,CAAiE,CAC/D,GAAM8M,CAAAA,WAAW,CAAGxQ,GAAG,CAACoO,IAAD,wBAAvB,CACA,GAAIoC,WAAW,EAAIA,WAAW,CAAC9M,MAA/B,CAAuC,CACrCmM,iBAAiB,CAAG1P,YAAY,CAC9B0P,iBAD8B,iBAErBxD,KAFqB,0BAG9BmE,WAH8B,CAAhC,CAKD,CACF,CACF,CA9ED,EA+EA,GAAIvE,MAAM,CAACgE,OAAP,CAAeJ,iBAAf,EAAkCnM,MAAtC,CAA8C,CAC5Cb,OAAO,CAAC4N,uBAAR,kBAAqCZ,iBAArC,GACD,CACF,CACF,C,oDAEahN,O,CAASG,c,CAAgB,CACrC,GAAM6M,CAAAA,iBAAiB,CAAG,EAA1B,CACA,GAAI9N,CAAAA,gBAAgB,CAAG/B,GAAG,CACxBgD,cADwB,WAErB,KAAKV,iBAFgB,8BAA1B,CAIA,GAAIP,gBAAJ,CAAsBA,gBAAgB,CAAGkK,MAAM,CAACgE,OAAP,CAAelO,gBAAf,CAAnB,CACtB,GACEA,gBAAgB,EAChBA,gBAAgB,CAAC2B,MADjB,EAEAuI,MAAM,CAACgE,OAAP,CAAe,KAAK5O,KAAL,CAAWU,gBAA1B,EAA4C2B,MAA5C,GAAuD,CAHzD,CAIE,CACAmM,iBAAiB,CAAC9N,gBAAlB,CAAqCA,gBAArC,CACD,CACD,GAAIC,CAAAA,UAAU,CAAGhC,GAAG,CAClBgD,cADkB,WAEf,KAAKV,iBAFU,8CAApB,CAIA,GAAIN,UAAJ,CAAgBA,UAAU,CAAGiK,MAAM,CAACgE,OAAP,CAAejO,UAAf,CAAb,CAChB,GAAIA,UAAU,EAAIA,UAAU,CAAC0B,MAAzB,EAAmCuI,MAAM,CAACgE,OAAP,CAAe,KAAK5O,KAAL,CAAWW,UAA1B,EAAsC0B,MAAtC,GAAiD,CAAxF,CAA2F,CACzFmM,iBAAiB,CAAC7N,UAAlB,CAA+BA,UAA/B,CACD,CACD,GAAIiK,MAAM,CAACkC,IAAP,CAAY0B,iBAAZ,EAA+BnM,MAAnC,CAA2C,CACzC,KAAKC,QAAL,kBAAmBkM,iBAAnB,GACD,CACF,C,kEAEoB/K,O,CAAS,CAC5B,MAAO,CACL+B,SAAS,CAAE/B,OAAO,GAAKxG,cAAc,CAACwD,KADjC,CAEL8F,SAAS,CAAE9C,OAAO,GAAKvG,cAAc,CAACuD,KAFjC,CAGL4O,gBAAgB,CAAE5L,OAAO,GAAKtG,qBAAqB,CAACsD,KAH/C,CAAP,CAKD,C,ucAI+B/B,CAAAA,UAAU,CAACC,GAAX,CAAe,KAAKoB,KAAL,CAAWK,EAA1B,C,QAA5B,KAAKuB,c,gBACL,GAAI,KAAKA,cAAL,CAAoBwI,QAApB,GAAiC,IAArC,CAA2C,KAAKnJ,mBAAL,CAA2B,IAA3B,CAC3C,KAAKC,iBAAL,CAAyB,KAAKD,mBAAL,CAA2B,YAA3B,CAA0C,mBAAnE,CACA,KAAKE,wBAAL,CAAgC,KAAKF,mBAAL,CAA2B,YAA3B,CAA0C,UAA1E,C,uBACM,MAAKsO,gBAAL,CAAsB,KAAK3N,cAA3B,C,gCACA,MAAK4N,iBAAL,CAAuB,KAAK5N,cAA5B,C,iCACe,MAAK6N,mBAAL,CAAyB,KAAK7N,cAA9B,C,SAAjBzB,Q,wCAE6B,MAAKuP,YAAL,E,SAA3BC,kB,sCACqBA,kBAAkB,CAAC9K,MAAnB,CACzB,SAAAiH,QAAQ,QAAIA,CAAAA,QAAQ,CAACzL,EAAT,GAAgBzB,GAAG,CAAC,MAAI,CAACgD,cAAN,CAAsB,wBAAtB,CAAvB,EADiB,C,gEAApBb,gB,2BAIP,KAAKwB,QAAL,8BACEnC,SAAS,CAAE,KADb,CAEEE,OAAO,CAAE,KAFX,CAGEH,QAAQ,CAARA,QAHF,EAIK,KAAKM,oBAAL,CAA0B,KAAKmB,cAAL,CAAoB,KAAKT,wBAAzB,EAAmDuC,OAA7E,CAJL,MAKE/C,gBAAgB,CAAE/B,GAAG,CACnB,KAAKgD,cADc,WAEhB,KAAKV,iBAFW,8BALvB,CASEN,UAAU,CAAEhC,GAAG,CACb,KAAKgD,cADQ,WAEV,KAAKV,iBAFK,8CATjB,CAaEL,yBAAyB,CACvB,4BAAKe,cAAL,2FAAqB2E,QAArB,8FAA+BF,UAA/B,wEAA2C3F,KAA3C,IACArE,QAAQ,CAAC+J,YAAT,CAAsBC,UAAtB,CAAiC3F,KAfrC,CAgBEI,SAAS,CAAE6O,kBAhBb,CAiBE5O,gBAAgB,CAAhBA,gBAjBF,I,qFAoBAiL,OAAO,CAACC,GAAR,CAAY,OAAZ,eACA,KAAK1J,QAAL,CAAc,CACZnC,SAAS,CAAE,KADC,CAEZE,OAAO,CAAE,IAFG,CAAd,E,yRAOesP,Q,+LAEShQ,CAAAA,WAAW,CAACiQ,iBAAZ,GAAgCH,YAAhC,E,QAAlB5O,S,gBAEA6O,kB,CAAqB7O,SAAS,CAAC+M,IAAV,CAAeiC,GAAf,CAAmB,SAAAhE,QAAQ,CAAI,CACxD,MAAO,CACLzL,EAAE,CAAEyL,QAAQ,CAACzL,EADR,CAEL8K,KAAK,CAAEW,QAAQ,CAACX,KAFX,CAAP,CAID,CAL0B,C,CAO3BwE,kBAAkB,CAACtE,OAAnB,CAA2B,SAAAvG,IAAI,CAAI,CACjC,GAAIA,IAAI,CAACzE,EAAL,GAAY3D,IAAI,CAACuH,OAAL,CAAa8H,cAAb,CAA4B1L,EAA5C,CAAgD,CAC9CsP,kBAAkB,CAACI,MAAnB,CAA0BJ,kBAAkB,CAACK,OAAnB,CAA2BlL,IAA3B,CAA1B,CAA4D,CAA5D,EACA6K,kBAAkB,CAACI,MAAnB,CAA0B,CAA1B,CAA6B,CAA7B,CAAgCjL,IAAhC,EACD,CACF,CALD,EAOA,GAAI8K,QAAJ,CAAc,CACZ,KAAKrN,QAAL,CAAc,iBAAO,CACnBzB,SAAS,CAAE6O,kBAAF,SAAEA,kBAAF,UAAEA,kBAAF,CAAwB,EADd,CAEnB5O,gBAAgB,CAAE4O,kBAAkB,CAAC,CAAD,CAFjB,CAAP,EAAd,EAID,C,iCACMA,kB,+DAEP3D,OAAO,CAAC5E,KAAR,e,qOAIgB,CAClB,GAAI,KAAKpH,KAAL,CAAWK,EAAf,CAAmB,CACjB,KAAK4P,OAAL,GACD,CAFD,IAEO,CACL,KAAKP,YAAL,CAAkB,IAAlB,EACD,CACF,C,4DAEiBtI,K,CAAO8I,S,CAAW,CAClClE,OAAO,CAACC,GAAR,CAAY,cAAZ,CAA4B7E,KAA5B,EACD,C,oEAEqB+I,S,CAAWC,S,CAAW,CAC1C;AACA,MAAO,KAAP,CACD,C,uCAEQ,CACP,GAAI,KAAKnQ,KAAL,CAAWC,WAAf,CAA4B,CAC1B,MAAO,MAAKmQ,cAAL,CAAoB,KAAKpQ,KAAL,CAAWC,WAA/B,CAAP,CACD,CACD,GAAI,KAAKD,KAAL,CAAWG,SAAf,CAA0B,mBAAO,oBAAC,OAAD,EAAS,MAAM,CAAC,MAAhB,EAAP,CAC1B,GAAI,KAAKH,KAAL,CAAWK,OAAf,CAAwB,mBAAO,wHAAP,CACxB,MAAO,MAAKgQ,UAAL,EAAP,CACD,C,qBA5jCmBzU,Q,wEA6bnByC,Q,yJAcAA,Q,sJAqIAA,Q,qGA+eHyB,OAAO,CAACwQ,aAAR,CAAwB,CACtBlQ,EAAE,CAAE,IADkB,CAAxB,CAIAN,OAAO,CAACyQ,UAAR,CAAqB,CACnBnQ,EAAE,CAAE3B,SAAS,CAAC+R,MADK,CAArB,CAIA,cAAe1Q,CAAAA,OAAf","sourcesContent":["import React from 'react';\r\nimport FormBase from '../../../common/form/FormBase';\r\nimport FormBuilder from '../../../common/form/documents/DocumentFormBuilder';\r\n\r\nimport Invoice from '@distate/core/dist/domain/documents/upd/vo/Invoice';\r\nimport DateInvoice from '@distate/core/dist/domain/documents/upd/vo/invoice/Date';\r\nimport NumInvoice from '@distate/core/dist/domain/documents/upd/vo/invoice/Num';\r\n\r\nimport Correct from '@distate/core/dist/domain/documents/upd/vo/Correct';\r\nimport DateCorrect from '@distate/core/dist/domain/documents/upd/vo/correct/Date';\r\nimport NumberCorrect from '@distate/core/dist/domain/documents/upd/vo/correct/Number';\r\n\r\nimport Currency from '@distate/core/dist/domain/documents/upd/vo/Currency';\r\nimport Recipient from '@distate/core/dist/domain/documents/upd/vo/recipient/Recipient';\r\nimport EconomicSubjectName from '@distate/core/dist/domain/documents/upd/vo/EconomicSubjectName';\r\nimport ExchangeRate from '@distate/core/dist/domain/documents/upd/vo/currency/ExchangeRate';\r\n\r\nimport Flash from '../../../common/flash/Flash';\r\nimport Core from '@distate/core/dist/application/Core';\r\nimport AutocompleteService from '@distate/core/dist/application/autocomplete/AutocompleteService';\r\nimport { SAVE, SUCCESS_SAVE_FORM } from '../../../common/Lbl';\r\n\r\nimport PaymentDocument from '@distate/core/dist/domain/documents/upd/vo/invoice/payment_document/PaymentDocument';\r\nimport CargoFrom from '@distate/core/dist/domain/documents/upd/vo/invoice/CargoFrom';\r\nimport CargoTo from '@distate/core/dist/domain/documents/upd/vo/invoice/CargoTo';\r\nimport Purpose from '@distate/core/dist/domain/documents/upd/vo/Purpose';\r\nimport InvoicePurpose from '@distate/core/dist/domain/documents/upd/vo/purpose/Invoice';\r\nimport WaybillPurpose from '@distate/core/dist/domain/documents/upd/vo/purpose/Waybill';\r\nimport InvoiceWaybillPurpose from '@distate/core/dist/domain/documents/upd/vo/purpose/InvoiceWaybill';\r\n\r\nimport Carrier from '@distate/core/dist/domain/documents/upd/vo/transfer/carrier/Carrier';\r\nimport Name from '@distate/core/dist/domain/documents/upd/vo/Name';\r\n\r\nimport InformationBasisType from '@distate/core/dist/domain/documents/upd/vo/invoice/InformationBasisType';\r\nimport ShipmentDocuments from '@distate/core/dist/domain/documents/upd/vo/invoice/ShipmentDocuments';\r\nimport BasisDocName from '@distate/core/dist/domain/documents/upd/standard_element/basis/DocName';\r\nimport BasisDocNumber from '@distate/core/dist/domain/documents/upd/standard_element/basis/DocNumber';\r\nimport BasisDocDate from '@distate/core/dist/domain/documents/upd/standard_element/basis/DocDate';\r\nimport BasisInformation from '@distate/core/dist/domain/documents/upd/standard_element/basis/Information';\r\nimport BasisDocId from '@distate/core/dist/domain/documents/upd/standard_element/basis/DocId';\r\nimport BasisDocNameEmptyOption from '@distate/core/dist/domain/documents/upd/standard_element/basis/DocNameEmptyOption';\r\n\r\nimport InfoFieldFact1 from '@distate/core/dist/domain/documents/upd/vo/invoice/InfoFieldFact1';\r\n\r\nimport BasisName from '@distate/core/dist/domain/documents/upd/vo/BasisName';\r\n\r\nimport styles from '../../../common/form/documents/DocumentFormBuilder.module.css';\r\nimport { TOP } from '../../../common/Placement';\r\nimport Behavior from '../../../common/form/parameters/Behavior';\r\nimport Appearance from '../../../common/form/parameters/Appearance';\r\nimport createError from '@distate/core/dist/application/error/ErrorFactory';\r\nimport autobind from 'autobind-decorator';\r\nimport { DOCUMENT_VIEW } from '../../../common/Url';\r\nimport { DOCUMENT as DOCUMENT_ERROR } from '@distate/core/dist/application/error/Error';\r\nimport PropTypes from 'prop-types';\r\nimport UPDService from '@distate/core/dist/application/documents/upd/UPDService';\r\nimport get from 'get-value';\r\nimport set from 'set-value';\r\nimport setObject from 'object-path';\r\nimport { set as setImmutable, wrap } from 'object-path-immutable';\r\nimport { clone, removeEmpty } from '../../../utils/ObjectUtil';\r\nimport { Loading } from '@distate/components';\r\nimport ParticipantForm from '../fields/ParticipantForm';\r\nimport Factor from '@distate/core/dist/domain/documents/upd/vo/factor/Factor';\r\nimport InvoiceTableForm from '../../../common/form/InvoiceTableForm';\r\nimport ArrayGroup from './ArrayGroup';\r\nimport PassedByForm from './PassedByForm';\r\nimport TransportationAndCargoModal from './TransportationAndCargoModal';\r\nimport TransportationAndCargo from '@distate/core/dist/domain/documents/upd/vo/transfer/TransportationAndCargo';\r\nimport skipArgs from '../../../utils/skipArgs';\r\n\r\nimport Environment from '@distate/core/dist/application/Environment';\r\nimport DivisionSelect from './DivisionSelect';\r\nimport Division from '@distate/core/dist/domain/documents/upd/vo/Division';\r\n\r\nclass UPDForm extends FormBase {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      ...this.state,\r\n      redirectUrl: '',\r\n      document: null,\r\n      isLoading: !!props.id,\r\n      isError: false,\r\n      showSaveDocumentModal: false,\r\n      errors: null,\r\n      ...this.getDocumentTypeState(InvoicePurpose.value),\r\n      paymentDocuments: [],\r\n      infoFields: [],\r\n      isExchangeRateFieldHidden: true,\r\n      divisions: [],\r\n      selectedDivision: null,\r\n      transferDetails: null\r\n    };\r\n\r\n    this.isDocumentDuplicate = false;\r\n    this.responsePathEntry = null;\r\n    this.responcePathFirstSegment = null;\r\n  }\r\n\r\n  createForm() {\r\n    const BASE_WIDTH = 460;\r\n    const MARGIN = 6;\r\n    const defaultBehavior = new Behavior();\r\n    const defaultAppearance = new Appearance({ width: BASE_WIDTH + MARGIN });\r\n\r\n    const builder = new FormBuilder(this, defaultBehavior, defaultAppearance);\r\n\r\n    const requiredBehavior = new Behavior({ isRequired: true });\r\n\r\n    const serverResponse = this.state.document;\r\n\r\n    this.getCustomData(builder, serverResponse);\r\n    this.getCustomGoodsData(builder, serverResponse);\r\n    const getErrors = errorsObjPath => {\r\n      return clone(get(builder._component, `state.errors.${errorsObjPath}`));\r\n    };\r\n    const clearFieldError = path => {\r\n      let errors = get(builder._component, `state.errors.${path}`);\r\n      if (Array.isArray(errors) && errors.length) {\r\n        setObject(errors, `state.errors.${path}`, []);\r\n        builder._component.setState({ errors });\r\n      }\r\n      if (typeof errors === 'string') {\r\n        errors = get(builder._component, `state.errors`);\r\n        const updatedErrors = setImmutable(errors, path, '');\r\n        builder._component.setState({ errors: updatedErrors });\r\n      }\r\n    };\r\n\r\n    const getBehavior = (defaultBehavior, path, scope = '') => {\r\n      return serverResponse\r\n        ? Behavior.mixin(defaultBehavior, {\r\n            initialFieldDomain: {\r\n              value: scope ? set({}, scope, get(serverResponse, path)) : get(serverResponse, path)\r\n            }\r\n          })\r\n        : defaultBehavior;\r\n    };\r\n\r\n    const handleArrayGroupErrorsChange = path => newErrors => {\r\n      const allErrors = clone(this.state.errors) || {};\r\n      const updatedComponentStateErrors = set(allErrors, path, newErrors);\r\n      this.setState({ errors: updatedComponentStateErrors });\r\n    };\r\n\r\n    builder.buildGroup(\r\n      Invoice,\r\n      {\r\n        [NumInvoice.field]: builder.buildInput,\r\n        [DateInvoice.field]: builder.buildDateInput\r\n      },\r\n      getBehavior(defaultBehavior, `${this.responsePathEntry}.invoice`),\r\n      defaultAppearance,\r\n      {\r\n        [NumInvoice.field]: getBehavior(\r\n          requiredBehavior,\r\n          `${this.responsePathEntry}.invoice.number`\r\n        ),\r\n        [DateInvoice.field]: getBehavior(requiredBehavior, `${this.responsePathEntry}.invoice.date`)\r\n      },\r\n      {\r\n        [NumInvoice.field]: new Appearance({\r\n          width: BASE_WIDTH - 120,\r\n          align: TOP\r\n        }),\r\n        [DateInvoice.field]: new Appearance({\r\n          width: 120,\r\n          customClasses: `ds-input ${styles.width100}`,\r\n          align: TOP\r\n        })\r\n      }\r\n    );\r\n\r\n    builder.buildGroup(\r\n      Correct,\r\n      {\r\n        [NumberCorrect.field]: builder.buildInput,\r\n        [DateCorrect.field]: builder.buildDateInput\r\n      },\r\n      getBehavior(defaultBehavior, `${this.responsePathEntry}.invoice.correction`),\r\n      defaultAppearance,\r\n      {\r\n        [NumberCorrect.field]: getBehavior(\r\n          defaultBehavior,\r\n          `${this.responsePathEntry}.invoice.correction.number`\r\n        ),\r\n        [DateCorrect.field]: getBehavior(\r\n          defaultBehavior,\r\n          `${this.responsePathEntry}.invoice.correction.date`\r\n        )\r\n      },\r\n      {\r\n        [NumberCorrect.field]: new Appearance({\r\n          width: BASE_WIDTH - 120,\r\n          align: TOP\r\n        }),\r\n        [DateCorrect.field]: new Appearance({\r\n          width: 120,\r\n          customClasses: `ds-input ${styles.width100}`,\r\n          align: TOP\r\n        })\r\n      }\r\n    );\r\n\r\n    const getPurpose = () => {\r\n      if (serverResponse) {\r\n        switch (get(serverResponse, `${this.responcePathFirstSegment}.purpose`)) {\r\n          case InvoicePurpose.value:\r\n            return InvoicePurpose;\r\n          case WaybillPurpose.value:\r\n            return WaybillPurpose;\r\n          case InvoiceWaybillPurpose.value:\r\n            return InvoiceWaybillPurpose;\r\n          default:\r\n            return InvoicePurpose;\r\n        }\r\n      } else {\r\n        return InvoicePurpose;\r\n      }\r\n    };\r\n\r\n    const onPurposeChange = purpose => {\r\n      this.setState(this.getDocumentTypeState(purpose));\r\n    };\r\n    const purposeBehavior = new Behavior({\r\n      initialFieldDomain: getPurpose(),\r\n      onChange: onPurposeChange,\r\n      isRequired: true\r\n    });\r\n    builder.buildSelect(Purpose, purposeBehavior);\r\n\r\n    builder.content.push(() => (\r\n      <ArrayGroup\r\n        domainVO={PaymentDocument}\r\n        initialValues={this.state.paymentDocuments}\r\n        returnState={paymentDocuments => this.setState({ paymentDocuments })}\r\n        hasFixedWidthFields\r\n        inputGroupWidth=\"466px\"\r\n        errors={getErrors(PaymentDocument.field)}\r\n        handleErrorsChange={handleArrayGroupErrorsChange(PaymentDocument.field)}\r\n      />\r\n    ));\r\n\r\n    const companyINN = Core.company?.inn?.value ? `, ИНН: ${Core.company?.inn?.value}` : '';\r\n    const companyKPP = Core.company?.kpp?.value ? `, КПП: ${Core.company?.kpp?.value}` : '';\r\n    const economicSubjectNameInitialValue = serverResponse\r\n      ? get(serverResponse, `${this.responsePathEntry}.economicSubjectName`)\r\n      : `${Core.company?.name}${companyINN}${companyKPP}`;\r\n\r\n    const economicSubjectNameBehavior = new Behavior({\r\n      initialFieldDomain: {\r\n        value: economicSubjectNameInitialValue\r\n      },\r\n      isRequired: true\r\n    });\r\n\r\n    const hasDivisions = this.state.divisions.length > 1;\r\n\r\n    builder.content.push(() => (\r\n      <DivisionSelect\r\n        DomainVO={Division}\r\n        options={this.state.divisions}\r\n        selected={this.state.selectedDivision}\r\n        returnState={selectedDivision => this.setState({ selectedDivision })}\r\n        isVisible={hasDivisions}\r\n      />\r\n    ));\r\n\r\n    builder.buildInfo(EconomicSubjectName, economicSubjectNameBehavior, undefined, hasDivisions);\r\n\r\n    const filterLegalEntities = res => res.filter(item => item.type === 'division');\r\n    builder.buildAutocomplete(\r\n      Recipient,\r\n      getBehavior(\r\n        new Behavior({ isRequired: true, onChange: () => clearFieldError(Recipient.field) }),\r\n        `${Recipient.field}.title`\r\n      ),\r\n      ...skipArgs(2),\r\n      filterLegalEntities\r\n    );\r\n\r\n    const setDataToFormState = path => data => {\r\n      set(builder.formState, `values.${path}`, data, { merge: true });\r\n    };\r\n\r\n    builder.content.push(() => (\r\n      <ParticipantForm\r\n        DomainVO={Factor}\r\n        setDataToFormState={setDataToFormState('information')}\r\n        initialValues={{\r\n          factor: get(serverResponse, `${this.responsePathEntry}.invoice.information.factor`)\r\n        }}\r\n        errors={{ factor: getErrors('information.factor') }}\r\n        clearFieldError={clearFieldError}\r\n      />\r\n    ));\r\n\r\n    const cargoFromInitialValues = get(\r\n      serverResponse,\r\n      `${this.responsePathEntry}.invoice.cargoFrom`\r\n    );\r\n    builder.content.push(() => (\r\n      <ParticipantForm\r\n        DomainVO={CargoFrom}\r\n        setDataToFormState={setDataToFormState('invoice.cargoFrom')}\r\n        scope={'consignor'}\r\n        initialValues={\r\n          this.isDocumentDuplicate ? cargoFromInitialValues[0] : cargoFromInitialValues\r\n        }\r\n        errors={getErrors('invoice.cargoFrom')}\r\n        clearFieldError={clearFieldError}\r\n      />\r\n    ));\r\n\r\n    const consigneeInitialValues = get(\r\n      serverResponse,\r\n      `${this.responsePathEntry}.invoice.consignee${this.isDocumentDuplicate ? 's' : ''}`\r\n    );\r\n    builder.content.push(() => (\r\n      <ParticipantForm\r\n        DomainVO={CargoTo}\r\n        setDataToFormState={setDataToFormState('invoice')}\r\n        scope={'consignee'}\r\n        initialValues={{\r\n          consignee: this.isDocumentDuplicate ? consigneeInitialValues[0] : consigneeInitialValues\r\n        }}\r\n        errors={{ consignee: getErrors('consignee') }}\r\n        clearFieldError={clearFieldError}\r\n      />\r\n    ));\r\n\r\n    builder.content.push(() => (\r\n      <ParticipantForm\r\n        DomainVO={Carrier}\r\n        setDataToFormState={setDataToFormState('transferDetails.transportation')}\r\n        customClasses={this.state.isInvoice ? styles.hiddenAndZeroHeight : ''}\r\n        initialValues={{\r\n          carrier: get(\r\n            serverResponse,\r\n            `${this.responsePathEntry}.waybill.transferDetails.transportation.carrier`\r\n          )\r\n        }}\r\n        errors={{ carrier: getErrors('transferDetails.transportation.carrier') }}\r\n        clearFieldError={clearFieldError}\r\n      />\r\n    ));\r\n\r\n    builder.content.push(() => (\r\n      <PassedByForm\r\n        setDataToFormState={setDataToFormState('transferDetails')}\r\n        customClasses={this.state.isInvoice ? styles.hiddenAndZeroHeight : ''}\r\n        initialValues={{\r\n          passedBy: get(\r\n            serverResponse,\r\n            `${this.responsePathEntry}.waybill.transferDetails.passedBy`\r\n          )\r\n        }}\r\n        errors={{ passedBy: getErrors('transferDetails.passedBy') }}\r\n        clearFieldError={clearFieldError}\r\n      />\r\n    ));\r\n\r\n    const clearTransportationAndCargoModalState = () => {\r\n      const updatedDocument = wrap(this.state.document)\r\n        .set('formData.document.waybill.transferDetails.operationInformation', null)\r\n        .set('formData.document.waybill.transferDetails.basis', null)\r\n        .value();\r\n\r\n      this.setState({\r\n        document: updatedDocument,\r\n        transferDetails: null\r\n      });\r\n    };\r\n\r\n    // setDataToFormState('transferDetails')\r\n    // setDataToFormState={transferDetails =>\r\n    //   this.setState({\r\n    //     transferDetails\r\n    //   })\r\n    // }\r\n\r\n    builder.content.push(() => (\r\n      <TransportationAndCargoModal\r\n        DomainVO={TransportationAndCargo}\r\n        setDataToFormState={transferDetails =>\r\n          this.setState({\r\n            transferDetails\r\n          })\r\n        }\r\n        customClasses={this.state.isInvoice ? styles.hiddenAndZeroHeight : ''}\r\n        initialValues={{\r\n          operationInformation: get(\r\n            serverResponse,\r\n            `${this.responsePathEntry}.waybill.transferDetails.operationInformation`\r\n          ),\r\n          basis: get(serverResponse, `${this.responsePathEntry}.waybill.transferDetails.basis`)\r\n        }}\r\n        errors={this.state.errors?.transferDetails}\r\n        waybillError={this.state.errors?.waybill}\r\n        clearFieldError={clearFieldError}\r\n        clearParentState={clearTransportationAndCargoModalState}\r\n      />\r\n    ));\r\n\r\n    const handleCurrencyChange = ({ letter_code }) => {\r\n      clearFieldError(Currency.field);\r\n      this.setState({\r\n        isExchangeRateFieldHidden: letter_code === Currency.initialValue.letterCode.value\r\n      });\r\n    };\r\n    const behaviorCurrency = new Behavior({\r\n      initialFieldDomain: (serverResponse && serverResponse.currency) || Currency.initialValue,\r\n      isRequired: true,\r\n      onChange: handleCurrencyChange\r\n    });\r\n    builder.buildAutocomplete(Currency, behaviorCurrency);\r\n\r\n    builder.buildInput(\r\n      ExchangeRate,\r\n      getBehavior(\r\n        defaultBehavior,\r\n        `${this.responsePathEntry}.invoice.information.currencyExchangeRate`\r\n      ),\r\n      new Appearance({\r\n        ...defaultAppearance,\r\n        customClasses: this.state.isExchangeRateFieldHidden ? styles.hiddenAndZeroHeight : ''\r\n      })\r\n    );\r\n\r\n    builder.buildInput(\r\n      Name,\r\n      getBehavior(defaultBehavior, `${this.responsePathEntry}.name`),\r\n      new Appearance({\r\n        ...defaultAppearance,\r\n        customClasses: !this.state.isWaybill ? styles.hiddenAndZeroHeight : '',\r\n        withRequiredView: true\r\n      })\r\n    );\r\n\r\n    const DATE_WIDTH = 120;\r\n    const basisBehaviors = {\r\n      [BasisDocName.field]: defaultBehavior,\r\n      [BasisDocNumber.field]: defaultBehavior,\r\n      [BasisDocDate.field]: defaultBehavior,\r\n      [BasisInformation.field]: defaultBehavior,\r\n      [BasisDocId.field]: defaultBehavior\r\n    };\r\n    const basisFieldsAppearance = new Appearance({\r\n      width: (2 * BASE_WIDTH - DATE_WIDTH - 3 * MARGIN) / 4,\r\n      align: TOP,\r\n      customClasses: `ds-input ${styles.width100}`\r\n    });\r\n    const basisAppearances = {\r\n      [BasisDocName.field]: basisFieldsAppearance,\r\n      [BasisDocNumber.field]: basisFieldsAppearance,\r\n      [BasisDocDate.field]: new Appearance({\r\n        width: DATE_WIDTH,\r\n        align: TOP,\r\n        customClasses: `ds-input ${styles.width100}`\r\n      }),\r\n      [BasisInformation.field]: basisFieldsAppearance,\r\n      [BasisDocId.field]: basisFieldsAppearance\r\n    };\r\n\r\n    builder.content.push(() => (\r\n      <ArrayGroup\r\n        domainVO={InfoFieldFact1}\r\n        initialValues={this.state.infoFields}\r\n        returnState={infoFields => this.setState({ infoFields })}\r\n        hasFixedWidthFields\r\n        inputGroupWidth=\"466px\"\r\n        errors={getErrors(InfoFieldFact1.field)}\r\n        handleErrorsChange={handleArrayGroupErrorsChange(InfoFieldFact1.field)}\r\n      />\r\n    ));\r\n\r\n    builder.buildInput(\r\n      BasisName,\r\n      getBehavior(defaultBehavior, `${this.responsePathEntry}.basisName`),\r\n      defaultAppearance\r\n    );\r\n\r\n    builder.buildGroup(\r\n      InformationBasisType,\r\n      {\r\n        [BasisDocName.field]: builder.buildInput,\r\n        [BasisDocNumber.field]: builder.buildInput,\r\n        [BasisDocDate.field]: builder.buildDateInput,\r\n        [BasisInformation.field]: builder.buildInput,\r\n        [BasisDocId.field]: builder.buildInput\r\n      },\r\n      getBehavior(defaultBehavior, `${this.responsePathEntry}.invoice.information.basis`),\r\n      defaultAppearance,\r\n      basisBehaviors,\r\n      basisAppearances\r\n    );\r\n\r\n    /** Документ об отгрузке */\r\n    builder.buildGroup(\r\n      ShipmentDocuments,\r\n      {\r\n        [BasisDocName.field]: builder.buildInput,\r\n        [BasisDocNumber.field]: builder.buildInput,\r\n        [BasisDocDate.field]: builder.buildDateInput,\r\n      },\r\n      getBehavior(defaultBehavior, `${this.responsePathEntry}.shipmentDocuments`),\r\n      defaultAppearance,\r\n      basisBehaviors,\r\n      basisAppearances\r\n    );\r\n\r\n    InvoiceTableForm.build(builder, serverResponse, this.responsePathEntry);\r\n    builder.buildLoader();\r\n    builder.buildSubmit(SAVE, null, getErrors('global'));\r\n    builder.buildForm();\r\n\r\n    return builder.getForm();\r\n  }\r\n\r\n  @autobind\r\n  showServerErrorsInForm(data, errorCb = null) {\r\n    if (data[0]) {\r\n      Flash.error(data[0]);\r\n    }\r\n    if (errorCb) errorCb(data);\r\n  }\r\n\r\n  makeSubmitRequest(data) {\r\n    return this.state.document && this.props.isEdit\r\n      ? UPDService.edit(this.state.document.id, data)\r\n      : UPDService.create(data);\r\n  }\r\n\r\n  @autobind\r\n  handleError(data) {\r\n    const errors = {};\r\n    const document = 'messages.document';\r\n    const invoice = 'messages.document.invoice';\r\n    const consignee = 'messages.document.invoice.consignee';\r\n    const consignor = 'messages.document.invoice.cargoFrom.consignor';\r\n    const goods = 'messages.document.table.goods';\r\n    const waybill = 'messages.document.waybill';\r\n\r\n    const purposeError = get(data, `messages.purpose.errors`);\r\n    if (purposeError) errors.purpose = purposeError[0];\r\n\r\n    const toError = get(data, `messages.to.errors`);\r\n    if (toError) errors.recipient = toError[0];\r\n\r\n    const economicSubjectNameError = get(data, `${document}.economicSubjectName.errors`);\r\n    if (economicSubjectNameError) errors.economicSubjectName = economicSubjectNameError[0];\r\n\r\n    const signorPositionError = get(data, `${document}.signor.position.errors`);\r\n    if (signorPositionError) {\r\n      signorPositionError.unshift('Заполните поле Должность в разделе Кабинет');\r\n      this.showServerErrorsInForm(signorPositionError);\r\n      errors.global = signorPositionError[0];\r\n    }\r\n\r\n    const nameError = get(data, `${document}.name.errors`);\r\n    if (nameError) errors.name = nameError[0];\r\n\r\n    const numberError = get(data, `${invoice}.number.errors`);\r\n    if (numberError) errors.number = numberError[0];\r\n\r\n    const dateError = get(data, `${invoice}.date.errors`);\r\n    if (dateError) errors.date = dateError[0];\r\n\r\n    const paymentDocumentsError = get(data, `${invoice}.paymentDocuments.errors`);\r\n    if (paymentDocumentsError) {\r\n      set(errors, 'invoice.paymentDocuments', paymentDocumentsError[0]);\r\n    }\r\n\r\n    const paymentDocumentsElementsErrors = get(data, `${invoice}.paymentDocuments`);\r\n    if (paymentDocumentsElementsErrors) {\r\n      set(errors, 'invoice.paymentDocuments', paymentDocumentsElementsErrors);\r\n    }\r\n\r\n    const consignorErrors = get(data, consignor);\r\n    if (consignorErrors) {\r\n      set(errors, 'cargoFrom.consignor', consignorErrors);\r\n    }\r\n\r\n    const consigneeErrors = get(data, consignee);\r\n    if (consigneeErrors) {\r\n      set(errors, 'consignee', consigneeErrors);\r\n    }\r\n\r\n    const factorErrors = get(data, `${invoice}.information.factor`);\r\n    if (factorErrors) {\r\n      set(errors, 'information.factor', factorErrors);\r\n    }\r\n\r\n    const currencyCodeError = get(data, `${invoice}.currencyCode.errors`);\r\n    if (currencyCodeError) errors.currency = currencyCodeError[0];\r\n\r\n    const currencyNameError = get(data, `${invoice}.information.currencyName.errors`);\r\n    if (currencyNameError) errors.currency = currencyNameError[0];\r\n\r\n    const exchangeRateError = get(data, `${invoice}.information.currencyExchangeRate.errors`);\r\n    if (exchangeRateError) errors.exchangeRate = exchangeRateError[0];\r\n\r\n    const informationFieldsElementsErrors = get(\r\n      data,\r\n      `${invoice}.informationField.attributeValues`\r\n    );\r\n\r\n    if (informationFieldsElementsErrors) {\r\n      if (errors.invoice) {\r\n        errors.invoice.informationField = {\r\n          attributeValues: informationFieldsElementsErrors\r\n        };\r\n      } else {\r\n        errors.invoice = {};\r\n        errors.invoice.informationField = {\r\n          attributeValues: informationFieldsElementsErrors\r\n        };\r\n      }\r\n    }\r\n\r\n    const waybillError = get(data, `${waybill}.errors`);\r\n    if (waybillError) errors.waybill = waybillError[0];\r\n\r\n    const operationInformationError = get(\r\n      data,\r\n      `${waybill}.transferDetails.operationInformation.errors`\r\n    );\r\n    if (operationInformationError) errors.operationInformation = operationInformationError[0];\r\n\r\n    const transferDetailsBasisError = get(data, `${waybill}.transferDetails.basis`);\r\n    if (transferDetailsBasisError) {\r\n      set(errors, 'transferDetails.basis', transferDetailsBasisError);\r\n    }\r\n    const transferDetailsOperationInformationError = get(\r\n      data,\r\n      `${waybill}.transferDetails.operationInformation`\r\n    );\r\n    if (transferDetailsOperationInformationError) {\r\n      set(errors, 'transferDetails.operationInformation', transferDetailsOperationInformationError);\r\n    }\r\n    const passedByErrors = get(data, `${waybill}.transferDetails.passedBy`);\r\n    if (passedByErrors) {\r\n      set(errors, 'transferDetails.passedBy', passedByErrors);\r\n    }\r\n    const carrierErrors = get(data, `${waybill}.transferDetails.transportation.carrier`);\r\n    if (carrierErrors) {\r\n      set(errors, 'transferDetails.transportation.carrier.', carrierErrors);\r\n    }\r\n\r\n    const informationBasisError = get(data, `${invoice}.information.basis.errors`);\r\n    if (informationBasisError) {\r\n      set(errors, 'information.basis', informationBasisError[0]);\r\n    }\r\n\r\n    const goodsErrors = get(data, `${goods}`);\r\n    if (goodsErrors) {\r\n      for (let item in goodsErrors) {\r\n        if (goodsErrors[item].measurementCode) {\r\n          goodsErrors[item].measurement = goodsErrors[item].measurementCode;\r\n        }\r\n      }\r\n      errors.goods = goodsErrors;\r\n    }\r\n    this.setState({ showSaveDocumentModal: true, errors });\r\n  }\r\n\r\n  @autobind\r\n  handleSubmitSuccess(res) {\r\n    if (res.data && res.data.success) {\r\n      const redirectUrl = DOCUMENT_VIEW.replace(':id', res.data.id);\r\n      this.setState({\r\n        isFormSentSuccessfully: true,\r\n        isBusy: false,\r\n        redirectUrl,\r\n        errors: null,\r\n        showSaveDocumentModal: false\r\n      });\r\n    }\r\n  }\r\n\r\n  getAutocompleteValue(DomainVO, formData) {\r\n    const value = formData[DomainVO.field];\r\n    if (!value) return Promise.resolve(null);\r\n    if (this.fieldValueIsNotChosenFromDropdown(value)) {\r\n      return AutocompleteService[DomainVO.field]\r\n        .request(value)\r\n        .then(AutocompleteService.handleUserInput(DomainVO));\r\n    } else {\r\n      return Promise.resolve(new DomainVO(value));\r\n    }\r\n  }\r\n\r\n  sortArrayGroupData(data) {\r\n    const sortedState = [];\r\n    const sortedData = Object.values(data).reduce((itemsStore, item, index) => {\r\n      itemsStore[index] = item;\r\n      sortedState.push(item);\r\n      return itemsStore;\r\n    }, {});\r\n    return { sortedData, sortedState };\r\n  }\r\n\r\n  formatBasisTypeFields(basisTypeFields) {\r\n    if (!basisTypeFields) {\r\n      return {\r\n        0: {\r\n          [BasisDocName.field]: BasisDocNameEmptyOption.title\r\n        }\r\n      };\r\n    }\r\n\r\n    const formattedBasisTypeFields = [];\r\n\r\n    Object.values(basisTypeFields).forEach(el => {\r\n      if (!el[BasisDocName.field]) {\r\n        formattedBasisTypeFields.push({\r\n          [BasisDocName.field]: BasisDocNameEmptyOption.title\r\n        });\r\n      } else {\r\n        formattedBasisTypeFields.push(el);\r\n      }\r\n    });\r\n\r\n    return formattedBasisTypeFields;\r\n  }\r\n\r\n  async processFormData(rawFormData) {\r\n    try {\r\n      delete rawFormData.paymentDocuments;\r\n      const paymentDocumentsSorted = this.sortArrayGroupData(this.state.paymentDocuments);\r\n      set(rawFormData, 'invoice.paymentDocuments', paymentDocumentsSorted.sortedData);\r\n      this.setState({ paymentDocuments: paymentDocumentsSorted.sortedState });\r\n\r\n      delete rawFormData.infoFields;\r\n      const infoFieldsSorted = this.sortArrayGroupData(this.state.infoFields);\r\n      set(rawFormData, 'invoice.informationField.attributeValues', infoFieldsSorted.sortedData);\r\n      this.setState({ infoFields: infoFieldsSorted.sortedState });\r\n\r\n      const formData = removeEmpty(rawFormData);\r\n      const outputObj = {};\r\n\r\n      outputObj.purpose = formData.purpose;\r\n      outputObj.force = formData.force;\r\n      outputObj.from = {\r\n        division: this.state.selectedDivision.id ?? Core.company.mainDepartment.id\r\n      };\r\n\r\n      if (formData.recipient) {\r\n        let division = undefined;\r\n        if (typeof formData.recipient === 'string') {\r\n          console.log('string recipient ', formData.recipient);\r\n          const recipient = await this.getRecipientByTitle(formData.recipient);\r\n          if (recipient) {\r\n            division = Number(recipient.id);\r\n          }\r\n        }\r\n        if (typeof formData.recipient === 'object' && formData.recipient.id) {\r\n          console.log('object recipient ', formData.recipient);\r\n          division = Number(formData.recipient.id);\r\n        }\r\n        if (division) {\r\n          outputObj.to = { division };\r\n        }\r\n      }\r\n\r\n      outputObj.document = {\r\n        economicSubjectName: formData.economicSubjectName,\r\n        basisName: formData.basisName\r\n      };\r\n\r\n      const invoice = formData.invoice || {};\r\n\r\n      const information = formData.information || {};\r\n\r\n      const shipmentDocuments = formData.shipmentDocuments;\r\n      \r\n\r\n      try {\r\n        const currency = await this.getAutocompleteValue(Currency, formData);\r\n        if (currency) {\r\n          invoice.currencyCode = currency.code.value;\r\n          information.currencyName = currency.title;\r\n          if (formData.exchangeRate && !this.state.isExchangeRateFieldHidden) {\r\n            information.currencyExchangeRate = formData.exchangeRate;\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.log(error);\r\n      }\r\n\r\n      if (shipmentDocuments) {\r\n        invoice.shipmentDocuments = [shipmentDocuments];\r\n      }\r\n\r\n      const informationBasis = information?.basis;\r\n\r\n      if (informationBasis) {\r\n        information.basis = this.formatBasisTypeFields(informationBasis);\r\n      }\r\n\r\n      if (Object.keys(information).length) invoice.information = information;\r\n\r\n      outputObj.document.invoice = invoice;\r\n\r\n      \r\n      const goods = formData.goods;\r\n\r\n      goods.forEach(function(good) {\r\n        if (good.measurementCode && (!good.information || !good.information.measurementTitle)) {\r\n          if (!good.information) {\r\n            good.information = {};\r\n          }\r\n          good.information.measurementTitle = good.measurementCode;\r\n          good.measurementCode = '0000';\r\n        }\r\n      });\r\n\r\n      if (goods) {\r\n        const total = {};\r\n        total.totalCostBeforeTax = formData.totalCostBeforeTax;\r\n        total.totalCostAfterTax = formData.totalCostAfterTax;\r\n        total.totalAmountOfTax = formData.totalAmountOfTax;\r\n        outputObj.document.table = { goods, total };\r\n      }\r\n\r\n      if (\r\n        formData.purpose !== InvoicePurpose.value &&\r\n        (this.state.transferDetails || formData.operationInformation)\r\n      ) {\r\n        const waybill = {\r\n          transferDetails: {}\r\n        };\r\n\r\n        if (this.state.transferDetails) {\r\n          waybill.transferDetails = this.state.transferDetails;\r\n          waybill.transferDetails.basis = this.formatBasisTypeFields(\r\n            this.state.transferDetails.basis\r\n          );\r\n        }\r\n\r\n        outputObj.document.waybill = waybill;\r\n      }\r\n      if (formData.purpose === WaybillPurpose.value && formData.name) {\r\n        outputObj.document.name = formData.name;\r\n      }\r\n\r\n      return outputObj;\r\n    } catch (error) {\r\n      throw createError(DOCUMENT_ERROR, 'Ошибка processFormData для формы создания УПД.', error);\r\n    }\r\n  }\r\n\r\n  renderRedirect(url) {\r\n    window.location = url;\r\n  }\r\n\r\n  showSuccessMsg() {\r\n    Flash.success(SUCCESS_SAVE_FORM);\r\n  }\r\n\r\n  async decorateCurrency(serverResponse) {\r\n    const invoice = this.isDocumentDuplicate\r\n      ? serverResponse.parameters.invoice\r\n      : serverResponse.formData.document.invoice;\r\n    const currencyCode = invoice.currencyCode;\r\n\r\n    if (currencyCode) {\r\n      let serverResponseCurrency = await AutocompleteService.currencyByCode.request(currencyCode);\r\n      if (serverResponseCurrency.rows.length === 1) {\r\n        serverResponse.currency = new Currency(serverResponseCurrency.rows[0]);\r\n      }\r\n    }\r\n  }\r\n\r\n  async getRecipientByTitle(title) {\r\n    if (!title) return Promise.resolve(null);\r\n    const recipient = await AutocompleteService.recipient\r\n      .request(title)\r\n      .then(recipients => {\r\n        return recipients.rows.filter(item =>\r\n          item.title.toLowerCase().includes(title.toLowerCase())\r\n        );\r\n      })\r\n      .then(filteredRecipients => {\r\n        if (filteredRecipients.length === 1) return filteredRecipients[0];\r\n        const exactMatch = filteredRecipients.find(\r\n          item => item.title.toLowerCase() === title.toLowerCase()\r\n        );\r\n        return exactMatch || null;\r\n      });\r\n    return recipient;\r\n  }\r\n\r\n  async decorateRecipient(serverResponse) {\r\n    try { // исправление бага без возможности воспроизвести на рабочем стенде\r\n      if (!serverResponse[this.responcePathFirstSegment]?.to) return;\r\n\r\n      if (this.isDocumentDuplicate) {\r\n        // TODO check buyers\r\n        const resArr =serverResponse?.parameters?.invoice?.buyers || [];\r\n        const { name, inn } = resArr[0] || {};\r\n        const recipients = await AutocompleteService.recipient.request();\r\n        const {rows = []} = recipients;\r\n        serverResponse[Recipient.field] = rows.find(\r\n          value => value.title.includes(name) || value.title.includes(inn)\r\n        );\r\n      } else {\r\n        // TODO process person\r\n        const { division } = serverResponse.formData.to;\r\n        if (division) {\r\n          const recipients = await AutocompleteService.recipient.request();\r\n          serverResponse[Recipient.field] = recipients.rows.find(value => value.id === division);\r\n        }\r\n      }\r\n\r\n    } catch (err) {\r\n      console.log('err', err)\r\n    }\r\n    \r\n  }\r\n\r\n  async decorateMeasurement(serverResponse) {\r\n    const goods = get(serverResponse, `${this.responsePathEntry}.table.goods`);\r\n    if (!goods) return;\r\n    let newServerResponse = serverResponse;\r\n    goods.forEach((good, index) => {\r\n      const measurementTitle = get(good, 'information.measurementTitle');\r\n      newServerResponse = setImmutable(\r\n        newServerResponse,\r\n        `${this.responsePathEntry}.table.goods.${index}.measurementCode`,\r\n        measurementTitle\r\n      );\r\n    });\r\n    return newServerResponse;\r\n  }\r\n\r\n  getCustomGoodsData(builder, serverResponse) {\r\n    const serverResponseGoods = get(serverResponse, `${this.responsePathEntry}.table.goods`);\r\n    const localStateGoods = get(builder._component.state, 'goods');\r\n    if (serverResponseGoods && !localStateGoods) {\r\n      let newValuesForState = {};\r\n      serverResponseGoods.forEach((good, index) => {\r\n        const measurementTitle = get(\r\n          builder._component.state,\r\n          `goods.${index}.information.measurementTitle`\r\n        );\r\n        if (!measurementTitle) {\r\n          const newMeasurementTitle = get(good, 'information.measurementTitle');\r\n          if (newMeasurementTitle) {\r\n            const newMeasurementData = {\r\n              information: {\r\n                measurementTitle: newMeasurementTitle\r\n              },\r\n              measurementCode: get(\r\n                this.serverResponse,\r\n                `${this.responsePathEntry}.table.goods.${index}.measurementCode`\r\n              )\r\n            };\r\n            newValuesForState = setImmutable(\r\n              newValuesForState,\r\n              `goods.${index}`,\r\n              newMeasurementData\r\n            );\r\n          }\r\n        }\r\n\r\n        const currentInfoFields = get(builder._component.state, `goods.${index}.infoFields`);\r\n        if (!currentInfoFields || !Object.entries(currentInfoFields).length) {\r\n          const newInfoFields = get(good, `infoFields`);\r\n          if (newInfoFields && newInfoFields.length) {\r\n            newValuesForState = setImmutable(\r\n              newValuesForState,\r\n              `goods.${index}.infoFields`,\r\n              newInfoFields\r\n            );\r\n          }\r\n        }\r\n\r\n        const currentInformation = get(builder._component.state, `goods.${index}.information`);\r\n        if (!currentInformation || !Object.entries(currentInformation).length) {\r\n          const newInformation = get(good, `information`);\r\n          if (newInformation) {\r\n            newValuesForState = setImmutable(\r\n              newValuesForState,\r\n              `goods.${index}.information`,\r\n              newInformation\r\n            );\r\n          }\r\n        }\r\n\r\n        const currentIdentificationNumbers = get(\r\n          builder._component.state,\r\n          `goods.${index}.information.identificationNumbers`\r\n        );\r\n        if (!currentIdentificationNumbers || !Object.entries(currentIdentificationNumbers).length) {\r\n          const newIdentificationNumbers = get(good, `information.identificationNumbers`);\r\n          if (newIdentificationNumbers && newIdentificationNumbers.length) {\r\n            newValuesForState = setImmutable(\r\n              newValuesForState,\r\n              `goods.${index}.information.identificationNumbers`,\r\n              newIdentificationNumbers\r\n            );\r\n          }\r\n        }\r\n\r\n        const currentTracking = get(\r\n          builder._component.state,\r\n          `goods.${index}.information.tracking`\r\n        );\r\n        if (!currentTracking || !Object.entries(currentTracking).length) {\r\n          const newTracking = get(good, `information.tracking`);\r\n          if (newTracking && newTracking.length) {\r\n            newValuesForState = setImmutable(\r\n              newValuesForState,\r\n              `goods.${index}.information.tracking`,\r\n              newTracking\r\n            );\r\n          }\r\n        }\r\n      });\r\n      if (Object.entries(newValuesForState).length) {\r\n        builder.setDataToComponentState({ ...newValuesForState });\r\n      }\r\n    }\r\n  }\r\n\r\n  getCustomData(builder, serverResponse) {\r\n    const newValuesForState = {};\r\n    let paymentDocuments = get(\r\n      serverResponse,\r\n      `${this.responsePathEntry}.invoice.paymentDocuments`\r\n    );\r\n    if (paymentDocuments) paymentDocuments = Object.entries(paymentDocuments);\r\n    if (\r\n      paymentDocuments &&\r\n      paymentDocuments.length &&\r\n      Object.entries(this.state.paymentDocuments).length === 0\r\n    ) {\r\n      newValuesForState.paymentDocuments = paymentDocuments;\r\n    }\r\n    let infoFields = get(\r\n      serverResponse,\r\n      `${this.responsePathEntry}.invoice.informationField.attributeValues`\r\n    );\r\n    if (infoFields) infoFields = Object.entries(infoFields);\r\n    if (infoFields && infoFields.length && Object.entries(this.state.infoFields).length === 0) {\r\n      newValuesForState.infoFields = infoFields;\r\n    }\r\n    if (Object.keys(newValuesForState).length) {\r\n      this.setState({ ...newValuesForState });\r\n    }\r\n  }\r\n\r\n  getDocumentTypeState(purpose) {\r\n    return {\r\n      isInvoice: purpose === InvoicePurpose.value,\r\n      isWaybill: purpose === WaybillPurpose.value,\r\n      isInvoiceWaybill: purpose === InvoiceWaybillPurpose.value\r\n    };\r\n  }\r\n\r\n  async getData() {\r\n    try {\r\n      this.serverResponse = await UPDService.get(this.props.id);\r\n      if (this.serverResponse.formData === null) this.isDocumentDuplicate = true;\r\n      this.responsePathEntry = this.isDocumentDuplicate ? 'parameters' : 'formData.document';\r\n      this.responcePathFirstSegment = this.isDocumentDuplicate ? 'parameters' : 'formData';\r\n      await this.decorateCurrency(this.serverResponse);\r\n      await this.decorateRecipient(this.serverResponse);\r\n      let document = await this.decorateMeasurement(this.serverResponse);\r\n\r\n      const formattedDivisions = await this.getDivisions();\r\n      const [selectedDivision] = formattedDivisions.filter(\r\n        division => division.id === get(this.serverResponse, 'formData.from.division')\r\n      );\r\n\r\n      this.setState({\r\n        isLoading: false,\r\n        isError: false,\r\n        document,\r\n        ...this.getDocumentTypeState(this.serverResponse[this.responcePathFirstSegment].purpose),\r\n        paymentDocuments: get(\r\n          this.serverResponse,\r\n          `${this.responsePathEntry}.invoice.paymentDocuments`\r\n        ),\r\n        infoFields: get(\r\n          this.serverResponse,\r\n          `${this.responsePathEntry}.invoice.informationField.attributeValues`\r\n        ),\r\n        isExchangeRateFieldHidden:\r\n          this.serverResponse?.currency?.letterCode?.value ===\r\n          Currency.initialValue.letterCode.value,\r\n        divisions: formattedDivisions,\r\n        selectedDivision\r\n      });\r\n    } catch (error) {\r\n      console.log('error', error);\r\n      this.setState({\r\n        isLoading: false,\r\n        isError: true\r\n      });\r\n    }\r\n  }\r\n\r\n  async getDivisions(isNewDoc) {\r\n    try {\r\n      const divisions = await Environment.getCompanyGateway().getDivisions();\r\n\r\n      const formattedDivisions = divisions.rows.map(division => {\r\n        return {\r\n          id: division.id,\r\n          title: division.title\r\n        };\r\n      });\r\n\r\n      formattedDivisions.forEach(item => {\r\n        if (item.id === Core.company.mainDepartment.id) {\r\n          formattedDivisions.splice(formattedDivisions.indexOf(item), 1);\r\n          formattedDivisions.splice(0, 0, item);\r\n        }\r\n      });\r\n\r\n      if (isNewDoc) {\r\n        this.setState(() => ({\r\n          divisions: formattedDivisions ?? [],\r\n          selectedDivision: formattedDivisions[0]\r\n        }));\r\n      }\r\n      return formattedDivisions;\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    if (this.props.id) {\r\n      this.getData();\r\n    } else {\r\n      this.getDivisions(true);\r\n    }\r\n  }\r\n\r\n  componentDidCatch(error, errorInfo) {\r\n    console.log('React error:', error);\r\n  }\r\n\r\n  shouldComponentUpdate(nextProps, nextState) {\r\n    // TODO optimize performance\r\n    return true;\r\n  }\r\n\r\n  render() {\r\n    if (this.state.redirectUrl) {\r\n      return this.renderRedirect(this.state.redirectUrl);\r\n    }\r\n    if (this.state.isLoading) return <Loading height=\"75vh\" />;\r\n    if (this.state.isError) return <span>Возникла ошибка</span>;\r\n    return this.createForm();\r\n  }\r\n}\r\n\r\nUPDForm.defaultValues = {\r\n  id: null\r\n};\r\n\r\nUPDForm.propsTypes = {\r\n  id: PropTypes.string\r\n};\r\n\r\nexport default UPDForm;\r\n"]},"metadata":{},"sourceType":"module"}