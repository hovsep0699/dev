{"ast":null,"code":"import _classCallCheck from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _get from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/get\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\nimport SignHandlerBase from '../SignHandlerBase';\nimport SignRequest from '../../SignRequest';\nimport { CertificateService } from '../../../certificate/CertificateService';\n\nvar CreateSignHandler = /*#__PURE__*/function (_SignHandlerBase) {\n  _inherits(CreateSignHandler, _SignHandlerBase);\n\n  var _super = _createSuper(CreateSignHandler);\n\n  function CreateSignHandler() {\n    _classCallCheck(this, CreateSignHandler);\n\n    return _super.apply(this, arguments);\n  }\n\n  _createClass(CreateSignHandler, [{\n    key: \"sign\",\n    value: function sign(request) {\n      var _this = this;\n\n      _get(_getPrototypeOf(CreateSignHandler.prototype), \"sign\", this).call(this, request);\n\n      if (this.canHandle(request)) {\n        var successHandler = function successHandler(signature) {\n          var documentRequest = SignRequest.clone(request);\n          documentRequest.addSignature(signature);\n          return _this.doNextHandler(documentRequest);\n        };\n\n        var failHandler = function failHandler(error) {\n          var failureRequest = SignRequest.clone(request);\n          failureRequest.addSignFailure({\n            id: request.documentToSign.id,\n            step: 'CreateSignHandler',\n            error: error\n          });\n          return _this.doNextHandler(failureRequest);\n        };\n\n        return CertificateService.sign(request.documentToSign.content, request.certificate.thumbprint).then(successHandler).catch(failHandler);\n      }\n\n      return this.doNextHandler(request);\n    }\n  }, {\n    key: \"canHandle\",\n    value: function canHandle(request) {\n      var _a;\n\n      _get(_getPrototypeOf(CreateSignHandler.prototype), \"canHandle\", this).call(this, request);\n\n      var docIsSigned = request.signedDocumentIds.has(request.documentToSign.packageId);\n      return !!request.certificate && request.isGrantedToSign && !docIsSigned && ((_a = request.documentToSign) === null || _a === void 0 ? void 0 : _a.content);\n    }\n  }]);\n\n  return CreateSignHandler;\n}(SignHandlerBase);\n\nexport default CreateSignHandler;","map":{"version":3,"sources":["../../../../../src/application/sign/handlers/sign/CreateSignHandler.js"],"names":[],"mappings":";;;;;;AAAA,OAAO,eAAP,MAA4B,oBAA5B;AACA,OAAO,WAAP,MAAwB,mBAAxB;AACA,SAAS,kBAAT,QAAmC,yCAAnC;;IAEM,iB;;;;;;;;;;;;;yBACC,O,EAAO;AAAA;;AACV,kFAAW,OAAX;;AACA,UAAI,KAAK,SAAL,CAAe,OAAf,CAAJ,EAA6B;AAC3B,YAAM,cAAc,GAAG,SAAjB,cAAiB,CAAA,SAAS,EAAG;AACjC,cAAM,eAAe,GAAG,WAAW,CAAC,KAAZ,CAAkB,OAAlB,CAAxB;AACA,UAAA,eAAe,CAAC,YAAhB,CAA6B,SAA7B;AACA,iBAAO,KAAI,CAAC,aAAL,CAAmB,eAAnB,CAAP;AACD,SAJD;;AAMA,YAAM,WAAW,GAAG,SAAd,WAAc,CAAA,KAAK,EAAG;AAC1B,cAAM,cAAc,GAAG,WAAW,CAAC,KAAZ,CAAkB,OAAlB,CAAvB;AACA,UAAA,cAAc,CAAC,cAAf,CAA8B;AAC5B,YAAA,EAAE,EAAE,OAAO,CAAC,cAAR,CAAuB,EADC;AAE5B,YAAA,IAAI,EAAE,mBAFsB;AAG5B,YAAA,KAAK,EAAL;AAH4B,WAA9B;AAKA,iBAAO,KAAI,CAAC,aAAL,CAAmB,cAAnB,CAAP;AACD,SARD;;AASA,eAAO,kBAAkB,CAAC,IAAnB,CAAwB,OAAO,CAAC,cAAR,CAAuB,OAA/C,EAAwD,OAAO,CAAC,WAAR,CAAoB,UAA5E,EACJ,IADI,CACC,cADD,EAEJ,KAFI,CAEE,WAFF,CAAP;AAGD;;AACD,aAAO,KAAK,aAAL,CAAmB,OAAnB,CAAP;AACD;;;8BAES,O,EAAO;;;AACf,uFAAgB,OAAhB;;AACA,UAAM,WAAW,GAAG,OAAO,CAAC,iBAAR,CAA0B,GAA1B,CAA8B,OAAO,CAAC,cAAR,CAAuB,SAArD,CAApB;AACA,aACE,CAAC,CAAC,OAAO,CAAC,WAAV,IACA,OAAO,CAAC,eADR,IAEA,CAAC,WAFD,KAEY,CAAA,EAAA,GACZ,OAAO,CAAC,cADI,MACU,IADV,IACU,EAAA,KAAA,KAAA,CADV,GACU,KAAA,CADV,GACU,EAAA,CAAE,OAHxB,CADF;AAMD;;;;EAnC6B,e;;AAsChC,eAAe,iBAAf","sourceRoot":"","sourcesContent":["import SignHandlerBase from '../SignHandlerBase';\r\nimport SignRequest from '../../SignRequest';\r\nimport { CertificateService } from '../../../certificate/CertificateService';\r\nclass CreateSignHandler extends SignHandlerBase {\r\n    sign(request) {\r\n        super.sign(request);\r\n        if (this.canHandle(request)) {\r\n            const successHandler = signature => {\r\n                const documentRequest = SignRequest.clone(request);\r\n                documentRequest.addSignature(signature);\r\n                return this.doNextHandler(documentRequest);\r\n            };\r\n            const failHandler = error => {\r\n                const failureRequest = SignRequest.clone(request);\r\n                failureRequest.addSignFailure({\r\n                    id: request.documentToSign.id,\r\n                    step: 'CreateSignHandler',\r\n                    error\r\n                });\r\n                return this.doNextHandler(failureRequest);\r\n            };\r\n            return CertificateService.sign(request.documentToSign.content, request.certificate.thumbprint)\r\n                .then(successHandler)\r\n                .catch(failHandler);\r\n        }\r\n        return this.doNextHandler(request);\r\n    }\r\n    canHandle(request) {\r\n        var _a;\r\n        super.canHandle(request);\r\n        const docIsSigned = request.signedDocumentIds.has(request.documentToSign.packageId);\r\n        return (!!request.certificate &&\r\n            request.isGrantedToSign &&\r\n            !docIsSigned && ((_a = request.documentToSign) === null || _a === void 0 ? void 0 : _a.content));\r\n    }\r\n}\r\nexport default CreateSignHandler;\r\n//# sourceMappingURL=CreateSignHandler.js.map"]},"metadata":{},"sourceType":"module"}