{"ast":null,"code":"import _defineProperty from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _objectSpread from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useRef}from'react';import styles from'./ArrayGroup.module.css';import classNames from'classnames';import Text from'../../../common/form/components/Text';import Textarea from'../../../common/form/components/Textarea';import{TOP}from'../../../common/Placement';import DateInputNew from'../../../common/form/components/DateInputNew';import{DELETE,ADD}from'../../../common/Lbl';import MeasurementAutocomplete from'../fields/MeasurementAutocomplete';import Select from'../../../common/form/components/select/Select';import get from'get-value';import{set as setImmutable}from'object-path-immutable';var ArrayGroup=function ArrayGroup(_ref){var returnState=_ref.returnState,initialValues=_ref.initialValues,_ref$isFirstRowNameHi=_ref.isFirstRowNameHidden,isFirstRowNameHidden=_ref$isFirstRowNameHi===void 0?false:_ref$isFirstRowNameHi,domainVO=_ref.domainVO,_ref$hasFixedWidthFie=_ref.hasFixedWidthFields,hasFixedWidthFields=_ref$hasFixedWidthFie===void 0?false:_ref$hasFixedWidthFie,_ref$isHidden=_ref.isHidden,isHidden=_ref$isHidden===void 0?false:_ref$isHidden,requiredFields=_ref.requiredFields,_ref$errors=_ref.errors,errors=_ref$errors===void 0?{}:_ref$errors,_ref$handleErrorsChan=_ref.handleErrorsChange,handleErrorsChange=_ref$handleErrorsChan===void 0?function(){}:_ref$handleErrorsChan;var initialFields=domainVO.VOs.reduce(function(obj,DomainVO){obj[DomainVO.field]='';return obj;},{});var initialFieldsAmount=domainVO.VOs.length;var defaultState={0:initialFields};var _useState=useState(defaultState),_useState2=_slicedToArray(_useState,2),stateValues=_useState2[0],setStateValues=_useState2[1];var hasInitialValues=Array.isArray(initialValues)&&initialValues.length>0;var totalRows=useRef(0);if(hasInitialValues)totalRows.current=initialValues.length;var newState=hasInitialValues&&initialValues.reduce(function(newValues,value,index){if(initialValues.length===1&&Object.values(value).every(function(val){return val==='';})){return _objectSpread({},defaultState);}else{newValues[index]=value;return _objectSpread({},newValues);}},{});var isRowNumberVisible=Object.keys(stateValues).length>0&&totalRows.current>0;var checkedRequiredFields=Array.isArray(requiredFields)&&requiredFields.length>0&&requiredFields;var addRow=function addRow(fieldsData){totalRows.current+=1;setStateValues(_objectSpread(_objectSpread({},stateValues),{},_defineProperty({},totalRows.current,_objectSpread({},initialFields))));};var discardProp=function discardProp(obj,key){var leftValues=Object.keys(obj).reduce(function(newValues,currentKey){if(currentKey!==key)newValues[currentKey]=obj[currentKey];return newValues;},{});return leftValues;};var removeRow=function removeRow(key){handleErrorsChange(discardProp(errors,key));setStateValues(discardProp(stateValues,key));};var handleBtnClick=function handleBtnClick(fieldsData,key){if(parseInt(key,10)===0){addRow(fieldsData);}else{removeRow(key);}};var changeValue=function changeValue(fieldData,DomainVO,key){var fieldName=DomainVO.field;var updatedValues=Object.keys(stateValues).reduce(function(newValues,currentKey){newValues[currentKey]=stateValues[currentKey];if(currentKey===key){newValues[currentKey][fieldName]=fieldData;validateField(DomainVO,key,fieldData);}return newValues;},{});setStateValues(updatedValues);};var validateField=function validateField(Domain,key,value){var newFieldErrors=[];var errorMsg=Domain.validate(value);if(errorMsg){newFieldErrors.push(errorMsg);}var updatedErrors=setImmutable(errors,\"\".concat(key,\".\").concat(Domain.field,\".errors\"),newFieldErrors);handleErrorsChange(updatedErrors);};var getFieldErrorMsg=function getFieldErrorMsg(Domain,itemNumber){var fieldErrors=get(errors,\"\".concat(itemNumber,\".\").concat(Domain.field,\".errors\"));if(Array.isArray(fieldErrors)&&fieldErrors.length>0){return fieldErrors[fieldErrors.length-1];}};var renderDateField=function renderDateField(DomainVO,itemNumber,isRequired){return/*#__PURE__*/React.createElement(DateInputNew,{DomainVO:DomainVO,labelAlign:TOP,initialValue:stateValues[itemNumber][DomainVO.field],onValueChange:function onValueChange(value){return changeValue(value,DomainVO,itemNumber);},hasLabel:false,isRequired:isRequired,errorMsg:getFieldErrorMsg(DomainVO,itemNumber)});};var renderSelectField=function renderSelectField(DomainVO,itemNumber,isRequired){return/*#__PURE__*/React.createElement(Select,{DomainVO:DomainVO,labelAlign:TOP,initialValue:stateValues[itemNumber][DomainVO.field],onValueChange:function onValueChange(value){return changeValue(value,DomainVO,itemNumber);},hasLabel:false,selectorWidth:\"100%\",isRequired:isRequired,errorMsg:getFieldErrorMsg(DomainVO,itemNumber)});};var renderAutocomplete=function renderAutocomplete(DomainVO,itemNumber,isRequired){return/*#__PURE__*/React.createElement(MeasurementAutocomplete,{labelAlign:TOP,initialValue:stateValues[itemNumber][DomainVO.field].title,onValueChange:function onValueChange(value){return changeValue(value,DomainVO,itemNumber);},hasLabel:false,isRequired:isRequired,errorMsg:getFieldErrorMsg(DomainVO,itemNumber)});};var renderTextarea=function renderTextarea(DomainVO,itemNumber,isRequired){return/*#__PURE__*/React.createElement(Textarea,{DomainVO:DomainVO,labelAlign:TOP,initialValue:stateValues[itemNumber][DomainVO.field],onValueChange:function onValueChange(value){return changeValue(value,DomainVO,itemNumber);},hasLabel:false,isRequired:isRequired,errorMsg:getFieldErrorMsg(DomainVO,itemNumber)});};var renderInputField=function renderInputField(DomainVO,itemNumber,isRequired){return/*#__PURE__*/React.createElement(Text,{DomainVO:DomainVO,labelAlign:TOP,initialValue:stateValues[itemNumber][DomainVO.field],onValueChange:function onValueChange(value){return changeValue(value,DomainVO,itemNumber);},hasLabel:false,isRequired:isRequired,errorMsg:getFieldErrorMsg(DomainVO,itemNumber)});};var renderFormFields=function renderFormFields(groupDomainVO,itemNumber){return groupDomainVO.VOs.map(function(DomainVO,index){var isRequired=checkedRequiredFields[index];if(DomainVO.type==='date'){return renderDateField(DomainVO,itemNumber,isRequired);}else if(DomainVO.type==='select'){return renderSelectField(DomainVO,itemNumber,isRequired);}else if(DomainVO.type==='autocomplete'){return renderAutocomplete(DomainVO,itemNumber,isRequired);}else if(DomainVO.type==='textarea'){return renderTextarea(DomainVO,itemNumber,isRequired);}else{return renderInputField(DomainVO,itemNumber,isRequired);}});};useEffect(function(){if(newState){setStateValues(newState);returnState(newState);}else{returnState(stateValues);}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[stateValues,initialValues]);return Object.entries(stateValues).map(function(item,index){var _classNames2;var isFirstRow=index===0;var removableRow=index>0;var itemNumber=item[0];return/*#__PURE__*/React.createElement(\"li\",{className:classNames(_defineProperty({},styles.hidden,isHidden))},isFirstRow&&/*#__PURE__*/React.createElement(\"div\",{className:classNames(styles.customLabels,(_classNames2={},_defineProperty(_classNames2,styles.narrowLeftIndent,isFirstRowNameHidden),_defineProperty(_classNames2,styles.fullWidth,isFirstRowNameHidden),_defineProperty(_classNames2,styles.fixedWidth,hasFixedWidthFields),_classNames2))},domainVO.VOs.map(function(DomainVO,index){return/*#__PURE__*/React.createElement(\"div\",{className:classNames('ds-field-name','top',styles.customLabel,styles[\"customLabelCol\".concat(initialFieldsAmount)],{required:checkedRequiredFields[index]})},DomainVO.name);})),/*#__PURE__*/React.createElement(\"div\",{className:classNames('group',styles.alignTop)},/*#__PURE__*/React.createElement(\"div\",{className:classNames('ds-field-name',_defineProperty({},styles.rowNameNarrow,isFirstRowNameHidden))},isFirstRow&&!isFirstRowNameHidden&&/*#__PURE__*/React.createElement(\"span\",{className:styles.longLable},domainVO.name),isRowNumberVisible&&/*#__PURE__*/React.createElement(\"span\",{className:\"right\"},index+1))),/*#__PURE__*/React.createElement(\"div\",{className:classNames('group',styles.noMargin,_defineProperty({},styles.fullWidth,!hasFixedWidthFields))},/*#__PURE__*/React.createElement(\"div\",{className:classNames('group',styles.inputGroup,styles[\"fieldCols\".concat(initialFieldsAmount)],styles.alignChildrenTop,_defineProperty({},styles.fixedWidth,hasFixedWidthFields))},renderFormFields(domainVO,itemNumber)),/*#__PURE__*/React.createElement(\"div\",{className:classNames('group',styles.alignTop)},/*#__PURE__*/React.createElement(\"button\",{className:classNames('ds-button',{'icon-add':!removableRow,'icon-delete':removableRow}),type:\"button\",style:{width:130},onClick:function onClick(){return handleBtnClick(item[1],item[0]);}},removableRow?DELETE:ADD))));});};ArrayGroup.defaultProps={hasFixedWidthFields:false,isFirstRowNameHidden:false};export default ArrayGroup;","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/upd/forms/ArrayGroup.js"],"names":["React","useState","useEffect","useRef","styles","classNames","Text","Textarea","TOP","DateInputNew","DELETE","ADD","MeasurementAutocomplete","Select","get","set","setImmutable","ArrayGroup","returnState","initialValues","isFirstRowNameHidden","domainVO","hasFixedWidthFields","isHidden","requiredFields","errors","handleErrorsChange","initialFields","VOs","reduce","obj","DomainVO","field","initialFieldsAmount","length","defaultState","stateValues","setStateValues","hasInitialValues","Array","isArray","totalRows","current","newState","newValues","value","index","Object","values","every","val","isRowNumberVisible","keys","checkedRequiredFields","addRow","fieldsData","discardProp","key","leftValues","currentKey","removeRow","handleBtnClick","parseInt","changeValue","fieldData","fieldName","updatedValues","validateField","Domain","newFieldErrors","errorMsg","validate","push","updatedErrors","getFieldErrorMsg","itemNumber","fieldErrors","renderDateField","isRequired","renderSelectField","renderAutocomplete","title","renderTextarea","renderInputField","renderFormFields","groupDomainVO","map","type","entries","item","isFirstRow","removableRow","hidden","customLabels","narrowLeftIndent","fullWidth","fixedWidth","customLabel","required","name","alignTop","rowNameNarrow","longLable","noMargin","inputGroup","alignChildrenTop","width","defaultProps"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport styles from './ArrayGroup.module.css';\r\nimport classNames from 'classnames';\r\nimport Text from '../../../common/form/components/Text';\r\nimport Textarea from '../../../common/form/components/Textarea';\r\nimport { TOP } from '../../../common/Placement';\r\nimport DateInputNew from '../../../common/form/components/DateInputNew';\r\nimport { DELETE, ADD } from '../../../common/Lbl';\r\nimport PropTypes from 'prop-types';\r\nimport MeasurementAutocomplete from '../fields/MeasurementAutocomplete';\r\nimport Select from '../../../common/form/components/select/Select';\r\nimport get from 'get-value';\r\nimport { set as setImmutable } from 'object-path-immutable';\r\n\r\nconst ArrayGroup = ({\r\n  returnState,\r\n  initialValues,\r\n  isFirstRowNameHidden = false,\r\n  domainVO,\r\n  hasFixedWidthFields = false,\r\n  isHidden = false,\r\n  requiredFields,\r\n  errors = {},\r\n  handleErrorsChange = () => {}\r\n}) => {\r\n  const initialFields = domainVO.VOs.reduce((obj, DomainVO) => {\r\n    obj[DomainVO.field] = '';\r\n    return obj;\r\n  }, {});\r\n  const initialFieldsAmount = domainVO.VOs.length;\r\n  const defaultState = { 0: initialFields };\r\n  const [stateValues, setStateValues] = useState(defaultState);\r\n  const hasInitialValues = Array.isArray(initialValues) && initialValues.length > 0;\r\n  const totalRows = useRef(0);\r\n  if (hasInitialValues) totalRows.current = initialValues.length;\r\n  const newState =\r\n    hasInitialValues &&\r\n    initialValues.reduce((newValues, value, index) => {\r\n      if (initialValues.length === 1 && Object.values(value).every(val => val === '')) {\r\n        return { ...defaultState };\r\n      } else {\r\n        newValues[index] = value;\r\n        return { ...newValues };\r\n      }\r\n    }, {});\r\n  const isRowNumberVisible = Object.keys(stateValues).length > 0 && totalRows.current > 0;\r\n  const checkedRequiredFields =\r\n    Array.isArray(requiredFields) && requiredFields.length > 0 && requiredFields;\r\n\r\n  const addRow = fieldsData => {\r\n    totalRows.current += 1;\r\n    setStateValues({\r\n      ...stateValues,\r\n      [totalRows.current]: { ...initialFields }\r\n    });\r\n  };\r\n\r\n  const discardProp = (obj, key) => {\r\n    const leftValues = Object.keys(obj).reduce((newValues, currentKey) => {\r\n      if (currentKey !== key) newValues[currentKey] = obj[currentKey];\r\n      return newValues;\r\n    }, {});\r\n    return leftValues;\r\n  };\r\n\r\n  const removeRow = key => {\r\n    handleErrorsChange(discardProp(errors, key));\r\n    setStateValues(discardProp(stateValues, key));\r\n  };\r\n\r\n  const handleBtnClick = (fieldsData, key) => {\r\n    if (parseInt(key, 10) === 0) {\r\n      addRow(fieldsData);\r\n    } else {\r\n      removeRow(key);\r\n    }\r\n  };\r\n\r\n  const changeValue = (fieldData, DomainVO, key) => {\r\n    const fieldName = DomainVO.field;\r\n    const updatedValues = Object.keys(stateValues).reduce((newValues, currentKey) => {\r\n      newValues[currentKey] = stateValues[currentKey];\r\n      if (currentKey === key) {\r\n        newValues[currentKey][fieldName] = fieldData;\r\n        validateField(DomainVO, key, fieldData);\r\n      }\r\n      return newValues;\r\n    }, {});\r\n\r\n    setStateValues(updatedValues);\r\n  };\r\n\r\n  const validateField = (Domain, key, value) => {\r\n    const newFieldErrors = [];\r\n    const errorMsg = Domain.validate(value);\r\n    if (errorMsg) {\r\n      newFieldErrors.push(errorMsg);\r\n    }\r\n    const updatedErrors = setImmutable(errors, `${key}.${Domain.field}.errors`, newFieldErrors);\r\n    handleErrorsChange(updatedErrors);\r\n  };\r\n\r\n  const getFieldErrorMsg = (Domain, itemNumber) => {\r\n    const fieldErrors = get(errors, `${itemNumber}.${Domain.field}.errors`);\r\n    if (Array.isArray(fieldErrors) && fieldErrors.length > 0) {\r\n      return fieldErrors[fieldErrors.length - 1];\r\n    }\r\n  };\r\n\r\n  const renderDateField = (DomainVO, itemNumber, isRequired) => (\r\n    <DateInputNew\r\n      DomainVO={DomainVO}\r\n      labelAlign={TOP}\r\n      initialValue={stateValues[itemNumber][DomainVO.field]}\r\n      onValueChange={value => changeValue(value, DomainVO, itemNumber)}\r\n      hasLabel={false}\r\n      isRequired={isRequired}\r\n      errorMsg={getFieldErrorMsg(DomainVO, itemNumber)}\r\n    />\r\n  );\r\n\r\n  const renderSelectField = (DomainVO, itemNumber, isRequired) => (\r\n    <Select\r\n      DomainVO={DomainVO}\r\n      labelAlign={TOP}\r\n      initialValue={stateValues[itemNumber][DomainVO.field]}\r\n      onValueChange={value => changeValue(value, DomainVO, itemNumber)}\r\n      hasLabel={false}\r\n      selectorWidth=\"100%\"\r\n      isRequired={isRequired}\r\n      errorMsg={getFieldErrorMsg(DomainVO, itemNumber)}\r\n    />\r\n  );\r\n\r\n  const renderAutocomplete = (DomainVO, itemNumber, isRequired) => (\r\n    <MeasurementAutocomplete\r\n      labelAlign={TOP}\r\n      initialValue={stateValues[itemNumber][DomainVO.field].title}\r\n      onValueChange={value => changeValue(value, DomainVO, itemNumber)}\r\n      hasLabel={false}\r\n      isRequired={isRequired}\r\n      errorMsg={getFieldErrorMsg(DomainVO, itemNumber)}\r\n    />\r\n  );\r\n\r\n  const renderTextarea = (DomainVO, itemNumber, isRequired) => (\r\n    <Textarea\r\n      DomainVO={DomainVO}\r\n      labelAlign={TOP}\r\n      initialValue={stateValues[itemNumber][DomainVO.field]}\r\n      onValueChange={value => changeValue(value, DomainVO, itemNumber)}\r\n      hasLabel={false}\r\n      isRequired={isRequired}\r\n      errorMsg={getFieldErrorMsg(DomainVO, itemNumber)}\r\n    />\r\n  );\r\n\r\n  const renderInputField = (DomainVO, itemNumber, isRequired) => (\r\n    <Text\r\n      DomainVO={DomainVO}\r\n      labelAlign={TOP}\r\n      initialValue={stateValues[itemNumber][DomainVO.field]}\r\n      onValueChange={value => changeValue(value, DomainVO, itemNumber)}\r\n      hasLabel={false}\r\n      isRequired={isRequired}\r\n      errorMsg={getFieldErrorMsg(DomainVO, itemNumber)}\r\n    />\r\n  );\r\n\r\n  const renderFormFields = (groupDomainVO, itemNumber) => {\r\n    return groupDomainVO.VOs.map((DomainVO, index) => {\r\n      const isRequired = checkedRequiredFields[index];\r\n      if (DomainVO.type === 'date') {\r\n        return renderDateField(DomainVO, itemNumber, isRequired);\r\n      } else if (DomainVO.type === 'select') {\r\n        return renderSelectField(DomainVO, itemNumber, isRequired);\r\n      } else if (DomainVO.type === 'autocomplete') {\r\n        return renderAutocomplete(DomainVO, itemNumber, isRequired);\r\n      } else if (DomainVO.type === 'textarea') {\r\n        return renderTextarea(DomainVO, itemNumber, isRequired);\r\n      } else {\r\n        return renderInputField(DomainVO, itemNumber, isRequired);\r\n      }\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (newState) {\r\n      setStateValues(newState);\r\n      returnState(newState);\r\n    } else {\r\n      returnState(stateValues);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [stateValues, initialValues]);\r\n\r\n  return Object.entries(stateValues).map((item, index) => {\r\n    const isFirstRow = index === 0;\r\n    const removableRow = index > 0;\r\n    const itemNumber = item[0];\r\n    return (\r\n      <li className={classNames({ [styles.hidden]: isHidden })}>\r\n        {isFirstRow && (\r\n          <div\r\n            className={classNames(styles.customLabels, {\r\n              [styles.narrowLeftIndent]: isFirstRowNameHidden,\r\n              [styles.fullWidth]: isFirstRowNameHidden,\r\n              [styles.fixedWidth]: hasFixedWidthFields\r\n            })}\r\n          >\r\n            {domainVO.VOs.map((DomainVO, index) => (\r\n              <div\r\n                className={classNames(\r\n                  'ds-field-name',\r\n                  'top',\r\n                  styles.customLabel,\r\n                  styles[`customLabelCol${initialFieldsAmount}`],\r\n                  { required: checkedRequiredFields[index] }\r\n                )}\r\n              >\r\n                {DomainVO.name}\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n\r\n        <div className={classNames('group', styles.alignTop)}>\r\n          <div\r\n            className={classNames('ds-field-name', {\r\n              [styles.rowNameNarrow]: isFirstRowNameHidden\r\n            })}\r\n          >\r\n            {isFirstRow && !isFirstRowNameHidden && (\r\n              <span className={styles.longLable}>{domainVO.name}</span>\r\n            )}\r\n\r\n            {isRowNumberVisible && <span className=\"right\">{index + 1}</span>}\r\n          </div>\r\n        </div>\r\n\r\n        <div\r\n          className={classNames('group', styles.noMargin, {\r\n            [styles.fullWidth]: !hasFixedWidthFields\r\n          })}\r\n        >\r\n          <div\r\n            className={classNames(\r\n              'group',\r\n              styles.inputGroup,\r\n              styles[`fieldCols${initialFieldsAmount}`],\r\n              styles.alignChildrenTop,\r\n              {\r\n                [styles.fixedWidth]: hasFixedWidthFields\r\n              }\r\n            )}\r\n          >\r\n            {renderFormFields(domainVO, itemNumber)}\r\n          </div>\r\n\r\n          <div className={classNames('group', styles.alignTop)}>\r\n            <button\r\n              className={classNames('ds-button', {\r\n                'icon-add': !removableRow,\r\n                'icon-delete': removableRow\r\n              })}\r\n              type=\"button\"\r\n              style={{ width: 130 }}\r\n              onClick={() => handleBtnClick(item[1], item[0])}\r\n            >\r\n              {removableRow ? DELETE : ADD}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </li>\r\n    );\r\n  });\r\n};\r\n\r\nArrayGroup.defaultProps = {\r\n  hasFixedWidthFields: false,\r\n  isFirstRowNameHidden: false\r\n};\r\n\r\nArrayGroup.propTypes = {\r\n  returnState: PropTypes.func.isRequired,\r\n  initialValues: PropTypes.oneOfType([PropTypes.array, PropTypes.object]).isRequired,\r\n  hasFixedWidthFields: PropTypes.bool,\r\n  isFirstRowNameHidden: PropTypes.bool,\r\n  domainVO: PropTypes.object,\r\n  scope: PropTypes.string,\r\n  requiredFields: PropTypes.arrayOf(PropTypes.bool)\r\n};\r\n\r\nexport default ArrayGroup;\r\n"]},"metadata":{},"sourceType":"module"}