{"ast":null,"code":"import _objectSpread from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(certificatesEffect),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(getCertificatesWorker),_marked3=/*#__PURE__*/_regeneratorRuntime.mark(changeUseCertificateWorker);import{takeLatest,put}from'redux-saga/effects';import{Flash}from'../../../../common/flash/Flash';import{getCertificates,setCertificates,changeUseCertificate}from'../actions';import{cabinetGateway}from'@distate/core/dist/application/cabinet/CabinetGateway';import{expandCertificateList}from'@distate/core/dist/application/certificate/CertificateHelper';import cryptoPro from'@distate/core/dist/infrastructure/CryptoPro';/** Кабинет - Сертификаты */export function certificatesEffect(){return _regeneratorRuntime.wrap(function certificatesEffect$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return takeLatest(getCertificates,getCertificatesWorker);case 2:_context.next=4;return takeLatest(changeUseCertificate,changeUseCertificateWorker);case 4:case\"end\":return _context.stop();}}},_marked);}/** получение информации о сертификатах */function getCertificatesWorker(_ref){var payload,certificates,localCertificates,localThumbprints,extendedRows,message;return _regeneratorRuntime.wrap(function getCertificatesWorker$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:payload=_ref.payload;_context2.prev=1;_context2.next=4;return cabinetGateway.getCertificates(payload);case 4:certificates=_context2.sent;_context2.next=7;return cryptoPro.get();case 7:localCertificates=_context2.sent;/** отпечатки установленных на компьютер сертификатов */localThumbprints=localCertificates.map(function(item){return item.Thumbprint;});/** достаем из сертов дополнительную информацию */_context2.next=11;return expandCertificateList(certificates.rows);case 11:extendedRows=_context2.sent;_context2.next=14;return put(setCertificates({certificates:_objectSpread(_objectSpread({},certificates),{},{rows:extendedRows,localThumbprints:localThumbprints})}));case 14:_context2.next=21;break;case 16:_context2.prev=16;_context2.t0=_context2[\"catch\"](1);message=_context2.t0.message;_context2.next=21;return Flash.error(message||'Возникла ошибка');case 21:case\"end\":return _context2.stop();}}},_marked2,null,[[1,16]]);}/** смена используемого сертификата */function changeUseCertificateWorker(_ref3){var payload,message;return _regeneratorRuntime.wrap(function changeUseCertificateWorker$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:payload=_ref3.payload;_context3.prev=1;_context3.next=4;return cabinetGateway.changeUseCertificate(payload);case 4:_context3.next=6;return put(getCertificates({}));case 6:_context3.next=13;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](1);message=_context3.t0.message;_context3.next=13;return Flash.error(message||'Возникла ошибка');case 13:case\"end\":return _context3.stop();}}},_marked3,null,[[1,8]]);}","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/cabinet/store/sagas/certificates.effect.ts"],"names":["certificatesEffect","getCertificatesWorker","changeUseCertificateWorker","takeLatest","put","Flash","getCertificates","setCertificates","changeUseCertificate","cabinetGateway","expandCertificateList","cryptoPro","payload","certificates","get","localCertificates","localThumbprints","map","item","Thumbprint","rows","extendedRows","message","error"],"mappings":"8XAQiBA,kB,iDAMPC,qB,iDAqBAC,0B,EAnCV,OAASC,UAAT,CAAqBC,GAArB,KAAgC,oBAAhC,CACA,OAASC,KAAT,KAAsB,gCAAtB,CACA,OAASC,eAAT,CAA0BC,eAA1B,CAA2CC,oBAA3C,KAAuE,YAAvE,CACA,OAASC,cAAT,KAA+B,uDAA/B,CACA,OAASC,qBAAT,KAAsC,8DAAtC,CACA,MAAOC,CAAAA,SAAP,KAAsB,6CAAtB,CAEA,4BACA,MAAO,SAAUX,CAAAA,kBAAV,8IACL,MAAMG,CAAAA,UAAU,CAACG,eAAD,CAAkBL,qBAAlB,CAAhB,CADK,uBAEL,MAAME,CAAAA,UAAU,CAACK,oBAAD,CAAuBN,0BAAvB,CAAhB,CAFK,sDAKP,0CACA,QAAUD,CAAAA,qBAAV,yNAAkCW,OAAlC,MAAkCA,OAAlC,mCAGyB,MAAMH,CAAAA,cAAc,CAACH,eAAf,CAA+BM,OAA/B,CAAN,CAHzB,OAGUC,YAHV,iCAK8B,MAAMF,CAAAA,SAAS,CAACG,GAAV,EAAN,CAL9B,OAKUC,iBALV,gBAMI,wDACMC,gBAPV,CAO6BD,iBAAiB,CAACE,GAAlB,CAAsB,SAACC,IAAD,QAAeA,CAAAA,IAAI,CAACC,UAApB,EAAtB,CAP7B,CASI,kDATJ,kBAUyB,MAAMT,CAAAA,qBAAqB,CAACG,YAAY,CAACO,IAAd,CAA3B,CAVzB,QAUUC,YAVV,kCAYI,MAAMjB,CAAAA,GAAG,CACPG,eAAe,CAAC,CAAEM,YAAY,gCAAOA,YAAP,MAAqBO,IAAI,CAAEC,YAA3B,CAAyCL,gBAAgB,CAAhBA,gBAAzC,EAAd,CAAD,CADR,CAAT,CAZJ,6FAeaM,OAfb,cAeaA,OAfb,mBAgBI,MAAMjB,CAAAA,KAAK,CAACkB,KAAN,CAAYD,OAAO,EAAI,iBAAvB,CAAN,CAhBJ,uEAoBA,sCACA,QAAUpB,CAAAA,0BAAV,kKAAuCU,OAAvC,OAAuCA,OAAvC,mCAEI,MAAMH,CAAAA,cAAc,CAACD,oBAAf,CAAoCI,OAApC,CAAN,CAFJ,wBAGI,MAAMR,CAAAA,GAAG,CAACE,eAAe,CAAC,EAAD,CAAhB,CAAT,CAHJ,0FAIagB,OAJb,cAIaA,OAJb,mBAKI,MAAMjB,CAAAA,KAAK,CAACkB,KAAN,CAAYD,OAAO,EAAI,iBAAvB,CAAN,CALJ","sourcesContent":["import { takeLatest, put } from 'redux-saga/effects';\r\nimport { Flash } from '../../../../common/flash/Flash';\r\nimport { getCertificates, setCertificates, changeUseCertificate } from '../actions';\r\nimport { cabinetGateway } from '@distate/core/dist/application/cabinet/CabinetGateway';\r\nimport { expandCertificateList } from '@distate/core/dist/application/certificate/CertificateHelper';\r\nimport cryptoPro from '@distate/core/dist/infrastructure/CryptoPro';\r\n\r\n/** Кабинет - Сертификаты */\r\nexport function* certificatesEffect() {\r\n  yield takeLatest(getCertificates, getCertificatesWorker);\r\n  yield takeLatest(changeUseCertificate, changeUseCertificateWorker);\r\n}\r\n\r\n/** получение информации о сертификатах */\r\nfunction* getCertificatesWorker({ payload }: { payload: any }) {\r\n  try {\r\n    /** получаем сертификаты */\r\n    const certificates = yield cabinetGateway.getCertificates(payload);\r\n\r\n    const localCertificates = yield cryptoPro.get();\r\n    /** отпечатки установленных на компьютер сертификатов */\r\n    const localThumbprints = localCertificates.map((item: any) => item.Thumbprint);\r\n\r\n    /** достаем из сертов дополнительную информацию */\r\n    const extendedRows = yield expandCertificateList(certificates.rows);\r\n\r\n    yield put(\r\n      setCertificates({ certificates: { ...certificates, rows: extendedRows, localThumbprints } })\r\n    );\r\n  } catch ({ message }) {\r\n    yield Flash.error(message || 'Возникла ошибка');\r\n  }\r\n}\r\n\r\n/** смена используемого сертификата */\r\nfunction* changeUseCertificateWorker({ payload }: { payload: number }) {\r\n  try {\r\n    yield cabinetGateway.changeUseCertificate(payload);\r\n    yield put(getCertificates({}));\r\n  } catch ({ message }) {\r\n    yield Flash.error(message || 'Возникла ошибка');\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}