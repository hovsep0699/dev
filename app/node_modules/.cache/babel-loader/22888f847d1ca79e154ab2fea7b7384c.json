{"ast":null,"code":"import React from'react';import styled from'styled-components';import{Anchor}from'grommet';import{CheckBox,Icons}from'@distate/components';import PackageStatesService from'@distate/core/dist/application/documents/common/packageStates/PackageStatesService';import{DOCUMENT_DRAFT,DOCUMENT_VIEW}from'../../../common/Url';import{EDIT}from'../../../common/Lbl';import changeIconFill from'../../../utils/changeIconFill';import{ButtonDetach}from'../../../container/folder/features/detach';import{ButtonDownload}from'../components/buttons';import{HTMLTags,HTMLTag,HTMLIcons}from'../documents.style';import{getEditUrl}from'./documnets.helpers';import{getExternalTypeToString}from'../../../helpers/heplers';var IconEdit=changeIconFill(Icons.IconPencil);var IconDownload=changeIconFill(Icons.IconDownload);export var HTMLAnchor=styled(Anchor).withConfig({displayName:\"documentscolumns__HTMLAnchor\",componentId:\"sc-132lb5h-0\"})(function(_ref){var theme=_ref.theme;return{color:theme.main.font.color.dark,':hover':{color:theme.main.font.color.dark}};});export var getColumnts=function getColumnts(_ref2){var _ref2$rows=_ref2.rows,rows=_ref2$rows===void 0?[]:_ref2$rows,folders=_ref2.folders,pathname=_ref2.pathname,isDownload=_ref2.isDownload,isAllSelected=_ref2.isAllSelected,onCheck=_ref2.onCheck,onCheckAll=_ref2.onCheckAll,onDetachFolder=_ref2.onDetachFolder,onClickDownload=_ref2.onClickDownload;var foldersHash=folders?folders.reduce(function(prev,curr){prev[curr.id]=curr.title;return prev;},{}):{};return[{width:'229px',property:'companyName',header:'Контрагент',format:function format(value,datum,index){var status=datum.status,toCompanyName=datum.toCompanyName,toPersonName=datum.toPersonName,fromPersonName=datum.fromPersonName,fromCompanyName=datum.fromCompanyName,containerID=datum.containerID,containerSize=datum.containerSize,toCompanyExternalType=datum.toCompanyExternalType,toCompanyExternalOperator=datum.toCompanyExternalOperator,toCompanyNetwork=datum.toCompanyNetwork,fromCompanyExternalType=datum.fromCompanyExternalType,fromCompanyExternalOperator=datum.fromCompanyExternalOperator,fromCompanyNetwork=datum.fromCompanyNetwork;/** подготовленная строка с описанием типеа для исходящих */var toContractorType=getExternalTypeToString(toCompanyExternalType,toCompanyExternalOperator,toCompanyNetwork);/** подготовленная строка с описание типа для входящих */var fromContractorType=getExternalTypeToString(fromCompanyExternalType,fromCompanyExternalOperator,fromCompanyNetwork);if(containerSize&&rows[index-1]&&containerID===rows[index-1]['containerID']){return null;}if(status==='sent'||status==='draft'||status==='signed'){if(toPersonName)return toPersonName;if(toCompanyName)return toCompanyName+toContractorType;}if(status==='received'){if(fromPersonName)return fromPersonName;if(fromCompanyName)return fromCompanyName+fromContractorType;}if(toCompanyName)return toCompanyName+toContractorType;if(fromCompanyName)return fromCompanyName+fromContractorType;if(toPersonName)return toPersonName;if(fromPersonName)return fromPersonName;return'';}},{width:'48px',property:'containerSize',format:function format(value,datum,index){var containerID=datum.containerID,containerSize=datum.containerSize;if(!value||containerSize&&rows[index-1]&&containerID===rows[index-1]['containerID']){return null;}return/*#__PURE__*/React.createElement(HTMLIcons,null,/*#__PURE__*/React.createElement(Icons.IconFiles,null),/*#__PURE__*/React.createElement(\"span\",null,value));}},{width:'48px',property:'checkbox',header:/*#__PURE__*/React.createElement(CheckBox,{onChange:onCheckAll,checked:!!isAllSelected}),format:function format(value,datum){var checked=datum.checked;return/*#__PURE__*/React.createElement(CheckBox,{checked:checked,onChange:function onChange(){return onCheck(datum);}});}},{width:'200px',property:'documentTitle',header:'Документ',format:function format(value,_ref3){var id=_ref3.id,isRead=_ref3.isRead,containerSize=_ref3.containerSize;var styles={};var hrefView=DOCUMENT_VIEW.replace(':id',id);var renders=[];if(!isRead){renders.push(/*#__PURE__*/React.createElement(HTMLTag,{key:\"tag_\".concat(id),kind:\"success\"},\"\\u043D\\u043E\\u0432\\u044B\\u0439\"));}if(containerSize){styles['marginTop']=8;}renders.push(/*#__PURE__*/React.createElement(HTMLAnchor,{key:\"link_\".concat(id),style:styles,label:value,href:hrefView,margin:{vertical:'small'}}));return/*#__PURE__*/React.createElement(HTMLTags,{key:\"tags_\".concat(id)},renders);}},{width:'120px',property:'status',header:'Статус',format:function format(value,datum){if(pathname===DOCUMENT_DRAFT){if(value==='signed'){return'Подписан';}var state=PackageStatesService.getStateByName(datum.packageState,'OUT');return state.label;}var aggregatedPackageState=PackageStatesService.getAggregatedStateByStateName(datum.packageState,datum.packageType||'IN');var label=aggregatedPackageState.label;if(aggregatedPackageState.name==='complete'&&datum.uvutochExist){label=\"\".concat(aggregatedPackageState.label,\" (c \\u0443\\u0442\\u043E\\u0447\\u043D\\u0435\\u043D\\u0438\\u0435\\u043C)\");}return label;}},{width:'180px',property:'date',header:'Дата создания'},// TODO колонка с названием договора для Tektorg\n{width:'40px',property:'edit',format:function format(value,datum){var id=datum.id,flowType=datum.flowType,flowGroup=datum.flowGroup,status=datum.status,documentTypeSystemName=datum.documentTypeSystemName;var isEdit=status==='draft'&&!['act','waybill'].includes(documentTypeSystemName);var url=getEditUrl(id,flowType,flowGroup);if(!isEdit){return null;}return/*#__PURE__*/React.createElement(HTMLAnchor,{title:EDIT,href:url},/*#__PURE__*/React.createElement(IconEdit,null));}},{width:'40px',property:'download',format:function format(value,_ref4){var packageId=_ref4.packageId;return/*#__PURE__*/React.createElement(ButtonDownload,{solid:true,onClick:function onClick(){return onClickDownload([packageId]);},loading:!!isDownload},/*#__PURE__*/React.createElement(IconDownload,null));}},{width:'40px',property:'folder',format:function format(value,datum){var packageId=datum.packageId,_datum$labels=datum.labels,labels=_datum$labels===void 0?[]:_datum$labels;var itemFolders=labels.map(function(item){return{id:item.id,title:foldersHash.hasOwnProperty(item.id)?foldersHash[item.id]:item.title};});return/*#__PURE__*/React.createElement(ButtonDetach,{packageId:packageId,folders:itemFolders,callbackSuccess:onDetachFolder});}}];};export var getRowClass=function getRowClass(item,index,rows){var containerID=item.containerID,containerSize=item.containerSize;if(containerSize&&rows[index-1]&&rows[index-1].containerID===containerID){return'no-border';}return;};","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/documents/helpers/documents.columns.tsx"],"names":["React","styled","Anchor","CheckBox","Icons","PackageStatesService","DOCUMENT_DRAFT","DOCUMENT_VIEW","EDIT","changeIconFill","ButtonDetach","ButtonDownload","HTMLTags","HTMLTag","HTMLIcons","getEditUrl","getExternalTypeToString","IconEdit","IconPencil","IconDownload","HTMLAnchor","theme","color","main","font","dark","getColumnts","rows","folders","pathname","isDownload","isAllSelected","onCheck","onCheckAll","onDetachFolder","onClickDownload","foldersHash","reduce","prev","curr","id","title","width","property","header","format","value","datum","index","status","toCompanyName","toPersonName","fromPersonName","fromCompanyName","containerID","containerSize","toCompanyExternalType","toCompanyExternalOperator","toCompanyNetwork","fromCompanyExternalType","fromCompanyExternalOperator","fromCompanyNetwork","toContractorType","fromContractorType","checked","isRead","styles","hrefView","replace","renders","push","vertical","state","getStateByName","packageState","label","aggregatedPackageState","getAggregatedStateByStateName","packageType","name","uvutochExist","flowType","flowGroup","documentTypeSystemName","isEdit","includes","url","packageId","labels","itemFolders","map","item","hasOwnProperty","getRowClass"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport styled from 'styled-components';\r\nimport { Anchor } from 'grommet';\r\nimport { CheckBox, Icons } from '@distate/components';\r\nimport PackageStatesService from '@distate/core/dist/application/documents/common/packageStates/PackageStatesService';\r\n\r\nimport { DOCUMENT_DRAFT, DOCUMENT_VIEW } from '../../../common/Url';\r\nimport { EDIT } from '../../../common/Lbl';\r\nimport changeIconFill from '../../../utils/changeIconFill';\r\n\r\nimport { ButtonDetach } from '../../../container/folder/features/detach';\r\nimport { IColumn } from '../components/table/types';\r\nimport { ButtonDownload } from '../components/buttons';\r\nimport { HTMLTags, HTMLTag, HTMLIcons } from '../documents.style';\r\nimport { DocumentType } from './documents.typings';\r\nimport { getEditUrl } from './documnets.helpers';\r\nimport { getExternalTypeToString } from '../../../helpers/heplers';\r\n\r\nconst IconEdit = changeIconFill(Icons.IconPencil);\r\nconst IconDownload = changeIconFill(Icons.IconDownload);\r\n\r\nexport const HTMLAnchor = styled(Anchor)(({ theme }) => {\r\n  return {\r\n    color: theme.main.font.color.dark,\r\n    ':hover': {\r\n      color: theme.main.font.color.dark\r\n    }\r\n  };\r\n});\r\n\r\nexport type IRows = DocumentType[];\r\n\r\nexport type IColumns = {\r\n  rows: DocumentType[];\r\n  folders?: any[];\r\n  onCheck: (item: DocumentType) => void;\r\n  onCheckAll: () => void;\r\n  onDetachFolder: ({ folderId, packageId }: any) => void;\r\n  onClickDownload: (ids: any[]) => void;\r\n  pathname: string;\r\n  isDownload?: boolean;\r\n  isAllSelected?: boolean;\r\n};\r\n\r\nexport const getColumnts = <D extends DocumentType>({\r\n  rows = [],\r\n  folders,\r\n  pathname,\r\n  isDownload,\r\n  isAllSelected,\r\n  onCheck,\r\n  onCheckAll,\r\n  onDetachFolder,\r\n  onClickDownload\r\n}: IColumns): IColumn<D>[] => {\r\n  const foldersHash: any = folders\r\n    ? folders.reduce((prev, curr) => {\r\n        prev[curr.id] = curr.title;\r\n        return prev;\r\n      }, {})\r\n    : {};\r\n\r\n  return [\r\n    {\r\n      width: '229px',\r\n      property: 'companyName',\r\n      header: 'Контрагент',\r\n      format: (value, datum: DocumentType, index) => {\r\n        const {\r\n          status,\r\n          toCompanyName,\r\n          toPersonName,\r\n          fromPersonName,\r\n          fromCompanyName,\r\n          containerID,\r\n          containerSize,\r\n          toCompanyExternalType,\r\n          toCompanyExternalOperator,\r\n          toCompanyNetwork,\r\n          fromCompanyExternalType,\r\n          fromCompanyExternalOperator,\r\n          fromCompanyNetwork\r\n        } = datum;\r\n\r\n        /** подготовленная строка с описанием типеа для исходящих */\r\n        const toContractorType = getExternalTypeToString(\r\n          toCompanyExternalType,\r\n          toCompanyExternalOperator,\r\n          toCompanyNetwork\r\n        );\r\n\r\n        /** подготовленная строка с описание типа для входящих */\r\n        const fromContractorType = getExternalTypeToString(\r\n          fromCompanyExternalType,\r\n          fromCompanyExternalOperator,\r\n          fromCompanyNetwork\r\n        );\r\n\r\n        if (containerSize && rows[index - 1] && containerID === rows[index - 1]['containerID']) {\r\n          return null;\r\n        }\r\n\r\n        if (status === 'sent' || status === 'draft' || status === 'signed') {\r\n          if (toPersonName) return toPersonName;\r\n          if (toCompanyName) return toCompanyName + toContractorType;\r\n        }\r\n\r\n        if (status === 'received') {\r\n          if (fromPersonName) return fromPersonName;\r\n          if (fromCompanyName) return fromCompanyName + fromContractorType;\r\n        }\r\n\r\n        if (toCompanyName) return toCompanyName + toContractorType;\r\n        if (fromCompanyName) return fromCompanyName + fromContractorType;\r\n        if (toPersonName) return toPersonName;\r\n        if (fromPersonName) return fromPersonName;\r\n\r\n        return '';\r\n      }\r\n    },\r\n    {\r\n      width: '48px',\r\n      property: 'containerSize',\r\n      format: (value, datum: DocumentType, index) => {\r\n        const { containerID, containerSize } = datum;\r\n        if (\r\n          !value ||\r\n          (containerSize && rows[index - 1] && containerID === rows[index - 1]['containerID'])\r\n        ) {\r\n          return null;\r\n        }\r\n\r\n        return (\r\n          <HTMLIcons>\r\n            <Icons.IconFiles />\r\n            <span>{value}</span>\r\n          </HTMLIcons>\r\n        );\r\n      }\r\n    },\r\n    {\r\n      width: '48px',\r\n      property: 'checkbox',\r\n      header: <CheckBox onChange={onCheckAll} checked={!!isAllSelected} />,\r\n      format: (value, datum: DocumentType) => {\r\n        const { checked } = datum;\r\n        return <CheckBox checked={checked} onChange={() => onCheck(datum)} />;\r\n      }\r\n    },\r\n    {\r\n      width: '200px',\r\n      property: 'documentTitle',\r\n      header: 'Документ',\r\n      format: (value, { id, isRead, containerSize }: DocumentType) => {\r\n        const styles: React.CSSProperties = {};\r\n        const hrefView = DOCUMENT_VIEW.replace(':id', id);\r\n        const renders = [];\r\n\r\n        if (!isRead) {\r\n          renders.push(\r\n            <HTMLTag key={`tag_${id}`} kind=\"success\">\r\n              новый\r\n            </HTMLTag>\r\n          );\r\n        }\r\n\r\n        if (containerSize) {\r\n          styles['marginTop'] = 8;\r\n        }\r\n\r\n        renders.push(\r\n          <HTMLAnchor\r\n            key={`link_${id}`}\r\n            style={styles}\r\n            label={value}\r\n            href={hrefView}\r\n            margin={{ vertical: 'small' }}\r\n          />\r\n        );\r\n\r\n        return <HTMLTags key={`tags_${id}`}>{renders}</HTMLTags>;\r\n      }\r\n    },\r\n    {\r\n      width: '120px',\r\n      property: 'status',\r\n      header: 'Статус',\r\n      format: (value, datum: DocumentType) => {\r\n        if (pathname === DOCUMENT_DRAFT) {\r\n          if (value === 'signed') {\r\n            return 'Подписан';\r\n          }\r\n\r\n          const state = PackageStatesService.getStateByName(datum.packageState, 'OUT');\r\n          return state.label;\r\n        }\r\n\r\n        const aggregatedPackageState = PackageStatesService.getAggregatedStateByStateName(\r\n          datum.packageState,\r\n          datum.packageType || 'IN'\r\n        );\r\n\r\n        let label = aggregatedPackageState.label;\r\n        if (aggregatedPackageState.name === 'complete' && datum.uvutochExist) {\r\n          label = `${aggregatedPackageState.label} (c уточнением)`;\r\n        }\r\n\r\n        return label;\r\n      }\r\n    },\r\n    {\r\n      width: '180px',\r\n      property: 'date',\r\n      header: 'Дата создания'\r\n    },\r\n    // TODO колонка с названием договора для Tektorg\r\n    {\r\n      width: '40px',\r\n      property: 'edit',\r\n      format: (value, datum: DocumentType) => {\r\n        const { id, flowType, flowGroup, status, documentTypeSystemName } = datum;\r\n        const isEdit = status === 'draft' && !['act', 'waybill'].includes(documentTypeSystemName);\r\n        const url = getEditUrl(id, flowType, flowGroup);\r\n\r\n        if (!isEdit) {\r\n          return null;\r\n        }\r\n\r\n        return (\r\n          <HTMLAnchor title={EDIT} href={url}>\r\n            <IconEdit />\r\n          </HTMLAnchor>\r\n        );\r\n      }\r\n    },\r\n    {\r\n      width: '40px',\r\n      property: 'download',\r\n      format: (value, { packageId }: DocumentType) => (\r\n        <ButtonDownload solid onClick={() => onClickDownload([packageId])} loading={!!isDownload}>\r\n          <IconDownload />\r\n        </ButtonDownload>\r\n      )\r\n    },\r\n    {\r\n      width: '40px',\r\n      property: 'folder',\r\n      format: (value, datum: DocumentType) => {\r\n        const { packageId, labels = [] } = datum;\r\n        const itemFolders = labels.map(item => ({\r\n          id: item.id,\r\n          title: foldersHash.hasOwnProperty(item.id) ? foldersHash[item.id] : item.title\r\n        }));\r\n\r\n        return (\r\n          <ButtonDetach\r\n            packageId={packageId}\r\n            folders={itemFolders}\r\n            callbackSuccess={onDetachFolder}\r\n          />\r\n        );\r\n      }\r\n    }\r\n  ];\r\n};\r\n\r\nexport const getRowClass = (\r\n  item: DocumentType,\r\n  index: number,\r\n  rows: DocumentType[]\r\n): string | undefined => {\r\n  const { containerID, containerSize } = item;\r\n  if (containerSize && rows[index - 1] && rows[index - 1].containerID === containerID) {\r\n    return 'no-border';\r\n  }\r\n\r\n  return;\r\n};\r\n"]},"metadata":{},"sourceType":"module"}