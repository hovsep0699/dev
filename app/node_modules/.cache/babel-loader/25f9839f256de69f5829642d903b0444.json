{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import _applyDecoratedDescriptor from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/applyDecoratedDescriptor\";var _class;import React from'react';import autobind from'autobind-decorator';import Flash from'../../common/flash/Flash';import DiError from'@distate/core/dist/application/error/Error';import{assert}from'chai';import{SERVER_500,SERVER_404,SERVER_405,SUCCESS_SAVE_FORM}from'../Lbl';var FormBase=(_class=/*#__PURE__*/function(_React$Component){_inherits(FormBase,_React$Component);var _super=_createSuper(FormBase);function FormBase(props){var _this;_classCallCheck(this,FormBase);_this=_super.call(this,props);_this.state={isComplete:false,isFormSentSuccessfully:false,isBusy:false};return _this;}_createClass(FormBase,[{key:\"createForm\",value:function createForm(){throw new Error('Переопределите метод в подклассе');}},{key:\"checkCompleteness\",value:function checkCompleteness(formState,requiredFields){var values=formState.values;var isComplete=requiredFields.every(function(field){return!!values[field];});this.setState({isComplete:isComplete});}},{key:\"fieldValueIsNotChosenFromDropdown\",value:function fieldValueIsNotChosenFromDropdown(field){return typeof field==='string';}},{key:\"submit\",value:function submit(formData,errorCb){var _this2=this;this.setState({isBusy:true});this.processFormData(formData).then(function(data){return _this2.makeSubmitRequest(data);}).then(this.handleSubmitSuccess).then(this.showSuccessMsg).catch(function(error){return _this2.handleSubmitError(errorCb)(error);});}},{key:\"processFormData\",value:function(){var _processFormData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(data){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt(\"return\",data);case 1:case\"end\":return _context.stop();}}},_callee);}));function processFormData(_x){return _processFormData.apply(this,arguments);}return processFormData;}()},{key:\"makeSubmitRequest\",value:function makeSubmitRequest(){throw new Error('Необходимо переопределить метод в подклассах');}},{key:\"handleSubmitSuccess\",value:function handleSubmitSuccess(){this.setState({isFormSentSuccessfully:true,isBusy:false});}},{key:\"showSuccessMsg\",value:function showSuccessMsg(){Flash.success(SUCCESS_SAVE_FORM);}},{key:\"handleSubmitError\",value:function handleSubmitError(){var _this3=this;var errorCb=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return function(error){assert.instanceOf(error,DiError);_this3.setState({isFormSentSuccessfully:false,isBusy:false});if(error.jsError&&error.jsError.response){var status=error.jsError.response.status;switch(status){case 400:_this3.showServerErrorsInForm(error.jsError.response.data,errorCb);break;case 404:Flash.error(SERVER_404);break;case 405:Flash.error(SERVER_405);break;case 500:Flash.error(SERVER_500);break;default:throw new Error(\"\\u041D\\u0435 \\u043E\\u0431\\u0440\\u0430\\u0431\\u0430\\u0442\\u044B\\u0432\\u0430\\u0435\\u0442\\u0441\\u044F \\u0441\\u0442\\u0430\\u0442\\u0443\\u0441 \".concat(status));}}else{Flash.error(error);}};}},{key:\"showServerErrorsInForm\",value:function showServerErrorsInForm(data){var errorCb=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(data[0]){Flash.error(data[0]);}if(errorCb){Object.entries(data).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];var errorMsg=Array.isArray(value)?value[0]:value;errorCb(key,errorMsg);});}}},{key:\"render\",value:function render(){return this.createForm();}}]);return FormBase;}(React.Component),(_applyDecoratedDescriptor(_class.prototype,\"checkCompleteness\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"checkCompleteness\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"fieldValueIsNotChosenFromDropdown\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"fieldValueIsNotChosenFromDropdown\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"submit\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"submit\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"handleSubmitSuccess\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"handleSubmitSuccess\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"handleSubmitError\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"handleSubmitError\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"showServerErrorsInForm\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"showServerErrorsInForm\"),_class.prototype)),_class);export default FormBase;","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/common/form/FormBase.js"],"names":["React","autobind","Flash","DiError","assert","SERVER_500","SERVER_404","SERVER_405","SUCCESS_SAVE_FORM","FormBase","props","state","isComplete","isFormSentSuccessfully","isBusy","Error","formState","requiredFields","values","every","field","setState","formData","errorCb","processFormData","then","data","makeSubmitRequest","handleSubmitSuccess","showSuccessMsg","catch","error","handleSubmitError","success","instanceOf","jsError","response","status","showServerErrorsInForm","Object","entries","forEach","key","value","errorMsg","Array","isArray","createForm","Component"],"mappings":"s2CAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,QAAP,KAAqB,oBAArB,CACA,MAAOC,CAAAA,KAAP,KAAkB,0BAAlB,CACA,MAAOC,CAAAA,OAAP,KAAoB,4CAApB,CACA,OAASC,MAAT,KAAuB,MAAvB,CACA,OAASC,UAAT,CAAqBC,UAArB,CAAiCC,UAAjC,CAA6CC,iBAA7C,KAAsE,QAAtE,C,GAEMC,CAAAA,Q,wHACJ,kBAAYC,KAAZ,CAAmB,0CACjB,uBAAMA,KAAN,EACA,MAAKC,KAAL,CAAa,CACXC,UAAU,CAAE,KADD,CAEXC,sBAAsB,CAAE,KAFb,CAGXC,MAAM,CAAE,KAHG,CAAb,CAFiB,aAOlB,C,oEACY,CACX,KAAM,IAAIC,CAAAA,KAAJ,CAAU,kCAAV,CAAN,CACD,C,4DAEiBC,S,CAAWC,c,CAAgB,IACnCC,CAAAA,MADmC,CACxBF,SADwB,CACnCE,MADmC,CAE3C,GAAMN,CAAAA,UAAU,CAAGK,cAAc,CAACE,KAAf,CAAqB,SAAAC,KAAK,QAAI,CAAC,CAACF,MAAM,CAACE,KAAD,CAAZ,EAA1B,CAAnB,CACA,KAAKC,QAAL,CAAc,CAAET,UAAU,CAAVA,UAAF,CAAd,EACD,C,4FAEiCQ,K,CAAO,CACvC,MAAO,OAAOA,CAAAA,KAAP,GAAiB,QAAxB,CACD,C,sCAEME,Q,CAAUC,O,CAAS,iBACxB,KAAKF,QAAL,CAAc,CAAEP,MAAM,CAAE,IAAV,CAAd,EACA,KAAKU,eAAL,CAAqBF,QAArB,EACGG,IADH,CACQ,SAAAC,IAAI,QAAI,CAAA,MAAI,CAACC,iBAAL,CAAuBD,IAAvB,CAAJ,EADZ,EAEGD,IAFH,CAEQ,KAAKG,mBAFb,EAGGH,IAHH,CAGQ,KAAKI,cAHb,EAIGC,KAJH,CAIS,SAAAC,KAAK,QAAI,CAAA,MAAI,CAACC,iBAAL,CAAuBT,OAAvB,EAAgCQ,KAAhC,CAAJ,EAJd,EAKD,C,wIACqBL,I,kJACbA,I,8NAEW,CAClB,KAAM,IAAIX,CAAAA,KAAJ,CAAU,8CAAV,CAAN,CACD,C,iEAEqB,CACpB,KAAKM,QAAL,CAAc,CAAER,sBAAsB,CAAE,IAA1B,CAAgCC,MAAM,CAAE,KAAxC,CAAd,EACD,C,uDACgB,CACfZ,KAAK,CAAC+B,OAAN,CAAczB,iBAAd,EACD,C,6DAEiC,oBAAhBe,CAAAA,OAAgB,2DAAN,IAAM,CAChC,MAAO,UAAAQ,KAAK,CAAI,CACd3B,MAAM,CAAC8B,UAAP,CAAkBH,KAAlB,CAAyB5B,OAAzB,EACA,MAAI,CAACkB,QAAL,CAAc,CAAER,sBAAsB,CAAE,KAA1B,CAAiCC,MAAM,CAAE,KAAzC,CAAd,EACA,GAAIiB,KAAK,CAACI,OAAN,EAAiBJ,KAAK,CAACI,OAAN,CAAcC,QAAnC,CAA6C,CAC3C,GAAMC,CAAAA,MAAM,CAAGN,KAAK,CAACI,OAAN,CAAcC,QAAd,CAAuBC,MAAtC,CACA,OAAQA,MAAR,EACE,IAAK,IAAL,CACE,MAAI,CAACC,sBAAL,CAA4BP,KAAK,CAACI,OAAN,CAAcC,QAAd,CAAuBV,IAAnD,CAAyDH,OAAzD,EACA,MACF,IAAK,IAAL,CACErB,KAAK,CAAC6B,KAAN,CAAYzB,UAAZ,EACA,MACF,IAAK,IAAL,CACEJ,KAAK,CAAC6B,KAAN,CAAYxB,UAAZ,EACA,MACF,IAAK,IAAL,CACEL,KAAK,CAAC6B,KAAN,CAAY1B,UAAZ,EACA,MACF,QACE,KAAM,IAAIU,CAAAA,KAAJ,kJAAsCsB,MAAtC,EAAN,CAdJ,CAgBD,CAlBD,IAkBO,CACLnC,KAAK,CAAC6B,KAAN,CAAYA,KAAZ,EACD,CACF,CAxBD,CAyBD,C,sEAEsBL,I,CAAsB,IAAhBH,CAAAA,OAAgB,2DAAN,IAAM,CAC3C,GAAIG,IAAI,CAAC,CAAD,CAAR,CAAa,CACXxB,KAAK,CAAC6B,KAAN,CAAYL,IAAI,CAAC,CAAD,CAAhB,EACD,CAED,GAAIH,OAAJ,CAAa,CACXgB,MAAM,CAACC,OAAP,CAAed,IAAf,EAAqBe,OAArB,CAA6B,cAAkB,kCAAhBC,GAAgB,UAAXC,KAAW,UAC7C,GAAMC,CAAAA,QAAQ,CAAGC,KAAK,CAACC,OAAN,CAAcH,KAAd,EAAuBA,KAAK,CAAC,CAAD,CAA5B,CAAkCA,KAAnD,CACApB,OAAO,CAACmB,GAAD,CAAME,QAAN,CAAP,CACD,CAHD,EAID,CACF,C,uCAEQ,CACP,MAAO,MAAKG,UAAL,EAAP,CACD,C,sBAxFoB/C,KAAK,CAACgD,S,mEAY1B/C,Q,0KAMAA,Q,+JAIAA,Q,iJAeAA,Q,4JAOAA,Q,+JA4BAA,Q,wGAmBH,cAAeQ,CAAAA,QAAf","sourcesContent":["import React from 'react';\r\nimport autobind from 'autobind-decorator';\r\nimport Flash from '../../common/flash/Flash';\r\nimport DiError from '@distate/core/dist/application/error/Error';\r\nimport { assert } from 'chai';\r\nimport { SERVER_500, SERVER_404, SERVER_405, SUCCESS_SAVE_FORM } from '../Lbl';\r\n\r\nclass FormBase extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      isComplete: false,\r\n      isFormSentSuccessfully: false,\r\n      isBusy: false\r\n    };\r\n  }\r\n  createForm() {\r\n    throw new Error('Переопределите метод в подклассе');\r\n  }\r\n  @autobind\r\n  checkCompleteness(formState, requiredFields) {\r\n    const { values } = formState;\r\n    const isComplete = requiredFields.every(field => !!values[field]);\r\n    this.setState({ isComplete });\r\n  }\r\n  @autobind\r\n  fieldValueIsNotChosenFromDropdown(field) {\r\n    return typeof field === 'string';\r\n  }\r\n  @autobind\r\n  submit(formData, errorCb) {\r\n    this.setState({ isBusy: true });\r\n    this.processFormData(formData)\r\n      .then(data => this.makeSubmitRequest(data))\r\n      .then(this.handleSubmitSuccess)\r\n      .then(this.showSuccessMsg)\r\n      .catch(error => this.handleSubmitError(errorCb)(error));\r\n  }\r\n  async processFormData(data) {\r\n    return data;\r\n  }\r\n  makeSubmitRequest() {\r\n    throw new Error('Необходимо переопределить метод в подклассах');\r\n  }\r\n  @autobind\r\n  handleSubmitSuccess() {\r\n    this.setState({ isFormSentSuccessfully: true, isBusy: false });\r\n  }\r\n  showSuccessMsg() {\r\n    Flash.success(SUCCESS_SAVE_FORM);\r\n  }\r\n  @autobind\r\n  handleSubmitError(errorCb = null) {\r\n    return error => {\r\n      assert.instanceOf(error, DiError);\r\n      this.setState({ isFormSentSuccessfully: false, isBusy: false });\r\n      if (error.jsError && error.jsError.response) {\r\n        const status = error.jsError.response.status;\r\n        switch (status) {\r\n          case 400:\r\n            this.showServerErrorsInForm(error.jsError.response.data, errorCb);\r\n            break;\r\n          case 404:\r\n            Flash.error(SERVER_404);\r\n            break;\r\n          case 405:\r\n            Flash.error(SERVER_405);\r\n            break;\r\n          case 500:\r\n            Flash.error(SERVER_500);\r\n            break;\r\n          default:\r\n            throw new Error(`Не обрабатывается статус ${status}`);\r\n        }\r\n      } else {\r\n        Flash.error(error);\r\n      }\r\n    };\r\n  }\r\n  @autobind\r\n  showServerErrorsInForm(data, errorCb = null) {\r\n    if (data[0]) {\r\n      Flash.error(data[0]);\r\n    }\r\n\r\n    if (errorCb) {\r\n      Object.entries(data).forEach(([key, value]) => {\r\n        const errorMsg = Array.isArray(value) ? value[0] : value;\r\n        errorCb(key, errorMsg);\r\n      });\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return this.createForm();\r\n  }\r\n}\r\n\r\nexport default FormBase;\r\n"]},"metadata":{},"sourceType":"module"}