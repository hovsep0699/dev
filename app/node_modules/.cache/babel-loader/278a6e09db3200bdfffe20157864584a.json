{"ast":null,"code":"import _objectSpread from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import get from'lodash.get';import{dateFormat}from'@distate/components/dist/FormSchema';var getArrayOrObject=function getArrayOrObject(val){if(Array.isArray(val))return val[0];return val;};export var transformerDTOUCDForm=function transformerDTOUCDForm(UCD){var systemName=UCD.type.systemName,formData=UCD.formData;if(systemName==='on_schfdoppr'){throw new Error(\"\\u0422\\u0438\\u043F \\\"\".concat(systemName,\"\\\" \\u043D\\u0435 \\u043F\\u043E\\u0434\\u0434\\u0435\\u0440\\u0436\\u0438\\u0432\\u0430\\u0435\\u0442\\u0441\\u044F \\u0432 \\u0442\\u0435\\u043A\\u0443\\u0449\\u0435\\u0439 \\u0432\\u0435\\u0440\\u0441\\u0438\\u0438 \\u0434\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u043E\\u043E\\u0431\\u043E\\u0440\\u043E\\u0442\\u0430.\"));}var isEditDocument=Boolean(formData);return isEditDocument?parseUCDFormData(UCD):parseUCDDocuemnt(UCD);};/** Парсим formData созданного документа */var parseUCDFormData=function parseUCDFormData(_ref){var _ref$package=_ref.package,to=_ref$package.to,from=_ref$package.from,formData=_ref.formData;if(!formData){throw new Error('Данные \"formData\" не найдены');}var date=dateFormat(new Date(),'dd.MM.yyyy');var invoiceDate=get(formData,'document.invoiceCorrection.date');var invoiceNumber=get(formData,'document.invoiceCorrection.number');var buyer=get(formData,'document.invoiceCorrection.buyer');var seller=get(formData,'document.invoiceCorrection.seller');var contractId=get(formData,'document.invoiceCorrection.information.governmentContractId');var currencyCode=get(formData,'document.invoiceCorrection.currencyCode');var currencyName=get(formData,'document.invoiceCorrection.information.currencyName');var currencyString=\"\".concat(currencyCode,\" \\u2014 \").concat(currencyName);var factActivity=\"\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442 \\u2116 \".concat(invoiceNumber,\" \\u043E\\u0442 \").concat(invoiceDate);return{factActivity:factActivity,currencyString:currencyString,governmentContractId:contractId,invoiceCorrectionDate:get(formData,'document.invoiceCorrection.date',date),invoiceCorrectionNumber:get(formData,'document.invoiceCorrection.number',''),purpose:getUCDPurpose(get(formData,'purpose')),name:get(formData,'document.name'),buyer:createFromPlace(to,buyer),seller:createFromPlace(from,seller),basisDocuments:get(formData,'document.factActivity3.basisDocuments',[{date:date}]),attributeValues:get(formData,'document.invoiceCorrection.infoField.attributeValues',[]),transferDocuments:get(formData,'document.factActivity3.transferDocuments',[{date:date}]),operationInformation:get(formData,'document.factActivity3.operationInformation'),additionalInformation:get(formData,'document.factActivity3.additionalInformation')};};/** Порсим данные для документа */var parseUCDDocuemnt=function parseUCDDocuemnt(_ref2){var _ref2$package=_ref2.package,to=_ref2$package.to,from=_ref2$package.from,parameters=_ref2.parameters;var purpose=parameters.purpose,_parameters$invoice=parameters.invoice,invoiceDate=_parameters$invoice.date,number=_parameters$invoice.number,buyers=_parameters$invoice.buyers,currencyCode=_parameters$invoice.currencyCode,currencyName=_parameters$invoice.information.currencyName;var buyer=getArrayOrObject(buyers);var date=dateFormat(new Date(),'dd.MM.yyyy');var factActivity=\"\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442 \\u2116 \".concat(number,\" \\u043E\\u0442 \").concat(invoiceDate);var currencyString=\"\".concat(currencyCode,\" \\u2014 \").concat(currencyName);return{governmentContractId:'',invoiceCorrectionDate:date,invoiceCorrectionNumber:'',name:'',buyer:createFromPlace(to,buyer),seller:createFromPlace(from,buyer),purpose:getUCDPurpose(purpose),factActivity:factActivity,currencyString:currencyString,basisDocuments:[{date:date}],attributeValues:[],transferDocuments:[{date:date}],operationInformation:'',additionalInformation:''};};var getUCDPurpose=function getUCDPurpose(val){switch(val){case'ДОП':case'ДИС':return{label:'Документ об изменении стоимости',value:'ДИС'};case'СЧФ':case'КСЧФ':return{label:'Корр. счет-фактура',value:'КСЧФ'};case'СЧФДОП':case'КСЧФДИС':return{label:'Корр. счет-фактура и документ об изменении стоимости',value:'КСЧФДИС'};}return null;};var createFromPlace=function createFromPlace(place,_ref3){var address=_ref3.address;var computed=[];var _place$company=place.company,participantType=_place$company.type,participantAccountNumber=_place$company.accountNumber,participantBIK=_place$company.bik,participantName=_place$company.name,participantINN=_place$company.inn,authorizedPerson=_place$company.authorizedPerson,_place$division=place.division,participantKPP=_place$division.kpp,participantAddress=_place$division.address,participantOKPO=_place$division.classificationNumber;var result={inn:participantINN,kpp:participantKPP,name:participantName,okpo:participantOKPO,type:participantType.systemName,innkpp:participantINN+(participantKPP?\"/\"+participantKPP:''),address:null,accountNumber:participantAccountNumber,bank:{name:null,bik:participantBIK}};if(participantAddress){result.address=_objectSpread(_objectSpread({},address),{},{looselyTypedAddress:participantAddress.looselyTypedAddress,postalCode:participantAddress.postalCode,settlement:participantAddress.settlement,district:participantAddress.district,building:participantAddress.building,country:{code:participantAddress.country.code,title:participantAddress.country.title},street:participantAddress.street,region:{code:participantAddress.region&&participantAddress.region.code,title:participantAddress.region&&participantAddress.region.title},house:participantAddress.house,city:participantAddress.city,room:participantAddress.room});}if(authorizedPerson&&participantType.systemName==='IP'){result.companyName=participantName;result.fio={name:authorizedPerson.person.name,surname:authorizedPerson.person.surname,patronymic:authorizedPerson.person.patronymic};}else{result.companyName=participantName;}if(result.address.region&&result.address.country&&result.address.region.code&&result.address.country.code){var requiredData=\"\".concat(result.address.country.title,\" \").concat(result.address.region.title);computed.push(requiredData);if(result.address.postalCode)computed.push(result.address.postalCode);if(result.address.city)computed.push(\"\\u0433. \".concat(result.address.city));if(result.address.district)computed.push(\"\\u0440. \".concat(result.address.district));if(result.address.settlement)computed.push(\"\\u043F\\u043E\\u0441. \".concat(result.address.settlement));if(result.address.street)computed.push(\"\\u0443\\u043B. \".concat(result.address.street));if(result.address.house)computed.push(\"\\u0434. \".concat(result.address.house));if(result.address.building)computed.push(\"\\u0441\\u0442\\u0440. \".concat(result.address.building));if(result.address.room)computed.push(\"\\u043A\\u0432. \".concat(result.address.room));}else if(result.address.looselyTypedAddress){computed.push(result.address.looselyTypedAddress);}result.address.computed=computed.filter(Boolean).join(', ');return result;};","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/upd/helpers/transformers/ucd/dto-to-ucd-form.ts"],"names":["get","dateFormat","getArrayOrObject","val","Array","isArray","transformerDTOUCDForm","UCD","systemName","type","formData","Error","isEditDocument","Boolean","parseUCDFormData","parseUCDDocuemnt","package","to","from","date","Date","invoiceDate","invoiceNumber","buyer","seller","contractId","currencyCode","currencyName","currencyString","factActivity","governmentContractId","invoiceCorrectionDate","invoiceCorrectionNumber","purpose","getUCDPurpose","name","createFromPlace","basisDocuments","attributeValues","transferDocuments","operationInformation","additionalInformation","parameters","invoice","number","buyers","information","label","value","place","address","computed","company","participantType","participantAccountNumber","accountNumber","participantBIK","bik","participantName","participantINN","inn","authorizedPerson","division","participantKPP","kpp","participantAddress","participantOKPO","classificationNumber","result","okpo","innkpp","bank","looselyTypedAddress","postalCode","settlement","district","building","country","code","title","street","region","house","city","room","companyName","fio","person","surname","patronymic","requiredData","push","filter","join"],"mappings":"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","sourcesContent":["import get from 'lodash.get';\r\nimport { DTOUCDDocument, UCDDocumentSchema } from './types';\r\nimport { dateFormat } from '@distate/components/dist/FormSchema';\r\n\r\nconst getArrayOrObject = (val: unknown) => {\r\n  if (Array.isArray(val)) return val[0];\r\n  return val;\r\n};\r\n\r\nexport const transformerDTOUCDForm = (UCD: DTOUCDDocument): UCDDocumentSchema => {\r\n  const {\r\n    type: { systemName },\r\n    formData\r\n  } = UCD;\r\n\r\n  if (systemName === 'on_schfdoppr') {\r\n    throw new Error(`Тип \"${systemName}\" не поддерживается в текущей версии документооборота.`);\r\n  }\r\n\r\n  const isEditDocument = Boolean(formData);\r\n  return isEditDocument ? parseUCDFormData(UCD) : parseUCDDocuemnt(UCD);\r\n};\r\n\r\n/** Парсим formData созданного документа */\r\nconst parseUCDFormData = ({\r\n  package: { to, from },\r\n  formData\r\n}: DTOUCDDocument): UCDDocumentSchema => {\r\n  if (!formData) {\r\n    throw new Error('Данные \"formData\" не найдены');\r\n  }\r\n\r\n  const date = dateFormat(new Date(), 'dd.MM.yyyy');\r\n  const invoiceDate = get(formData, 'document.invoiceCorrection.date');\r\n  const invoiceNumber = get(formData, 'document.invoiceCorrection.number');\r\n  const buyer = get(formData, 'document.invoiceCorrection.buyer');\r\n  const seller = get(formData, 'document.invoiceCorrection.seller');\r\n  const contractId = get(formData, 'document.invoiceCorrection.information.governmentContractId');\r\n  const currencyCode = get(formData, 'document.invoiceCorrection.currencyCode');\r\n  const currencyName = get(formData, 'document.invoiceCorrection.information.currencyName');\r\n  const currencyString = `${currencyCode} — ${currencyName}`;\r\n  const factActivity = `Документ № ${invoiceNumber} от ${invoiceDate}`;\r\n\r\n  return {\r\n    factActivity,\r\n    currencyString,\r\n    governmentContractId: contractId,\r\n    invoiceCorrectionDate: get(formData, 'document.invoiceCorrection.date', date),\r\n    invoiceCorrectionNumber: get(formData, 'document.invoiceCorrection.number', ''),\r\n    purpose: getUCDPurpose(get(formData, 'purpose')),\r\n    name: get(formData, 'document.name'),\r\n    buyer: createFromPlace(to, buyer),\r\n    seller: createFromPlace(from, seller),\r\n    basisDocuments: get(formData, 'document.factActivity3.basisDocuments', [{ date }]),\r\n    attributeValues: get(formData, 'document.invoiceCorrection.infoField.attributeValues', []),\r\n    transferDocuments: get(formData, 'document.factActivity3.transferDocuments', [{ date }]),\r\n    operationInformation: get(formData, 'document.factActivity3.operationInformation'),\r\n    additionalInformation: get(formData, 'document.factActivity3.additionalInformation')\r\n  };\r\n};\r\n\r\n/** Порсим данные для документа */\r\nconst parseUCDDocuemnt = ({\r\n  package: { to, from },\r\n  parameters\r\n}: DTOUCDDocument): UCDDocumentSchema => {\r\n  const {\r\n    purpose,\r\n    invoice: {\r\n      date: invoiceDate,\r\n      number,\r\n      buyers,\r\n      currencyCode,\r\n      information: { currencyName }\r\n    }\r\n  } = parameters;\r\n\r\n  const buyer = getArrayOrObject(buyers);\r\n  const date = dateFormat(new Date(), 'dd.MM.yyyy') as string;\r\n  const factActivity = `Документ № ${number} от ${invoiceDate}`;\r\n  const currencyString = `${currencyCode} — ${currencyName}`;\r\n\r\n  return {\r\n    governmentContractId: '',\r\n    invoiceCorrectionDate: date,\r\n    invoiceCorrectionNumber: '',\r\n    name: '',\r\n    buyer: createFromPlace(to, buyer),\r\n    seller: createFromPlace(from, buyer),\r\n    purpose: getUCDPurpose(purpose),\r\n    factActivity,\r\n    currencyString,\r\n    basisDocuments: [{ date }],\r\n    attributeValues: [],\r\n    transferDocuments: [{ date }],\r\n    operationInformation: '',\r\n    additionalInformation: ''\r\n  };\r\n};\r\n\r\nconst getUCDPurpose = (val: string) => {\r\n  switch (val) {\r\n    case 'ДОП':\r\n    case 'ДИС':\r\n      return { label: 'Документ об изменении стоимости', value: 'ДИС' };\r\n    case 'СЧФ':\r\n    case 'КСЧФ':\r\n      return { label: 'Корр. счет-фактура', value: 'КСЧФ' };\r\n    case 'СЧФДОП':\r\n    case 'КСЧФДИС':\r\n      return { label: 'Корр. счет-фактура и документ об изменении стоимости', value: 'КСЧФДИС' };\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nconst createFromPlace = (place: Record<string, any>, { address }: Record<string, any>): any => {\r\n  const computed = [];\r\n  const {\r\n    company: {\r\n      type: participantType,\r\n      accountNumber: participantAccountNumber,\r\n      bik: participantBIK,\r\n      name: participantName,\r\n      inn: participantINN,\r\n      authorizedPerson\r\n    },\r\n    division: {\r\n      kpp: participantKPP,\r\n      address: participantAddress,\r\n      classificationNumber: participantOKPO\r\n    }\r\n  } = place;\r\n\r\n  const result: Record<string, any> = {\r\n    inn: participantINN,\r\n    kpp: participantKPP,\r\n    name: participantName,\r\n    okpo: participantOKPO,\r\n    type: participantType.systemName,\r\n    innkpp: participantINN + ((participantKPP)?`/` + participantKPP : ''),\r\n    address: null,\r\n    accountNumber: participantAccountNumber,\r\n    bank: {\r\n      name: null,\r\n      bik: participantBIK\r\n    }\r\n  };\r\n\r\n  if (participantAddress) {\r\n    result.address = {\r\n      ...address,\r\n      looselyTypedAddress: participantAddress.looselyTypedAddress,\r\n      postalCode: participantAddress.postalCode,\r\n      settlement: participantAddress.settlement,\r\n      district: participantAddress.district,\r\n      building: participantAddress.building,\r\n      country: {\r\n        code: participantAddress.country.code,\r\n        title: participantAddress.country.title\r\n      },\r\n      street: participantAddress.street,\r\n      region: {\r\n        code: participantAddress.region && participantAddress.region.code,\r\n        title: participantAddress.region && participantAddress.region.title\r\n      },\r\n      house: participantAddress.house,\r\n      city: participantAddress.city,\r\n      room: participantAddress.room\r\n    };\r\n  }\r\n\r\n  if (authorizedPerson && participantType.systemName === 'IP') {\r\n    result.companyName = participantName;\r\n    result.fio = {\r\n      name : authorizedPerson.person.name,\r\n      surname : authorizedPerson.person.surname,\r\n      patronymic : authorizedPerson.person.patronymic\r\n    }\r\n\r\n  } else {\r\n    result.companyName = participantName;\r\n  }\r\n\r\n  if (\r\n    result.address.region &&\r\n    result.address.country &&\r\n    result.address.region.code &&\r\n    result.address.country.code\r\n  ) {\r\n    const requiredData = `${result.address.country.title} ${result.address.region.title}`;\r\n\r\n    computed.push(requiredData);\r\n    if (result.address.postalCode) computed.push(result.address.postalCode);\r\n    if (result.address.city) computed.push(`г. ${result.address.city}`);\r\n    if (result.address.district) computed.push(`р. ${result.address.district}`);\r\n    if (result.address.settlement) computed.push(`пос. ${result.address.settlement}`);\r\n    if (result.address.street) computed.push(`ул. ${result.address.street}`);\r\n    if (result.address.house) computed.push(`д. ${result.address.house}`);\r\n    if (result.address.building) computed.push(`стр. ${result.address.building}`);\r\n    if (result.address.room) computed.push(`кв. ${result.address.room}`);\r\n  } else if (result.address.looselyTypedAddress) {\r\n    computed.push(result.address.looselyTypedAddress);\r\n  }\r\n\r\n  result.address.computed = computed.filter(Boolean).join(', ');\r\n\r\n  return result;\r\n};\r\n"]},"metadata":{},"sourceType":"module"}