{"ast":null,"code":"import _objectSpread from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _defineProperty from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _asyncToGenerator from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import _applyDecoratedDescriptor from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/applyDecoratedDescriptor\";var _class,_temp;import React,{Component}from'react';import Modal from'../../../common/modal/Modal';import autobind from'autobind-decorator';import ArrayGroup from'./ArrayGroup';import Button,{PRIMARY}from'../../../common/Button';import{ICON}from'@distate/components';import{CLEAR,SAVE}from'../../../common/Lbl';import GoodTraceabilityInfo from'@distate/core/dist/domain/documents/upd/vo/good/GoodTraceabilityInfo';import style from'../../../common/form/documents/DocumentFormBuilder.module.css';import classNames from'classnames';import RadioGroup from'../../../common/form/components/radio/RadioGroup';import Tracking from'@distate/core/dist/domain/documents/upd/vo/good/information/tracking/Tracking';import IdentificationNumbers from'@distate/core/dist/domain/documents/upd/vo/good/information/identificationNumbers/IdentificationNumbers';import{set}from'object-path-immutable';import ProductNotSubjectToLabelingOrTraceability from'@distate/core/dist/domain/common/options/ProductNotSubjectToLabelingOrTraceability';import ProductTraceabilityInformation from'@distate/core/dist/domain/common/options/ProductTraceabilityInformation';import ProductIdentificationNumber from'@distate/core/dist/domain/common/options/ProductIdentificationNumber';import get from'get-value';var GoodTraceabilityInfoModal=(_class=(_temp=/*#__PURE__*/function(_Component){_inherits(GoodTraceabilityInfoModal,_Component);var _super=_createSuper(GoodTraceabilityInfoModal);function GoodTraceabilityInfoModal(props){var _this;_classCallCheck(this,GoodTraceabilityInfoModal);_this=_super.call(this,props);_this.saveData=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var setDataToComponentState,activeFields,_this$setState,savePath,removalPath,_this$getSortedFields,sortedInitialFieldsValues,sortedFieldsValuesToSend,sortedInitialFieldsValuesToSend,valuesToSave;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setDataToComponentState=_this.props.setDataToComponentState;activeFields=_this.state.activeFields;if(!activeFields){_context.next=12;break;}savePath=activeFields==='trackingFields'?_this.trackingPath:_this.identificationNumbersPath;removalPath=activeFields==='trackingFields'?_this.identificationNumbersPath:_this.trackingPath;_this$getSortedFields=_this.getSortedFields(activeFields),sortedInitialFieldsValues=_this$getSortedFields.sortedInitialFieldsValues,sortedFieldsValuesToSend=_this$getSortedFields.sortedFieldsValuesToSend,sortedInitialFieldsValuesToSend=_this$getSortedFields.sortedInitialFieldsValuesToSend;valuesToSave=set({},savePath,sortedFieldsValuesToSend);_context.next=9;return setDataToComponentState(valuesToSave,savePath,false);case 9:_context.next=11;return setDataToComponentState(null,removalPath,false);case 11:_this.setState((_this$setState={},_defineProperty(_this$setState,activeFields,sortedInitialFieldsValues),_defineProperty(_this$setState,\"\".concat(activeFields,\"ToSend\"),sortedInitialFieldsValuesToSend),_this$setState));case 12:case\"end\":return _context.stop();}}},_callee);}));_this.state={activeFields:null,hasErrors:false,isModalVisible:false,radioValue:ProductNotSubjectToLabelingOrTraceability.value,trackingErrors:[],trackingFields:{},trackingFieldsToSend:{},identificationNumbersErrors:[],identificationNumbersFields:{},identificationNumbersFieldsToSend:{}};_this.formScope=\"\".concat(props.scope);_this.trackingPath=\"\".concat(_this.formScope,\".\").concat(Tracking.field);_this.identificationNumbersPath=\"\".concat(_this.formScope,\".\").concat(IdentificationNumbers.field);return _this;}_createClass(GoodTraceabilityInfoModal,[{key:\"componentDidMount\",value:function componentDidMount(){this.setInitialValues();}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){if(prevProps!==this.props){this.setInitialValues();}if(JSON.stringify(prevProps.errors)!==JSON.stringify(this.props.errors)){this.updateServerErrors();}}},{key:\"updateServerErrors\",value:function updateServerErrors(){var serverErrors=get(this.props,'errors');if(serverErrors===null||serverErrors===void 0?void 0:serverErrors.tracking){this.handleTrackingErrorsChange(serverErrors.tracking);}if(serverErrors===null||serverErrors===void 0?void 0:serverErrors.identificationNumbers){this.handleIdentificationNumbersErrorsChange(serverErrors.identificationNumbers,true);}}},{key:\"handleTrackingErrorsChange\",value:function handleTrackingErrorsChange(errors){var errorsObj=Array.isArray(errors)?_objectSpread({},errors):errors;var trackingErrors=Object.keys(errorsObj).reduce(function(newErrors,currentKey){newErrors[currentKey]={additionalIndicator:errorsObj[currentKey].additionalIndicator,measurement:errorsObj[currentKey].measurementTitle?errorsObj[currentKey].measurementTitle:errorsObj[currentKey].measurement,measurementValue:errorsObj[currentKey].measurementValue,number:errorsObj[currentKey].number};return newErrors;},{});this.setState({trackingErrors:trackingErrors},this.hasErrors(trackingErrors));}},{key:\"handleIdentificationNumbersErrorsChange\",value:function handleIdentificationNumbersErrorsChange(errors){var isServer=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var errorsObj=Array.isArray(errors)?_objectSpread({},errors):errors;var identificationNumbersErrors=Object.keys(errorsObj).reduce(function(newErrors,currentKey){newErrors[currentKey]={collection:isServer?errorsObj[currentKey].numbers.collection:errorsObj[currentKey].collection,numbers:errorsObj[currentKey].numbers,type:isServer?errorsObj[currentKey].numbers.type:errorsObj[currentKey].type};return newErrors;},{});this.setState({identificationNumbersErrors:identificationNumbersErrors},this.hasErrors(identificationNumbersErrors));}},{key:\"hasErrors\",value:function hasErrors(errors){var _this2=this;var trackingErrArr=errors?Object.values(errors):[];if(trackingErrArr.length>0){trackingErrArr.forEach(function(errorObj){if(errorObj){var hasErrors=Object.values(errorObj).some(function(field){var _field$errors;return field&&((_field$errors=field.errors)===null||_field$errors===void 0?void 0:_field$errors.length)>0;});_this2.setState({hasErrors:hasErrors});return;}});}}},{key:\"setInitialValues\",value:function setInitialValues(){var initialValues=get(this.props,'initialFieldDomain.value');var identificationNumbers=initialValues===null||initialValues===void 0?void 0:initialValues.identificationNumbers;var tracking=initialValues===null||initialValues===void 0?void 0:initialValues.tracking;if(Array.isArray(identificationNumbers)&&identificationNumbers.length>0){var identificationNumbersFields=identificationNumbers.map(function(item){var _item$numbers,_item$numbers2;return{packNumber:item.packNumber,type:(_item$numbers=item.numbers)===null||_item$numbers===void 0?void 0:_item$numbers.type,collection:(_item$numbers2=item.numbers)===null||_item$numbers2===void 0?void 0:_item$numbers2.collection.join('\\n')};});this.setState({identificationNumbersFields:identificationNumbersFields,activeFields:'identificationNumbersFields',radioValue:ProductIdentificationNumber.value,identificationNumbersFieldsToSend:identificationNumbers});}if(Array.isArray(tracking)&&tracking.length>0){var trackingFields=tracking.map(function(item){return{additionalIndicator:item.additionalIndicator,measurement:{code:item.measurementCode,title:item.measurementTitle},measurementValue:item.measurementValue,number:item.number};});this.setState({trackingFields:trackingFields,activeFields:'trackingFields',radioValue:ProductTraceabilityInformation.value,trackingFieldsToSend:tracking});}}},{key:\"showModal\",value:function showModal(){this.setState({isModalVisible:true});}},{key:\"hideModal\",value:function hideModal(){this.setState({isModalVisible:false});}},{key:\"handleShowModalBtnClick\",value:function handleShowModalBtnClick(){this.showModal();}},{key:\"handleTrackingFieldsValues\",value:function handleTrackingFieldsValues(trackingFields){var trackingFieldsToSend=Object.keys(trackingFields).reduce(function(obj,key){var _trackingFields$key=trackingFields[key],additionalIndicator=_trackingFields$key.additionalIndicator,measurement=_trackingFields$key.measurement,measurementValue=_trackingFields$key.measurementValue,number=_trackingFields$key.number;obj[key]={additionalIndicator:additionalIndicator||'',measurementCode:(measurement===null||measurement===void 0?void 0:measurement.code)||'',measurementTitle:(measurement===null||measurement===void 0?void 0:measurement.title)||'',measurementValue:measurementValue||'',number:number||''};return obj;},{});this.setState({trackingFields:trackingFields,trackingFieldsToSend:trackingFieldsToSend});}},{key:\"handleIdentificationNumbersFieldsValues\",value:function handleIdentificationNumbersFieldsValues(identificationNumbersFields){var identificationNumbersFieldsToSend=Object.keys(identificationNumbersFields).reduce(function(obj,key){var _identificationNumber=identificationNumbersFields[key],packNumber=_identificationNumber.packNumber,type=_identificationNumber.type,collection=_identificationNumber.collection;obj[key]={packNumber:packNumber,numbers:{type:type,collection:collection===null||collection===void 0?void 0:collection.split('\\n')}};return obj;},{});this.setState({identificationNumbersFields:identificationNumbersFields,identificationNumbersFieldsToSend:identificationNumbersFieldsToSend});}},{key:\"handleRadioChange\",value:function handleRadioChange(value){if(value===ProductTraceabilityInformation.value){this.setState({activeFields:'trackingFields'});}else if(value===ProductIdentificationNumber.value){this.setState({activeFields:'identificationNumbersFields'});}else{this.setState({activeFields:null});}}},{key:\"handleClearBtnClick\",value:function handleClearBtnClick(){var activeFields=this.state.activeFields;if(activeFields){var cleanFields=Object.keys(this.state[activeFields][0]).reduce(function(obj,prop){obj[prop]='';return obj;},{});this.setState(_defineProperty({},activeFields,[cleanFields]));}}},{key:\"getSortedFields\",value:function getSortedFields(activeFields){var sortedInitialFieldsValues=Object.values(this.state[activeFields]).map(function(fieldsValues){return fieldsValues;});var sortedInitialFieldsValuesToSend=[];var sortedFieldsValuesToSend=Object.values(this.state[\"\".concat(activeFields,\"ToSend\")]).reduce(function(fieldsValues,values,index){fieldsValues[index]=values;sortedInitialFieldsValuesToSend.push(values);return fieldsValues;},{});return{sortedInitialFieldsValues:sortedInitialFieldsValues,sortedFieldsValuesToSend:sortedFieldsValuesToSend,sortedInitialFieldsValuesToSend:sortedInitialFieldsValuesToSend};}},{key:\"handleSaveBtnClick\",value:function handleSaveBtnClick(){this.saveData();this.hideModal();}},{key:\"render\",value:function render(){var _this$state=this.state,isModalVisible=_this$state.isModalVisible,activeFields=_this$state.activeFields,radioValue=_this$state.radioValue,trackingFields=_this$state.trackingFields,identificationNumbersFields=_this$state.identificationNumbersFields,trackingErrors=_this$state.trackingErrors,identificationNumbersErrors=_this$state.identificationNumbersErrors,hasErrors=_this$state.hasErrors;var formClasses=classNames('form',style.modalForm,style.center,style.bottomIndent,style.hideFirstHr,style.rightIndent);return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Button,{type:\"button\",title:GoodTraceabilityInfo.name,iconClass:ICON.tiStamp,className:classNames(_defineProperty({},style.btnError,hasErrors)),onClick:this.handleShowModalBtnClick}),/*#__PURE__*/React.createElement(Modal,{hide:this.hideModal,isVisible:isModalVisible,width:\"700px\",key:\"\".concat(this.formScope,\"_goodTraceabilityInfoModal\")},/*#__PURE__*/React.createElement(Modal.Header,{title:GoodTraceabilityInfo.name,className:style.center}),/*#__PURE__*/React.createElement(Modal.Body,null,/*#__PURE__*/React.createElement(\"ul\",{className:formClasses},/*#__PURE__*/React.createElement(\"li\",null,/*#__PURE__*/React.createElement(RadioGroup,{DomainVO:GoodTraceabilityInfo,onChange:this.handleRadioChange,initialValue:radioValue,isBlock:true,isWidthAuto:true})),/*#__PURE__*/React.createElement(ArrayGroup,{isFirstRowNameHidden:true,domainVO:Tracking,scope:this.formScope,initialValues:trackingFields,returnState:this.handleTrackingFieldsValues,isHidden:activeFields!=='trackingFields',requiredFields:[true,true,true,false],handleErrorsChange:this.handleTrackingErrorsChange,errors:trackingErrors}),/*#__PURE__*/React.createElement(ArrayGroup,{isFirstRowNameHidden:true,domainVO:IdentificationNumbers,scope:this.formScope,initialValues:identificationNumbersFields,returnState:this.handleIdentificationNumbersFieldsValues,isHidden:activeFields!=='identificationNumbersFields',requiredFields:[false,true,true],handleErrorsChange:this.handleIdentificationNumbersErrorsChange,errors:identificationNumbersErrors}))),/*#__PURE__*/React.createElement(Modal.Footer,null,/*#__PURE__*/React.createElement(Button,{type:\"button\",className:\"center\",iconClass:ICON.accept,colorClass:PRIMARY,onClick:this.handleSaveBtnClick},SAVE),/*#__PURE__*/React.createElement(Button,{type:\"button\",className:\"center\",iconClass:ICON.cancel,onClick:this.handleClearBtnClick},CLEAR))));}}]);return GoodTraceabilityInfoModal;}(Component),_temp),(_applyDecoratedDescriptor(_class.prototype,\"handleTrackingErrorsChange\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"handleTrackingErrorsChange\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"handleIdentificationNumbersErrorsChange\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"handleIdentificationNumbersErrorsChange\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"showModal\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"showModal\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"hideModal\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"hideModal\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"handleShowModalBtnClick\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"handleShowModalBtnClick\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"handleTrackingFieldsValues\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"handleTrackingFieldsValues\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"handleIdentificationNumbersFieldsValues\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"handleIdentificationNumbersFieldsValues\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"handleRadioChange\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"handleRadioChange\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"handleClearBtnClick\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"handleClearBtnClick\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"handleSaveBtnClick\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"handleSaveBtnClick\"),_class.prototype)),_class);export default GoodTraceabilityInfoModal;","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/upd/forms/GoodTraceabilityInfoModal.js"],"names":["React","Component","Modal","autobind","ArrayGroup","Button","PRIMARY","ICON","CLEAR","SAVE","GoodTraceabilityInfo","style","classNames","RadioGroup","Tracking","IdentificationNumbers","set","ProductNotSubjectToLabelingOrTraceability","ProductTraceabilityInformation","ProductIdentificationNumber","get","GoodTraceabilityInfoModal","props","saveData","setDataToComponentState","activeFields","state","savePath","trackingPath","identificationNumbersPath","removalPath","getSortedFields","sortedInitialFieldsValues","sortedFieldsValuesToSend","sortedInitialFieldsValuesToSend","valuesToSave","setState","hasErrors","isModalVisible","radioValue","value","trackingErrors","trackingFields","trackingFieldsToSend","identificationNumbersErrors","identificationNumbersFields","identificationNumbersFieldsToSend","formScope","scope","field","setInitialValues","prevProps","JSON","stringify","errors","updateServerErrors","serverErrors","tracking","handleTrackingErrorsChange","identificationNumbers","handleIdentificationNumbersErrorsChange","errorsObj","Array","isArray","Object","keys","reduce","newErrors","currentKey","additionalIndicator","measurement","measurementTitle","measurementValue","number","isServer","collection","numbers","type","trackingErrArr","values","length","forEach","errorObj","some","initialValues","map","item","packNumber","join","code","measurementCode","title","showModal","obj","key","split","cleanFields","prop","fieldsValues","index","push","hideModal","formClasses","modalForm","center","bottomIndent","hideFirstHr","rightIndent","name","tiStamp","btnError","handleShowModalBtnClick","handleRadioChange","handleTrackingFieldsValues","handleIdentificationNumbersFieldsValues","accept","handleSaveBtnClick","cancel","handleClearBtnClick"],"mappings":"whDAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,MAAOC,CAAAA,KAAP,KAAkB,6BAAlB,CACA,MAAOC,CAAAA,QAAP,KAAqB,oBAArB,CACA,MAAOC,CAAAA,UAAP,KAAuB,cAAvB,CACA,MAAOC,CAAAA,MAAP,EAAiBC,OAAjB,KAAgC,wBAAhC,CACA,OAASC,IAAT,KAAqB,qBAArB,CACA,OAASC,KAAT,CAAgBC,IAAhB,KAA4B,qBAA5B,CACA,MAAOC,CAAAA,oBAAP,KAAiC,sEAAjC,CACA,MAAOC,CAAAA,KAAP,KAAkB,+DAAlB,CACA,MAAOC,CAAAA,UAAP,KAAuB,YAAvB,CACA,MAAOC,CAAAA,UAAP,KAAuB,kDAAvB,CACA,MAAOC,CAAAA,QAAP,KAAqB,+EAArB,CACA,MAAOC,CAAAA,qBAAP,KAAkC,yGAAlC,CACA,OAASC,GAAT,KAAoB,uBAApB,CAEA,MAAOC,CAAAA,yCAAP,KAAsD,oFAAtD,CACA,MAAOC,CAAAA,8BAAP,KAA2C,yEAA3C,CACA,MAAOC,CAAAA,2BAAP,KAAwC,sEAAxC,CACA,MAAOC,CAAAA,GAAP,KAAgB,WAAhB,C,GAEMC,CAAAA,yB,qJAKJ,mCAAYC,KAAZ,CAAmB,2DACjB,uBAAMA,KAAN,EADiB,MA2OnBC,QA3OmB,sEA2OR,sUACDC,uBADC,CAC2B,MAAKF,KADhC,CACDE,uBADC,CAEDC,YAFC,CAEgB,MAAKC,KAFrB,CAEDD,YAFC,KAILA,YAJK,0BAKDE,QALC,CAMLF,YAAY,GAAK,gBAAjB,CAAoC,MAAKG,YAAzC,CAAwD,MAAKC,yBANxD,CAODC,WAPC,CAQLL,YAAY,GAAK,gBAAjB,CAAoC,MAAKI,yBAAzC,CAAqE,MAAKD,YARrE,uBAaH,MAAKG,eAAL,CAAqBN,YAArB,CAbG,CAULO,yBAVK,uBAULA,yBAVK,CAWLC,wBAXK,uBAWLA,wBAXK,CAYLC,+BAZK,uBAYLA,+BAZK,CAcDC,YAdC,CAccnB,GAAG,CAAC,EAAD,CAAKW,QAAL,CAAeM,wBAAf,CAdjB,uBAgBDT,CAAAA,uBAAuB,CAACW,YAAD,CAAeR,QAAf,CAAyB,KAAzB,CAhBtB,+BAiBDH,CAAAA,uBAAuB,CAAC,IAAD,CAAOM,WAAP,CAAoB,KAApB,CAjBtB,SAmBP,MAAKM,QAAL,mDACGX,YADH,CACkBO,yBADlB,2CAEMP,YAFN,WAE6BS,+BAF7B,mBAnBO,uDA3OQ,GAEjB,MAAKR,KAAL,CAAa,CACXD,YAAY,CAAE,IADH,CAEXY,SAAS,CAAE,KAFA,CAGXC,cAAc,CAAE,KAHL,CAIXC,UAAU,CAAEtB,yCAAyC,CAACuB,KAJ3C,CAMXC,cAAc,CAAE,EANL,CAOXC,cAAc,CAAE,EAPL,CAQXC,oBAAoB,CAAE,EARX,CAUXC,2BAA2B,CAAE,EAVlB,CAWXC,2BAA2B,CAAE,EAXlB,CAYXC,iCAAiC,CAAE,EAZxB,CAAb,CAeA,MAAKC,SAAL,WAAoBzB,KAAK,CAAC0B,KAA1B,EACA,MAAKpB,YAAL,WAAuB,MAAKmB,SAA5B,aAAyCjC,QAAQ,CAACmC,KAAlD,EACA,MAAKpB,yBAAL,WAAoC,MAAKkB,SAAzC,aAAsDhC,qBAAqB,CAACkC,KAA5E,EAnBiB,aAoBlB,C,mGAEmB,CAClB,KAAKC,gBAAL,GACD,C,8DAEkBC,S,CAAW,CAC5B,GAAIA,SAAS,GAAK,KAAK7B,KAAvB,CAA8B,CAC5B,KAAK4B,gBAAL,GACD,CACD,GAAIE,IAAI,CAACC,SAAL,CAAeF,SAAS,CAACG,MAAzB,IAAqCF,IAAI,CAACC,SAAL,CAAe,KAAK/B,KAAL,CAAWgC,MAA1B,CAAzC,CAA4E,CAC1E,KAAKC,kBAAL,GACD,CACF,C,+DAEoB,CACnB,GAAMC,CAAAA,YAAY,CAAGpC,GAAG,CAAC,KAAKE,KAAN,CAAa,QAAb,CAAxB,CAEA,GAAIkC,YAAJ,SAAIA,YAAJ,iBAAIA,YAAY,CAAEC,QAAlB,CAA4B,CAC1B,KAAKC,0BAAL,CAAgCF,YAAY,CAACC,QAA7C,EACD,CAED,GAAID,YAAJ,SAAIA,YAAJ,iBAAIA,YAAY,CAAEG,qBAAlB,CAAyC,CACvC,KAAKC,uCAAL,CAA6CJ,YAAY,CAACG,qBAA1D,CAAiF,IAAjF,EACD,CACF,C,8EAG0BL,M,CAAQ,CACjC,GAAMO,CAAAA,SAAS,CAAGC,KAAK,CAACC,OAAN,CAAcT,MAAd,mBAA6BA,MAA7B,EAAwCA,MAA1D,CAEA,GAAMb,CAAAA,cAAc,CAAGuB,MAAM,CAACC,IAAP,CAAYJ,SAAZ,EAAuBK,MAAvB,CAA8B,SAACC,SAAD,CAAYC,UAAZ,CAA2B,CAC9ED,SAAS,CAACC,UAAD,CAAT,CAAwB,CACtBC,mBAAmB,CAAER,SAAS,CAACO,UAAD,CAAT,CAAsBC,mBADrB,CAEtBC,WAAW,CAAET,SAAS,CAACO,UAAD,CAAT,CAAsBG,gBAAtB,CACTV,SAAS,CAACO,UAAD,CAAT,CAAsBG,gBADb,CAETV,SAAS,CAACO,UAAD,CAAT,CAAsBE,WAJJ,CAKtBE,gBAAgB,CAAEX,SAAS,CAACO,UAAD,CAAT,CAAsBI,gBALlB,CAMtBC,MAAM,CAAEZ,SAAS,CAACO,UAAD,CAAT,CAAsBK,MANR,CAAxB,CASA,MAAON,CAAAA,SAAP,CACD,CAXsB,CAWpB,EAXoB,CAAvB,CAaA,KAAK/B,QAAL,CAAc,CAAEK,cAAc,CAAdA,cAAF,CAAd,CAAkC,KAAKJ,SAAL,CAAeI,cAAf,CAAlC,EACD,C,wGAGuCa,M,CAA0B,IAAlBoB,CAAAA,QAAkB,2DAAP,KAAO,CAChE,GAAMb,CAAAA,SAAS,CAAGC,KAAK,CAACC,OAAN,CAAcT,MAAd,mBAA6BA,MAA7B,EAAwCA,MAA1D,CAEA,GAAMV,CAAAA,2BAA2B,CAAGoB,MAAM,CAACC,IAAP,CAAYJ,SAAZ,EAAuBK,MAAvB,CAA8B,SAACC,SAAD,CAAYC,UAAZ,CAA2B,CAC3FD,SAAS,CAACC,UAAD,CAAT,CAAwB,CACtBO,UAAU,CAAED,QAAQ,CAChBb,SAAS,CAACO,UAAD,CAAT,CAAsBQ,OAAtB,CAA8BD,UADd,CAEhBd,SAAS,CAACO,UAAD,CAAT,CAAsBO,UAHJ,CAItBC,OAAO,CAAEf,SAAS,CAACO,UAAD,CAAT,CAAsBQ,OAJT,CAKtBC,IAAI,CAAEH,QAAQ,CAAGb,SAAS,CAACO,UAAD,CAAT,CAAsBQ,OAAtB,CAA8BC,IAAjC,CAAwChB,SAAS,CAACO,UAAD,CAAT,CAAsBS,IALtD,CAAxB,CAQA,MAAOV,CAAAA,SAAP,CACD,CAVmC,CAUjC,EAViC,CAApC,CAYA,KAAK/B,QAAL,CAAc,CAAEQ,2BAA2B,CAA3BA,2BAAF,CAAd,CAA+C,KAAKP,SAAL,CAAeO,2BAAf,CAA/C,EACD,C,4CAESU,M,CAAQ,iBAChB,GAAMwB,CAAAA,cAAc,CAAGxB,MAAM,CAAGU,MAAM,CAACe,MAAP,CAAczB,MAAd,CAAH,CAA2B,EAAxD,CAEA,GAAIwB,cAAc,CAACE,MAAf,CAAwB,CAA5B,CAA+B,CAC7BF,cAAc,CAACG,OAAf,CAAuB,SAAAC,QAAQ,CAAI,CACjC,GAAIA,QAAJ,CAAc,CACZ,GAAM7C,CAAAA,SAAS,CAAG2B,MAAM,CAACe,MAAP,CAAcG,QAAd,EAAwBC,IAAxB,CAA6B,SAAAlC,KAAK,CAAI,mBACtD,MAAOA,CAAAA,KAAK,EAAI,gBAAAA,KAAK,CAACK,MAAN,sDAAc0B,MAAd,EAAuB,CAAvC,CACD,CAFiB,CAAlB,CAIA,MAAI,CAAC5C,QAAL,CAAc,CAAEC,SAAS,CAATA,SAAF,CAAd,EACA,OACD,CACF,CATD,EAUD,CACF,C,2DAEkB,CACjB,GAAM+C,CAAAA,aAAa,CAAGhE,GAAG,CAAC,KAAKE,KAAN,CAAa,0BAAb,CAAzB,CACA,GAAMqC,CAAAA,qBAAqB,CAAGyB,aAAH,SAAGA,aAAH,iBAAGA,aAAa,CAAEzB,qBAA7C,CACA,GAAMF,CAAAA,QAAQ,CAAG2B,aAAH,SAAGA,aAAH,iBAAGA,aAAa,CAAE3B,QAAhC,CAEA,GAAIK,KAAK,CAACC,OAAN,CAAcJ,qBAAd,GAAwCA,qBAAqB,CAACqB,MAAtB,CAA+B,CAA3E,CAA8E,CAC5E,GAAMnC,CAAAA,2BAA2B,CAAGc,qBAAqB,CAAC0B,GAAtB,CAA0B,SAAAC,IAAI,yCAAK,CACrEC,UAAU,CAAED,IAAI,CAACC,UADoD,CAErEV,IAAI,gBAAES,IAAI,CAACV,OAAP,wCAAE,cAAcC,IAFiD,CAGrEF,UAAU,iBAAEW,IAAI,CAACV,OAAP,yCAAE,eAAcD,UAAd,CAAyBa,IAAzB,CAA8B,IAA9B,CAHyD,CAAL,EAA9B,CAApC,CAMA,KAAKpD,QAAL,CAAc,CACZS,2BAA2B,CAA3BA,2BADY,CAEZpB,YAAY,CAAE,6BAFF,CAGZc,UAAU,CAAEpB,2BAA2B,CAACqB,KAH5B,CAIZM,iCAAiC,CAAEa,qBAJvB,CAAd,EAMD,CAED,GAAIG,KAAK,CAACC,OAAN,CAAcN,QAAd,GAA2BA,QAAQ,CAACuB,MAAT,CAAkB,CAAjD,CAAoD,CAClD,GAAMtC,CAAAA,cAAc,CAAGe,QAAQ,CAAC4B,GAAT,CAAa,SAAAC,IAAI,QAAK,CAC3CjB,mBAAmB,CAAEiB,IAAI,CAACjB,mBADiB,CAE3CC,WAAW,CAAE,CACXmB,IAAI,CAAEH,IAAI,CAACI,eADA,CAEXC,KAAK,CAAEL,IAAI,CAACf,gBAFD,CAF8B,CAM3CC,gBAAgB,CAAEc,IAAI,CAACd,gBANoB,CAO3CC,MAAM,CAAEa,IAAI,CAACb,MAP8B,CAAL,EAAjB,CAAvB,CAUA,KAAKrC,QAAL,CAAc,CACZM,cAAc,CAAdA,cADY,CAEZjB,YAAY,CAAE,gBAFF,CAGZc,UAAU,CAAErB,8BAA8B,CAACsB,KAH/B,CAIZG,oBAAoB,CAAEc,QAJV,CAAd,EAMD,CACF,C,6CAGW,CACV,KAAKrB,QAAL,CAAc,CAAEE,cAAc,CAAE,IAAlB,CAAd,EACD,C,6CAGW,CACV,KAAKF,QAAL,CAAc,CAAEE,cAAc,CAAE,KAAlB,CAAd,EACD,C,yEAGyB,CACxB,KAAKsD,SAAL,GACD,C,8EAG0BlD,c,CAAgB,CACzC,GAAMC,CAAAA,oBAAoB,CAAGqB,MAAM,CAACC,IAAP,CAAYvB,cAAZ,EAA4BwB,MAA5B,CAAmC,SAAC2B,GAAD,CAAMC,GAAN,CAAc,yBACLpD,cAAc,CAACoD,GAAD,CADT,CACpEzB,mBADoE,qBACpEA,mBADoE,CAC/CC,WAD+C,qBAC/CA,WAD+C,CAClCE,gBADkC,qBAClCA,gBADkC,CAChBC,MADgB,qBAChBA,MADgB,CAE5EoB,GAAG,CAACC,GAAD,CAAH,CAAW,CACTzB,mBAAmB,CAAEA,mBAAmB,EAAI,EADnC,CAETqB,eAAe,CAAE,CAAApB,WAAW,OAAX,EAAAA,WAAW,SAAX,QAAAA,WAAW,CAAEmB,IAAb,GAAqB,EAF7B,CAGTlB,gBAAgB,CAAE,CAAAD,WAAW,OAAX,EAAAA,WAAW,SAAX,QAAAA,WAAW,CAAEqB,KAAb,GAAsB,EAH/B,CAITnB,gBAAgB,CAAEA,gBAAgB,EAAI,EAJ7B,CAKTC,MAAM,CAAEA,MAAM,EAAI,EALT,CAAX,CAOA,MAAOoB,CAAAA,GAAP,CACD,CAV4B,CAU1B,EAV0B,CAA7B,CAYA,KAAKzD,QAAL,CAAc,CAAEM,cAAc,CAAdA,cAAF,CAAkBC,oBAAoB,CAApBA,oBAAlB,CAAd,EACD,C,wGAGuCE,2B,CAA6B,CACnE,GAAMC,CAAAA,iCAAiC,CAAGkB,MAAM,CAACC,IAAP,CAAYpB,2BAAZ,EAAyCqB,MAAzC,CACxC,SAAC2B,GAAD,CAAMC,GAAN,CAAc,2BAC6BjD,2BAA2B,CAACiD,GAAD,CADxD,CACJP,UADI,uBACJA,UADI,CACQV,IADR,uBACQA,IADR,CACcF,UADd,uBACcA,UADd,CAEZkB,GAAG,CAACC,GAAD,CAAH,CAAW,CACTP,UAAU,CAAVA,UADS,CAETX,OAAO,CAAE,CACPC,IAAI,CAAJA,IADO,CAEPF,UAAU,CAAEA,UAAF,SAAEA,UAAF,iBAAEA,UAAU,CAAEoB,KAAZ,CAAkB,IAAlB,CAFL,CAFA,CAAX,CAOA,MAAOF,CAAAA,GAAP,CACD,CAXuC,CAYxC,EAZwC,CAA1C,CAeA,KAAKzD,QAAL,CAAc,CAAES,2BAA2B,CAA3BA,2BAAF,CAA+BC,iCAAiC,CAAjCA,iCAA/B,CAAd,EACD,C,4DAGiBN,K,CAAO,CACvB,GAAIA,KAAK,GAAKtB,8BAA8B,CAACsB,KAA7C,CAAoD,CAClD,KAAKJ,QAAL,CAAc,CAAEX,YAAY,CAAE,gBAAhB,CAAd,EACD,CAFD,IAEO,IAAIe,KAAK,GAAKrB,2BAA2B,CAACqB,KAA1C,CAAiD,CACtD,KAAKJ,QAAL,CAAc,CAAEX,YAAY,CAAE,6BAAhB,CAAd,EACD,CAFM,IAEA,CACL,KAAKW,QAAL,CAAc,CAAEX,YAAY,CAAE,IAAhB,CAAd,EACD,CACF,C,iEAGqB,IACZA,CAAAA,YADY,CACK,KAAKC,KADV,CACZD,YADY,CAEpB,GAAIA,YAAJ,CAAkB,CAChB,GAAMuE,CAAAA,WAAW,CAAGhC,MAAM,CAACC,IAAP,CAAY,KAAKvC,KAAL,CAAWD,YAAX,EAAyB,CAAzB,CAAZ,EAAyCyC,MAAzC,CAAgD,SAAC2B,GAAD,CAAMI,IAAN,CAAe,CACjFJ,GAAG,CAACI,IAAD,CAAH,CAAY,EAAZ,CACA,MAAOJ,CAAAA,GAAP,CACD,CAHmB,CAGjB,EAHiB,CAApB,CAIA,KAAKzD,QAAL,oBAAiBX,YAAjB,CAAgC,CAACuE,WAAD,CAAhC,GACD,CACF,C,wDAEevE,Y,CAAc,CAC5B,GAAMO,CAAAA,yBAAyB,CAAGgC,MAAM,CAACe,MAAP,CAAc,KAAKrD,KAAL,CAAWD,YAAX,CAAd,EAAwC4D,GAAxC,CAChC,SAAAa,YAAY,QAAIA,CAAAA,YAAJ,EADoB,CAAlC,CAGA,GAAMhE,CAAAA,+BAA+B,CAAG,EAAxC,CACA,GAAMD,CAAAA,wBAAwB,CAAG+B,MAAM,CAACe,MAAP,CAAc,KAAKrD,KAAL,WAAcD,YAAd,WAAd,EAAmDyC,MAAnD,CAC/B,SAACgC,YAAD,CAAenB,MAAf,CAAuBoB,KAAvB,CAAiC,CAC/BD,YAAY,CAACC,KAAD,CAAZ,CAAsBpB,MAAtB,CACA7C,+BAA+B,CAACkE,IAAhC,CAAqCrB,MAArC,EACA,MAAOmB,CAAAA,YAAP,CACD,CAL8B,CAM/B,EAN+B,CAAjC,CASA,MAAO,CAAElE,yBAAyB,CAAzBA,yBAAF,CAA6BC,wBAAwB,CAAxBA,wBAA7B,CAAuDC,+BAA+B,CAA/BA,+BAAvD,CAAP,CACD,C,+DA6BoB,CACnB,KAAKX,QAAL,GACA,KAAK8E,SAAL,GACD,C,uCAEQ,iBAUH,KAAK3E,KAVF,CAELY,cAFK,aAELA,cAFK,CAGLb,YAHK,aAGLA,YAHK,CAILc,UAJK,aAILA,UAJK,CAKLG,cALK,aAKLA,cALK,CAMLG,2BANK,aAMLA,2BANK,CAOLJ,cAPK,aAOLA,cAPK,CAQLG,2BARK,aAQLA,2BARK,CASLP,SATK,aASLA,SATK,CAYP,GAAMiE,CAAAA,WAAW,CAAG1F,UAAU,CAC5B,MAD4B,CAE5BD,KAAK,CAAC4F,SAFsB,CAG5B5F,KAAK,CAAC6F,MAHsB,CAI5B7F,KAAK,CAAC8F,YAJsB,CAK5B9F,KAAK,CAAC+F,WALsB,CAM5B/F,KAAK,CAACgG,WANsB,CAA9B,CASA,mBACE,qDACE,oBAAC,MAAD,EACE,IAAI,CAAC,QADP,CAEE,KAAK,CAAEjG,oBAAoB,CAACkG,IAF9B,CAGE,SAAS,CAAErG,IAAI,CAACsG,OAHlB,CAIE,SAAS,CAAEjG,UAAU,oBAAID,KAAK,CAACmG,QAAV,CAAqBzE,SAArB,EAJvB,CAKE,OAAO,CAAE,KAAK0E,uBALhB,EADF,cASE,oBAAC,KAAD,EACE,IAAI,CAAE,KAAKV,SADb,CAEE,SAAS,CAAE/D,cAFb,CAGE,KAAK,CAAC,OAHR,CAIE,GAAG,WAAK,KAAKS,SAAV,8BAJL,eAME,oBAAC,KAAD,CAAO,MAAP,EAAc,KAAK,CAAErC,oBAAoB,CAACkG,IAA1C,CAAgD,SAAS,CAAEjG,KAAK,CAAC6F,MAAjE,EANF,cAOE,oBAAC,KAAD,CAAO,IAAP,mBACE,0BAAI,SAAS,CAAEF,WAAf,eACE,2CACE,oBAAC,UAAD,EACE,QAAQ,CAAE5F,oBADZ,CAEE,QAAQ,CAAE,KAAKsG,iBAFjB,CAGE,YAAY,CAAEzE,UAHhB,CAIE,OAAO,CAAE,IAJX,CAKE,WAAW,CAAE,IALf,EADF,CADF,cAWE,oBAAC,UAAD,EACE,oBAAoB,KADtB,CAEE,QAAQ,CAAEzB,QAFZ,CAGE,KAAK,CAAE,KAAKiC,SAHd,CAIE,aAAa,CAAEL,cAJjB,CAKE,WAAW,CAAE,KAAKuE,0BALpB,CAME,QAAQ,CAAExF,YAAY,GAAK,gBAN7B,CAOE,cAAc,CAAE,CAAC,IAAD,CAAO,IAAP,CAAa,IAAb,CAAmB,KAAnB,CAPlB,CAQE,kBAAkB,CAAE,KAAKiC,0BAR3B,CASE,MAAM,CAAEjB,cATV,EAXF,cAuBE,oBAAC,UAAD,EACE,oBAAoB,KADtB,CAEE,QAAQ,CAAE1B,qBAFZ,CAGE,KAAK,CAAE,KAAKgC,SAHd,CAIE,aAAa,CAAEF,2BAJjB,CAKE,WAAW,CAAE,KAAKqE,uCALpB,CAME,QAAQ,CAAEzF,YAAY,GAAK,6BAN7B,CAOE,cAAc,CAAE,CAAC,KAAD,CAAQ,IAAR,CAAc,IAAd,CAPlB,CAQE,kBAAkB,CAAE,KAAKmC,uCAR3B,CASE,MAAM,CAAEhB,2BATV,EAvBF,CADF,CAPF,cA4CE,oBAAC,KAAD,CAAO,MAAP,mBACE,oBAAC,MAAD,EACE,IAAI,CAAC,QADP,CAEE,SAAS,CAAC,QAFZ,CAGE,SAAS,CAAErC,IAAI,CAAC4G,MAHlB,CAIE,UAAU,CAAE7G,OAJd,CAKE,OAAO,CAAE,KAAK8G,kBALhB,EAOG3G,IAPH,CADF,cAUE,oBAAC,MAAD,EACE,IAAI,CAAC,QADP,CAEE,SAAS,CAAC,QAFZ,CAGE,SAAS,CAAEF,IAAI,CAAC8G,MAHlB,CAIE,OAAO,CAAE,KAAKC,mBAJhB,EAMG9G,KANH,CAVF,CA5CF,CATF,CADF,CA4ED,C,uCAjXqCP,S,mFAoDrCE,Q,yLAoBAA,Q,wKA4EAA,Q,0IAKAA,Q,wJAKAA,Q,yKAKAA,Q,yLAiBAA,Q,gLAoBAA,Q,4JAWAA,Q,6JAuDAA,Q,oGA+GH,cAAekB,CAAAA,yBAAf","sourcesContent":["import React, { Component } from 'react';\r\nimport Modal from '../../../common/modal/Modal';\r\nimport autobind from 'autobind-decorator';\r\nimport ArrayGroup from './ArrayGroup';\r\nimport Button, { PRIMARY } from '../../../common/Button';\r\nimport { ICON } from '@distate/components';\r\nimport { CLEAR, SAVE } from '../../../common/Lbl';\r\nimport GoodTraceabilityInfo from '@distate/core/dist/domain/documents/upd/vo/good/GoodTraceabilityInfo';\r\nimport style from '../../../common/form/documents/DocumentFormBuilder.module.css';\r\nimport classNames from 'classnames';\r\nimport RadioGroup from '../../../common/form/components/radio/RadioGroup';\r\nimport Tracking from '@distate/core/dist/domain/documents/upd/vo/good/information/tracking/Tracking';\r\nimport IdentificationNumbers from '@distate/core/dist/domain/documents/upd/vo/good/information/identificationNumbers/IdentificationNumbers';\r\nimport { set } from 'object-path-immutable';\r\nimport PropTypes from 'prop-types';\r\nimport ProductNotSubjectToLabelingOrTraceability from '@distate/core/dist/domain/common/options/ProductNotSubjectToLabelingOrTraceability';\r\nimport ProductTraceabilityInformation from '@distate/core/dist/domain/common/options/ProductTraceabilityInformation';\r\nimport ProductIdentificationNumber from '@distate/core/dist/domain/common/options/ProductIdentificationNumber';\r\nimport get from 'get-value';\r\n\r\nclass GoodTraceabilityInfoModal extends Component {\r\n  static propTypes = {\r\n    errors: PropTypes.array\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      activeFields: null,\r\n      hasErrors: false,\r\n      isModalVisible: false,\r\n      radioValue: ProductNotSubjectToLabelingOrTraceability.value,\r\n\r\n      trackingErrors: [],\r\n      trackingFields: {},\r\n      trackingFieldsToSend: {},\r\n\r\n      identificationNumbersErrors: [],\r\n      identificationNumbersFields: {},\r\n      identificationNumbersFieldsToSend: {}\r\n    };\r\n\r\n    this.formScope = `${props.scope}`;\r\n    this.trackingPath = `${this.formScope}.${Tracking.field}`;\r\n    this.identificationNumbersPath = `${this.formScope}.${IdentificationNumbers.field}`;\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.setInitialValues();\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    if (prevProps !== this.props) {\r\n      this.setInitialValues();\r\n    }\r\n    if (JSON.stringify(prevProps.errors) !== JSON.stringify(this.props.errors)) {\r\n      this.updateServerErrors();\r\n    }\r\n  }\r\n\r\n  updateServerErrors() {\r\n    const serverErrors = get(this.props, 'errors');\r\n\r\n    if (serverErrors?.tracking) {\r\n      this.handleTrackingErrorsChange(serverErrors.tracking);\r\n    }\r\n\r\n    if (serverErrors?.identificationNumbers) {\r\n      this.handleIdentificationNumbersErrorsChange(serverErrors.identificationNumbers, true);\r\n    }\r\n  }\r\n\r\n  @autobind\r\n  handleTrackingErrorsChange(errors) {\r\n    const errorsObj = Array.isArray(errors) ? { ...errors } : errors;\r\n\r\n    const trackingErrors = Object.keys(errorsObj).reduce((newErrors, currentKey) => {\r\n      newErrors[currentKey] = {\r\n        additionalIndicator: errorsObj[currentKey].additionalIndicator,\r\n        measurement: errorsObj[currentKey].measurementTitle\r\n          ? errorsObj[currentKey].measurementTitle\r\n          : errorsObj[currentKey].measurement,\r\n        measurementValue: errorsObj[currentKey].measurementValue,\r\n        number: errorsObj[currentKey].number\r\n      };\r\n\r\n      return newErrors;\r\n    }, {});\r\n\r\n    this.setState({ trackingErrors }, this.hasErrors(trackingErrors));\r\n  }\r\n\r\n  @autobind\r\n  handleIdentificationNumbersErrorsChange(errors, isServer = false) {\r\n    const errorsObj = Array.isArray(errors) ? { ...errors } : errors;\r\n\r\n    const identificationNumbersErrors = Object.keys(errorsObj).reduce((newErrors, currentKey) => {\r\n      newErrors[currentKey] = {\r\n        collection: isServer\r\n          ? errorsObj[currentKey].numbers.collection\r\n          : errorsObj[currentKey].collection,\r\n        numbers: errorsObj[currentKey].numbers,\r\n        type: isServer ? errorsObj[currentKey].numbers.type : errorsObj[currentKey].type\r\n      };\r\n\r\n      return newErrors;\r\n    }, {});\r\n\r\n    this.setState({ identificationNumbersErrors }, this.hasErrors(identificationNumbersErrors));\r\n  }\r\n\r\n  hasErrors(errors) {\r\n    const trackingErrArr = errors ? Object.values(errors) : [];\r\n\r\n    if (trackingErrArr.length > 0) {\r\n      trackingErrArr.forEach(errorObj => {\r\n        if (errorObj) {\r\n          const hasErrors = Object.values(errorObj).some(field => {\r\n            return field && field.errors?.length > 0;\r\n          });\r\n\r\n          this.setState({ hasErrors });\r\n          return;\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  setInitialValues() {\r\n    const initialValues = get(this.props, 'initialFieldDomain.value');\r\n    const identificationNumbers = initialValues?.identificationNumbers;\r\n    const tracking = initialValues?.tracking;\r\n\r\n    if (Array.isArray(identificationNumbers) && identificationNumbers.length > 0) {\r\n      const identificationNumbersFields = identificationNumbers.map(item => ({\r\n        packNumber: item.packNumber,\r\n        type: item.numbers?.type,\r\n        collection: item.numbers?.collection.join('\\n')\r\n      }));\r\n\r\n      this.setState({\r\n        identificationNumbersFields,\r\n        activeFields: 'identificationNumbersFields',\r\n        radioValue: ProductIdentificationNumber.value,\r\n        identificationNumbersFieldsToSend: identificationNumbers\r\n      });\r\n    }\r\n\r\n    if (Array.isArray(tracking) && tracking.length > 0) {\r\n      const trackingFields = tracking.map(item => ({\r\n        additionalIndicator: item.additionalIndicator,\r\n        measurement: {\r\n          code: item.measurementCode,\r\n          title: item.measurementTitle\r\n        },\r\n        measurementValue: item.measurementValue,\r\n        number: item.number\r\n      }));\r\n\r\n      this.setState({\r\n        trackingFields,\r\n        activeFields: 'trackingFields',\r\n        radioValue: ProductTraceabilityInformation.value,\r\n        trackingFieldsToSend: tracking\r\n      });\r\n    }\r\n  }\r\n\r\n  @autobind\r\n  showModal() {\r\n    this.setState({ isModalVisible: true });\r\n  }\r\n\r\n  @autobind\r\n  hideModal() {\r\n    this.setState({ isModalVisible: false });\r\n  }\r\n\r\n  @autobind\r\n  handleShowModalBtnClick() {\r\n    this.showModal();\r\n  }\r\n\r\n  @autobind\r\n  handleTrackingFieldsValues(trackingFields) {\r\n    const trackingFieldsToSend = Object.keys(trackingFields).reduce((obj, key) => {\r\n      const { additionalIndicator, measurement, measurementValue, number } = trackingFields[key];\r\n      obj[key] = {\r\n        additionalIndicator: additionalIndicator || '',\r\n        measurementCode: measurement?.code || '',\r\n        measurementTitle: measurement?.title || '',\r\n        measurementValue: measurementValue || '',\r\n        number: number || ''\r\n      };\r\n      return obj;\r\n    }, {});\r\n\r\n    this.setState({ trackingFields, trackingFieldsToSend });\r\n  }\r\n\r\n  @autobind\r\n  handleIdentificationNumbersFieldsValues(identificationNumbersFields) {\r\n    const identificationNumbersFieldsToSend = Object.keys(identificationNumbersFields).reduce(\r\n      (obj, key) => {\r\n        const { packNumber, type, collection } = identificationNumbersFields[key];\r\n        obj[key] = {\r\n          packNumber,\r\n          numbers: {\r\n            type,\r\n            collection: collection?.split('\\n')\r\n          }\r\n        };\r\n        return obj;\r\n      },\r\n      {}\r\n    );\r\n\r\n    this.setState({ identificationNumbersFields, identificationNumbersFieldsToSend });\r\n  }\r\n\r\n  @autobind\r\n  handleRadioChange(value) {\r\n    if (value === ProductTraceabilityInformation.value) {\r\n      this.setState({ activeFields: 'trackingFields' });\r\n    } else if (value === ProductIdentificationNumber.value) {\r\n      this.setState({ activeFields: 'identificationNumbersFields' });\r\n    } else {\r\n      this.setState({ activeFields: null });\r\n    }\r\n  }\r\n\r\n  @autobind\r\n  handleClearBtnClick() {\r\n    const { activeFields } = this.state;\r\n    if (activeFields) {\r\n      const cleanFields = Object.keys(this.state[activeFields][0]).reduce((obj, prop) => {\r\n        obj[prop] = '';\r\n        return obj;\r\n      }, {});\r\n      this.setState({ [activeFields]: [cleanFields] });\r\n    }\r\n  }\r\n\r\n  getSortedFields(activeFields) {\r\n    const sortedInitialFieldsValues = Object.values(this.state[activeFields]).map(\r\n      fieldsValues => fieldsValues\r\n    );\r\n    const sortedInitialFieldsValuesToSend = [];\r\n    const sortedFieldsValuesToSend = Object.values(this.state[`${activeFields}ToSend`]).reduce(\r\n      (fieldsValues, values, index) => {\r\n        fieldsValues[index] = values;\r\n        sortedInitialFieldsValuesToSend.push(values);\r\n        return fieldsValues;\r\n      },\r\n      {}\r\n    );\r\n\r\n    return { sortedInitialFieldsValues, sortedFieldsValuesToSend, sortedInitialFieldsValuesToSend };\r\n  }\r\n\r\n  saveData = async () => {\r\n    const { setDataToComponentState } = this.props;\r\n    const { activeFields } = this.state;\r\n\r\n    if (activeFields) {\r\n      const savePath =\r\n        activeFields === 'trackingFields' ? this.trackingPath : this.identificationNumbersPath;\r\n      const removalPath =\r\n        activeFields === 'trackingFields' ? this.identificationNumbersPath : this.trackingPath;\r\n      const {\r\n        sortedInitialFieldsValues,\r\n        sortedFieldsValuesToSend,\r\n        sortedInitialFieldsValuesToSend\r\n      } = this.getSortedFields(activeFields);\r\n      const valuesToSave = set({}, savePath, sortedFieldsValuesToSend);\r\n\r\n      await setDataToComponentState(valuesToSave, savePath, false);\r\n      await setDataToComponentState(null, removalPath, false);\r\n\r\n      this.setState({\r\n        [activeFields]: sortedInitialFieldsValues,\r\n        [`${activeFields}ToSend`]: sortedInitialFieldsValuesToSend\r\n      });\r\n    }\r\n  };\r\n\r\n  @autobind\r\n  handleSaveBtnClick() {\r\n    this.saveData();\r\n    this.hideModal();\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      isModalVisible,\r\n      activeFields,\r\n      radioValue,\r\n      trackingFields,\r\n      identificationNumbersFields,\r\n      trackingErrors,\r\n      identificationNumbersErrors,\r\n      hasErrors\r\n    } = this.state;\r\n\r\n    const formClasses = classNames(\r\n      'form',\r\n      style.modalForm,\r\n      style.center,\r\n      style.bottomIndent,\r\n      style.hideFirstHr,\r\n      style.rightIndent\r\n    );\r\n\r\n    return (\r\n      <>\r\n        <Button\r\n          type=\"button\"\r\n          title={GoodTraceabilityInfo.name}\r\n          iconClass={ICON.tiStamp}\r\n          className={classNames({ [style.btnError]: hasErrors })}\r\n          onClick={this.handleShowModalBtnClick}\r\n        ></Button>\r\n\r\n        <Modal\r\n          hide={this.hideModal}\r\n          isVisible={isModalVisible}\r\n          width=\"700px\"\r\n          key={`${this.formScope}_goodTraceabilityInfoModal`}\r\n        >\r\n          <Modal.Header title={GoodTraceabilityInfo.name} className={style.center} />\r\n          <Modal.Body>\r\n            <ul className={formClasses}>\r\n              <li>\r\n                <RadioGroup\r\n                  DomainVO={GoodTraceabilityInfo}\r\n                  onChange={this.handleRadioChange}\r\n                  initialValue={radioValue}\r\n                  isBlock={true}\r\n                  isWidthAuto={true}\r\n                />\r\n              </li>\r\n\r\n              <ArrayGroup\r\n                isFirstRowNameHidden\r\n                domainVO={Tracking}\r\n                scope={this.formScope}\r\n                initialValues={trackingFields}\r\n                returnState={this.handleTrackingFieldsValues}\r\n                isHidden={activeFields !== 'trackingFields'}\r\n                requiredFields={[true, true, true, false]}\r\n                handleErrorsChange={this.handleTrackingErrorsChange}\r\n                errors={trackingErrors}\r\n              />\r\n\r\n              <ArrayGroup\r\n                isFirstRowNameHidden\r\n                domainVO={IdentificationNumbers}\r\n                scope={this.formScope}\r\n                initialValues={identificationNumbersFields}\r\n                returnState={this.handleIdentificationNumbersFieldsValues}\r\n                isHidden={activeFields !== 'identificationNumbersFields'}\r\n                requiredFields={[false, true, true]}\r\n                handleErrorsChange={this.handleIdentificationNumbersErrorsChange}\r\n                errors={identificationNumbersErrors}\r\n              />\r\n            </ul>\r\n          </Modal.Body>\r\n          <Modal.Footer>\r\n            <Button\r\n              type=\"button\"\r\n              className=\"center\"\r\n              iconClass={ICON.accept}\r\n              colorClass={PRIMARY}\r\n              onClick={this.handleSaveBtnClick}\r\n            >\r\n              {SAVE}\r\n            </Button>\r\n            <Button\r\n              type=\"button\"\r\n              className=\"center\"\r\n              iconClass={ICON.cancel}\r\n              onClick={this.handleClearBtnClick}\r\n            >\r\n              {CLEAR}\r\n            </Button>\r\n          </Modal.Footer>\r\n        </Modal>\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nGoodTraceabilityInfoModal.propTypes = {\r\n  setDataToComponentState: PropTypes.func,\r\n  scope: PropTypes.string\r\n};\r\n\r\nexport default GoodTraceabilityInfoModal;\r\n"]},"metadata":{},"sourceType":"module"}