{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import set from'lodash.set';import{useState,useEffect}from'react';import{useLocation,useParams}from'react-router-dom';import InvoiceService from'@distate/core/dist/application/documents/invoice/InvoiceService';import{DOCUMENT_VIEW}from'../../../common/Url';import{CREATE_UCD,EDIT_UCD}from'../../../common/Lbl';import{parseLocationSearch}from'../../../utils/parseLocationSearch';import{schemaUCD,uiSchemaUCD}from'../helpers/schema.ucd';import{transformerDTOUCDForm,transformerDTOUCDTable,getPurposeSchema}from'../helpers/transformers';var formSchema=schemaUCD;var formUISchema=uiSchemaUCD;export var useUCD=function useUCD(){var _useParams=useParams(),id=_useParams.id;var _useLocation=useLocation(),search=_useLocation.search;var _parseLocationSearch=parseLocationSearch(search),documentID=_parseLocationSearch.id;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setIsLoading=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),rawUCD=_useState4[0],setRawUCD=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),formData=_useState6[0],setFormData=_useState6[1];var _useState7=useState({}),_useState8=_slicedToArray(_useState7,2),formTable=_useState8[0],setFormTable=_useState8[1];var _useState9=useState({}),_useState10=_slicedToArray(_useState9,2),formTableDefault=_useState10[0],setFormTableDefault=_useState10[1];var customSetFormData=function customSetFormData(data){return setFormData(function(state){return _objectSpread(_objectSpread({},state),data);});};/**\r\n   * Универсальный корректировочный документ\r\n   * для форм схемы.\r\n   */useEffect(function(){var requestId=documentID||id;if(!requestId)return;var onClickFactActivity=function onClickFactActivity(){return window.open(DOCUMENT_VIEW.replace(':id',String(requestId)));};var request=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var UCD,purpose,_formData,_formTable,formTableJson;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setIsLoading(true);_context.next=4;return InvoiceService.get(requestId);case 4:UCD=_context.sent;purpose=getPurposeSchema(UCD);_formData=transformerDTOUCDForm(UCD);_formTable=transformerDTOUCDTable(UCD);// кастомизируем форм схему динамическими значениями\nset(formSchema,'properties.purpose',purpose);set(formUISchema,'factActivity.onClick',onClickFactActivity);setRawUCD(UCD);setFormData(_formData);setFormTable(_formTable);// клонируем объект для избежания перезаписи вложенных объектов\nformTableJson=JSON.stringify(_formTable);setFormTableDefault(JSON.parse(formTableJson));case 15:_context.prev=15;setIsLoading(false);return _context.finish(15);case 18:case\"end\":return _context.stop();}}},_callee,null,[[0,,15,18]]);}));return function request(){return _ref.apply(this,arguments);};}();request();},[id,documentID]);var title=id?EDIT_UCD:CREATE_UCD;return{rawUCD:rawUCD,id:id,title:title,isLoading:isLoading,schema:formSchema,uischema:formUISchema,formData:formData,formTable:formTable,formTableDefault:formTableDefault,setFormTable:setFormTable,setFormData:customSetFormData,setIsLoading:setIsLoading};};","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/upd/hooks/use-ucd.ts"],"names":["set","useState","useEffect","useLocation","useParams","InvoiceService","DOCUMENT_VIEW","CREATE_UCD","EDIT_UCD","parseLocationSearch","schemaUCD","uiSchemaUCD","transformerDTOUCDForm","transformerDTOUCDTable","getPurposeSchema","formSchema","formUISchema","useUCD","id","search","documentID","isLoading","setIsLoading","rawUCD","setRawUCD","formData","setFormData","formTable","setFormTable","formTableDefault","setFormTableDefault","customSetFormData","data","state","requestId","onClickFactActivity","window","open","replace","String","request","get","UCD","purpose","formTableJson","JSON","stringify","parse","title","schema","uischema"],"mappings":"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","sourcesContent":["import set from 'lodash.set';\r\nimport { useState, useEffect } from 'react';\r\nimport { useLocation, useParams } from 'react-router-dom';\r\nimport InvoiceService from '@distate/core/dist/application/documents/invoice/InvoiceService';\r\n\r\nimport {DOCUMENT_VIEW} from '../../../common/Url';\r\nimport {CREATE_UCD, EDIT_UCD} from '../../../common/Lbl';\r\nimport { parseLocationSearch } from '../../../utils/parseLocationSearch';\r\nimport { schemaUCD, uiSchemaUCD } from '../helpers/schema.ucd';\r\n\r\nimport {\r\n  transformerDTOUCDForm,\r\n  transformerDTOUCDTable,\r\n  getPurposeSchema\r\n} from '../helpers/transformers';\r\n\r\nconst formSchema: Record<string, any> = schemaUCD;\r\nconst formUISchema: Record<string, any> = uiSchemaUCD;\r\n\r\nexport const useUCD = () => {\r\n  const { id } = useParams();\r\n  const { search } = useLocation();\r\n  const { id: documentID } = parseLocationSearch(search);\r\n\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [rawUCD, setRawUCD] = useState();\r\n  const [formData, setFormData] = useState<Record<string, any>>({});\r\n  const [formTable, setFormTable] = useState<Record<string, any>>({});\r\n  const [formTableDefault, setFormTableDefault] = useState<Record<string, any>>({});\r\n\r\n  const customSetFormData = (data: Record<string, any>) =>\r\n    setFormData(state => ({ ...state, ...data }));\r\n\r\n  /**\r\n   * Универсальный корректировочный документ\r\n   * для форм схемы.\r\n   */\r\n  useEffect(() => {\r\n    const requestId = documentID || id;\r\n    if (!requestId) return;\r\n\r\n    const onClickFactActivity = () => window.open(DOCUMENT_VIEW.replace(':id', String(requestId)));\r\n    const request = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        const UCD = await InvoiceService.get(requestId);\r\n        const purpose = getPurposeSchema(UCD);\r\n        const formData = transformerDTOUCDForm(UCD);\r\n        const formTable = transformerDTOUCDTable(UCD);\r\n\r\n        // кастомизируем форм схему динамическими значениями\r\n        set(formSchema, 'properties.purpose', purpose);\r\n        set(formUISchema, 'factActivity.onClick', onClickFactActivity);\r\n\r\n        setRawUCD(UCD);\r\n        setFormData(formData);\r\n        setFormTable(formTable);\r\n\r\n        // клонируем объект для избежания перезаписи вложенных объектов\r\n        const formTableJson = JSON.stringify(formTable);\r\n        setFormTableDefault(JSON.parse(formTableJson));\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    request();\r\n  }, [id, documentID]);\r\n  const title = id ? EDIT_UCD : CREATE_UCD;\r\n  return {\r\n    rawUCD,\r\n    id,\r\n    title,\r\n    isLoading,\r\n    schema: formSchema,\r\n    uischema: formUISchema,\r\n    formData,\r\n    formTable,\r\n    formTableDefault,\r\n    setFormTable,\r\n    setFormData: customSetFormData,\r\n    setIsLoading\r\n  };\r\n};\r\n"]},"metadata":{},"sourceType":"module"}