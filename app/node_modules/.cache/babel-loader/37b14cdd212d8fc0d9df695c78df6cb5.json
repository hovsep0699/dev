{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(cabinetEffect),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(getEmployeeInfoWorker),_marked3=/*#__PURE__*/_regeneratorRuntime.mark(changeEmployeeInfoWorker);import{takeLatest,put}from'redux-saga/effects';import{Flash}from'../../../../common/flash/Flash';import{getEmployeeInfo,setEmployeeInfo,changeEmployeeInfo,setEmployeeError}from'../actions';import AuthGateway from'@distate/core/dist/application/auth/AuthGateway';import{cabinetGateway}from'@distate/core/dist/application/cabinet/CabinetGateway';/** Кабинет */export function cabinetEffect(){return _regeneratorRuntime.wrap(function cabinetEffect$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return takeLatest(getEmployeeInfo,getEmployeeInfoWorker);case 2:_context.next=4;return takeLatest(changeEmployeeInfo,changeEmployeeInfoWorker);case 4:case\"end\":return _context.stop();}}},_marked);}/** получение информации о пользователе */function getEmployeeInfoWorker(){var _response$person,_response$person2,_response$person3,_response$employee,_response$employee2,authGateway,response,employee,message;return _regeneratorRuntime.wrap(function getEmployeeInfoWorker$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;authGateway=new AuthGateway();_context2.next=4;return authGateway.currentUser();case 4:response=_context2.sent;employee={surname:response===null||response===void 0?void 0:(_response$person=response.person)===null||_response$person===void 0?void 0:_response$person.surname,name:response===null||response===void 0?void 0:(_response$person2=response.person)===null||_response$person2===void 0?void 0:_response$person2.name,patronymic:response===null||response===void 0?void 0:(_response$person3=response.person)===null||_response$person3===void 0?void 0:_response$person3.patronymic,position:response===null||response===void 0?void 0:(_response$employee=response.employee)===null||_response$employee===void 0?void 0:_response$employee.position,email:response===null||response===void 0?void 0:(_response$employee2=response.employee)===null||_response$employee2===void 0?void 0:_response$employee2.email};_context2.next=8;return put(setEmployeeInfo({employee:employee}));case 8:_context2.next=15;break;case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](0);message=_context2.t0.message;_context2.next=15;return Flash.error(message||'Возникла ошибка');case 15:case\"end\":return _context2.stop();}}},_marked2,null,[[0,10]]);}/** изменение информации о пользователе */function changeEmployeeInfoWorker(_ref2){var payload,name,surname,patronymic,position,email,password,formData,response;return _regeneratorRuntime.wrap(function changeEmployeeInfoWorker$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:payload=_ref2.payload;_context3.prev=1;name=payload.name,surname=payload.surname,patronymic=payload.patronymic,position=payload.position,email=payload.email,password=payload.password;formData=new FormData();name&&formData.append('person[name]',name);surname&&formData.append('person[surname]',surname);patronymic&&formData.append('person[patronymic]',patronymic);position&&formData.append('position',position);email&&formData.append('email',email);password&&formData.append('password',password);_context3.next=12;return cabinetGateway.changeCabinetEmployee(formData);case 12:_context3.next=14;return Flash.success('Данные изменены');case 14:_context3.next=23;break;case 16:_context3.prev=16;_context3.t0=_context3[\"catch\"](1);response=_context3.t0.response;_context3.next=21;return put(setEmployeeError({errors:response===null||response===void 0?void 0:response.data}));case 21:_context3.next=23;return Flash.error('Возникла ошибка');case 23:case\"end\":return _context3.stop();}}},_marked3,null,[[1,16]]);}","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/cabinet/store/sagas/cabinetEmployee.effect.ts"],"names":["cabinetEffect","getEmployeeInfoWorker","changeEmployeeInfoWorker","takeLatest","put","Flash","getEmployeeInfo","setEmployeeInfo","changeEmployeeInfo","setEmployeeError","AuthGateway","cabinetGateway","authGateway","currentUser","response","employee","surname","person","name","patronymic","position","email","message","error","payload","password","formData","FormData","append","changeCabinetEmployee","success","errors","data"],"mappings":"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","sourcesContent":["import { takeLatest, put } from 'redux-saga/effects';\r\nimport { Flash } from '../../../../common/flash/Flash';\r\nimport { getEmployeeInfo, setEmployeeInfo, changeEmployeeInfo, setEmployeeError } from '../actions';\r\nimport AuthGateway from '@distate/core/dist/application/auth/AuthGateway';\r\nimport { cabinetGateway } from '@distate/core/dist/application/cabinet/CabinetGateway';\r\n\r\n/** Кабинет */\r\nexport function* cabinetEffect() {\r\n  yield takeLatest(getEmployeeInfo, getEmployeeInfoWorker);\r\n  yield takeLatest(changeEmployeeInfo, changeEmployeeInfoWorker);\r\n}\r\n\r\n/** получение информации о пользователе */\r\nfunction* getEmployeeInfoWorker() {\r\n  try {\r\n    const authGateway = new AuthGateway();\r\n    const response = yield authGateway.currentUser();\r\n\r\n    const employee = {\r\n      surname: response?.person?.surname,\r\n      name: response?.person?.name,\r\n      patronymic: response?.person?.patronymic,\r\n      position: response?.employee?.position,\r\n      email: response?.employee?.email\r\n    };\r\n\r\n    yield put(setEmployeeInfo({ employee }));\r\n  } catch ({ message }) {\r\n    yield Flash.error(message || 'Возникла ошибка');\r\n  }\r\n}\r\n\r\n/** изменение информации о пользователе */\r\nfunction* changeEmployeeInfoWorker({ payload }: { payload: any }) {\r\n  try {\r\n    const { name, surname, patronymic, position, email, password } = payload;\r\n    const formData = new FormData();\r\n    name && formData.append('person[name]', name);\r\n    surname && formData.append('person[surname]', surname);\r\n    patronymic && formData.append('person[patronymic]', patronymic);\r\n    position && formData.append('position', position);\r\n    email && formData.append('email', email);\r\n    password && formData.append('password', password);\r\n\r\n    yield cabinetGateway.changeCabinetEmployee(formData);\r\n    yield Flash.success('Данные изменены');\r\n  } catch ({ response }) {\r\n    yield put(setEmployeeError({ errors: response?.data }));\r\n    yield Flash.error('Возникла ошибка');\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}