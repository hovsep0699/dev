{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(companyAddressEffect),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(setAddressWorker);import{takeLatest,put}from'redux-saga/effects';import SecurityService from'@distate/core/dist/application/security/SecurityService';import{Flash}from'../../../../common/flash/Flash';import{setAddress,clearErrors,setAddressErrors}from'../actions';import{setHasRoleIncomplete}from'../../../../container/sign/store/actions';import CompanyGateway from'@distate/core/dist/application/company/CompanyGateway';/** Реквизиты компании */export function companyAddressEffect(){return _regeneratorRuntime.wrap(function companyAddressEffect$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return takeLatest(setAddress,setAddressWorker);case 2:case\"end\":return _context.stop();}}},_marked);}/** установка реквизитов */function setAddressWorker(_ref){var payload,postalCode,region,district,city,settlement,street,house,building,room,formData,companyGateway,hasRoleIncomplete,request,response;return _regeneratorRuntime.wrap(function setAddressWorker$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:payload=_ref.payload;_context2.prev=1;postalCode=payload.postalCode,region=payload.region,district=payload.district,city=payload.city,settlement=payload.settlement,street=payload.street,house=payload.house,building=payload.building,room=payload.room;formData=new FormData();postalCode&&formData.set('postalCode',postalCode);(region===null||region===void 0?void 0:region.value)&&formData.set('region',region.value);district&&formData.set('district',district);city&&formData.set('city',city);settlement&&formData.set('settlement',settlement);street&&formData.set('street',street);house&&formData.set('house',house);building&&formData.set('building',building);room&&formData.set('room',room);formData.set('country','172');companyGateway=new CompanyGateway();_context2.next=17;return companyGateway.setCompanyAddress(formData);case 17:_context2.next=19;return put(clearErrors({}));case 19:_context2.next=21;return Flash.success('Данные сохранены');case 21:_context2.next=23;return SecurityService.update(function(){return true;});case 23:_context2.next=25;return SecurityService.hasRole('ROLE_INCOMPLETE');case 25:hasRoleIncomplete=_context2.sent;_context2.next=28;return put(setHasRoleIncomplete({hasRoleIncomplete:hasRoleIncomplete}));case 28:_context2.next=40;break;case 30:_context2.prev=30;_context2.t0=_context2[\"catch\"](1);request=_context2.t0.request;_context2.next=35;return JSON.parse(request===null||request===void 0?void 0:request.response);case 35:response=_context2.sent;_context2.next=38;return put(setAddressErrors(response));case 38:_context2.next=40;return Flash.error('Возникла ошибка');case 40:case\"end\":return _context2.stop();}}},_marked2,null,[[1,30]]);}","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/company/store/sagas/companyAddress.effect.ts"],"names":["companyAddressEffect","setAddressWorker","takeLatest","put","SecurityService","Flash","setAddress","clearErrors","setAddressErrors","setHasRoleIncomplete","CompanyGateway","payload","postalCode","region","district","city","settlement","street","house","building","room","formData","FormData","set","value","companyGateway","setCompanyAddress","success","update","hasRole","hasRoleIncomplete","request","JSON","parse","response","error"],"mappings":"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","sourcesContent":["import { takeLatest, put } from 'redux-saga/effects';\r\nimport SecurityService from '@distate/core/dist/application/security/SecurityService';\r\nimport { Flash } from '../../../../common/flash/Flash';\r\nimport { setAddress, clearErrors, setAddressErrors } from '../actions';\r\nimport { setHasRoleIncomplete } from '../../../../container/sign/store/actions';\r\n\r\nimport CompanyGateway from '@distate/core/dist/application/company/CompanyGateway';\r\n\r\n/** Реквизиты компании */\r\nexport function* companyAddressEffect() {\r\n  yield takeLatest(setAddress, setAddressWorker);\r\n}\r\n\r\n/** установка реквизитов */\r\nfunction* setAddressWorker({ payload }: { payload: any }) {\r\n  try {\r\n    const {\r\n      postalCode,\r\n      region,\r\n      district,\r\n      city,\r\n      settlement,\r\n      street,\r\n      house,\r\n      building,\r\n      room\r\n    } = payload;\r\n\r\n    const formData = new FormData();\r\n    postalCode && formData.set('postalCode', postalCode);\r\n    region?.value && formData.set('region', region.value);\r\n    district && formData.set('district', district);\r\n    city && formData.set('city', city);\r\n    settlement && formData.set('settlement', settlement);\r\n    street && formData.set('street', street);\r\n    house && formData.set('house', house);\r\n    building && formData.set('building', building);\r\n    room && formData.set('room', room);\r\n    formData.set('country', '172');\r\n\r\n    const companyGateway = new CompanyGateway();\r\n\r\n    yield companyGateway.setCompanyAddress(formData);\r\n\r\n    yield put(clearErrors({}));\r\n    yield Flash.success('Данные сохранены');\r\n    /** проверка и обновление роли */\r\n    yield SecurityService.update(() => true);\r\n    const hasRoleIncomplete = yield SecurityService.hasRole('ROLE_INCOMPLETE');\r\n    yield put(setHasRoleIncomplete({ hasRoleIncomplete }));\r\n  } catch ({ request }) {\r\n    const response = yield JSON.parse(request?.response);\r\n    yield put(setAddressErrors(response));\r\n    yield Flash.error('Возникла ошибка');\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}