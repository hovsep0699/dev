{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{useDispatch,useSelector}from'react-redux';import fileDownload from'js-file-download';import{Button}from'@distate/components';import{dateFormat}from'@distate/components/dist/FormSchema';import{getCompanyEmployee,getCertificates,setCertificates}from'../../../store/actions';import{employeeSelector,certificatesSelector}from'../../../store/selects';import'./style.css';export var Staff=function Staff(props){var _empployee$rows;var companyId=props.companyId;var dispatch=useDispatch();var empployee=useSelector(employeeSelector);var certificates=useSelector(certificatesSelector);useEffect(function(){companyId&&dispatch(getCompanyEmployee(companyId));},[companyId,dispatch]);var _useState=useState(),_useState2=_slicedToArray(_useState,2),visibleCert=_useState2[0],setVisibleCert=_useState2[1];/** показать информацию о сертификате */var onView=function onView(id){dispatch(getCertificates(id));setVisibleCert(id);};/** скрыть информацию о сертификате */var onHide=function onHide(){dispatch(setCertificates({certificates:undefined}));setVisibleCert(undefined);};/** скачать сертификат */var onDownloadCertificate=function onDownloadCertificate(data){fileDownload(new Blob([data]),'certificate.cer');};return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h2\",{className:\"text-center title\",style:{paddingBottom:15}},\"\\u0421\\u043E\\u0442\\u0440\\u0443\\u0434\\u043D\\u0438\\u043A\\u0438 \\u043A\\u043E\\u043C\\u043F\\u0430\\u043D\\u0438\\u0438\"),/*#__PURE__*/React.createElement(\"table\",{className:\"table\"},/*#__PURE__*/React.createElement(\"thead\",{className:\"common-table-head\"},/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null,\"\\u0424\\u0418\\u041E\"),/*#__PURE__*/React.createElement(\"td\",null,\"\\u0414\\u043E\\u043B\\u0436\\u043D\\u043E\\u0441\\u0442\\u044C\"),/*#__PURE__*/React.createElement(\"td\",null,\"Email\"),/*#__PURE__*/React.createElement(\"td\",{align:\"center\"},\"\\u0421\\u0435\\u0440\\u0442\\u0438\\u0444\\u0438\\u043A\\u0430\\u0442\\u044B\"))),/*#__PURE__*/React.createElement(\"tbody\",null,empployee===null||empployee===void 0?void 0:(_empployee$rows=empployee.rows)===null||_empployee$rows===void 0?void 0:_empployee$rows.map(function(item){var id=item.id,surname=item.surname,name=item.name,patronymic=item.patronymic,position=item.position,email=item.email;var fio=[surname,name,patronymic].filter(function(item){return item;}).join(' ');var isVisible=visibleCert===id;var validCertificates=certificates===null||certificates===void 0?void 0:certificates.filter(function(item){var dateTo=item.dateTo,dateFrom=item.dateFrom,active=item.active;var now=new Date();var isTimeNotMatch=now<dateFrom||now>dateTo;var inactive=isTimeNotMatch&&!active;return!inactive;});var isEmptyCertList=!validCertificates||validCertificates.length===0;return/*#__PURE__*/React.createElement(React.Fragment,{key:id},/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null,fio),/*#__PURE__*/React.createElement(\"td\",null,position),/*#__PURE__*/React.createElement(\"td\",null,email),/*#__PURE__*/React.createElement(\"td\",{align:\"center\"},isVisible?/*#__PURE__*/React.createElement(Button,{onClick:onHide},\"\\u0421\\u043A\\u0440\\u044B\\u0442\\u044C\"):/*#__PURE__*/React.createElement(Button,{onClick:function onClick(){return onView(id);}},\"\\u041F\\u043E\\u043A\\u0430\\u0437\\u0430\\u0442\\u044C\"))),isVisible&&/*#__PURE__*/React.createElement(\"tr\",null,isEmptyCertList?/*#__PURE__*/React.createElement(\"td\",{colSpan:4,className:\"license-element-td\"},/*#__PURE__*/React.createElement(\"h2\",null,\"\\u0421\\u0435\\u0440\\u0442\\u0438\\u0444\\u0438\\u043A\\u0430\\u0442\\u044B \\u043E\\u0442\\u0441\\u0443\\u0442\\u0441\\u0442\\u0432\\u0443\\u044E\\u0442\")):/*#__PURE__*/React.createElement(\"td\",{colSpan:4,className:\"license-element-td\"},validCertificates===null||validCertificates===void 0?void 0:validCertificates.map(function(item){var id=item.id,companyName=item.companyName,fio=item.fio,inn=item.inn,ogrn=item.ogrn,dateTo=item.dateTo,data=item.data;var date=dateFormat(dateTo,'dd.MM.yyyy hh:mm:ss');return/*#__PURE__*/React.createElement(\"div\",{key:id,className:\"license-element-wrapper\"},/*#__PURE__*/React.createElement(\"div\",{className:\"license-element-left\"},/*#__PURE__*/React.createElement(\"h3\",null,companyName),/*#__PURE__*/React.createElement(\"div\",null,fio)),/*#__PURE__*/React.createElement(\"div\",{className:\"license-element-right\"},inn&&/*#__PURE__*/React.createElement(\"div\",null,\"\\u0418\\u041D\\u041D \",inn),ogrn&&/*#__PURE__*/React.createElement(\"div\",null,\"\\u041E\\u0413\\u0420\\u041D \",ogrn),/*#__PURE__*/React.createElement(\"div\",null,\"\\u0414\\u0435\\u0439\\u0441\\u0442\\u0432\\u0438\\u0442\\u0435\\u043B\\u0435\\u043D \\u0434\\u043E \",date),/*#__PURE__*/React.createElement(Button,{onClick:function onClick(){return onDownloadCertificate(data);}},\"\\u0421\\u043A\\u0430\\u0447\\u0430\\u0442\\u044C\")));}))));}))));};","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/system/components/companies/card/Staff.tsx"],"names":["React","useState","useEffect","useDispatch","useSelector","fileDownload","Button","dateFormat","getCompanyEmployee","getCertificates","setCertificates","employeeSelector","certificatesSelector","Staff","props","companyId","dispatch","empployee","certificates","visibleCert","setVisibleCert","onView","id","onHide","undefined","onDownloadCertificate","data","Blob","paddingBottom","rows","map","item","surname","name","patronymic","position","email","fio","filter","join","isVisible","validCertificates","dateTo","dateFrom","active","now","Date","isTimeNotMatch","inactive","isEmptyCertList","length","companyName","inn","ogrn","date"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport fileDownload from 'js-file-download';\r\nimport { Button } from '@distate/components';\r\nimport { dateFormat } from '@distate/components/dist/FormSchema';\r\nimport { getCompanyEmployee, getCertificates, setCertificates } from '../../../store/actions';\r\nimport { employeeSelector, certificatesSelector } from '../../../store/selects';\r\nimport './style.css';\r\n\r\ntype Props = {\r\n  companyId: number;\r\n};\r\n\r\nexport const Staff = (props: Props) => {\r\n  const { companyId } = props;\r\n\r\n  const dispatch = useDispatch();\r\n  const empployee = useSelector(employeeSelector);\r\n  const certificates = useSelector(certificatesSelector);\r\n\r\n  useEffect(() => {\r\n    companyId && dispatch(getCompanyEmployee(companyId));\r\n  }, [companyId, dispatch]);\r\n\r\n  const [visibleCert, setVisibleCert] = useState<number>();\r\n\r\n  /** показать информацию о сертификате */\r\n  const onView = (id: number) => {\r\n    dispatch(getCertificates(id));\r\n    setVisibleCert(id);\r\n  };\r\n\r\n  /** скрыть информацию о сертификате */\r\n  const onHide = () => {\r\n    dispatch(setCertificates({ certificates: undefined }));\r\n    setVisibleCert(undefined);\r\n  };\r\n\r\n  /** скачать сертификат */\r\n  const onDownloadCertificate = (data: any) => {\r\n    fileDownload(new Blob([data]), 'certificate.cer');\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <h2 className=\"text-center title\" style={{ paddingBottom: 15 }}>\r\n        Сотрудники компании\r\n      </h2>\r\n\r\n      <table className=\"table\">\r\n        <thead className=\"common-table-head\">\r\n          <tr>\r\n            <td>ФИО</td>\r\n            <td>Должность</td>\r\n            <td>Email</td>\r\n            <td align=\"center\">Сертификаты</td>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {empployee?.rows?.map((item: any) => {\r\n            const { id, surname, name, patronymic, position, email } = item;\r\n            const fio = [surname, name, patronymic].filter(item => item).join(' ');\r\n\r\n            const isVisible = visibleCert === id;\r\n\r\n            const validCertificates = certificates?.filter((item: any) => {\r\n              const { dateTo, dateFrom, active } = item;\r\n\r\n              const now = new Date();\r\n              const isTimeNotMatch = now < dateFrom || now > dateTo;\r\n\r\n              const inactive = isTimeNotMatch && !active;\r\n\r\n              return !inactive;\r\n            });\r\n\r\n            const isEmptyCertList = !validCertificates || validCertificates.length === 0;\r\n\r\n            return (\r\n              <React.Fragment key={id}>\r\n                <tr>\r\n                  <td>{fio}</td>\r\n                  <td>{position}</td>\r\n                  <td>{email}</td>\r\n                  <td align=\"center\">\r\n                    {isVisible ? (\r\n                      <Button onClick={onHide}>Скрыть</Button>\r\n                    ) : (\r\n                      <Button onClick={() => onView(id)}>Показать</Button>\r\n                    )}\r\n                  </td>\r\n                </tr>\r\n                {isVisible && (\r\n                  <tr>\r\n                    {isEmptyCertList ? (\r\n                      <td colSpan={4} className=\"license-element-td\">\r\n                        <h2>Сертификаты отсутствуют</h2>\r\n                      </td>\r\n                    ) : (\r\n                      <td colSpan={4} className=\"license-element-td\">\r\n                        {validCertificates?.map((item: any) => {\r\n                          const { id, companyName, fio, inn, ogrn, dateTo, data } = item;\r\n                          const date = dateFormat(dateTo, 'dd.MM.yyyy hh:mm:ss');\r\n\r\n                          return (\r\n                            <div key={id} className=\"license-element-wrapper\">\r\n                              <div className=\"license-element-left\">\r\n                                <h3>{companyName}</h3>\r\n                                <div>{fio}</div>\r\n                              </div>\r\n                              <div className=\"license-element-right\">\r\n                                {inn && <div>ИНН {inn}</div>}\r\n                                {ogrn && <div>ОГРН {ogrn}</div>}\r\n                                <div>Действителен до {date}</div>\r\n                                <Button onClick={() => onDownloadCertificate(data)}>Скачать</Button>\r\n                              </div>\r\n                            </div>\r\n                          );\r\n                        })}\r\n                      </td>\r\n                    )}\r\n                  </tr>\r\n                )}\r\n              </React.Fragment>\r\n            );\r\n          })}\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}