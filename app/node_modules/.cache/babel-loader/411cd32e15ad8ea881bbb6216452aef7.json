{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _toConsumableArray from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import get from'lodash.get';import{useState,useRef,useEffect}from'react';import{useHistory}from'react-router-dom';import InvoiceService from'@distate/core/dist/application/documents/invoice/InvoiceService';import{Flash}from'../../../common/flash';import{DOCUMENT_VIEW}from'../../../common/Url';import{transformerUCDToDTO}from'../helpers/transformers';import{transformerErrors}from'../../../utils/errors';import{validateMessagesUCD}from'../helpers/transformers/ucd/validate.messages';import{transformerDTOUCDError}from'../helpers/transformers/ucd/dto-to-ucd-error';export var useUCDCreate=function useUCDCreate(){var history=useHistory();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),createErrors=_useState2[0],setCreateErrors=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isLoadingCreate=_useState4[0],setIsLoadingCreate=_useState4[1];var timerError=useRef();useEffect(function(){return function(){return timerError.current&&clearTimeout(timerError.current);};},[]);/**\r\n   * Метод создания универсального коррекционного документа.\r\n   * @param param object\r\n   */var createUCD=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref){var UCD,formData,formTable,force,requestUCD,fetchCreate,res,documentErrors,documentErrorMsx,errors,lastError;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:UCD=_ref.UCD,formData=_ref.formData,formTable=_ref.formTable,force=_ref.force;_context.prev=1;setCreateErrors([]);setIsLoadingCreate(true);requestUCD=transformerUCDToDTO(UCD,{formData:formData,formTable:formTable,force:Boolean(force)});fetchCreate=function fetchCreate(){return Boolean(UCD.formData)?InvoiceService.editUKD(UCD.id,requestUCD):InvoiceService.createUKD(requestUCD);};_context.next=8;return fetchCreate().then(function(_ref3){var data=_ref3.data;return data;});case 8:res=_context.sent;if(res.id){history.push(DOCUMENT_VIEW.replace(':id',res.id));}else{Flash.error('При создании документа возникла ошибка!');}_context.next=17;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](1);documentErrors=get(_context.t0,'jsError.response.data.messages.document');documentErrorMsx=get(_context.t0,'jsError.response.data.0');if(documentErrors){errors=transformerErrors(documentErrors,validateMessagesUCD);lastError=_toConsumableArray(errors).pop();Flash.error((lastError===null||lastError===void 0?void 0:lastError.message)||'Возникла ошибка!');setCreateErrors(transformerDTOUCDError(documentErrors));}else if(documentErrorMsx){Flash.error(documentErrorMsx);}else{Flash.error('При создании документа возникла ошибка!');}case 17:_context.prev=17;setIsLoadingCreate(false);return _context.finish(17);case 20:case\"end\":return _context.stop();}}},_callee,null,[[1,12,17,20]]);}));return function createUCD(_x){return _ref2.apply(this,arguments);};}();return{isLoadingCreate:isLoadingCreate,createErrors:createErrors,createUCD:createUCD};};","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/upd/hooks/use-ucd-create.ts"],"names":["get","useState","useRef","useEffect","useHistory","InvoiceService","Flash","DOCUMENT_VIEW","transformerUCDToDTO","transformerErrors","validateMessagesUCD","transformerDTOUCDError","useUCDCreate","history","createErrors","setCreateErrors","isLoadingCreate","setIsLoadingCreate","timerError","current","clearTimeout","createUCD","UCD","formData","formTable","force","requestUCD","Boolean","fetchCreate","editUKD","id","createUKD","then","data","res","push","replace","error","documentErrors","documentErrorMsx","errors","lastError","pop","message"],"mappings":"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","sourcesContent":["import get from 'lodash.get';\r\nimport { useState, useRef, useEffect } from 'react';\r\nimport { useHistory } from 'react-router-dom';\r\nimport InvoiceService from '@distate/core/dist/application/documents/invoice/InvoiceService';\r\n\r\nimport { Flash } from '../../../common/flash';\r\nimport { DOCUMENT_VIEW } from '../../../common/Url';\r\nimport { transformerUCDToDTO } from '../helpers/transformers';\r\nimport { transformerErrors } from '../../../utils/errors';\r\nimport { validateMessagesUCD } from '../helpers/transformers/ucd/validate.messages';\r\nimport { transformerDTOUCDError } from '../helpers/transformers/ucd/dto-to-ucd-error';\r\n\r\nexport const useUCDCreate = () => {\r\n  const history = useHistory();\r\n  const [createErrors, setCreateErrors] = useState<any>([]);\r\n  const [isLoadingCreate, setIsLoadingCreate] = useState(false);\r\n\r\n  const timerError = useRef<any>();\r\n  useEffect(() => () => timerError.current && clearTimeout(timerError.current), []);\r\n\r\n  /**\r\n   * Метод создания универсального коррекционного документа.\r\n   * @param param object\r\n   */\r\n  const createUCD = async ({ UCD, formData, formTable, force }: Record<string, any>) => {\r\n    try {\r\n      setCreateErrors([]);\r\n      setIsLoadingCreate(true);\r\n\r\n      const requestUCD = transformerUCDToDTO(UCD, { formData, formTable, force: Boolean(force) });\r\n      const fetchCreate = () => {\r\n        return Boolean(UCD.formData)\r\n          ? InvoiceService.editUKD(UCD.id, requestUCD)\r\n          : InvoiceService.createUKD(requestUCD);\r\n      };\r\n\r\n      const res = await fetchCreate().then(({ data }) => data);\r\n      if (res.id) {\r\n        history.push(DOCUMENT_VIEW.replace(':id', res.id));\r\n      } else {\r\n        Flash.error('При создании документа возникла ошибка!');\r\n      }\r\n    } catch (rawError) {\r\n      const documentErrors = get(rawError, 'jsError.response.data.messages.document');\r\n      const documentErrorMsx = get(rawError, 'jsError.response.data.0');\r\n\r\n      if (documentErrors) {\r\n        const errors = transformerErrors(documentErrors, validateMessagesUCD);\r\n        const lastError = [...errors].pop();\r\n        Flash.error(lastError?.message || 'Возникла ошибка!');\r\n        setCreateErrors(transformerDTOUCDError(documentErrors));\r\n      } else if (documentErrorMsx) {\r\n        Flash.error(documentErrorMsx);\r\n      } else {\r\n        Flash.error('При создании документа возникла ошибка!');\r\n      }\r\n    } finally {\r\n      setIsLoadingCreate(false);\r\n    }\r\n  };\r\n\r\n  return { isLoadingCreate, createErrors, createUCD };\r\n};\r\n"]},"metadata":{},"sourceType":"module"}