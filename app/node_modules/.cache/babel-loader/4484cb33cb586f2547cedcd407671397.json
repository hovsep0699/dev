{"ast":null,"code":"import _classCallCheck from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _get from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/get\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\nimport SignHandlerBase from '../SignHandlerBase';\nimport Environment from '../../../Environment';\nimport SignRequest from '../../SignRequest';\nimport getFormData from '../../../utils/getFormData';\n\nvar SendContainerHandler = /*#__PURE__*/function (_SignHandlerBase) {\n  _inherits(SendContainerHandler, _SignHandlerBase);\n\n  var _super = _createSuper(SendContainerHandler);\n\n  function SendContainerHandler() {\n    _classCallCheck(this, SendContainerHandler);\n\n    return _super.apply(this, arguments);\n  }\n\n  _createClass(SendContainerHandler, [{\n    key: \"sign\",\n    value: function sign(request) {\n      var _this = this;\n\n      _get(_getPrototypeOf(SendContainerHandler.prototype), \"sign\", this).call(this, request);\n\n      if (this.canHandle(request)) {\n        var successHandler = function successHandler(response) {\n          var _a;\n\n          if ((_a = response.data) === null || _a === void 0 ? void 0 : _a.success) {\n            return _this.doNextHandler(SignRequest.clone(request));\n          } else {\n            return failHandler(response);\n          }\n        };\n\n        var failHandler = function failHandler(error) {\n          var failureRequest = SignRequest.clone(request);\n          console.log('SendContainerHandler fail response ', error);\n          failureRequest.error = _this.createSignError('SendContainerHandler fail', null, error);\n          return _this.doNextHandler(failureRequest);\n        };\n\n        var formDataIds = getFormData(request.signedDocumentIds, 'packageIds[]');\n        return Environment.getSignGateway().sendContainer(formDataIds).then(successHandler).catch(failHandler);\n      }\n\n      return this.doNextHandler(request);\n    }\n  }, {\n    key: \"canHandle\",\n    value: function canHandle(request) {\n      var _a;\n\n      _get(_getPrototypeOf(SendContainerHandler.prototype), \"canHandle\", this).call(this, request);\n\n      var allDocsSigned = request.documents.length === request.signedDocumentIds.size;\n      return !!request.certificate && request.isGrantedToSign && allDocsSigned && !((_a = request.signFailures) === null || _a === void 0 ? void 0 : _a.length);\n    }\n  }]);\n\n  return SendContainerHandler;\n}(SignHandlerBase);\n\nexport default SendContainerHandler;","map":{"version":3,"sources":["../../../../../src/application/sign/handlers/sign/SendContainerHandler.js"],"names":[],"mappings":";;;;;;AAAA,OAAO,eAAP,MAA4B,oBAA5B;AACA,OAAO,WAAP,MAAwB,sBAAxB;AACA,OAAO,WAAP,MAAwB,mBAAxB;AACA,OAAO,WAAP,MAAwB,4BAAxB;;IAEM,oB;;;;;;;;;;;;;yBACC,O,EAAO;AAAA;;AACV,qFAAW,OAAX;;AACA,UAAI,KAAK,SAAL,CAAe,OAAf,CAAJ,EAA6B;AAC3B,YAAM,cAAc,GAAG,SAAjB,cAAiB,CAAA,QAAQ,EAAG;;;AAChC,cAAA,CAAA,EAAA,GAAI,QAAQ,CAAC,IAAb,MAAiB,IAAjB,IAAiB,EAAA,KAAA,KAAA,CAAjB,GAAiB,KAAA,CAAjB,GAAiB,EAAA,CAAE,OAAnB,EAA4B;AAC1B,mBAAO,KAAI,CAAC,aAAL,CAAmB,WAAW,CAAC,KAAZ,CAAkB,OAAlB,CAAnB,CAAP;AACD,WAFD,MAEO;AACL,mBAAO,WAAW,CAAC,QAAD,CAAlB;AACD;AACF,SAND;;AAQA,YAAM,WAAW,GAAG,SAAd,WAAc,CAAA,KAAK,EAAG;AAC1B,cAAM,cAAc,GAAG,WAAW,CAAC,KAAZ,CAAkB,OAAlB,CAAvB;AACA,UAAA,OAAO,CAAC,GAAR,CAAY,qCAAZ,EAAmD,KAAnD;AACA,UAAA,cAAc,CAAC,KAAf,GAAuB,KAAI,CAAC,eAAL,CAAqB,2BAArB,EAAkD,IAAlD,EAAwD,KAAxD,CAAvB;AACA,iBAAO,KAAI,CAAC,aAAL,CAAmB,cAAnB,CAAP;AACD,SALD;;AAMA,YAAM,WAAW,GAAG,WAAW,CAAC,OAAO,CAAC,iBAAT,EAA4B,cAA5B,CAA/B;AACA,eAAO,WAAW,CAAC,cAAZ,GACJ,aADI,CACU,WADV,EAEJ,IAFI,CAEC,cAFD,EAGJ,KAHI,CAGE,WAHF,CAAP;AAID;;AACD,aAAO,KAAK,aAAL,CAAmB,OAAnB,CAAP;AACD;;;8BAES,O,EAAO;;;AACf,0FAAgB,OAAhB;;AACA,UAAM,aAAa,GAAG,OAAO,CAAC,SAAR,CAAkB,MAAlB,KAA6B,OAAO,CAAC,iBAAR,CAA0B,IAA7E;AACA,aACE,CAAC,CAAC,OAAO,CAAC,WAAV,IACA,OAAO,CAAC,eADR,IAEA,aAFA,IAGA,EAAA,CAAA,EAAA,GAAC,OAAO,CAAC,YAAT,MAAqB,IAArB,IAAqB,EAAA,KAAA,KAAA,CAArB,GAAqB,KAAA,CAArB,GAAqB,EAAA,CAAE,MAAvB,CAJF;AAMD;;;;EApCgC,e;;AAuCnC,eAAe,oBAAf","sourceRoot":"","sourcesContent":["import SignHandlerBase from '../SignHandlerBase';\r\nimport Environment from '../../../Environment';\r\nimport SignRequest from '../../SignRequest';\r\nimport getFormData from '../../../utils/getFormData';\r\nclass SendContainerHandler extends SignHandlerBase {\r\n    sign(request) {\r\n        super.sign(request);\r\n        if (this.canHandle(request)) {\r\n            const successHandler = response => {\r\n                var _a;\r\n                if ((_a = response.data) === null || _a === void 0 ? void 0 : _a.success) {\r\n                    return this.doNextHandler(SignRequest.clone(request));\r\n                }\r\n                else {\r\n                    return failHandler(response);\r\n                }\r\n            };\r\n            const failHandler = error => {\r\n                const failureRequest = SignRequest.clone(request);\r\n                console.log('SendContainerHandler fail response ', error);\r\n                failureRequest.error = this.createSignError('SendContainerHandler fail', null, error);\r\n                return this.doNextHandler(failureRequest);\r\n            };\r\n            const formDataIds = getFormData(request.signedDocumentIds, 'packageIds[]');\r\n            return Environment.getSignGateway()\r\n                .sendContainer(formDataIds)\r\n                .then(successHandler)\r\n                .catch(failHandler);\r\n        }\r\n        return this.doNextHandler(request);\r\n    }\r\n    canHandle(request) {\r\n        var _a;\r\n        super.canHandle(request);\r\n        const allDocsSigned = request.documents.length === request.signedDocumentIds.size;\r\n        return (!!request.certificate &&\r\n            request.isGrantedToSign &&\r\n            allDocsSigned &&\r\n            !((_a = request.signFailures) === null || _a === void 0 ? void 0 : _a.length));\r\n    }\r\n}\r\nexport default SendContainerHandler;\r\n//# sourceMappingURL=SendContainerHandler.js.map"]},"metadata":{},"sourceType":"module"}