{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(companiesEffect),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(getCompaniesWorker),_marked3=/*#__PURE__*/_regeneratorRuntime.mark(getTariffsWorker),_marked4=/*#__PURE__*/_regeneratorRuntime.mark(getCompanyInfoWorker),_marked5=/*#__PURE__*/_regeneratorRuntime.mark(getCompanyEmployeeWorker),_marked6=/*#__PURE__*/_regeneratorRuntime.mark(getCertificatesWorker),_marked7=/*#__PURE__*/_regeneratorRuntime.mark(companyActivationWorker),_marked8=/*#__PURE__*/_regeneratorRuntime.mark(companyDeleteWorker);import{takeLatest,put}from'redux-saga/effects';import{SystemService}from'@distate/core/dist/application/system';import CompanyGateway from'@distate/core/dist/application/company/CompanyGateway';import AuthGateway from'@distate/core/dist/application/auth/AuthGateway';import{expandCertificateList}from'@distate/core/dist/application/certificate/CertificateHelper';import AutocompleteGateway from'@distate/core/dist/application/autocomplete/AutocompleteGateway';import{financeGateway}from'@distate/core/dist/application/finance/FinanceGateway';import Core from'@distate/core/dist/application/Core';import cryptoPro from'@distate/core/dist/infrastructure/CryptoPro';import{getCompanies,setCompanies,getCompanyInfo,setCompanyInfo,getCompanyEmployee,setCompanyEmployee,getCertificates,setCertificates,getTariffs,setTariffs,companyActivation,companyDelete}from'../actions';import{Flash}from'../../../../common/flash';export function companiesEffect(){return _regeneratorRuntime.wrap(function companiesEffect$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return takeLatest(getCompanies,getCompaniesWorker);case 2:_context.next=4;return takeLatest(getCompanyInfo,getCompanyInfoWorker);case 4:_context.next=6;return takeLatest(getCompanyEmployee,getCompanyEmployeeWorker);case 6:_context.next=8;return takeLatest(getCertificates,getCertificatesWorker);case 8:_context.next=10;return takeLatest(getTariffs,getTariffsWorker);case 10:_context.next=12;return takeLatest(companyActivation,companyActivationWorker);case 12:_context.next=14;return takeLatest(companyDelete,companyDeleteWorker);case 14:case\"end\":return _context.stop();}}},_marked);}/** получение информации о юр-лицах */function getCompaniesWorker(_ref){var payload,service,companies;return _regeneratorRuntime.wrap(function getCompaniesWorker$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:payload=_ref.payload;_context2.prev=1;service=new SystemService();_context2.next=5;return service.legal(payload);case 5:companies=_context2.sent;_context2.next=8;return put(setCompanies({companies:companies}));case 8:_context2.next=14;break;case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](1);_context2.next=14;return Flash.error('Произошла ошибка');case 14:case\"end\":return _context2.stop();}}},_marked2,null,[[1,10]]);}/** получение тарифов */function getTariffsWorker(){var tariffs;return _regeneratorRuntime.wrap(function getTariffsWorker$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return financeGateway.getTariffs({notStatusSystemName:'archive'});case 3:tariffs=_context3.sent;_context3.next=6;return put(setTariffs({tariffs:tariffs.rows}));case 6:_context3.next=12;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);_context3.next=12;return Flash.error('Произошла ошибка');case 12:case\"end\":return _context3.stop();}}},_marked3,null,[[0,8]]);}/** получение информации о юр-лице */function getCompanyInfoWorker(_ref2){var payload,_bankTitleResponse$ro,_bankTitleResponse$ro2,_tariffResponse$rows,companyGateway,autocompleteGateway,currentCompany,bik,bankTitleResponse,tariffResponse,currentTariff,tariffTitle;return _regeneratorRuntime.wrap(function getCompanyInfoWorker$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:payload=_ref2.payload;_context4.prev=1;companyGateway=new CompanyGateway();autocompleteGateway=new AutocompleteGateway();_context4.next=6;return companyGateway.getCompanyJson(payload);case 6:currentCompany=_context4.sent;bik=currentCompany.bik;_context4.next=10;return bik&&autocompleteGateway.getBankByBIK(bik);case 10:bankTitleResponse=_context4.sent;currentCompany.bankTitle=bik?bankTitleResponse===null||bankTitleResponse===void 0?void 0:(_bankTitleResponse$ro=bankTitleResponse.rows)===null||_bankTitleResponse$ro===void 0?void 0:(_bankTitleResponse$ro2=_bankTitleResponse$ro[0])===null||_bankTitleResponse$ro2===void 0?void 0:_bankTitleResponse$ro2.full_title:undefined;_context4.next=14;return financeGateway.getTariffsByCompanyId(payload);case 14:tariffResponse=_context4.sent;// текущий тариф тот, у которого to === null\ncurrentTariff=tariffResponse===null||tariffResponse===void 0?void 0:(_tariffResponse$rows=tariffResponse.rows)===null||_tariffResponse$rows===void 0?void 0:_tariffResponse$rows.find(function(item){return item.to===null;});tariffTitle=currentTariff===null||currentTariff===void 0?void 0:currentTariff.tariff_title;currentCompany.tariffTitle=tariffTitle;_context4.next=20;return put(setCompanyInfo({currentCompany:currentCompany}));case 20:_context4.next=26;break;case 22:_context4.prev=22;_context4.t0=_context4[\"catch\"](1);_context4.next=26;return Flash.error('Произошла ошибка');case 26:case\"end\":return _context4.stop();}}},_marked4,null,[[1,22]]);}/** получение сотрудников компании */function getCompanyEmployeeWorker(_ref3){var payload,authGateway,employee;return _regeneratorRuntime.wrap(function getCompanyEmployeeWorker$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:payload=_ref3.payload;_context5.prev=1;authGateway=new AuthGateway();_context5.next=5;return authGateway.companyEmployees(payload,{});case 5:employee=_context5.sent;_context5.next=8;return put(setCompanyEmployee({employee:employee}));case 8:_context5.next=14;break;case 10:_context5.prev=10;_context5.t0=_context5[\"catch\"](1);_context5.next=14;return Flash.error('Произошла ошибка');case 14:case\"end\":return _context5.stop();}}},_marked5,null,[[1,10]]);}/** получение сертификата */function getCertificatesWorker(_ref4){var payload,companyGateway,certificates,extendedRows;return _regeneratorRuntime.wrap(function getCertificatesWorker$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:payload=_ref4.payload;_context6.prev=1;companyGateway=new CompanyGateway();_context6.next=5;return companyGateway.getEmployeeCertificate(payload,{});case 5:certificates=_context6.sent;_context6.next=8;return expandCertificateList(certificates.rows);case 8:extendedRows=_context6.sent;_context6.next=11;return put(setCertificates({certificates:extendedRows}));case 11:_context6.next=17;break;case 13:_context6.prev=13;_context6.t0=_context6[\"catch\"](1);_context6.next=17;return Flash.error('Произошла ошибка');case 17:case\"end\":return _context6.stop();}}},_marked6,null,[[1,13]]);}/** активирование компании */function companyActivationWorker(_ref5){var payload,thumbprint,encodedStr,signature,formData,companyGateway;return _regeneratorRuntime.wrap(function companyActivationWorker$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:payload=_ref5.payload;_context7.prev=1;thumbprint=Core.certificate.thumbprint;encodedStr=btoa('please give me a sign');_context7.next=6;return cryptoPro.signData(encodedStr,thumbprint);case 6:signature=_context7.sent;formData=new FormData();formData.set('company',payload.toString());formData.set('signature',signature);companyGateway=new CompanyGateway();_context7.next=13;return companyGateway.companyActivation(formData);case 13:_context7.next=15;return put(getCompanies());case 15:_context7.next=21;break;case 17:_context7.prev=17;_context7.t0=_context7[\"catch\"](1);_context7.next=21;return Flash.error('Произошла ошибка');case 21:case\"end\":return _context7.stop();}}},_marked7,null,[[1,17]]);}/** удаление компании */function companyDeleteWorker(_ref6){var payload,thumbprint,encodedStr,signature,formData,companyGateway;return _regeneratorRuntime.wrap(function companyDeleteWorker$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:payload=_ref6.payload;_context8.prev=1;thumbprint=Core.certificate.thumbprint;encodedStr=btoa('please give me a sign');_context8.next=6;return cryptoPro.signData(encodedStr,thumbprint);case 6:signature=_context8.sent;formData=new URLSearchParams();formData.set('company',payload.toString());formData.set('signature',signature);companyGateway=new CompanyGateway();_context8.next=13;return companyGateway.companyDelete(formData);case 13:_context8.next=15;return put(getCompanies());case 15:_context8.next=21;break;case 17:_context8.prev=17;_context8.t0=_context8[\"catch\"](1);_context8.next=21;return Flash.error('Произошла ошибка');case 21:case\"end\":return _context8.stop();}}},_marked8,null,[[1,17]]);}","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/system/store/sagas/companies.saga.ts"],"names":["companiesEffect","getCompaniesWorker","getTariffsWorker","getCompanyInfoWorker","getCompanyEmployeeWorker","getCertificatesWorker","companyActivationWorker","companyDeleteWorker","takeLatest","put","SystemService","CompanyGateway","AuthGateway","expandCertificateList","AutocompleteGateway","financeGateway","Core","cryptoPro","getCompanies","setCompanies","getCompanyInfo","setCompanyInfo","getCompanyEmployee","setCompanyEmployee","getCertificates","setCertificates","getTariffs","setTariffs","companyActivation","companyDelete","Flash","payload","service","legal","companies","error","notStatusSystemName","tariffs","rows","companyGateway","autocompleteGateway","getCompanyJson","currentCompany","bik","getBankByBIK","bankTitleResponse","bankTitle","full_title","undefined","getTariffsByCompanyId","tariffResponse","currentTariff","find","item","to","tariffTitle","tariff_title","authGateway","companyEmployees","employee","getEmployeeCertificate","certificates","extendedRows","thumbprint","certificate","encodedStr","btoa","signData","signature","formData","FormData","set","toString","URLSearchParams"],"mappings":"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","sourcesContent":["import { takeLatest, put } from 'redux-saga/effects';\r\nimport { SystemService } from '@distate/core/dist/application/system';\r\nimport CompanyGateway from '@distate/core/dist/application/company/CompanyGateway';\r\nimport AuthGateway from '@distate/core/dist/application/auth/AuthGateway';\r\nimport { expandCertificateList } from '@distate/core/dist/application/certificate/CertificateHelper';\r\nimport AutocompleteGateway from '@distate/core/dist/application/autocomplete/AutocompleteGateway';\r\nimport { financeGateway } from '@distate/core/dist/application/finance/FinanceGateway';\r\nimport Core from '@distate/core/dist/application/Core';\r\nimport cryptoPro from '@distate/core/dist/infrastructure/CryptoPro';\r\n\r\nimport {\r\n  getCompanies,\r\n  setCompanies,\r\n  getCompanyInfo,\r\n  setCompanyInfo,\r\n  getCompanyEmployee,\r\n  setCompanyEmployee,\r\n  getCertificates,\r\n  setCertificates,\r\n  getTariffs,\r\n  setTariffs,\r\n  companyActivation,\r\n  companyDelete\r\n} from '../actions';\r\nimport { Flash } from '../../../../common/flash';\r\n\r\nexport function* companiesEffect() {\r\n  yield takeLatest(getCompanies, getCompaniesWorker);\r\n  yield takeLatest(getCompanyInfo, getCompanyInfoWorker);\r\n  yield takeLatest(getCompanyEmployee, getCompanyEmployeeWorker);\r\n  yield takeLatest(getCertificates, getCertificatesWorker);\r\n  yield takeLatest(getTariffs, getTariffsWorker);\r\n  yield takeLatest(companyActivation, companyActivationWorker);\r\n  yield takeLatest(companyDelete, companyDeleteWorker);\r\n}\r\n\r\n/** получение информации о юр-лицах */\r\nfunction* getCompaniesWorker({ payload }: any) {\r\n  try {\r\n    const service = new SystemService();\r\n    const companies = yield service.legal(payload);\r\n    yield put(setCompanies({ companies }));\r\n  } catch (error) {\r\n    yield Flash.error('Произошла ошибка');\r\n  }\r\n}\r\n\r\n/** получение тарифов */\r\nfunction* getTariffsWorker() {\r\n  try {\r\n    const tariffs = yield financeGateway.getTariffs({ notStatusSystemName: 'archive' });\r\n    yield put(setTariffs({ tariffs: tariffs.rows }));\r\n  } catch (error) {\r\n    yield Flash.error('Произошла ошибка');\r\n  }\r\n}\r\n\r\n/** получение информации о юр-лице */\r\nfunction* getCompanyInfoWorker({ payload }: { payload: number }) {\r\n  try {\r\n    const companyGateway = new CompanyGateway();\r\n    const autocompleteGateway = new AutocompleteGateway();\r\n\r\n    const currentCompany = yield companyGateway.getCompanyJson(payload);\r\n\r\n    const { bik } = currentCompany;\r\n    const bankTitleResponse = yield bik && autocompleteGateway.getBankByBIK(bik);\r\n    currentCompany.bankTitle = bik ? bankTitleResponse?.rows?.[0]?.full_title : undefined;\r\n\r\n    const tariffResponse = yield financeGateway.getTariffsByCompanyId(payload);\r\n    // текущий тариф тот, у которого to === null\r\n    const currentTariff = tariffResponse?.rows?.find((item: any) => item.to === null);\r\n    const tariffTitle = currentTariff?.tariff_title;\r\n    currentCompany.tariffTitle = tariffTitle;\r\n\r\n    yield put(setCompanyInfo({ currentCompany }));\r\n  } catch (error) {\r\n    yield Flash.error('Произошла ошибка');\r\n  }\r\n}\r\n\r\n/** получение сотрудников компании */\r\nfunction* getCompanyEmployeeWorker({ payload }: { payload: number }) {\r\n  try {\r\n    const authGateway = new AuthGateway();\r\n    const employee = yield authGateway.companyEmployees(payload, {});\r\n    yield put(setCompanyEmployee({ employee }));\r\n  } catch (error) {\r\n    yield Flash.error('Произошла ошибка');\r\n  }\r\n}\r\n\r\n/** получение сертификата */\r\nfunction* getCertificatesWorker({ payload }: { payload: number }) {\r\n  try {\r\n    const companyGateway = new CompanyGateway();\r\n    const certificates = yield companyGateway.getEmployeeCertificate(payload, {});\r\n\r\n    /** достаем из сертов дополнительную информацию */\r\n    const extendedRows = yield expandCertificateList(certificates.rows);\r\n\r\n    yield put(setCertificates({ certificates: extendedRows }));\r\n  } catch (error) {\r\n    yield Flash.error('Произошла ошибка');\r\n  }\r\n}\r\n\r\n/** активирование компании */\r\nfunction* companyActivationWorker({ payload }: { payload: number }) {\r\n  try {\r\n    const thumbprint = Core.certificate.thumbprint;\r\n    const encodedStr = btoa('please give me a sign');\r\n\r\n    const signature = yield cryptoPro.signData(encodedStr, thumbprint);\r\n\r\n    const formData = new FormData();\r\n    formData.set('company', payload.toString());\r\n    formData.set('signature', signature);\r\n\r\n    const companyGateway = new CompanyGateway();\r\n    yield companyGateway.companyActivation(formData);\r\n\r\n    yield put(getCompanies());\r\n  } catch (error) {\r\n    yield Flash.error('Произошла ошибка');\r\n  }\r\n}\r\n\r\n/** удаление компании */\r\nfunction* companyDeleteWorker({ payload }: { payload: number }) {\r\n  try {\r\n    const thumbprint = Core.certificate.thumbprint;\r\n    const encodedStr = btoa('please give me a sign');\r\n\r\n    const signature = yield cryptoPro.signData(encodedStr, thumbprint);\r\n\r\n    const formData = new URLSearchParams();\r\n    formData.set('company', payload.toString());\r\n    formData.set('signature', signature);\r\n\r\n    const companyGateway = new CompanyGateway();\r\n    yield companyGateway.companyDelete(formData);\r\n\r\n    yield put(getCompanies());\r\n  } catch (error) {\r\n    yield Flash.error('Произошла ошибка');\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}