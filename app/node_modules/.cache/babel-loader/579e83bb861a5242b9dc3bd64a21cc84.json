{"ast":null,"code":"import _classCallCheck from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _get from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/get\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\nimport HasAuthHandlerBase from '../HasAuthHandlerBase';\nimport AuthRequest from '../../AuthRequest';\nimport Environment from '../../../Environment';\n\nvar AjaxGetUserInfoHandler = /*#__PURE__*/function (_HasAuthHandlerBase) {\n  _inherits(AjaxGetUserInfoHandler, _HasAuthHandlerBase);\n\n  var _super = _createSuper(AjaxGetUserInfoHandler);\n\n  function AjaxGetUserInfoHandler() {\n    _classCallCheck(this, AjaxGetUserInfoHandler);\n\n    return _super.apply(this, arguments);\n  }\n\n  _createClass(AjaxGetUserInfoHandler, [{\n    key: \"hasAuth\",\n    value: function hasAuth(request) {\n      var _this = this;\n\n      var url = '/front/user/current';\n\n      var successHandler = function successHandler(res) {\n        if (typeof res === 'string' || !res) {\n          // Это редирект 302. Значит пользователь не залогинен\n          var notAuthedRequest = new AuthRequest();\n          notAuthedRequest.isAuthed = false;\n          return _this.doNextHandler(notAuthedRequest);\n        }\n\n        var userReadyRequest = request ? AuthRequest.clone(request) : new AuthRequest();\n        userReadyRequest.rawUser = res;\n        userReadyRequest.isAuthed = true;\n        return _this.doNextHandler(userReadyRequest);\n      };\n\n      var failHandler = function failHandler(error) {\n        var errorRequest = new AuthRequest();\n        errorRequest.error = _get(_getPrototypeOf(AjaxGetUserInfoHandler.prototype), \"createAuthError\", _this).call(_this, \"\\u0417\\u0430\\u043F\\u0440\\u043E\\u0441 \".concat(url), error);\n        return _this.doNextHandler(errorRequest);\n      };\n\n      return Environment.getAuthGateway().currentUser().then(successHandler).catch(failHandler);\n    }\n  }]);\n\n  return AjaxGetUserInfoHandler;\n}(HasAuthHandlerBase);\n\nexport default AjaxGetUserInfoHandler;","map":{"version":3,"sources":["../../../../../src/application/auth/handlers/hasAuth/AjaxGetUserInfoHandler.js"],"names":[],"mappings":";;;;;;AAAA,OAAO,kBAAP,MAA+B,uBAA/B;AACA,OAAO,WAAP,MAAwB,mBAAxB;AACA,OAAO,WAAP,MAAwB,sBAAxB;;IAEM,sB;;;;;;;;;;;;;4BACI,O,EAAO;AAAA;;AACb,UAAM,GAAG,GAAG,qBAAZ;;AACA,UAAM,cAAc,GAAG,SAAjB,cAAiB,CAAA,GAAG,EAAG;AAC3B,YAAI,OAAO,GAAP,KAAe,QAAf,IAA2B,CAAC,GAAhC,EAAqC;AACnC;AACA,cAAM,gBAAgB,GAAG,IAAI,WAAJ,EAAzB;AACA,UAAA,gBAAgB,CAAC,QAAjB,GAA4B,KAA5B;AACA,iBAAO,KAAI,CAAC,aAAL,CAAmB,gBAAnB,CAAP;AACD;;AACD,YAAM,gBAAgB,GAAG,OAAO,GAAG,WAAW,CAAC,KAAZ,CAAkB,OAAlB,CAAH,GAAgC,IAAI,WAAJ,EAAhE;AACA,QAAA,gBAAgB,CAAC,OAAjB,GAA2B,GAA3B;AACA,QAAA,gBAAgB,CAAC,QAAjB,GAA4B,IAA5B;AACA,eAAO,KAAI,CAAC,aAAL,CAAmB,gBAAnB,CAAP;AACD,OAXD;;AAaA,UAAM,WAAW,GAAG,SAAd,WAAc,CAAA,KAAK,EAAG;AAC1B,YAAM,YAAY,GAAG,IAAI,WAAJ,EAArB;AACA,QAAA,YAAY,CAAC,KAAb,gJAAqD,GAArD,GAA4D,KAA5D;AACA,eAAO,KAAI,CAAC,aAAL,CAAmB,YAAnB,CAAP;AACD,OAJD;;AAMA,aAAO,WAAW,CAAC,cAAZ,GACJ,WADI,GAEJ,IAFI,CAEC,cAFD,EAGJ,KAHI,CAGE,WAHF,CAAP;AAID;;;;EA1BkC,kB;;AA6BrC,eAAe,sBAAf","sourceRoot":"","sourcesContent":["import HasAuthHandlerBase from '../HasAuthHandlerBase';\r\nimport AuthRequest from '../../AuthRequest';\r\nimport Environment from '../../../Environment';\r\nclass AjaxGetUserInfoHandler extends HasAuthHandlerBase {\r\n    hasAuth(request) {\r\n        const url = '/front/user/current';\r\n        const successHandler = res => {\r\n            if (typeof res === 'string' || !res) {\r\n                // Это редирект 302. Значит пользователь не залогинен\r\n                const notAuthedRequest = new AuthRequest();\r\n                notAuthedRequest.isAuthed = false;\r\n                return this.doNextHandler(notAuthedRequest);\r\n            }\r\n            const userReadyRequest = request ? AuthRequest.clone(request) : new AuthRequest();\r\n            userReadyRequest.rawUser = res;\r\n            userReadyRequest.isAuthed = true;\r\n            return this.doNextHandler(userReadyRequest);\r\n        };\r\n        const failHandler = error => {\r\n            const errorRequest = new AuthRequest();\r\n            errorRequest.error = super.createAuthError(`Запрос ${url}`, error);\r\n            return this.doNextHandler(errorRequest);\r\n        };\r\n        return Environment.getAuthGateway()\r\n            .currentUser()\r\n            .then(successHandler)\r\n            .catch(failHandler);\r\n    }\r\n}\r\nexport default AjaxGetUserInfoHandler;\r\n//# sourceMappingURL=AjaxGetUserInfoHandler.js.map"]},"metadata":{},"sourceType":"module"}