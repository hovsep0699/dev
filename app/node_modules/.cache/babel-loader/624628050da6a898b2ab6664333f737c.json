{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import React from'react';import GlobalVariadicForm from\"../GlobalVariadicForm\";import ModalFormFooter from\"../../../../presentation/widgets/ModlFormFooter\";import{useDialog}from\"../../../pages/dashboard/modals/useDialog\";import{ulAdminFields}from\"../../../constants/options/options\";import ObservableComponent from\"../../../observableComponent/observableComponent\";import{PrincipalULAdminTypeOptions}from\"../../../constants/initialValues/PrincipalFormInitialValues\";import GeneralSectionOptions from\"../../../pages/Sections/page/GeneralSectionOptions\";import{serviceLocator}from\"../../../../di/app_component\";import{SectionPresenter}from\"../../../pages/Sections/presenter/SectionPresenter\";import{AdminFlFields,inUlAdminOptions}from\"../../../constants/initialValues/AdminFormInitialData\";var AdminSection=function AdminSection(_ref){var admin=_ref.admin,presenter=_ref.presenter,formPresenter=_ref.formPresenter,subAdminManager=_ref.subAdminManager,principalManager=_ref.principalManager,baseWidth=_ref.baseWidth,principalIndex=_ref.principalIndex;var _useDialog=useDialog(),openDialog=_useDialog.openDialog,hideDialog=_useDialog.hideDialog,hideAllDialogs=_useDialog.hideAllDialogs;var handleSubmitAdmin=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(index,formData,isEditMode){var principal,len;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:principal=principalManager.getPrincipals()[principalIndex];if(isEditMode===true){principal.editAdmin(index,formData);principal.getAdmin(index).changeAdmins(formPresenter.getState().currentAdmin.getAdmins());}else{principalManager.addAdminToPrincipal(principalIndex,formData);len=principalManager.getPrincipals()[principalIndex].getAdmins().length;principal.getAdmin(len-1).changeAdmins(formPresenter.getState().currentAdmin.getAdmins());}presenter.update();case 3:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmitAdmin(_x,_x2,_x3){return _ref2.apply(this,arguments);};}();var handleSubmitSubAdmin=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(formData,index,adminIndex,isEditMode){var currentAdmin;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:currentAdmin=formPresenter.getState().currentAdmin;if(isEditMode===true){currentAdmin.editAdmin(adminIndex,formData);}else{currentAdmin.addAdmin(formData);}formPresenter.onCurrentAdminChange(currentAdmin);case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSubmitSubAdmin(_x4,_x5,_x6,_x7){return _ref3.apply(this,arguments);};}();var _handleRemoveSubAdmin=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(index,adminIndex,state){var currentAdmin;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:currentAdmin=state.currentAdmin;currentAdmin.removeAdmin(index);formPresenter.onCurrentAdminChange(currentAdmin);case 3:case\"end\":return _context3.stop();}}},_callee3);}));return function handleRemoveSubAdmin(_x8,_x9,_x10){return _ref4.apply(this,arguments);};}();var showSubAdminForm=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(e,index,defaultAdmin,adminIndex,isEditMode,callback,state){var _selelctedAdmin$getFi,_state$currentAdmin$g,_state$currentAdmin;var selelctedAdmin;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:selelctedAdmin=state.currentAdmin.getAdmins()[index];formPresenter.onActiveStateChanged(true);formPresenter.onParentActiveStateChanged(false);return _context4.abrupt(\"return\",openDialog({alignment:\"center\",content:/*#__PURE__*/React.createElement(GlobalVariadicForm,{formID:1,key:adminIndex,isValidating:true,isSubmitting:state.isSubmitting,onStateChange:formPresenter.onFormStateChange,defaultValues:(_selelctedAdmin$getFi=selelctedAdmin===null||selelctedAdmin===void 0?void 0:selelctedAdmin.getFields())!==null&&_selelctedAdmin$getFi!==void 0?_selelctedAdmin$getFi:{},admins:(_state$currentAdmin$g=(_state$currentAdmin=state.currentAdmin)===null||_state$currentAdmin===void 0?void 0:_state$currentAdmin.getAdmins())!==null&&_state$currentAdmin$g!==void 0?_state$currentAdmin$g:new Array(),adminIndex:adminIndex,initialFields:{'SUBADMINFL':AdminFlFields},formTypes:inUlAdminOptions,handleSubmit:function handleSubmit(e){handleSubmitSubAdmin(e,index,adminIndex,isEditMode);if(callback){callback(e);}},closeOnSubmit:function closeOnSubmit(){console.log(\",,,,,,,,,,,,,,,,,,,,,,,, ::: \",Array.isArray(defaultAdmin===null||defaultAdmin===void 0?void 0:defaultAdmin.getAdmins()));if(defaultAdmin){principalManager.getPrincipals()[principalIndex].changeAdmin(adminIndex,state.currentAdmin);}else{principalManager.getPrincipals()[principalIndex].addAdmin(state.currentAdmin);}presenter.update();// formPresenter.onActiveStateChanged(false);\n// formPresenter.onParentActiveStateChanged(true);\nhideDialog();},close:function close(){formPresenter.onResetCurrentAdmin();formPresenter.onParentActiveStateChanged(true);hideAllDialogs();}}),position:\"fixed\",width:\"704px\",maxHeight:\"90%\",footer:/*#__PURE__*/React.createElement(ObservableComponent,{builder:function builder(state){return/*#__PURE__*/React.createElement(ModalFormFooter,{state:state,onSave:function onSave(){formPresenter.onFormStateChange(null,true,null);formPresenter.onActiveStateChanged(false);formPresenter.onParentActiveStateChanged(true);}});},create:function create(){return formPresenter;}}),shouldCloseMultiple:true,title:'Поиск по МЧД'},e));case 4:case\"end\":return _context4.stop();}}},_callee4);}));return function showSubAdminForm(_x11,_x12,_x13,_x14,_x15,_x16,_x17){return _ref5.apply(this,arguments);};}();var showAdminForm=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(e,index,defaultAdmin,isEditMode,state,formState){var _defaultAdmin$getFiel,_defaultAdmin$getAdmi;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:console.log(\"MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM\",defaultAdmin===null||defaultAdmin===void 0?void 0:defaultAdmin.getAdmins(),index,e);formPresenter.onCurrentAdminChange(defaultAdmin);openDialog({alignment:\"center\",content:/*#__PURE__*/React.createElement(GlobalVariadicForm,{formID:0,isValidating:formState.isParentActive,isSubmitting:state.isSubmitting,onStateChange:presenter.onFormStateChange,handleSubmitSubAdmin:function handleSubmitSubAdmin(formData,adminIndex,callback){showSubAdminForm(formData,adminIndex,defaultAdmin,index,false,callback,formState);},handleEditSubAdmin:function handleEditSubAdmin(formData,adminIndex,callback){showSubAdminForm(formData,adminIndex,defaultAdmin,index,true,callback,formState);},handleRemoveSubAdmin:function handleRemoveSubAdmin(formData,adminIndex){_handleRemoveSubAdmin(index,adminIndex,formState);},defaultValues:(_defaultAdmin$getFiel=defaultAdmin===null||defaultAdmin===void 0?void 0:defaultAdmin.getFields())!==null&&_defaultAdmin$getFiel!==void 0?_defaultAdmin$getFiel:{},admins:(_defaultAdmin$getAdmi=defaultAdmin===null||defaultAdmin===void 0?void 0:defaultAdmin.getAdmins())!==null&&_defaultAdmin$getAdmi!==void 0?_defaultAdmin$getAdmi:new Array(),initialFields:ulAdminFields,formTypes:PrincipalULAdminTypeOptions,handleSubmit:function handleSubmit(e){return handleSubmitAdmin(index,e,isEditMode);},close:function close(){hideDialog();}}),position:\"fixed\",width:\"704px\",maxHeight:\"90%\",footer:/*#__PURE__*/React.createElement(ObservableComponent,{builder:function builder(state){return/*#__PURE__*/React.createElement(ModalFormFooter,{state:state,onSave:function onSave(){presenter.onFormStateChange(\"\",true,null);}});},create:function create(){return presenter;}}),shouldOpenMultiple:true,title:'Поиск по МЧД'},e);case 3:case\"end\":return _context5.stop();}}},_callee5);}));return function showAdminForm(_x18,_x19,_x20,_x21,_x22,_x23){return _ref6.apply(this,arguments);};}();// Function to handle removing an admin\nvar handleRemoveAdmin=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(index){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:principalManager.getPrincipals()[principalIndex].removeAdmin(index);presenter.update();case 2:case\"end\":return _context6.stop();}}},_callee6);}));return function handleRemoveAdmin(_x24){return _ref7.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(ObservableComponent,{builder:function builder(state){return/*#__PURE__*/React.createElement(ObservableComponent,{builder:function builder(formState){return/*#__PURE__*/React.createElement(GeneralSectionOptions,{presenter:serviceLocator.get(SectionPresenter),sectionData:admin,baseWidth:baseWidth,onShowForm:/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(e,index){var defaultAdmin;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:defaultAdmin=state.principals[principalIndex].getAdmin(index);_context7.next=3;return showAdminForm(e,index,defaultAdmin,false,state,formState);case 3:// if (defaultAdmin) {\n//     principalManager.getPrincipals()[principalIndex].changeAdmin(index, formState.currentAdmin);\n// }\n// else {\n//     principalManager.getPrincipals()[principalIndex].addAdmin(formState.currentAdmin);\n// }\npresenter.update();case 4:case\"end\":return _context7.stop();}}},_callee7);}));return function(_x25,_x26){return _ref8.apply(this,arguments);};}(),onRemove:handleRemoveAdmin,getInn:function getInn(section){if(section.getFields().hasOwnProperty(\"inn\")){var _section$getFields$in;return(_section$getFields$in=section===null||section===void 0?void 0:section.getFields()[\"inn\"])!==null&&_section$getFields$in!==void 0?_section$getFields$in:\"\";}return\"\";},onEdit:/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(e,index){var defaultAdmin;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:defaultAdmin=state.principals[principalIndex].getAdmin(index);_context8.next=3;return showAdminForm(e,index,defaultAdmin,true,state,formState);case 3:// if (defaultAdmin) {\n//     principalManager.getPrincipals()[principalIndex].changeAdmin(index, formState.currentAdmin);\n// }\n// else {\n//     principalManager.getPrincipals()[principalIndex].addAdmin(formState.currentAdmin);\n// }\npresenter.update();case 4:case\"end\":return _context8.stop();}}},_callee8);}));return function(_x27,_x28){return _ref9.apply(this,arguments);};}(),isRequired:true,sectionTitle:\"Руководитель Организации\"});},create:function create(){return formPresenter;}});},create:function create(){return presenter;}});};export default AdminSection;","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/POA/MCHD_ROOT/presentation/components/forms/sections/AdminSection.tsx"],"names":["React","GlobalVariadicForm","ModalFormFooter","useDialog","ulAdminFields","ObservableComponent","PrincipalULAdminTypeOptions","GeneralSectionOptions","serviceLocator","SectionPresenter","AdminFlFields","inUlAdminOptions","AdminSection","admin","presenter","formPresenter","subAdminManager","principalManager","baseWidth","principalIndex","openDialog","hideDialog","hideAllDialogs","handleSubmitAdmin","index","formData","isEditMode","principal","getPrincipals","editAdmin","getAdmin","changeAdmins","getState","currentAdmin","getAdmins","addAdminToPrincipal","len","length","update","handleSubmitSubAdmin","adminIndex","addAdmin","onCurrentAdminChange","handleRemoveSubAdmin","state","removeAdmin","showSubAdminForm","e","defaultAdmin","callback","selelctedAdmin","onActiveStateChanged","onParentActiveStateChanged","alignment","content","isSubmitting","onFormStateChange","getFields","Array","console","log","isArray","changeAdmin","onResetCurrentAdmin","position","width","maxHeight","footer","shouldCloseMultiple","title","showAdminForm","formState","isParentActive","shouldOpenMultiple","handleRemoveAdmin","get","principals","section","hasOwnProperty"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport GlobalVariadicForm from \"../GlobalVariadicForm\";\r\nimport ModalFormFooter from \"../../../../presentation/widgets/ModlFormFooter\";\r\nimport {useDialog} from \"../../../pages/dashboard/modals/useDialog\";\r\nimport {PrincipalManager} from \"../../../../core/PrincipalManager\";\r\nimport {ulAdminFields} from \"../../../constants/options/options\";\r\nimport ObservableComponent from \"../../../observableComponent/observableComponent\";\r\nimport {PrincipalULAdminTypeOptions} from \"../../../constants/initialValues/PrincipalFormInitialValues\";\r\nimport {CreatePresenter} from \"../../../pages/CreatePoa/presenter/createPresenter\";\r\nimport {CreatePresenterState} from \"../../../pages/CreatePoa/presenter/createPresenterState\";\r\nimport GeneralSectionOptions from \"../../../pages/Sections/page/GeneralSectionOptions\";\r\nimport {serviceLocator} from \"../../../../di/app_component\";\r\nimport {SectionPresenter} from \"../../../pages/Sections/presenter/SectionPresenter\";\r\nimport {AdminFlFields, inUlAdminOptions} from \"../../../constants/initialValues/AdminFormInitialData\";\r\nimport {FormPresenter} from \"../presenter/FormPresenter\";\r\nimport {FormPresenterState} from \"../presenter/FormPresenterState\";\r\nimport {SubAdminManager} from \"../../../../core/SubAdminManager\";\r\nimport {FormPresenterViewModel} from \"../presenter/FormPresenterViewModel\";\r\nimport {CreatePresenterViewModel} from \"../../../pages/CreatePoa/presenter/createPresenterViewModel\";\r\nimport {SubAdmin} from \"../../../../domain/model/SubAdmin\";\r\nimport {Principal} from \"../../../../domain/model/Principal\";\r\nimport {PrincipalAdmin} from \"../../../../domain/model/PrincipalAdmin\";\r\n\r\ninterface AdminSectionProps {\r\n    admin: any;\r\n    presenter: CreatePresenter;\r\n    formPresenter: FormPresenter;\r\n    principalManager: PrincipalManager;\r\n    subAdminManager: SubAdminManager;\r\n    baseWidth?: string;\r\n    principalIndex: number;\r\n}\r\n\r\nconst AdminSection: React.FC<AdminSectionProps> = ({\r\n                                                       admin,\r\n                                                       presenter,\r\n                                                       formPresenter,\r\n                                                       subAdminManager,\r\n                                                       principalManager,\r\n                                                       baseWidth,\r\n                                                       principalIndex\r\n                                                   }: AdminSectionProps) => {\r\n\r\n    const {openDialog, hideDialog, hideAllDialogs} = useDialog();\r\n\r\n\r\n    const handleSubmitAdmin = async (index: number, formData: any, isEditMode: boolean | null) => {\r\n        const principal: Principal | null = principalManager.getPrincipals()[principalIndex];\r\n        if (isEditMode === true) {\r\n            principal.editAdmin(index, formData);\r\n            principal.getAdmin(index).changeAdmins(formPresenter.getState().currentAdmin.getAdmins());\r\n        } else {\r\n            principalManager.addAdminToPrincipal(principalIndex, formData);\r\n            const len = principalManager.getPrincipals()[principalIndex].getAdmins().length;\r\n            principal.getAdmin(len - 1).changeAdmins(formPresenter.getState().currentAdmin.getAdmins());\r\n        }\r\n        presenter.update();\r\n    };\r\n\r\n    const handleSubmitSubAdmin = async (formData: any, index: number, adminIndex: number, isEditMode: boolean | null) => {\r\n        const currentAdmin: PrincipalAdmin | null = formPresenter.getState().currentAdmin;\r\n\r\n        if (isEditMode === true) {\r\n            currentAdmin.editAdmin(adminIndex, formData);\r\n        } else {\r\n            currentAdmin.addAdmin(formData);\r\n        }\r\n        formPresenter.onCurrentAdminChange(currentAdmin);\r\n    }\r\n\r\n    const handleRemoveSubAdmin = async (index: number, adminIndex: number, state: FormPresenterState) => {\r\n        const currentAdmin = state.currentAdmin;\r\n        currentAdmin.removeAdmin(index);\r\n        formPresenter.onCurrentAdminChange(currentAdmin);\r\n    }\r\n\r\n    const showSubAdminForm = async (e: any, index: number, defaultAdmin: PrincipalAdmin | null, adminIndex: number, isEditMode: boolean, callback: any, state: FormPresenterState) => {\r\n        const selelctedAdmin: SubAdmin | null = state.currentAdmin.getAdmins()[index];\r\n        formPresenter.onActiveStateChanged(true);\r\n        formPresenter.onParentActiveStateChanged(false);\r\n\r\n\r\n        return openDialog({\r\n            alignment: \"center\",\r\n            content:\r\n                <GlobalVariadicForm\r\n                    formID={1}\r\n                    key={adminIndex}\r\n                    isValidating={true}\r\n                    isSubmitting={state.isSubmitting}\r\n                    onStateChange={formPresenter.onFormStateChange}\r\n                    defaultValues={selelctedAdmin?.getFields() ?? {}}\r\n                    admins={state.currentAdmin?.getAdmins() ?? new Array<SubAdmin>()}\r\n                    adminIndex={adminIndex}\r\n                    initialFields={{'SUBADMINFL': AdminFlFields}}\r\n                    formTypes={inUlAdminOptions}\r\n                    handleSubmit={(e: any) => {\r\n                        handleSubmitSubAdmin(e, index, adminIndex, isEditMode);\r\n                        if (callback) {\r\n                            callback!(e);\r\n                        }\r\n                    }}\r\n                    closeOnSubmit={() => {\r\n                        console.log(\",,,,,,,,,,,,,,,,,,,,,,,, ::: \", Array.isArray(defaultAdmin?.getAdmins()));\r\n                        if (defaultAdmin) {\r\n                            principalManager.getPrincipals()[principalIndex].changeAdmin(adminIndex, state.currentAdmin);\r\n                        }\r\n                        else {\r\n                            principalManager.getPrincipals()[principalIndex].addAdmin(state.currentAdmin);\r\n                        }\r\n                        presenter.update();\r\n                        // formPresenter.onActiveStateChanged(false);\r\n                        // formPresenter.onParentActiveStateChanged(true);\r\n                        hideDialog();\r\n                    }}\r\n                    close={() => {\r\n                        formPresenter.onResetCurrentAdmin();\r\n                        formPresenter.onParentActiveStateChanged(true);\r\n                        hideAllDialogs();\r\n                    }}\r\n\r\n                />,\r\n            position: \"fixed\",\r\n            width: \"704px\",\r\n            maxHeight: \"90%\",\r\n            footer:\r\n                <ObservableComponent<FormPresenterViewModel, FormPresenterState, FormPresenter>\r\n                    builder={(state: FormPresenterState) => (\r\n                        <ModalFormFooter\r\n                            state={state}\r\n                            onSave={() => {\r\n                                formPresenter.onFormStateChange(null, true, null)\r\n                                formPresenter.onActiveStateChanged(false);\r\n                                formPresenter.onParentActiveStateChanged(true);\r\n\r\n                            }}\r\n                        />\r\n                    )}\r\n                    create={() => formPresenter}\r\n                />,\r\n            shouldCloseMultiple: true,\r\n            title: 'Поиск по МЧД',\r\n        }, e)\r\n    }\r\n\r\n\r\n    const showAdminForm = async (e: any, index: number, defaultAdmin: PrincipalAdmin | null, isEditMode: boolean, state: CreatePresenterState, formState: FormPresenterState) => {\r\n        console.log(\"MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM\", defaultAdmin?.getAdmins(), index, e)\r\n        formPresenter.onCurrentAdminChange(defaultAdmin);\r\n        openDialog({\r\n            alignment: \"center\",\r\n            content:\r\n\r\n                <GlobalVariadicForm\r\n                    formID={0}\r\n                    isValidating={formState.isParentActive}\r\n                    isSubmitting={state.isSubmitting}\r\n                    onStateChange={presenter.onFormStateChange}\r\n                    handleSubmitSubAdmin={(formData: any, adminIndex: any, callback: any) => {\r\n                        showSubAdminForm(formData, adminIndex, defaultAdmin, index, false, callback, formState)\r\n                    }}\r\n                    handleEditSubAdmin={(formData: any, adminIndex: any, callback: any) => {\r\n                        showSubAdminForm(formData, adminIndex, defaultAdmin, index, true, callback, formState)\r\n                    }}\r\n                    handleRemoveSubAdmin={(formData: any, adminIndex: any) => {\r\n                        handleRemoveSubAdmin(index, adminIndex, formState)\r\n                    }}\r\n                    defaultValues={defaultAdmin?.getFields() ?? {}}\r\n                    admins={defaultAdmin?.getAdmins() ?? new Array<SubAdmin>()}\r\n                    initialFields={ulAdminFields}\r\n                    formTypes={PrincipalULAdminTypeOptions}\r\n                    handleSubmit={(e: any) => handleSubmitAdmin(index, e, isEditMode)}\r\n                    close={() => {\r\n                        hideDialog();\r\n                    }}\r\n                />,\r\n            position: \"fixed\",\r\n            width: \"704px\",\r\n            maxHeight: \"90%\",\r\n            footer: (\r\n                <ObservableComponent<CreatePresenterViewModel, CreatePresenterState, CreatePresenter>\r\n                    builder={(state) => (\r\n                        <ModalFormFooter state={state} onSave={() => {\r\n                            presenter.onFormStateChange(\"\", true, null)\r\n                        }}/>\r\n                    )} create={() => presenter}/>\r\n            ),\r\n            shouldOpenMultiple: true,\r\n            title: 'Поиск по МЧД',\r\n        }, e)\r\n    }\r\n\r\n\r\n    // Function to handle removing an admin\r\n    const handleRemoveAdmin = async (index: number) => {\r\n        principalManager.getPrincipals()[principalIndex].removeAdmin(index);\r\n        presenter.update();\r\n    };\r\n\r\n    return (\r\n        <ObservableComponent<CreatePresenterViewModel, CreatePresenterState, CreatePresenter>\r\n            builder={(state: CreatePresenterState) => (\r\n                <ObservableComponent<FormPresenterViewModel, FormPresenterState, FormPresenter>\r\n                    builder={(formState: FormPresenterState) => (\r\n                        <GeneralSectionOptions\r\n                            presenter={serviceLocator.get(SectionPresenter)}\r\n                            sectionData={admin}\r\n                            baseWidth={baseWidth}\r\n                            onShowForm={async (e: any, index: number) => {\r\n                                const defaultAdmin = state.principals[principalIndex].getAdmin(index)\r\n                                await showAdminForm(e, index, defaultAdmin, false, state, formState)\r\n                                // if (defaultAdmin) {\r\n                                //     principalManager.getPrincipals()[principalIndex].changeAdmin(index, formState.currentAdmin);\r\n                                // }\r\n                                // else {\r\n                                //     principalManager.getPrincipals()[principalIndex].addAdmin(formState.currentAdmin);\r\n                                // }\r\n                                presenter.update();\r\n                            }}\r\n                            onRemove={handleRemoveAdmin}\r\n                            getInn={(section) => {\r\n                                if (section.getFields().hasOwnProperty(\"inn\")) {\r\n                                    return section?.getFields()[\"inn\"] ?? \"\"\r\n                                }\r\n                                return \"\"\r\n                            }}\r\n                            onEdit={async (e: any, index: number) => {\r\n                                const defaultAdmin: PrincipalAdmin | null = state.principals[principalIndex].getAdmin(index)\r\n                                await showAdminForm(e, index, defaultAdmin, true, state, formState)\r\n                                // if (defaultAdmin) {\r\n                                //     principalManager.getPrincipals()[principalIndex].changeAdmin(index, formState.currentAdmin);\r\n                                // }\r\n                                // else {\r\n                                //     principalManager.getPrincipals()[principalIndex].addAdmin(formState.currentAdmin);\r\n                                // }\r\n                                presenter.update();\r\n                            }}\r\n                            isRequired={true}\r\n                            sectionTitle={\"Руководитель Организации\"}\r\n\r\n                        />\r\n                    )}\r\n                    create={() => formPresenter}\r\n                />\r\n            )}\r\n            create={() => presenter}\r\n        />\r\n    );\r\n}\r\n\r\nexport default AdminSection;\r\n"]},"metadata":{},"sourceType":"module"}