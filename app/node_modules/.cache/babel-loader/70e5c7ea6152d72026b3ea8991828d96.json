{"ast":null,"code":"import _objectSpread from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(companyConnectorsEffect),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(createConnectorAccountWorker),_marked3=/*#__PURE__*/_regeneratorRuntime.mark(getConnectorsWorker),_marked4=/*#__PURE__*/_regeneratorRuntime.mark(getConnectorWorker),_marked5=/*#__PURE__*/_regeneratorRuntime.mark(stopConnectorWorker),_marked6=/*#__PURE__*/_regeneratorRuntime.mark(startConnectorWorker),_marked7=/*#__PURE__*/_regeneratorRuntime.mark(updateConnectorWorker);import{takeLatest,put}from'redux-saga/effects';import{Flash}from'../../../../common/flash/Flash';import{ConnectorStatus}from'../../helpers/company.typings';import{createConnectorAccount,setConnectorErrors,clearErrors,getConnectors,setConnectors,getConnector,setConnector,stopConnector,startConnector,updateConnector,setConnectorStatus}from'../actions';import{ConnectorGateway}from'@distate/core/dist/application/connector/ConnectorGateway';import AuthGateway from'@distate/core/dist/application/auth/AuthGateway';/** Коннекторы */export function companyConnectorsEffect(){return _regeneratorRuntime.wrap(function companyConnectorsEffect$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return takeLatest(createConnectorAccount,createConnectorAccountWorker);case 2:_context.next=4;return takeLatest(getConnectors,getConnectorsWorker);case 4:_context.next=6;return takeLatest(getConnector,getConnectorWorker);case 6:_context.next=8;return takeLatest(stopConnector,stopConnectorWorker);case 8:_context.next=10;return takeLatest(startConnector,startConnectorWorker);case 10:_context.next=12;return takeLatest(updateConnector,updateConnectorWorker);case 12:case\"end\":return _context.stop();}}},_marked);}/** подключение коннектора */function createConnectorAccountWorker(_ref){var payload,login,password,position,operatorCode,importFrom,boxId,fnsUid,kpp,connectorGateway,messages;return _regeneratorRuntime.wrap(function createConnectorAccountWorker$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:payload=_ref.payload;_context2.prev=1;login=payload.login,password=payload.password,position=payload.position,operatorCode=payload.operatorCode,importFrom=payload.importFrom,boxId=payload.boxId,fnsUid=payload.fnsUid,kpp=payload.kpp;connectorGateway=new ConnectorGateway();_context2.next=6;return connectorGateway.create({credentials:{login:login,password:password},position:position,operatorCode:operatorCode,importFrom:importFrom,boxId:boxId,fnsUid:fnsUid,kpp:kpp});case 6:_context2.next=8;return put(clearErrors({}));case 8:_context2.next=10;return put(getConnector(operatorCode));case 10:_context2.next=12;return Flash.success('Данные отправлены');case 12:_context2.next=21;break;case 14:_context2.prev=14;_context2.t0=_context2[\"catch\"](1);messages=_context2.t0.messages;_context2.next=19;return put(setConnectorErrors(messages));case 19:_context2.next=21;return Flash.error('Возникла ошибка');case 21:case\"end\":return _context2.stop();}}},_marked2,null,[[1,14]]);}/** получение списка коннекторов */function getConnectorsWorker(){var connectorGateway,response;return _regeneratorRuntime.wrap(function getConnectorsWorker$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;connectorGateway=new ConnectorGateway();_context3.next=4;return connectorGateway.operators();case 4:response=_context3.sent;_context3.next=7;return put(setConnectors(response.connectors));case 7:_context3.next=13;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](0);_context3.next=13;return Flash.error('Возникла ошибка');case 13:case\"end\":return _context3.stop();}}},_marked3,null,[[0,9]]);}/** получение информации о коннекторе */function getConnectorWorker(_ref2){var payload,connectorGateway,_yield$connectorGatew,connectors,currentConnector,id,connector,authGateway,res,position;return _regeneratorRuntime.wrap(function getConnectorWorker$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:payload=_ref2.payload;_context4.prev=1;connectorGateway=new ConnectorGateway();_context4.next=5;return connectorGateway.operators();case 5:_yield$connectorGatew=_context4.sent;connectors=_yield$connectorGatew.connectors;currentConnector=connectors.filter(function(item){var _item$operator;return(item===null||item===void 0?void 0:(_item$operator=item.operator)===null||_item$operator===void 0?void 0:_item$operator.code)===payload;});/** id коннектора */id=currentConnector[0].id;_context4.next=11;return connectorGateway.operator(id);case 11:connector=_context4.sent;authGateway=new AuthGateway();/** должность пользователя */_context4.next=15;return authGateway.currentUser();case 15:res=_context4.sent;position=res.employee.position;_context4.next=19;return put(setConnector(_objectSpread(_objectSpread({},connector),{},{position:position})));case 19:_context4.next=25;break;case 21:_context4.prev=21;_context4.t0=_context4[\"catch\"](1);_context4.next=25;return Flash.error('Возникла ошибка');case 25:case\"end\":return _context4.stop();}}},_marked4,null,[[1,21]]);}/** приостановка коннектора */function stopConnectorWorker(_ref3){var payload,connectorGateway,success;return _regeneratorRuntime.wrap(function stopConnectorWorker$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:payload=_ref3.payload;_context5.prev=1;connectorGateway=new ConnectorGateway();_context5.next=5;return connectorGateway.stop(payload);case 5:success=_context5.sent;if(!success){_context5.next=9;break;}_context5.next=9;return put(setConnectorStatus(ConnectorStatus.stopped));case 9:_context5.next=15;break;case 11:_context5.prev=11;_context5.t0=_context5[\"catch\"](1);_context5.next=15;return Flash.error('Возникла ошибка');case 15:case\"end\":return _context5.stop();}}},_marked5,null,[[1,11]]);}/** запуск коннектора */function startConnectorWorker(_ref4){var payload,connectorGateway,success;return _regeneratorRuntime.wrap(function startConnectorWorker$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:payload=_ref4.payload;_context6.prev=1;connectorGateway=new ConnectorGateway();_context6.next=5;return connectorGateway.start(payload);case 5:success=_context6.sent;if(!success){_context6.next=9;break;}_context6.next=9;return put(setConnectorStatus(ConnectorStatus.connector));case 9:_context6.next=15;break;case 11:_context6.prev=11;_context6.t0=_context6[\"catch\"](1);_context6.next=15;return Flash.error('Возникла ошибка');case 15:case\"end\":return _context6.stop();}}},_marked6,null,[[1,11]]);}/** обновление коннектора */function updateConnectorWorker(_ref5){var payload,id,data,connectorGateway;return _regeneratorRuntime.wrap(function updateConnectorWorker$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:payload=_ref5.payload;_context7.prev=1;id=payload.id,data=payload.data;connectorGateway=new ConnectorGateway();_context7.next=6;return connectorGateway.update(id,data);case 6:_context7.next=8;return Flash.success('Данные обновлены');case 8:_context7.next=14;break;case 10:_context7.prev=10;_context7.t0=_context7[\"catch\"](1);_context7.next=14;return Flash.error('Возникла ошибка');case 14:case\"end\":return _context7.stop();}}},_marked7,null,[[1,10]]);}","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/company/store/sagas/companyConnectors.effect.ts"],"names":["companyConnectorsEffect","createConnectorAccountWorker","getConnectorsWorker","getConnectorWorker","stopConnectorWorker","startConnectorWorker","updateConnectorWorker","takeLatest","put","Flash","ConnectorStatus","createConnectorAccount","setConnectorErrors","clearErrors","getConnectors","setConnectors","getConnector","setConnector","stopConnector","startConnector","updateConnector","setConnectorStatus","ConnectorGateway","AuthGateway","payload","login","password","position","operatorCode","importFrom","boxId","fnsUid","kpp","connectorGateway","create","credentials","success","messages","error","operators","response","connectors","currentConnector","filter","item","operator","code","id","connector","authGateway","currentUser","res","employee","stop","stopped","start","data","update"],"mappings":"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","sourcesContent":["import { takeLatest, put } from 'redux-saga/effects';\r\n\r\nimport { Flash } from '../../../../common/flash/Flash';\r\nimport { CreateConnectorAccountProps, ConnectorStatus } from '../../helpers/company.typings';\r\nimport {\r\n  createConnectorAccount,\r\n  setConnectorErrors,\r\n  clearErrors,\r\n  getConnectors,\r\n  setConnectors,\r\n  getConnector,\r\n  setConnector,\r\n  stopConnector,\r\n  startConnector,\r\n  updateConnector,\r\n  setConnectorStatus\r\n} from '../actions';\r\nimport { ConnectorGateway } from '@distate/core/dist/application/connector/ConnectorGateway';\r\nimport AuthGateway from '@distate/core/dist/application/auth/AuthGateway';\r\n\r\n/** Коннекторы */\r\nexport function* companyConnectorsEffect() {\r\n  yield takeLatest(createConnectorAccount, createConnectorAccountWorker);\r\n  yield takeLatest(getConnectors, getConnectorsWorker);\r\n  yield takeLatest(getConnector, getConnectorWorker);\r\n  yield takeLatest(stopConnector, stopConnectorWorker);\r\n  yield takeLatest(startConnector, startConnectorWorker);\r\n  yield takeLatest(updateConnector, updateConnectorWorker);\r\n}\r\n\r\n/** подключение коннектора */\r\nfunction* createConnectorAccountWorker({ payload }: { payload: CreateConnectorAccountProps }) {\r\n  try {\r\n    const { login, password, position, operatorCode, importFrom, boxId, fnsUid, kpp } = payload;\r\n    const connectorGateway = new ConnectorGateway();\r\n    yield connectorGateway.create({\r\n      credentials: {\r\n        login,\r\n        password\r\n      },\r\n      position,\r\n      operatorCode,\r\n      importFrom,\r\n      boxId,\r\n      fnsUid,\r\n      kpp\r\n    });\r\n    yield put(clearErrors({}));\r\n    yield put(getConnector(operatorCode));\r\n    yield Flash.success('Данные отправлены');\r\n  } catch (err) {\r\n    const { messages } = err;\r\n    yield put(setConnectorErrors(messages));\r\n    yield Flash.error('Возникла ошибка');\r\n  }\r\n}\r\n\r\n/** получение списка коннекторов */\r\nfunction* getConnectorsWorker() {\r\n  try {\r\n    const connectorGateway = new ConnectorGateway();\r\n    const response = yield connectorGateway.operators();\r\n    yield put(setConnectors(response.connectors));\r\n  } catch (err) {\r\n    yield Flash.error('Возникла ошибка');\r\n  }\r\n}\r\n\r\n/** получение информации о коннекторе */\r\nfunction* getConnectorWorker({ payload }: { payload: string }) {\r\n  try {\r\n    const connectorGateway = new ConnectorGateway();\r\n    const { connectors } = yield connectorGateway.operators();\r\n    const currentConnector = connectors.filter((item: any) => item?.operator?.code === payload);\r\n    /** id коннектора */\r\n    const { id } = currentConnector[0];\r\n    const connector = yield connectorGateway.operator(id);\r\n    const authGateway = new AuthGateway();\r\n    /** должность пользователя */\r\n    const res = yield authGateway.currentUser();\r\n    const position = res.employee.position;\r\n    yield put(setConnector({ ...connector, position }));\r\n  } catch (err) {\r\n    yield Flash.error('Возникла ошибка');\r\n  }\r\n}\r\n\r\n/** приостановка коннектора */\r\nfunction* stopConnectorWorker({ payload }: { payload: number }) {\r\n  try {\r\n    const connectorGateway = new ConnectorGateway();\r\n    const success = yield connectorGateway.stop(payload);\r\n    if (success) {\r\n      yield put(setConnectorStatus(ConnectorStatus.stopped));\r\n    }\r\n  } catch (err) {\r\n    yield Flash.error('Возникла ошибка');\r\n  }\r\n}\r\n\r\n/** запуск коннектора */\r\nfunction* startConnectorWorker({ payload }: { payload: number }) {\r\n  try {\r\n    const connectorGateway = new ConnectorGateway();\r\n    const success = yield connectorGateway.start(payload);\r\n    if (success) {\r\n      yield put(setConnectorStatus(ConnectorStatus.connector));\r\n    }\r\n  } catch (err) {\r\n    yield Flash.error('Возникла ошибка');\r\n  }\r\n}\r\n\r\n/** обновление коннектора */\r\nfunction* updateConnectorWorker({ payload }: { payload: { id: number; data?: {} } }) {\r\n  try {\r\n    const { id, data } = payload;\r\n    const connectorGateway = new ConnectorGateway();\r\n    yield connectorGateway.update(id, data);\r\n    yield Flash.success('Данные обновлены');\r\n  } catch (err) {\r\n    yield Flash.error('Возникла ошибка');\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}