{"ast":null,"code":"import React from'react';import{useSelector}from'react-redux';import styled from'styled-components';import{Loading}from'@distate/components';import SecurityService from'@distate/core/dist/application/security/SecurityService';import Menu from'./menu/Menu';import PageMenu from'./menu/PageMenu';import PageMenuInner from'./menu/PageMenuInner';import{Switch,Route,Redirect}from'react-router-dom';import Container from'./Container';import{Footer}from'@distate/components';import TopBar from'./topbar/TopBar';import{SingInit}from'../container/sign/sign.init';import{history}from'../App';var Wrap=styled.div.withConfig({displayName:\"Layout__Wrap\",componentId:\"sc-19mxdc9-0\"})([\"position:relative;width:100%;min-width:1000px;min-height:100%;margin:0 auto;overflow:hidden;min-height:100vh !important;\"]);var LoadingWrapp=styled(Loading).withConfig({displayName:\"Layout__LoadingWrapp\",componentId:\"sc-19mxdc9-1\"})([\"position:fixed;top:0;left:0;right:0;bottom:0;z-index:4000;\"]);var Wrapper=styled.div.withConfig({displayName:\"Layout__Wrapper\",componentId:\"sc-19mxdc9-2\"})([\"padding:\",\";\"],function(_ref){var theme=_ref.theme;return\"\".concat(theme.main.sizes.padding,\" \").concat(theme.main.sizes.padding,\" 0\");});/** получение всех url */var getAllUrls=function getAllUrls(config){var arr=[];/** обходим главные подразделы */for(var i=0;i<config.length;i++){var _config$i;if((_config$i=config[i])===null||_config$i===void 0?void 0:_config$i.submenu){var _config$i2;var submenu=(_config$i2=config[i])===null||_config$i2===void 0?void 0:_config$i2.submenu;/** обходим вложенные разделы */for(var j=0;j<submenu.length;j++){arr.push(submenu[j].link||submenu[j].path);}}else{arr.push(config[i].link||config[i].path);}}return arr;};/** получение линейного массива всех роутов  */var getLineRouts=function getLineRouts(){var routes=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var lineRouts=[];routes.forEach(function(item){lineRouts.push(item);if(item.submenu){item.submenu.forEach(function(subItem){lineRouts.push(subItem);});}});return lineRouts;};var TopBarRoute=React.memo(function(_ref2){var routs=_ref2.routs,topBarHeading=_ref2.topBarHeading;var lineRouts=getLineRouts(routs);return/*#__PURE__*/React.createElement(Switch,null,lineRouts.map(function(route,index){var path=route.path,exact=route.exact,title=route.title;return/*#__PURE__*/React.createElement(Route,{key:index,path:path,strict:true,exact:exact,children:topBarHeading||title});}));});var Layout=function Layout(_ref3){var title=_ref3.title,config=_ref3.config,children=_ref3.children,pageMenuHeader=_ref3.pageMenuHeader,_ref3$isLoading=_ref3.isLoading,isLoading=_ref3$isLoading===void 0?false:_ref3$isLoading,topBarHeading=_ref3.topBarHeading,menuTopFragment=_ref3.menuTopFragment,mainCategoryRedirect=_ref3.mainCategoryRedirect,containerClassName=_ref3.containerClassName;var hasIncopleteRole=useSelector(function(state){return state.sign.hasRoleIncomplete;});var allUrls=config&&getAllUrls(config);var currentUrl=history.location.pathname;/** если среди роутов нет текущей страницы то редирект на основную стрницу раздела */var needRedirect=allUrls&&!allUrls.includes(currentUrl);var renderMainContent=function renderMainContent(routs){/** линейный массив всех роутов  */var lineRouts=getLineRouts(routs);return routs?/*#__PURE__*/React.createElement(Switch,null,lineRouts.map(function(route,index){var _route$roles;var hasRole=Boolean(route.roles);var isVisible=!hasRole||((_route$roles=route.roles)===null||_route$roles===void 0?void 0:_route$roles.some(function(role){return SecurityService.hasRole(role);}));if(!isVisible){return null;}return/*#__PURE__*/React.createElement(Route,{strict:true,key:index,path:route.path,exact:route.exact,children:route.main?/*#__PURE__*/React.createElement(route.main,null):children});}),mainCategoryRedirect&&needRedirect&&/*#__PURE__*/React.createElement(Redirect,{to:mainCategoryRedirect})):children;};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(SingInit,null),/*#__PURE__*/React.createElement(Menu,null),config&&/*#__PURE__*/React.createElement(PageMenu,{header:pageMenuHeader,topFragment:menuTopFragment},/*#__PURE__*/React.createElement(PageMenuInner,{config:config})),/*#__PURE__*/React.createElement(TopBar,{hasIncopleteRole:hasIncopleteRole},title&&title,config?/*#__PURE__*/React.createElement(TopBarRoute,{routs:config,topBarHeading:topBarHeading}):topBarHeading),/*#__PURE__*/React.createElement(Wrap,{className:\"wrap\"},/*#__PURE__*/React.createElement(Container,{className:containerClassName},isLoading&&/*#__PURE__*/React.createElement(LoadingWrapp,{height:\"100vh\"}),/*#__PURE__*/React.createElement(Wrapper,null,renderMainContent(config))),/*#__PURE__*/React.createElement(Footer,{hasIncreasedIndent:!!config})));};export default Layout;","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/common/Layout.tsx"],"names":["React","useSelector","styled","Loading","SecurityService","Menu","PageMenu","PageMenuInner","Switch","Route","Redirect","Container","Footer","TopBar","SingInit","history","Wrap","div","LoadingWrapp","Wrapper","theme","main","sizes","padding","getAllUrls","config","arr","i","length","submenu","j","push","link","path","getLineRouts","routes","lineRouts","forEach","item","subItem","TopBarRoute","memo","routs","topBarHeading","map","route","index","exact","title","Layout","children","pageMenuHeader","isLoading","menuTopFragment","mainCategoryRedirect","containerClassName","hasIncopleteRole","state","sign","hasRoleIncomplete","allUrls","currentUrl","location","pathname","needRedirect","includes","renderMainContent","hasRole","Boolean","roles","isVisible","some","role"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport styled from 'styled-components';\r\nimport { Loading } from '@distate/components';\r\nimport SecurityService from '@distate/core/dist/application/security/SecurityService';\r\n\r\nimport Menu from './menu/Menu';\r\nimport PageMenu from './menu/PageMenu';\r\nimport PageMenuInner from './menu/PageMenuInner';\r\nimport { Switch, Route, Redirect } from 'react-router-dom';\r\nimport Container from './Container';\r\nimport { Footer } from '@distate/components';\r\nimport TopBar from './topbar/TopBar';\r\nimport { IRoute } from '../types/routes';\r\nimport { SingInit } from '../container/sign/sign.init';\r\nimport { history } from '../App';\r\n\r\nconst Wrap = styled.div`\r\n  position: relative;\r\n  width: 100%;\r\n  min-width: 1000px;\r\n  min-height: 100%;\r\n  margin: 0 auto;\r\n  overflow: hidden;\r\n  min-height: 100vh !important;\r\n`;\r\n\r\nconst LoadingWrapp = styled(Loading)`\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  z-index: 4000;\r\n`;\r\n\r\nconst Wrapper = styled.div`\r\n  padding: ${({ theme }) => `${theme.main.sizes.padding} ${theme.main.sizes.padding} 0`};\r\n`;\r\n\r\ninterface ILayout {\r\n  title?: string;\r\n  config?: IRoute[];\r\n  isLoading?: boolean;\r\n  children?: React.ReactNode;\r\n  pageMenuHeader?: string;\r\n  topBarHeading?: string;\r\n  menuTopFragment?: any;\r\n  /** урл для перенаправления из page в категорию при первом заходе в раздел */\r\n  mainCategoryRedirect?: string;\r\n  /** кастомное имя класса */\r\n  containerClassName?: string;\r\n}\r\n\r\n/** получение всех url */\r\nconst getAllUrls = (config: IRoute[]): string[] => {\r\n  const arr: string[] = [];\r\n  /** обходим главные подразделы */\r\n  for (let i = 0; i < config.length; i++) {\r\n    if (config[i]?.submenu) {\r\n      const submenu = config[i]?.submenu;\r\n      /** обходим вложенные разделы */\r\n      for (let j = 0; j < submenu!.length; j++) {\r\n        arr.push(submenu![j].link || submenu![j].path);\r\n      }\r\n    } else {\r\n      arr.push(config[i].link || config[i].path);\r\n    }\r\n  }\r\n  return arr;\r\n};\r\n\r\n/** получение линейного массива всех роутов  */\r\nconst getLineRouts = (routes: IRoute[] = []) => {\r\n  const lineRouts: IRoute[] = [];\r\n  routes.forEach(item => {\r\n    lineRouts.push(item);\r\n    if (item.submenu) {\r\n      item.submenu.forEach(subItem => {\r\n        lineRouts.push(subItem);\r\n      });\r\n    }\r\n  });\r\n  return lineRouts;\r\n};\r\n\r\nconst TopBarRoute: React.FC<{ routs: IRoute[]; topBarHeading?: string }> = React.memo(\r\n  ({ routs, topBarHeading }) => {\r\n    const lineRouts = getLineRouts(routs);\r\n    return (\r\n      <Switch>\r\n        {lineRouts.map((route: IRoute, index: number) => {\r\n          const { path, exact, title } = route;\r\n          return (\r\n            <Route key={index} path={path} strict exact={exact} children={topBarHeading || title} />\r\n          );\r\n        })}\r\n      </Switch>\r\n    );\r\n  }\r\n);\r\n\r\nconst Layout = ({\r\n  title,\r\n  config,\r\n  children,\r\n  pageMenuHeader,\r\n  isLoading = false,\r\n  topBarHeading,\r\n  menuTopFragment,\r\n  mainCategoryRedirect,\r\n  containerClassName\r\n}: ILayout) => {\r\n  const hasIncopleteRole = useSelector((state: any) => state.sign.hasRoleIncomplete);\r\n  const allUrls = config && getAllUrls(config);\r\n  const currentUrl = history.location.pathname;\r\n  /** если среди роутов нет текущей страницы то редирект на основную стрницу раздела */\r\n  const needRedirect = allUrls && !allUrls.includes(currentUrl);\r\n\r\n  const renderMainContent = (routs: IRoute[] | undefined) => {\r\n    /** линейный массив всех роутов  */\r\n    const lineRouts = getLineRouts(routs);\r\n\r\n    return routs ? (\r\n      <Switch>\r\n        {lineRouts.map((route: IRoute, index: number) => {\r\n          const hasRole = Boolean(route.roles);\r\n          const isVisible = !hasRole || route.roles?.some(role => SecurityService.hasRole(role));\r\n\r\n          if (!isVisible) {\r\n            return null;\r\n          }\r\n\r\n          return (\r\n            <Route\r\n              strict\r\n              key={index}\r\n              path={route.path}\r\n              exact={route.exact}\r\n              children={route.main ? <route.main /> : children}\r\n            />\r\n          );\r\n        })}\r\n        {mainCategoryRedirect && needRedirect && <Redirect to={mainCategoryRedirect} />}\r\n      </Switch>\r\n    ) : (\r\n      children\r\n    );\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <SingInit />\r\n      <Menu />\r\n\r\n      {config && (\r\n        <PageMenu header={pageMenuHeader} topFragment={menuTopFragment}>\r\n          <PageMenuInner config={config} />\r\n        </PageMenu>\r\n      )}\r\n\r\n      <TopBar hasIncopleteRole={hasIncopleteRole}>\r\n        {title && title}\r\n        {config ? <TopBarRoute routs={config} topBarHeading={topBarHeading} /> : topBarHeading}\r\n      </TopBar>\r\n\r\n      <Wrap className=\"wrap\">\r\n        <Container className={containerClassName}>\r\n          {isLoading && <LoadingWrapp height=\"100vh\" />}\r\n          <Wrapper>{renderMainContent(config)}</Wrapper>\r\n        </Container>\r\n        <Footer hasIncreasedIndent={!!config} />\r\n      </Wrap>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Layout;\r\n"]},"metadata":{},"sourceType":"module"}