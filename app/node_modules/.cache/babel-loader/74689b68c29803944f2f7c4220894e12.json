{"ast":null,"code":"import _createForOfIteratorHelper from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createForOfIteratorHelper\";import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(ducumentsSign),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(ducumentsSignContainer),_marked3=/*#__PURE__*/_regeneratorRuntime.mark(sagaSign),_marked4=/*#__PURE__*/_regeneratorRuntime.mark(sagaSignContainer);import{takeLatest,select,put,call}from'redux-saga/effects';import{Flash}from'../../../../common/flash/Flash';import{actionDocumentRequest,actionSign,actionSignFailure,actionSignRequest,actionSignSuccess,actionSignContainer,actionSignContainerRequest,actionSignContainerFailure,actionSignContainerSuccess}from'../actions';import{selectSelected,selectList}from'../selects';import{DocumentsApiServices}from'../../services/documents.api';export function ducumentsSign(){return _regeneratorRuntime.wrap(function ducumentsSign$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return takeLatest(actionSign,sagaSign);case 2:case\"end\":return _context.stop();}}},_marked);}export function ducumentsSignContainer(){return _regeneratorRuntime.wrap(function ducumentsSignContainer$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return takeLatest(actionSignContainer,sagaSignContainer);case 2:case\"end\":return _context2.stop();}}},_marked2);}function sagaSign(){var documents,selected,signDocuments,message;return _regeneratorRuntime.wrap(function sagaSign$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return select(selectList);case 2:documents=_context3.sent;_context3.next=5;return select(selectSelected);case 5:selected=_context3.sent;signDocuments=documents.filter(function(doc){return selected.includes(doc.packageId);});_context3.next=9;return put(actionSignRequest());case 9:_context3.prev=9;_context3.next=12;return call(DocumentsApiServices.signDocument,signDocuments);case 12:_context3.next=14;return put(actionDocumentRequest({}));case 14:_context3.next=16;return put(actionSignSuccess());case 16:_context3.next=25;break;case 18:_context3.prev=18;_context3.t0=_context3[\"catch\"](9);message=_context3.t0.message;_context3.next=23;return put(actionSignFailure(message));case 23:_context3.next=25;return Flash.error(message||'Возникла ошибка при подписании');case 25:case\"end\":return _context3.stop();}}},_marked3,null,[[9,18]]);}function sagaSignContainer(){var documents,selected,companies,signDocuments,_iterator,_step,toCompanyName,count,message;return _regeneratorRuntime.wrap(function sagaSignContainer$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return select(selectList);case 2:documents=_context4.sent;_context4.next=5;return select(selectSelected);case 5:selected=_context4.sent;companies=[];signDocuments=documents.filter(function(doc){return selected.includes(doc.packageId);});_iterator=_createForOfIteratorHelper(signDocuments);try{for(_iterator.s();!(_step=_iterator.n()).done;){toCompanyName=_step.value.toCompanyName;companies.push(toCompanyName);}}catch(err){_iterator.e(err);}finally{_iterator.f();}count=companies.filter(function(current,index){return companies.indexOf(current)===index;}).length;_context4.prev=11;if(!(count>1)){_context4.next=14;break;}throw new Error('Для отправки пакетом надо выбрать одинаковых получателей');case 14:_context4.next=16;return put(actionSignContainerRequest());case 16:_context4.next=18;return call(DocumentsApiServices.signContainer,signDocuments);case 18:_context4.next=20;return put(actionSignContainerSuccess());case 20:_context4.next=22;return put(actionDocumentRequest({}));case 22:_context4.next=31;break;case 24:_context4.prev=24;_context4.t0=_context4[\"catch\"](11);message=_context4.t0.message;_context4.next=29;return put(actionSignContainerFailure(message));case 29:_context4.next=31;return Flash.error(message||'Возникла ошибка при подписании');case 31:case\"end\":return _context4.stop();}}},_marked4,null,[[11,24]]);}","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/documents/store/sagas/sign.effect.ts"],"names":["ducumentsSign","ducumentsSignContainer","sagaSign","sagaSignContainer","takeLatest","select","put","call","Flash","actionDocumentRequest","actionSign","actionSignFailure","actionSignRequest","actionSignSuccess","actionSignContainer","actionSignContainerRequest","actionSignContainerFailure","actionSignContainerSuccess","selectSelected","selectList","DocumentsApiServices","documents","selected","signDocuments","filter","doc","includes","packageId","signDocument","message","error","companies","toCompanyName","push","count","current","index","indexOf","length","Error","signContainer"],"mappings":"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","sourcesContent":["import { takeLatest, select, put, call } from 'redux-saga/effects';\r\n\r\nimport { Flash } from '../../../../common/flash/Flash';\r\n\r\nimport {\r\n  actionDocumentRequest,\r\n  actionSign,\r\n  actionSignFailure,\r\n  actionSignRequest,\r\n  actionSignSuccess,\r\n  actionSignContainer,\r\n  actionSignContainerRequest,\r\n  actionSignContainerFailure,\r\n  actionSignContainerSuccess\r\n} from '../actions';\r\nimport { selectSelected, selectList } from '../selects';\r\nimport { DocumentsApiServices } from '../../services/documents.api';\r\nimport { DocumentType } from '../../helpers/documents.typings';\r\n\r\nexport function* ducumentsSign() {\r\n  yield takeLatest(actionSign, sagaSign);\r\n}\r\n\r\nexport function* ducumentsSignContainer() {\r\n  yield takeLatest(actionSignContainer, sagaSignContainer);\r\n}\r\n\r\nfunction* sagaSign() {\r\n  const documents: DocumentType[] = yield select(selectList);\r\n  const selected: string[] = yield select(selectSelected);\r\n\r\n  const signDocuments = documents.filter(doc => selected.includes(doc.packageId));\r\n\r\n  yield put(actionSignRequest());\r\n  try {\r\n    yield call(DocumentsApiServices.signDocument, signDocuments);\r\n    yield put(actionDocumentRequest({}));\r\n    yield put(actionSignSuccess());\r\n  } catch ({ message }) {\r\n    yield put(actionSignFailure(message));\r\n    yield Flash.error(message || 'Возникла ошибка при подписании');\r\n  }\r\n}\r\n\r\nfunction* sagaSignContainer() {\r\n  const documents: DocumentType[] = yield select(selectList);\r\n  const selected: string[] = yield select(selectSelected);\r\n\r\n  const companies: string[] = [];\r\n  const signDocuments = documents.filter(doc => selected.includes(doc.packageId));\r\n\r\n  for (const { toCompanyName } of signDocuments) {\r\n    companies.push(toCompanyName);\r\n  }\r\n\r\n  const count = companies.filter((current, index) => companies.indexOf(current) === index).length;\r\n  try {\r\n    if (count > 1) {\r\n      throw new Error('Для отправки пакетом надо выбрать одинаковых получателей');\r\n    }\r\n\r\n    yield put(actionSignContainerRequest());\r\n    yield call(DocumentsApiServices.signContainer, signDocuments);\r\n    yield put(actionSignContainerSuccess());\r\n    yield put(actionDocumentRequest({}));\r\n  } catch ({ message }) {\r\n    yield put(actionSignContainerFailure(message));\r\n    yield Flash.error(message || 'Возникла ошибка при подписании');\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}