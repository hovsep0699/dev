{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(ducumentDownload),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(sagaDocumentDownload);import{takeLatest,call,select,put}from'redux-saga/effects';import{Flash}from'../../../../common/flash/Flash';import{DocumentsApiServices}from'../../services/documents.api';import{selectSelected,selectList}from'../selects';import{actionDocumentDownloadRequest,actionDocumentDownloadSuccess,actionDocumentDownloadFailure}from'../actions';export function ducumentDownload(){return _regeneratorRuntime.wrap(function ducumentDownload$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return takeLatest(actionDocumentDownloadRequest,sagaDocumentDownload);case 2:case\"end\":return _context.stop();}}},_marked);}function sagaDocumentDownload(_ref){var ids,selected,items,isCorrect,message;return _regeneratorRuntime.wrap(function sagaDocumentDownload$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:ids=_ref.payload.ids;if(!ids){_context2.next=5;break;}_context2.t0=ids;_context2.next=8;break;case 5:_context2.next=7;return select(selectSelected);case 7:_context2.t0=_context2.sent;case 8:selected=_context2.t0;_context2.next=11;return select(selectList);case 11:items=_context2.sent;isCorrect=items.filter(function(item){return selected.includes(item.packageId);}).every(function(item){return item.isSavedCorrectly;});_context2.prev=13;if(isCorrect){_context2.next=16;break;}throw new Error('Документ содержит ошибки. Скачивание невозможно.');case 16:_context2.next=18;return call(DocumentsApiServices.download,selected);case 18:_context2.next=20;return put(actionDocumentDownloadSuccess());case 20:_context2.next=28;break;case 22:_context2.prev=22;_context2.t1=_context2[\"catch\"](13);message=_context2.t1.message;_context2.next=27;return put(actionDocumentDownloadFailure());case 27:Flash.error(message||'Документ содержит ошибки. Скачивание невозможно.');case 28:case\"end\":return _context2.stop();}}},_marked2,null,[[13,22]]);}","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/documents/store/sagas/download.effect.ts"],"names":["ducumentDownload","sagaDocumentDownload","takeLatest","call","select","put","Flash","DocumentsApiServices","selectSelected","selectList","actionDocumentDownloadRequest","actionDocumentDownloadSuccess","actionDocumentDownloadFailure","ids","payload","selected","items","isCorrect","filter","item","includes","packageId","every","isSavedCorrectly","Error","download","message","error"],"mappings":"oNAgBiBA,gB,iDAMPC,oB,EAtBV,OAASC,UAAT,CAAqBC,IAArB,CAA2BC,MAA3B,CAAmCC,GAAnC,KAA8C,oBAA9C,CAEA,OAASC,KAAT,KAAsB,gCAAtB,CACA,OAASC,oBAAT,KAAqC,8BAArC,CAMA,OAASC,cAAT,CAAyBC,UAAzB,KAA2C,YAA3C,CACA,OACEC,6BADF,CAEEC,6BAFF,CAGEC,6BAHF,KAIO,YAJP,CAMA,MAAO,SAAUZ,CAAAA,gBAAV,4IACL,MAAME,CAAAA,UAAU,CAACQ,6BAAD,CAAgCT,oBAAhC,CAAhB,CADK,sDAMP,QAAUA,CAAAA,oBAAV,gLAA4CY,GAA5C,MAAiCC,OAAjC,CAA4CD,GAA5C,KAC6BA,GAD7B,uCACmCA,GADnC,gDACyC,MAAMT,CAAAA,MAAM,CAACI,cAAD,CAAZ,CADzC,0CACQO,QADR,gCAEgC,MAAMX,CAAAA,MAAM,CAACK,UAAD,CAAZ,CAFhC,QAEQO,KAFR,gBAGQC,SAHR,CAGoBD,KAAK,CACpBE,MADe,CACR,SAAAC,IAAI,QAAIJ,CAAAA,QAAQ,CAACK,QAAT,CAAkBD,IAAI,CAACE,SAAvB,CAAJ,EADI,EAEfC,KAFe,CAET,SAAAH,IAAI,QAAIA,CAAAA,IAAI,CAACI,gBAAT,EAFK,CAHpB,sBAQSN,SART,gCASY,IAAIO,CAAAA,KAAJ,CAAU,kDAAV,CATZ,2BAYI,MAAMrB,CAAAA,IAAI,CAACI,oBAAoB,CAACkB,QAAtB,CAAgCV,QAAhC,CAAV,CAZJ,0BAaI,MAAMV,CAAAA,GAAG,CAACM,6BAA6B,EAA9B,CAAT,CAbJ,8FAcae,OAdb,cAcaA,OAdb,mBAeI,MAAMrB,CAAAA,GAAG,CAACO,6BAA6B,EAA9B,CAAT,CAfJ,QAgBIN,KAAK,CAACqB,KAAN,CAAYD,OAAO,EAAI,kDAAvB,EAhBJ","sourcesContent":["import { takeLatest, call, select, put } from 'redux-saga/effects';\r\n\r\nimport { Flash } from '../../../../common/flash/Flash';\r\nimport { DocumentsApiServices } from '../../services/documents.api';\r\nimport {\r\n  DefaultState,\r\n  DocumentType,\r\n  ADocumentDownloadPayload\r\n} from '../../helpers/documents.typings';\r\nimport { selectSelected, selectList } from '../selects';\r\nimport {\r\n  actionDocumentDownloadRequest,\r\n  actionDocumentDownloadSuccess,\r\n  actionDocumentDownloadFailure\r\n} from '../actions';\r\n\r\nexport function* ducumentDownload() {\r\n  yield takeLatest(actionDocumentDownloadRequest, sagaDocumentDownload);\r\n}\r\n\r\ntype Selected = Pick<DefaultState, 'selected'>['selected'];\r\n\r\nfunction* sagaDocumentDownload({ payload: { ids } }: ADocumentDownloadPayload) {\r\n  const selected: Selected = ids ? ids : yield select(selectSelected);\r\n  const items: DocumentType[] = yield select(selectList);\r\n  const isCorrect = items\r\n    .filter(item => selected.includes(item.packageId))\r\n    .every(item => item.isSavedCorrectly);\r\n\r\n  try {\r\n    if (!isCorrect) {\r\n      throw new Error('Документ содержит ошибки. Скачивание невозможно.');\r\n    }\r\n\r\n    yield call(DocumentsApiServices.download, selected);\r\n    yield put(actionDocumentDownloadSuccess());\r\n  } catch ({ message }) {\r\n    yield put(actionDocumentDownloadFailure());\r\n    Flash.error(message || 'Документ содержит ошибки. Скачивание невозможно.');\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}