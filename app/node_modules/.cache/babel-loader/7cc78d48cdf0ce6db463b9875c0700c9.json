{"ast":null,"code":"import _classCallCheck from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _get from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/get\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\nimport SignHandlerBase from '../SignHandlerBase';\nimport Environment from '../../../Environment';\nimport SignRequest from '../../SignRequest';\nimport DocumentContentHandler from './DocumentContentHandler';\nimport CreateSignHandler from './CreateSignHandler';\nimport SendSignHandler from './SendSignHandler';\n\nvar SendDocumentHandler = /*#__PURE__*/function (_SignHandlerBase) {\n  _inherits(SendDocumentHandler, _SignHandlerBase);\n\n  var _super = _createSuper(SendDocumentHandler);\n\n  function SendDocumentHandler() {\n    _classCallCheck(this, SendDocumentHandler);\n\n    return _super.apply(this, arguments);\n  }\n\n  _createClass(SendDocumentHandler, [{\n    key: \"sign\",\n    value: function sign(request) {\n      var _this = this;\n\n      _get(_getPrototypeOf(SendDocumentHandler.prototype), \"sign\", this).call(this, request);\n\n      if (this.canHandle(request)) {\n        var successHandler = function successHandler(response) {\n          var _a;\n\n          if (response.id && ['invoice', 'invoice_correction'].includes(request.documentToSign.flowType)) {\n            var invoiceRequest = new SignRequest({\n              certificate: request.certificate,\n              isGrantedToSign: request.isGrantedToSign,\n              documentToSign: response\n            });\n            var documentContentHandler = new DocumentContentHandler();\n            var createSignHandler = new CreateSignHandler();\n            var sendSignHandler = new SendSignHandler();\n            documentContentHandler.setNext(createSignHandler).setNext(sendSignHandler);\n            var invoiceResponse = documentContentHandler.sign(invoiceRequest);\n            console.log('invoiceResponse', invoiceResponse);\n          }\n\n          if ((_a = response.data) === null || _a === void 0 ? void 0 : _a.success) {\n            return _this.doNextHandler(SignRequest.clone(request));\n          } else {\n            return failHandler(response);\n          }\n        };\n\n        var failHandler = function failHandler(error) {\n          var failureRequest = SignRequest.clone(request);\n          failureRequest.addSignFailure({\n            id: request.documentToSign.id,\n            step: 'SendDocumentHandler',\n            error: error\n          });\n          return _this.doNextHandler(failureRequest);\n        };\n\n        var document = request.documentToSign;\n        return Environment.getSignGateway().sendDocument(document.id, document.flowType, document.flowGroup).then(successHandler).catch(failHandler);\n      }\n\n      return this.doNextHandler(request);\n    }\n  }, {\n    key: \"canHandle\",\n    value: function canHandle(request) {\n      _get(_getPrototypeOf(SendDocumentHandler.prototype), \"canHandle\", this).call(this, request);\n\n      var docIsSigned = request.signedDocumentIds.has(request.documentToSign.packageId);\n      return !!request.certificate && request.isGrantedToSign && docIsSigned;\n    }\n  }]);\n\n  return SendDocumentHandler;\n}(SignHandlerBase);\n\nexport default SendDocumentHandler;","map":{"version":3,"sources":["../../../../../src/application/sign/handlers/sign/SendDocumentHandler.js"],"names":[],"mappings":";;;;;;AAAA,OAAO,eAAP,MAA4B,oBAA5B;AACA,OAAO,WAAP,MAAwB,sBAAxB;AACA,OAAO,WAAP,MAAwB,mBAAxB;AACA,OAAO,sBAAP,MAAmC,0BAAnC;AACA,OAAO,iBAAP,MAA8B,qBAA9B;AACA,OAAO,eAAP,MAA4B,mBAA5B;;IAEM,mB;;;;;;;;;;;;;yBACC,O,EAAO;AAAA;;AACV,oFAAW,OAAX;;AACA,UAAI,KAAK,SAAL,CAAe,OAAf,CAAJ,EAA6B;AAC3B,YAAM,cAAc,GAAG,SAAjB,cAAiB,CAAA,QAAQ,EAAG;;;AAChC,cACE,QAAQ,CAAC,EAAT,IACA,CAAC,SAAD,EAAY,oBAAZ,EAAkC,QAAlC,CAA2C,OAAO,CAAC,cAAR,CAAuB,QAAlE,CAFF,EAGE;AACA,gBAAM,cAAc,GAAG,IAAI,WAAJ,CAAgB;AACrC,cAAA,WAAW,EAAE,OAAO,CAAC,WADgB;AAErC,cAAA,eAAe,EAAE,OAAO,CAAC,eAFY;AAGrC,cAAA,cAAc,EAAE;AAHqB,aAAhB,CAAvB;AAKA,gBAAM,sBAAsB,GAAG,IAAI,sBAAJ,EAA/B;AACA,gBAAM,iBAAiB,GAAG,IAAI,iBAAJ,EAA1B;AACA,gBAAM,eAAe,GAAG,IAAI,eAAJ,EAAxB;AACA,YAAA,sBAAsB,CAAC,OAAvB,CAA+B,iBAA/B,EAAkD,OAAlD,CAA0D,eAA1D;AACA,gBAAM,eAAe,GAAG,sBAAsB,CAAC,IAAvB,CAA4B,cAA5B,CAAxB;AACA,YAAA,OAAO,CAAC,GAAR,CAAY,iBAAZ,EAA+B,eAA/B;AACD;;AACD,cAAA,CAAA,EAAA,GAAI,QAAQ,CAAC,IAAb,MAAiB,IAAjB,IAAiB,EAAA,KAAA,KAAA,CAAjB,GAAiB,KAAA,CAAjB,GAAiB,EAAA,CAAE,OAAnB,EAA4B;AAC1B,mBAAO,KAAI,CAAC,aAAL,CAAmB,WAAW,CAAC,KAAZ,CAAkB,OAAlB,CAAnB,CAAP;AACD,WAFD,MAEO;AACL,mBAAO,WAAW,CAAC,QAAD,CAAlB;AACD;AACF,SAtBD;;AAwBA,YAAM,WAAW,GAAG,SAAd,WAAc,CAAA,KAAK,EAAG;AAC1B,cAAM,cAAc,GAAG,WAAW,CAAC,KAAZ,CAAkB,OAAlB,CAAvB;AACA,UAAA,cAAc,CAAC,cAAf,CAA8B;AAC5B,YAAA,EAAE,EAAE,OAAO,CAAC,cAAR,CAAuB,EADC;AAE5B,YAAA,IAAI,EAAE,qBAFsB;AAG5B,YAAA,KAAK,EAAL;AAH4B,WAA9B;AAKA,iBAAO,KAAI,CAAC,aAAL,CAAmB,cAAnB,CAAP;AACD,SARD;;AASA,YAAM,QAAQ,GAAG,OAAO,CAAC,cAAzB;AACA,eAAO,WAAW,CAAC,cAAZ,GACJ,YADI,CACS,QAAQ,CAAC,EADlB,EACsB,QAAQ,CAAC,QAD/B,EACyC,QAAQ,CAAC,SADlD,EAEJ,IAFI,CAEC,cAFD,EAGJ,KAHI,CAGE,WAHF,CAAP;AAID;;AACD,aAAO,KAAK,aAAL,CAAmB,OAAnB,CAAP;AACD;;;8BAES,O,EAAO;AACf,yFAAgB,OAAhB;;AACA,UAAM,WAAW,GAAG,OAAO,CAAC,iBAAR,CAA0B,GAA1B,CAA8B,OAAO,CAAC,cAAR,CAAuB,SAArD,CAApB;AACA,aAAO,CAAC,CAAC,OAAO,CAAC,WAAV,IAAyB,OAAO,CAAC,eAAjC,IAAoD,WAA3D;AACD;;;;EAlD+B,e;;AAqDlC,eAAe,mBAAf","sourceRoot":"","sourcesContent":["import SignHandlerBase from '../SignHandlerBase';\r\nimport Environment from '../../../Environment';\r\nimport SignRequest from '../../SignRequest';\r\nimport DocumentContentHandler from './DocumentContentHandler';\r\nimport CreateSignHandler from './CreateSignHandler';\r\nimport SendSignHandler from './SendSignHandler';\r\nclass SendDocumentHandler extends SignHandlerBase {\r\n    sign(request) {\r\n        super.sign(request);\r\n        if (this.canHandle(request)) {\r\n            const successHandler = response => {\r\n                var _a;\r\n                if (response.id &&\r\n                    ['invoice', 'invoice_correction'].includes(request.documentToSign.flowType)) {\r\n                    const invoiceRequest = new SignRequest({\r\n                        certificate: request.certificate,\r\n                        isGrantedToSign: request.isGrantedToSign,\r\n                        documentToSign: response\r\n                    });\r\n                    const documentContentHandler = new DocumentContentHandler();\r\n                    const createSignHandler = new CreateSignHandler();\r\n                    const sendSignHandler = new SendSignHandler();\r\n                    documentContentHandler.setNext(createSignHandler).setNext(sendSignHandler);\r\n                    const invoiceResponse = documentContentHandler.sign(invoiceRequest);\r\n                    console.log('invoiceResponse', invoiceResponse);\r\n                }\r\n                if ((_a = response.data) === null || _a === void 0 ? void 0 : _a.success) {\r\n                    return this.doNextHandler(SignRequest.clone(request));\r\n                }\r\n                else {\r\n                    return failHandler(response);\r\n                }\r\n            };\r\n            const failHandler = error => {\r\n                const failureRequest = SignRequest.clone(request);\r\n                failureRequest.addSignFailure({\r\n                    id: request.documentToSign.id,\r\n                    step: 'SendDocumentHandler',\r\n                    error\r\n                });\r\n                return this.doNextHandler(failureRequest);\r\n            };\r\n            const document = request.documentToSign;\r\n            return Environment.getSignGateway()\r\n                .sendDocument(document.id, document.flowType, document.flowGroup)\r\n                .then(successHandler)\r\n                .catch(failHandler);\r\n        }\r\n        return this.doNextHandler(request);\r\n    }\r\n    canHandle(request) {\r\n        super.canHandle(request);\r\n        const docIsSigned = request.signedDocumentIds.has(request.documentToSign.packageId);\r\n        return !!request.certificate && request.isGrantedToSign && docIsSigned;\r\n    }\r\n}\r\nexport default SendDocumentHandler;\r\n//# sourceMappingURL=SendDocumentHandler.js.map"]},"metadata":{},"sourceType":"module"}