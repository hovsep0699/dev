{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{useDispatch,useSelector}from'react-redux';import{Button,ButtonKinds,Icons,Input,Autocomplete}from'@distate/components';import AutocompleteGateway from'@distate/core/dist/application/autocomplete/AutocompleteGateway';import SecurityService from'@distate/core/dist/application/security/SecurityService';import{editDetails,clearErrors,getCompanyDetails}from'../../store/actions';import{selectKppError,selectOkpoError,selectAccountNumberError,selectTaxAuthorityError,selectBikError,selectName,selectDiServerId,selectInn,selectKpp,selectOkpo,selectOgrn,selectOgrnip,selectTaxAuthority,selectAccountNumber,selectBik,selectCompanyType}from'../../store/selectors';/** # Реквизиты компании */export var CompanyDetails=function CompanyDetails(){var companyName=useSelector(selectName);var diServerId=useSelector(selectDiServerId);var inn=useSelector(selectInn);var initialKpp=useSelector(selectKpp);var initialOkpo=useSelector(selectOkpo);var ogrn=useSelector(selectOgrn);var ogrnip=useSelector(selectOgrnip);var initialTaxAuthority=useSelector(selectTaxAuthority);var initialBik=useSelector(selectBik);var initialAccountNumber=useSelector(selectAccountNumber);var companyType=useSelector(selectCompanyType);var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isEditable=_useState2[0],setIsEditable=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),kpp=_useState4[0],setKpp=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),okpo=_useState6[0],setOkpo=_useState6[1];/** Код налогового органа */var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),code=_useState8[0],setCode=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),bik=_useState10[0],setBik=_useState10[1];/** Номер расчётного счёта */var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),accountNumber=_useState12[0],setAccountNumber=_useState12[1];var kppError=useSelector(selectKppError);var okpoError=useSelector(selectOkpoError);var accountNumberError=useSelector(selectAccountNumberError);var taxAuthorityError=useSelector(selectTaxAuthorityError);var bikError=useSelector(selectBikError);/** флаг незаполненных обязательных данных для регистрации */var hasIncopleteRole=useSelector(function(state){return state.sign.hasRoleIncomplete;});var dispatch=useDispatch();var autocompleteGateway=new AutocompleteGateway();useEffect(function(){setKpp(initialKpp);setOkpo(initialOkpo);setBik({label:initialBik,value:initialBik});setCode({label:initialTaxAuthority===null||initialTaxAuthority===void 0?void 0:initialTaxAuthority.code,value:initialTaxAuthority===null||initialTaxAuthority===void 0?void 0:initialTaxAuthority.id});setAccountNumber(initialAccountNumber);},[initialBik,initialTaxAuthority,initialAccountNumber,initialKpp,initialOkpo]);useEffect(function(){dispatch(getCompanyDetails());/** очистка старых ошибок при первом входе */dispatch(clearErrors());/** получение прав на редактирование */var role=SecurityService.hasRole('ROLE_COMPANY_EDITOR');setIsEditable(role);},[dispatch]);var onSubmit=function onSubmit(){var props={okpo:okpo,accountNumber:accountNumber,bik:bik&&bik.value,kpp:kpp&&kpp,hasIncopleteRole:hasIncopleteRole,taxAuthority:code===null||code===void 0?void 0:code.value};dispatch(editDetails(props));};/** загрузка подходящих кодов налогового органа в автокомплите */var codeLoad=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(raw,callback){var _yield$autocompleteGa,_yield$autocompleteGa2,rows,dataToOptions;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return autocompleteGateway.getIFNSByCode(raw);case 2:_yield$autocompleteGa=_context.sent;_yield$autocompleteGa2=_yield$autocompleteGa.rows;rows=_yield$autocompleteGa2===void 0?[]:_yield$autocompleteGa2;dataToOptions=rows.map(function(item){return{value:item.id,label:item.code};});callback(dataToOptions);case 7:case\"end\":return _context.stop();}}},_callee);}));return function codeLoad(_x,_x2){return _ref.apply(this,arguments);};}();/** загрузка подходящих БИК в автокомплите */var bikLoad=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(raw,callback){var _yield$autocompleteGa3,_yield$autocompleteGa4,rows,dataToOptions;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return autocompleteGateway.getBankByBIK(raw);case 2:_yield$autocompleteGa3=_context2.sent;_yield$autocompleteGa4=_yield$autocompleteGa3.rows;rows=_yield$autocompleteGa4===void 0?[]:_yield$autocompleteGa4;dataToOptions=rows.map(function(item){return{value:item.bik,label:item.bik};});callback(dataToOptions);case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function bikLoad(_x3,_x4){return _ref2.apply(this,arguments);};}();var setKppHandler=function setKppHandler(targetValue){var value=targetValue.trim();if(value.length<=9&&!isNaN(+value)){setKpp(value);}};var setOkpoHandler=function setOkpoHandler(targetValue){var value=targetValue.trim();var maxLength;if(companyType==='IP'){maxLength=10;}else{maxLength=8;}if(value.length<=maxLength&&!isNaN(+value)){setOkpo(value);}};var setAccountNumberHandler=function setAccountNumberHandler(targetValue){var value=targetValue.trim();if(value.length<=20&&!isNaN(+value)){setAccountNumber(value);}};var isIp=companyType==='IP';return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center\"},/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_name\"},\"\\u0418\\u0434\\u0435\\u043D\\u0442\\u0438\\u0444\\u0438\\u043A\\u0430\\u0442\\u043E\\u0440 \\u0443\\u0447\\u0430\\u0441\\u0442\\u043D\\u0438\\u043A\\u0430\"),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_value\"},diServerId)),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_name\"},\"\\u041E\\u0440\\u0433\\u0430\\u043D\\u0438\\u0437\\u0430\\u0446\\u0438\\u044F\"),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_value\"},companyName)),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_name\"},\"\\u0418\\u041D\\u041D\"),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_value\"},inn)),!isIp&&/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_name\"},\"\\u041A\\u041F\\u041F *\"),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_value\"},/*#__PURE__*/React.createElement(Input,{required:true,name:\"kpp\",width:320,value:kpp,onChange:function onChange(e){return setKppHandler(e.target.value);},error:!!kppError,errors:kppError,title:\"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 9-\\u0437\\u043D\\u0430\\u0447\\u043D\\u044B\\u0439 \\u041A\\u043E\\u0434 \\u041F\\u0440\\u0438\\u0447\\u0438\\u043D\\u044B \\u041F\\u043E\\u0441\\u0442\\u0430\\u043D\\u043E\\u0432\\u043A\\u0438 \\u043D\\u0430 \\u0443\\u0447\\u0435\\u0442\",disabled:!isEditable}))),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_name\"},\"\\u041E\\u041A\\u041F\\u041E\"),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_value\"},/*#__PURE__*/React.createElement(Input,{width:320,name:\"okpo\",value:okpo,onChange:function onChange(e){return setOkpoHandler(e.target.value);},error:!!okpoError,errors:okpoError,title:\"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 8-\\u0437\\u043D\\u0430\\u0447\\u043D\\u044B\\u0439 \\u043A\\u043E\\u0434 \\u043F\\u043E \\u041E\\u0431\\u0449\\u0435\\u0440\\u043E\\u0441\\u0441\\u0438\\u0439\\u0441\\u043A\\u043E\\u043C\\u0443 \\u041A\\u043B\\u0430\\u0441\\u0441\\u0438\\u0444\\u0438\\u043A\\u0430\\u0442\\u043E\\u0440\\u0443 \\u041F\\u0440\\u0435\\u0434\\u043F\\u0440\\u0438\\u044F\\u0442\\u0438\\u0439 \\u0438 \\u041E\\u0440\\u0433\\u0430\\u043D\\u0438\\u0437\\u0430\\u0446\\u0438\\u0439\",disabled:!isEditable}))),isIp?/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_name\"},\"\\u041E\\u0413\\u0420\\u041D\\u0418\\u041F\"),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_value\"},ogrnip)):/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_name\"},\"\\u041E\\u0413\\u0420\\u041D\"),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_value\"},ogrn)),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_name\"},\"\\u041A\\u043E\\u0434 \\u043D\\u0430\\u043B\\u043E\\u0433\\u043E\\u0432\\u043E\\u0433\\u043E \\u043E\\u0440\\u0433\\u0430\\u043D\\u0430 *\"),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_value\"},/*#__PURE__*/React.createElement(Autocomplete,{name:\"code\",width:320,value:code,loadOptions:codeLoad,onChange:function onChange(e){return setCode(e);},placeholder:\"\",error:!!taxAuthorityError,errors:taxAuthorityError,required:true,title:\"\\u041D\\u0430\\u0447\\u043D\\u0438\\u0442\\u0435 \\u0432\\u0432\\u043E\\u0434\\u0438\\u0442\\u044C \\xAB\\u041A\\u043E\\u0434 \\u043D\\u0430\\u043B\\u043E\\u0433\\u043E\\u0432\\u043E\\u0433\\u043E \\u043E\\u0440\\u0433\\u0430\\u043D\\u0430\\xBB \\u0438 \\u0432\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0435\\u0433\\u043E \\u0438\\u0437 \\u0432\\u044B\\u043F\\u0430\\u0434\\u0430\\u044E\\u0449\\u0435\\u0433\\u043E \\u0441\\u043F\\u0438\\u0441\\u043A\\u0430\",disabled:!isEditable}))),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_name\"},\"\\u0411\\u0418\\u041A\"),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_value\"},/*#__PURE__*/React.createElement(Autocomplete,{name:\"bik\",width:320,value:bik,loadOptions:bikLoad,onChange:function onChange(e){return setBik(e);},placeholder:\"\",error:!!bikError,errors:bikError,title:\"\\u041D\\u0430\\u0447\\u043D\\u0438\\u0442\\u0435 \\u0432\\u0432\\u043E\\u0434\\u0438\\u0442\\u044C \\xAB\\u0411\\u0430\\u043D\\u043A\\u043E\\u0432\\u0441\\u043A\\u0438\\u0439 \\u0438\\u0434\\u0435\\u043D\\u0442\\u0438\\u0444\\u0438\\u043A\\u0430\\u0446\\u0438\\u043E\\u043D\\u043D\\u044B\\u0439 \\u043A\\u043E\\u0434\\xBB \\u0438 \\u0432\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0435\\u0433\\u043E \\u0438\\u0437 \\u0432\\u044B\\u043F\\u0430\\u0434\\u0430\\u044E\\u0449\\u0435\\u0433\\u043E \\u0441\\u043F\\u0438\\u0441\\u043A\\u0430\",disabled:!isEditable}))),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_name\"},\"\\u041D\\u043E\\u043C\\u0435\\u0440 \\u0440\\u0430\\u0441\\u0447\\u0451\\u0442\\u043D\\u043E\\u0433\\u043E \\u0441\\u0447\\u0451\\u0442\\u0430\"),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_value\"},/*#__PURE__*/React.createElement(Input,{width:320,name:\"accountNumber\",value:accountNumber,onChange:function onChange(e){return setAccountNumberHandler(e.target.value);},error:!!accountNumberError,errors:accountNumberError,title:\"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 20-\\u0437\\u043D\\u0430\\u0447\\u043D\\u044B\\u0439 \\xAB\\u041D\\u043E\\u043C\\u0435\\u0440 \\u0440\\u0430\\u0441\\u0447\\u0451\\u0442\\u043D\\u043E\\u0433\\u043E \\u0441\\u0447\\u0451\\u0442\\u0430\\xBB\",disabled:!isEditable})))),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),isEditable&&/*#__PURE__*/React.createElement(Button,{icon:/*#__PURE__*/React.createElement(Icons.IconCheck,{fill:\"currentColor\"}),kind:ButtonKinds.Orange,onClick:onSubmit},\"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C \\u0434\\u0430\\u043D\\u043D\\u044B\\u0435 \\u043A\\u043E\\u043C\\u043F\\u0430\\u043D\\u0438\\u0438\"));};","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/company/components/company-details/CompanyDetails.tsx"],"names":["React","useState","useEffect","useDispatch","useSelector","Button","ButtonKinds","Icons","Input","Autocomplete","AutocompleteGateway","SecurityService","editDetails","clearErrors","getCompanyDetails","selectKppError","selectOkpoError","selectAccountNumberError","selectTaxAuthorityError","selectBikError","selectName","selectDiServerId","selectInn","selectKpp","selectOkpo","selectOgrn","selectOgrnip","selectTaxAuthority","selectAccountNumber","selectBik","selectCompanyType","CompanyDetails","companyName","diServerId","inn","initialKpp","initialOkpo","ogrn","ogrnip","initialTaxAuthority","initialBik","initialAccountNumber","companyType","isEditable","setIsEditable","kpp","setKpp","okpo","setOkpo","code","setCode","bik","setBik","accountNumber","setAccountNumber","kppError","okpoError","accountNumberError","taxAuthorityError","bikError","hasIncopleteRole","state","sign","hasRoleIncomplete","dispatch","autocompleteGateway","label","value","id","role","hasRole","onSubmit","props","taxAuthority","codeLoad","raw","callback","getIFNSByCode","rows","dataToOptions","map","item","bikLoad","getBankByBIK","setKppHandler","targetValue","trim","length","isNaN","setOkpoHandler","maxLength","setAccountNumberHandler","isIp","e","target","Orange"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { Button, ButtonKinds, Icons, Input, Autocomplete } from '@distate/components';\r\nimport AutocompleteGateway from '@distate/core/dist/application/autocomplete/AutocompleteGateway';\r\nimport SecurityService from '@distate/core/dist/application/security/SecurityService';\r\nimport { editDetails, clearErrors, getCompanyDetails } from '../../store/actions';\r\nimport {\r\n  selectKppError,\r\n  selectOkpoError,\r\n  selectAccountNumberError,\r\n  selectTaxAuthorityError,\r\n  selectBikError,\r\n  selectName,\r\n  selectDiServerId,\r\n  selectInn,\r\n  selectKpp,\r\n  selectOkpo,\r\n  selectOgrn,\r\n  selectOgrnip,\r\n  selectTaxAuthority,\r\n  selectAccountNumber,\r\n  selectBik,\r\n  selectCompanyType\r\n} from '../../store/selectors';\r\n\r\ntype AutocompleteItem = {\r\n  label?: string;\r\n  value?: string;\r\n};\r\n\r\n/** # Реквизиты компании */\r\nexport const CompanyDetails = () => {\r\n  const companyName = useSelector(selectName);\r\n  const diServerId = useSelector(selectDiServerId);\r\n  const inn = useSelector(selectInn);\r\n  const initialKpp = useSelector(selectKpp);\r\n  const initialOkpo = useSelector(selectOkpo);\r\n  const ogrn = useSelector(selectOgrn);\r\n  const ogrnip = useSelector(selectOgrnip);\r\n  const initialTaxAuthority = useSelector(selectTaxAuthority);\r\n  const initialBik = useSelector(selectBik);\r\n  const initialAccountNumber = useSelector(selectAccountNumber);\r\n  const companyType = useSelector(selectCompanyType);\r\n\r\n  const [isEditable, setIsEditable] = useState(false);\r\n  const [kpp, setKpp] = useState<string>();\r\n  const [okpo, setOkpo] = useState<string>();\r\n  /** Код налогового органа */\r\n  const [code, setCode] = useState<AutocompleteItem>();\r\n  const [bik, setBik] = useState<AutocompleteItem>();\r\n  /** Номер расчётного счёта */\r\n  const [accountNumber, setAccountNumber] = useState<string>();\r\n\r\n  const kppError = useSelector(selectKppError);\r\n  const okpoError = useSelector(selectOkpoError);\r\n  const accountNumberError = useSelector(selectAccountNumberError);\r\n  const taxAuthorityError = useSelector(selectTaxAuthorityError);\r\n  const bikError = useSelector(selectBikError);\r\n  /** флаг незаполненных обязательных данных для регистрации */\r\n  const hasIncopleteRole = useSelector((state: any) => state.sign.hasRoleIncomplete);\r\n\r\n  const dispatch = useDispatch();\r\n  const autocompleteGateway = new AutocompleteGateway();\r\n\r\n  useEffect(() => {\r\n    setKpp(initialKpp);\r\n    setOkpo(initialOkpo);\r\n    setBik({ label: initialBik, value: initialBik });\r\n    setCode({ label: initialTaxAuthority?.code, value: initialTaxAuthority?.id });\r\n    setAccountNumber(initialAccountNumber);\r\n  }, [initialBik, initialTaxAuthority, initialAccountNumber, initialKpp, initialOkpo]);\r\n\r\n  useEffect(() => {\r\n    dispatch(getCompanyDetails());\r\n    /** очистка старых ошибок при первом входе */\r\n    dispatch(clearErrors());\r\n    /** получение прав на редактирование */\r\n    const role = SecurityService.hasRole('ROLE_COMPANY_EDITOR');\r\n    setIsEditable(role);\r\n  }, [dispatch]);\r\n\r\n  const onSubmit = () => {\r\n    const props = {\r\n      okpo,\r\n      accountNumber,\r\n      bik: bik && bik.value,\r\n      kpp: kpp && kpp,\r\n      hasIncopleteRole,\r\n      taxAuthority: code?.value\r\n    };\r\n    dispatch(editDetails(props));\r\n  };\r\n\r\n  /** загрузка подходящих кодов налогового органа в автокомплите */\r\n  const codeLoad = async (raw: string, callback: any) => {\r\n    const { rows = [] } = await autocompleteGateway.getIFNSByCode(raw);\r\n    const dataToOptions = rows.map((item: any) => {\r\n      return {\r\n        value: item.id,\r\n        label: item.code\r\n      };\r\n    });\r\n    callback(dataToOptions);\r\n  };\r\n\r\n  /** загрузка подходящих БИК в автокомплите */\r\n  const bikLoad = async (raw: string, callback: any) => {\r\n    const { rows = [] } = await autocompleteGateway.getBankByBIK(raw);\r\n    const dataToOptions = rows.map(\r\n      (item: any): AutocompleteItem => {\r\n        return {\r\n          value: item.bik,\r\n          label: item.bik\r\n        };\r\n      }\r\n    );\r\n    callback(dataToOptions);\r\n  };\r\n\r\n  const setKppHandler = (targetValue: string) => {\r\n    let value = targetValue.trim();\r\n    if (value.length <= 9 && !isNaN(+value)) {\r\n      setKpp(value);\r\n    }\r\n  };\r\n\r\n  const setOkpoHandler = (targetValue: string) => {\r\n    let value = targetValue.trim();\r\n    let maxLength;\r\n\r\n    if (companyType === 'IP') {\r\n      maxLength = 10\r\n    } else {\r\n      maxLength = 8\r\n    }\r\n    if (value.length <= maxLength && !isNaN(+value)) {\r\n      setOkpo(value);\r\n    }\r\n  };\r\n\r\n  const setAccountNumberHandler = (targetValue: string) => {\r\n    let value = targetValue.trim();\r\n    if (value.length <= 20 && !isNaN(+value)) {\r\n      setAccountNumber(value);\r\n    }\r\n  };\r\n\r\n  const isIp = companyType === 'IP';\r\n\r\n  return (\r\n    <>\r\n      <div className=\"two-columns-center\">\r\n        <div className=\"two-columns-center_row\">\r\n          <div className=\"two-columns-center_name\">Идентификатор участника</div>\r\n          <div className=\"two-columns-center_value\">{diServerId}</div>\r\n        </div>\r\n        <div className=\"two-columns-center_row\">\r\n          <div className=\"two-columns-center_name\">Организация</div>\r\n          <div className=\"two-columns-center_value\">{companyName}</div>\r\n        </div>\r\n        <div className=\"two-columns-center_row\">\r\n          <div className=\"two-columns-center_name\">ИНН</div>\r\n          <div className=\"two-columns-center_value\">{inn}</div>\r\n        </div>\r\n        {!isIp && (\r\n          <div className=\"two-columns-center_row\">\r\n            <div className=\"two-columns-center_name\">КПП *</div>\r\n            <div className=\"two-columns-center_value\">\r\n              <Input\r\n                required\r\n                name=\"kpp\"\r\n                width={320}\r\n                value={kpp}\r\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) => setKppHandler(e.target.value)}\r\n                error={!!kppError}\r\n                errors={kppError}\r\n                title=\"Введите 9-значный Код Причины Постановки на учет\"\r\n                disabled={!isEditable}\r\n              />\r\n            </div>\r\n          </div>\r\n        )}\r\n        <div className=\"two-columns-center_row\">\r\n          <div className=\"two-columns-center_name\">ОКПО</div>\r\n          <div className=\"two-columns-center_value\">\r\n            <Input\r\n              width={320}\r\n              name=\"okpo\"\r\n              value={okpo}\r\n              onChange={(e: React.ChangeEvent<HTMLInputElement>) => setOkpoHandler(e.target.value)}\r\n              error={!!okpoError}\r\n              errors={okpoError}\r\n              title=\"Введите 8-значный код по Общероссийскому Классификатору Предприятий и Организаций\"\r\n              disabled={!isEditable}\r\n            />\r\n          </div>\r\n        </div>\r\n        {isIp ? (\r\n          <div className=\"two-columns-center_row\">\r\n            <div className=\"two-columns-center_name\">ОГРНИП</div>\r\n            <div className=\"two-columns-center_value\">{ogrnip}</div>\r\n          </div>\r\n        ) : (\r\n          <div className=\"two-columns-center_row\">\r\n            <div className=\"two-columns-center_name\">ОГРН</div>\r\n            <div className=\"two-columns-center_value\">{ogrn}</div>\r\n          </div>\r\n        )}\r\n        <div className=\"two-columns-center_row\">\r\n          <div className=\"two-columns-center_name\">Код налогового органа *</div>\r\n          <div className=\"two-columns-center_value\">\r\n            <Autocomplete\r\n              name=\"code\"\r\n              width={320}\r\n              value={code}\r\n              loadOptions={codeLoad}\r\n              onChange={(e: HTMLSelectElement) => setCode(e)}\r\n              placeholder=\"\"\r\n              error={!!taxAuthorityError}\r\n              errors={taxAuthorityError}\r\n              required\r\n              title=\"Начните вводить «Код налогового органа» и выберите его из выпадающего списка\"\r\n              disabled={!isEditable}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className=\"two-columns-center_row\">\r\n          <div className=\"two-columns-center_name\">БИК</div>\r\n          <div className=\"two-columns-center_value\">\r\n            <Autocomplete\r\n              name=\"bik\"\r\n              width={320}\r\n              value={bik}\r\n              loadOptions={bikLoad}\r\n              onChange={(e: HTMLSelectElement) => setBik(e)}\r\n              placeholder=\"\"\r\n              error={!!bikError}\r\n              errors={bikError}\r\n              title=\"Начните вводить «Банковский идентификационный код» и выберите его из выпадающего списка\"\r\n              disabled={!isEditable}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className=\"two-columns-center_row\">\r\n          <div className=\"two-columns-center_name\">Номер расчётного счёта</div>\r\n          <div className=\"two-columns-center_value\">\r\n            <Input\r\n              width={320}\r\n              name=\"accountNumber\"\r\n              value={accountNumber}\r\n              onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\r\n                setAccountNumberHandler(e.target.value)\r\n              }\r\n              error={!!accountNumberError}\r\n              errors={accountNumberError}\r\n              title=\"Введите 20-значный «Номер расчётного счёта»\"\r\n              disabled={!isEditable}\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <br />\r\n      <br />\r\n      {isEditable && (\r\n        <Button\r\n          icon={<Icons.IconCheck fill=\"currentColor\" />}\r\n          kind={ButtonKinds.Orange}\r\n          onClick={onSubmit}\r\n        >\r\n          Сохранить данные компании\r\n        </Button>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}