{"ast":null,"code":"import _objectSpread from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(companyDivisionsEffect),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(getCompanyDivisionsWorker),_marked3=/*#__PURE__*/_regeneratorRuntime.mark(createCompanyDivisionWorker),_marked4=/*#__PURE__*/_regeneratorRuntime.mark(updateCompanyDivisionWorker),_marked5=/*#__PURE__*/_regeneratorRuntime.mark(getDivisionEmployeeWorker),_marked6=/*#__PURE__*/_regeneratorRuntime.mark(getNoDivisionEmployeeWorker),_marked7=/*#__PURE__*/_regeneratorRuntime.mark(addEmployeeToDivisionWorker),_marked8=/*#__PURE__*/_regeneratorRuntime.mark(deleteEmployeeFromDivisionWorker),_marked9=/*#__PURE__*/_regeneratorRuntime.mark(deleteDivisionWorker),_marked10=/*#__PURE__*/_regeneratorRuntime.mark(doHeadDivisionWorker);import{takeLatest,put}from'redux-saga/effects';import{Flash}from'../../../../common/flash/Flash';import{getCompanyDivisions,setCompanyDivisions,createCompanyDivision,setCreateDivisionError,updateCompanyDivision,getDivisionEmployee,setDivisionEmployee,getNoDivisionEmployee,setNoDivisionEmployee,addEmployeeToDivision,deleteEmployeeFromDivision,deleteDivision,doHeadDivision}from'../actions';import CompanyGateway from'@distate/core/dist/application/company/CompanyGateway';import{CompanyApiServices}from'../../services/company.api';/** Подразделения компании */export function companyDivisionsEffect(){return _regeneratorRuntime.wrap(function companyDivisionsEffect$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return takeLatest(getCompanyDivisions,getCompanyDivisionsWorker);case 2:_context.next=4;return takeLatest(createCompanyDivision,createCompanyDivisionWorker);case 4:_context.next=6;return takeLatest(updateCompanyDivision,updateCompanyDivisionWorker);case 6:_context.next=8;return takeLatest(getDivisionEmployee,getDivisionEmployeeWorker);case 8:_context.next=10;return takeLatest(getNoDivisionEmployee,getNoDivisionEmployeeWorker);case 10:_context.next=12;return takeLatest(addEmployeeToDivision,addEmployeeToDivisionWorker);case 12:_context.next=14;return takeLatest(deleteEmployeeFromDivision,deleteEmployeeFromDivisionWorker);case 14:_context.next=16;return takeLatest(deleteDivision,deleteDivisionWorker);case 16:_context.next=18;return takeLatest(doHeadDivision,doHeadDivisionWorker);case 18:case\"end\":return _context.stop();}}},_marked);}/** получение подразделений компании */function getCompanyDivisionsWorker(_ref){var payload,props,companyGateway,roles;return _regeneratorRuntime.wrap(function getCompanyDivisionsWorker$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:payload=_ref.payload;_context2.prev=1;props=payload.props;companyGateway=new CompanyGateway();_context2.next=6;return companyGateway.getCompanyDivisions(props);case 6:roles=_context2.sent;_context2.next=9;return put(setCompanyDivisions(roles));case 9:_context2.next=15;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](1);_context2.next=15;return Flash.error('Возникла ошибка');case 15:case\"end\":return _context2.stop();}}},_marked2,null,[[1,11]]);}/** создание подразделения компании */function createCompanyDivisionWorker(_ref2){var payload,_err$response,_err$response$data;return _regeneratorRuntime.wrap(function createCompanyDivisionWorker$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:payload=_ref2.payload;_context3.prev=1;_context3.next=4;return CompanyApiServices.createCompanyDivision(payload);case 4:_context3.next=6;return put(getCompanyDivisions({}));case 6:_context3.next=8;return put(setCreateDivisionError({}));case 8:payload.hide();_context3.next=17;break;case 11:_context3.prev=11;_context3.t0=_context3[\"catch\"](1);_context3.next=15;return put(setCreateDivisionError(_context3.t0.response.data.messages));case 15:_context3.next=17;return Flash.error(((_err$response=_context3.t0.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.messages[0])||'Возникла ошибка');case 17:case\"end\":return _context3.stop();}}},_marked3,null,[[1,11]]);}/** обновление подразделение компании */function updateCompanyDivisionWorker(_ref3){var payload,_err$response2,_err$response2$data;return _regeneratorRuntime.wrap(function updateCompanyDivisionWorker$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:payload=_ref3.payload;_context4.prev=1;_context4.next=4;return CompanyApiServices.updateCompanyDivision(payload);case 4:_context4.next=6;return put(getCompanyDivisions({}));case 6:_context4.next=8;return put(setCreateDivisionError({}));case 8:_context4.next=10;return Flash.success('Изменения успешно сохранены');case 10:_context4.next=18;break;case 12:_context4.prev=12;_context4.t0=_context4[\"catch\"](1);_context4.next=16;return put(setCreateDivisionError(_context4.t0.response.data.messages));case 16:_context4.next=18;return Flash.error(((_err$response2=_context4.t0.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.messages[0])||'Возникла ошибка');case 18:case\"end\":return _context4.stop();}}},_marked4,null,[[1,12]]);}/** получить список сотрудников подразделения */function getDivisionEmployeeWorker(_ref4){var payload,divisionId,props,companyGateway,response,_err$response3,_err$response3$data;return _regeneratorRuntime.wrap(function getDivisionEmployeeWorker$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:payload=_ref4.payload;_context5.prev=1;divisionId=payload.divisionId,props=payload.props;companyGateway=new CompanyGateway();_context5.next=6;return companyGateway.getDivisionEmployee(divisionId,props);case 6:response=_context5.sent;_context5.next=9;return put(setDivisionEmployee(response));case 9:_context5.next=15;break;case 11:_context5.prev=11;_context5.t0=_context5[\"catch\"](1);_context5.next=15;return Flash.error(((_err$response3=_context5.t0.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.messages[0])||'Возникла ошибка');case 15:case\"end\":return _context5.stop();}}},_marked5,null,[[1,11]]);}/** получить список сотрудников не в подразделении */function getNoDivisionEmployeeWorker(_ref5){var payload,divisionId,props,companyGateway,response,_err$response4,_err$response4$data;return _regeneratorRuntime.wrap(function getNoDivisionEmployeeWorker$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:payload=_ref5.payload;_context6.prev=1;divisionId=payload.divisionId,props=payload.props;companyGateway=new CompanyGateway();_context6.next=6;return companyGateway.getDivisionEmployee(divisionId,_objectSpread(_objectSpread({},props),{},{inverseJoin:1}));case 6:response=_context6.sent;_context6.next=9;return put(setNoDivisionEmployee(response));case 9:_context6.next=15;break;case 11:_context6.prev=11;_context6.t0=_context6[\"catch\"](1);_context6.next=15;return Flash.error(((_err$response4=_context6.t0.response)===null||_err$response4===void 0?void 0:(_err$response4$data=_err$response4.data)===null||_err$response4$data===void 0?void 0:_err$response4$data.messages[0])||'Возникла ошибка');case 15:case\"end\":return _context6.stop();}}},_marked6,null,[[1,11]]);}/** добавить сотрудника в подразделение */function addEmployeeToDivisionWorker(_ref6){var payload,divisionId,employeeId,companyGateway,_err$response5,_err$response5$data;return _regeneratorRuntime.wrap(function addEmployeeToDivisionWorker$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:payload=_ref6.payload;_context7.prev=1;divisionId=payload.divisionId,employeeId=payload.employeeId;companyGateway=new CompanyGateway();_context7.next=6;return companyGateway.addEmployeeToDivision(divisionId,employeeId);case 6:_context7.next=8;return put(getDivisionEmployee({divisionId:divisionId}));case 8:_context7.next=10;return put(getNoDivisionEmployee({divisionId:divisionId}));case 10:_context7.next=16;break;case 12:_context7.prev=12;_context7.t0=_context7[\"catch\"](1);_context7.next=16;return Flash.error(((_err$response5=_context7.t0.response)===null||_err$response5===void 0?void 0:(_err$response5$data=_err$response5.data)===null||_err$response5$data===void 0?void 0:_err$response5$data.messages[0])||'Возникла ошибка');case 16:case\"end\":return _context7.stop();}}},_marked7,null,[[1,12]]);}/** удалить сотрудника из подразделения */function deleteEmployeeFromDivisionWorker(_ref7){var payload,divisionId,employeeId,companyGateway,_err$response6,_err$response6$data;return _regeneratorRuntime.wrap(function deleteEmployeeFromDivisionWorker$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:payload=_ref7.payload;_context8.prev=1;divisionId=payload.divisionId,employeeId=payload.employeeId;companyGateway=new CompanyGateway();_context8.next=6;return companyGateway.deleteEmployeeFromDivision(divisionId,employeeId);case 6:_context8.next=8;return put(getDivisionEmployee({divisionId:divisionId}));case 8:_context8.next=10;return put(getNoDivisionEmployee({divisionId:divisionId}));case 10:_context8.next=16;break;case 12:_context8.prev=12;_context8.t0=_context8[\"catch\"](1);_context8.next=16;return Flash.error(((_err$response6=_context8.t0.response)===null||_err$response6===void 0?void 0:(_err$response6$data=_err$response6.data)===null||_err$response6$data===void 0?void 0:_err$response6$data.messages[0])||'Возникла ошибка');case 16:case\"end\":return _context8.stop();}}},_marked8,null,[[1,12]]);}/** удалить подразделение */function deleteDivisionWorker(_ref8){var payload,divisionId,hide,companyGateway,_err$response7,_err$response7$data;return _regeneratorRuntime.wrap(function deleteDivisionWorker$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:payload=_ref8.payload;_context9.prev=1;divisionId=payload.divisionId,hide=payload.hide;companyGateway=new CompanyGateway();_context9.next=6;return companyGateway.deleteDivision(divisionId);case 6:_context9.next=8;return put(getCompanyDivisions({}));case 8:hide();_context9.next=15;break;case 11:_context9.prev=11;_context9.t0=_context9[\"catch\"](1);_context9.next=15;return Flash.error(((_err$response7=_context9.t0.response)===null||_err$response7===void 0?void 0:(_err$response7$data=_err$response7.data)===null||_err$response7$data===void 0?void 0:_err$response7$data.messages[0])||'Возникла ошибка');case 15:case\"end\":return _context9.stop();}}},_marked9,null,[[1,11]]);}/** назначение подразделения главным */function doHeadDivisionWorker(_ref9){var payload,divisionId,companyGateway,_err$response8,_err$response8$data;return _regeneratorRuntime.wrap(function doHeadDivisionWorker$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:payload=_ref9.payload;_context10.prev=1;divisionId=payload.divisionId;companyGateway=new CompanyGateway();_context10.next=6;return companyGateway.doHeadDivision(divisionId);case 6:_context10.next=8;return Flash.success('Подразделение назначено главным');case 8:_context10.next=14;break;case 10:_context10.prev=10;_context10.t0=_context10[\"catch\"](1);_context10.next=14;return Flash.error(((_err$response8=_context10.t0.response)===null||_err$response8===void 0?void 0:(_err$response8$data=_err$response8.data)===null||_err$response8$data===void 0?void 0:_err$response8$data.messages[0])||'Возникла ошибка');case 14:case\"end\":return _context10.stop();}}},_marked10,null,[[1,10]]);}","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/company/store/sagas/companyDivisions.effect.ts"],"names":["companyDivisionsEffect","getCompanyDivisionsWorker","createCompanyDivisionWorker","updateCompanyDivisionWorker","getDivisionEmployeeWorker","getNoDivisionEmployeeWorker","addEmployeeToDivisionWorker","deleteEmployeeFromDivisionWorker","deleteDivisionWorker","doHeadDivisionWorker","takeLatest","put","Flash","getCompanyDivisions","setCompanyDivisions","createCompanyDivision","setCreateDivisionError","updateCompanyDivision","getDivisionEmployee","setDivisionEmployee","getNoDivisionEmployee","setNoDivisionEmployee","addEmployeeToDivision","deleteEmployeeFromDivision","deleteDivision","doHeadDivision","CompanyGateway","CompanyApiServices","payload","props","companyGateway","roles","error","hide","response","data","messages","success","divisionId","inverseJoin","employeeId"],"mappings":"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","sourcesContent":["import { takeLatest, put } from 'redux-saga/effects';\r\nimport { Flash } from '../../../../common/flash/Flash';\r\nimport {\r\n  getCompanyDivisions,\r\n  setCompanyDivisions,\r\n  createCompanyDivision,\r\n  setCreateDivisionError,\r\n  updateCompanyDivision,\r\n  getDivisionEmployee,\r\n  setDivisionEmployee,\r\n  getNoDivisionEmployee,\r\n  setNoDivisionEmployee,\r\n  addEmployeeToDivision,\r\n  deleteEmployeeFromDivision,\r\n  deleteDivision,\r\n  doHeadDivision\r\n} from '../actions';\r\nimport CompanyGateway from '@distate/core/dist/application/company/CompanyGateway';\r\nimport { CompanyApiServices } from '../../services/company.api';\r\nimport { CompanyDivision } from '../../helpers/company.typings';\r\n\r\n/** Подразделения компании */\r\nexport function* companyDivisionsEffect() {\r\n  yield takeLatest(getCompanyDivisions, getCompanyDivisionsWorker);\r\n  yield takeLatest(createCompanyDivision, createCompanyDivisionWorker);\r\n  yield takeLatest(updateCompanyDivision, updateCompanyDivisionWorker);\r\n  yield takeLatest(getDivisionEmployee, getDivisionEmployeeWorker);\r\n  yield takeLatest(getNoDivisionEmployee, getNoDivisionEmployeeWorker);\r\n  yield takeLatest(addEmployeeToDivision, addEmployeeToDivisionWorker);\r\n  yield takeLatest(deleteEmployeeFromDivision, deleteEmployeeFromDivisionWorker);\r\n  yield takeLatest(deleteDivision, deleteDivisionWorker);\r\n  yield takeLatest(doHeadDivision, doHeadDivisionWorker);\r\n}\r\n\r\ntype GetStaffRoles = {\r\n  props: {};\r\n};\r\n/** получение подразделений компании */\r\nfunction* getCompanyDivisionsWorker({ payload }: { payload: GetStaffRoles }) {\r\n  try {\r\n    const { props } = payload;\r\n    const companyGateway = new CompanyGateway();\r\n    const roles = yield companyGateway.getCompanyDivisions(props);\r\n    yield put(setCompanyDivisions(roles));\r\n  } catch (err) {\r\n    yield Flash.error('Возникла ошибка');\r\n  }\r\n}\r\n\r\ntype CreateDivisionPayload = { hide: Function } & CompanyDivision;\r\n/** создание подразделения компании */\r\nfunction* createCompanyDivisionWorker({ payload }: { payload: CreateDivisionPayload }) {\r\n  try {\r\n    yield CompanyApiServices.createCompanyDivision(payload);\r\n    yield put(getCompanyDivisions({}));\r\n    yield put(setCreateDivisionError({}));\r\n    payload.hide();\r\n  } catch (err) {\r\n    yield put(setCreateDivisionError(err.response.data.messages));\r\n    yield Flash.error(err.response?.data?.messages[0] || 'Возникла ошибка');\r\n  }\r\n}\r\n\r\n\r\ntype UpdateDivisionPayload = { hide: Function, id: number } & CompanyDivision;\r\n/** обновление подразделение компании */\r\nfunction* updateCompanyDivisionWorker({ payload }: { payload: UpdateDivisionPayload }) {\r\n  try {\r\n    yield CompanyApiServices.updateCompanyDivision(payload);\r\n    yield put(getCompanyDivisions({}));\r\n    yield put(setCreateDivisionError({}));\r\n    yield Flash.success('Изменения успешно сохранены');\r\n  } catch (err) {\r\n    yield put(setCreateDivisionError(err.response.data.messages));\r\n    yield Flash.error(err.response?.data?.messages[0] || 'Возникла ошибка');\r\n  }\r\n}\r\n\r\n\r\ntype GetDivisionEmployee = {\r\n  divisionId: number;\r\n  props: {};\r\n};\r\n/** получить список сотрудников подразделения */\r\nfunction* getDivisionEmployeeWorker({ payload }: { payload: GetDivisionEmployee }) {\r\n  try {\r\n    const { divisionId, props } = payload;\r\n    const companyGateway = new CompanyGateway();\r\n    const response = yield companyGateway.getDivisionEmployee(divisionId, props);\r\n    yield put(setDivisionEmployee(response));\r\n  } catch (err) {\r\n    yield Flash.error(err.response?.data?.messages[0] || 'Возникла ошибка');\r\n  }\r\n}\r\n\r\ntype GetNoDivisionEmployee = {\r\n  divisionId: number;\r\n  props: {};\r\n};\r\n/** получить список сотрудников не в подразделении */\r\nfunction* getNoDivisionEmployeeWorker({ payload }: { payload: GetNoDivisionEmployee }) {\r\n  try {\r\n    const { divisionId, props } = payload;\r\n    const companyGateway = new CompanyGateway();\r\n    const response = yield companyGateway.getDivisionEmployee(divisionId, {...props, inverseJoin: 1});\r\n    yield put(setNoDivisionEmployee(response));\r\n  } catch (err) {\r\n    yield Flash.error(err.response?.data?.messages[0] || 'Возникла ошибка');\r\n  }\r\n}\r\n\r\ntype AddEmployeeToDivision = {\r\n  divisionId: number;\r\n  employeeId: number;\r\n};\r\n/** добавить сотрудника в подразделение */\r\nfunction* addEmployeeToDivisionWorker({ payload }: { payload: AddEmployeeToDivision }) {\r\n  try {\r\n    const { divisionId, employeeId } = payload;\r\n    const companyGateway = new CompanyGateway();\r\n    yield companyGateway.addEmployeeToDivision(divisionId, employeeId);\r\n    yield put(getDivisionEmployee({ divisionId }));\r\n    yield put(getNoDivisionEmployee({ divisionId }));\r\n  } catch (err) {\r\n    yield Flash.error(err.response?.data?.messages[0] || 'Возникла ошибка');\r\n  }\r\n}\r\n\r\ntype DeleteEmployeeFromDivision = {\r\n  divisionId: number;\r\n  employeeId: number;\r\n};\r\n/** удалить сотрудника из подразделения */\r\nfunction* deleteEmployeeFromDivisionWorker({ payload }: { payload: DeleteEmployeeFromDivision }) {\r\n  try {\r\n    const { divisionId, employeeId } = payload;\r\n    const companyGateway = new CompanyGateway();\r\n    yield companyGateway.deleteEmployeeFromDivision(divisionId, employeeId);\r\n    yield put(getDivisionEmployee({ divisionId }));\r\n    yield put(getNoDivisionEmployee({ divisionId }));\r\n  } catch (err) {\r\n    yield Flash.error(err.response?.data?.messages[0] || 'Возникла ошибка');\r\n  }\r\n}\r\n\r\ntype DeleteDivision = {\r\n  divisionId: number;\r\n  hide: Function;\r\n};\r\n/** удалить подразделение */\r\nfunction* deleteDivisionWorker({ payload }: { payload: DeleteDivision }) {\r\n  try {\r\n    const { divisionId, hide } = payload;\r\n    const companyGateway = new CompanyGateway();\r\n    yield companyGateway.deleteDivision(divisionId);\r\n    yield put(getCompanyDivisions({}));\r\n    hide();\r\n  } catch (err) {\r\n    yield Flash.error(err.response?.data?.messages[0] || 'Возникла ошибка');\r\n  }\r\n}\r\n\r\ntype DoHeadDivision = {\r\n  divisionId: number;\r\n};\r\n  /** назначение подразделения главным */\r\nfunction* doHeadDivisionWorker({ payload }: { payload: DoHeadDivision }) {\r\n  try {\r\n    const { divisionId } = payload;\r\n    const companyGateway = new CompanyGateway();\r\n    yield companyGateway.doHeadDivision(divisionId);\r\n    yield Flash.success('Подразделение назначено главным');\r\n  } catch (err) {\r\n    yield Flash.error(err.response?.data?.messages[0] || 'Возникла ошибка');\r\n  }\r\n}"]},"metadata":{},"sourceType":"module"}