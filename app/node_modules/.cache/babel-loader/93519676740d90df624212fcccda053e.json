{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React from'react';import{Redirect}from'react-router-dom';import{useDispatch,useSelector}from'react-redux';import SecurityService from'@distate/core/dist/application/security/SecurityService';import Layout from'../../common/Layout';import{DOCUMENTS}from'../../common/Lbl';import{DOCUMENT_INBOX}from'../../common/Url';import CommonTable from'../../common/table/Table';import{selectFolders}from'../../container/folder/store/selects';import{actionDocumentDownloadRequest,actionDocumentDetachFolder,actionDocumentNext,actionDocumentChecked}from'./store/actions';import{selectList,selectLimit,selectIsNextLoading,selectDownload,selectOffset,selectIsNext,selectSelected,selectMode,selectLoading}from'./store/selects';import{routes}from'./helpers/documents.routes';import{getColumnts,getRowClass}from'./helpers/documents.columns';import{Tools}from'./features/tools';import{Table}from'./components/table';export var DocumentsPage=function DocumentsPage(_ref){var pathname=_ref.location.pathname;var dispatch=useDispatch();var mode=useSelector(selectMode);var rows=useSelector(selectList);var limit=useSelector(selectLimit);var offset=useSelector(selectOffset);var selected=useSelector(selectSelected);var isNext=useSelector(selectIsNext);var isDownload=useSelector(selectDownload);var isNextLoading=useSelector(selectIsNextLoading);var folders=useSelector(selectFolders);var isLoading=useSelector(selectLoading);var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),sticky=_React$useState2[0],setSticky=_React$useState2[1];var visible=React.useMemo(function(){return SecurityService.hasDocumentRole();},[]);React.useEffect(function(){var calculateSticky=function calculateSticky(){var _document$body$getBou=document.body.getBoundingClientRect(),top=_document$body$getBou.top;var scrollTop=top*-1;if(!sticky&&scrollTop>=10){setSticky(true);}else if(sticky&&scrollTop<10){setSticky(false);}};window.addEventListener('scroll',calculateSticky);window.addEventListener('resize',calculateSticky);return function(){window.removeEventListener('scroll',calculateSticky);window.removeEventListener('resize',calculateSticky);};});// Handle\n// -----------------------------------------------------------\nvar onCheck=function onCheck(_ref2){var packageId=_ref2.packageId,checked=_ref2.checked;var actionType=checked?'remove':'append';dispatch(actionDocumentChecked({type:actionType,values:[packageId]}));};var onCheckAll=function onCheckAll(){dispatch(actionDocumentChecked({type:'checkedAll'}));};var onNextLoading=function onNextLoading(){if(!isNext)return;dispatch(actionDocumentNext());};var onDetachFolder=function onDetachFolder(data){dispatch(actionDocumentDetachFolder(data));};var onClickDownload=function onClickDownload(ids){dispatch(actionDocumentDownloadRequest({ids:ids}));};var columns=React.useMemo(function(){var isAllSelected=!!(rows.length&&rows.length===selected.length);return getColumnts({rows:rows,folders:folders,pathname:pathname,isAllSelected:isAllSelected,isDownload:isDownload,onCheck:onCheck,onCheckAll:onCheckAll,onDetachFolder:onDetachFolder,onClickDownload:onClickDownload});// eslint-disable-next-line react-hooks/exhaustive-deps\n},[rows,folders,isDownload]);// Render\n// -----------------------------------------------------------\nvar renderBody=function renderBody(){if(!visible){return/*#__PURE__*/React.createElement(\"p\",null,\"\\u041D\\u0435\\u0434\\u043E\\u0441\\u0442\\u0430\\u0442\\u043E\\u0447\\u043D\\u043E \\u043F\\u0440\\u0430\\u0432 \\u0434\\u043B\\u044F \\u043E\\u0442\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u044F \\u0434\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u043E\\u0432.\");}return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Tools,{fixed:sticky}),/*#__PURE__*/React.createElement(Table,{rows:rows,limit:limit,offset:offset,onMore:onNextLoading,columns:columns,classNameRow:getRowClass,hasMore:isNext,isLoading:isLoading,isNextLoading:isNextLoading,emptyTitle:'Список документов пуст.'}),/*#__PURE__*/React.createElement(CommonTable,null));};if(mode==='redirect'){return/*#__PURE__*/React.createElement(Redirect,{to:DOCUMENT_INBOX});}return/*#__PURE__*/React.createElement(Layout,{config:routes,pageMenuHeader:DOCUMENTS},renderBody());};","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/documents/documents.page.tsx"],"names":["React","Redirect","useDispatch","useSelector","SecurityService","Layout","DOCUMENTS","DOCUMENT_INBOX","CommonTable","selectFolders","actionDocumentDownloadRequest","actionDocumentDetachFolder","actionDocumentNext","actionDocumentChecked","selectList","selectLimit","selectIsNextLoading","selectDownload","selectOffset","selectIsNext","selectSelected","selectMode","selectLoading","routes","getColumnts","getRowClass","Tools","Table","DocumentsPage","pathname","location","dispatch","mode","rows","limit","offset","selected","isNext","isDownload","isNextLoading","folders","isLoading","useState","sticky","setSticky","visible","useMemo","hasDocumentRole","useEffect","calculateSticky","document","body","getBoundingClientRect","top","scrollTop","window","addEventListener","removeEventListener","onCheck","packageId","checked","actionType","type","values","onCheckAll","onNextLoading","onDetachFolder","data","onClickDownload","ids","columns","isAllSelected","length","renderBody"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { RouteComponentProps, Redirect } from 'react-router-dom';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport SecurityService from '@distate/core/dist/application/security/SecurityService';\r\n\r\nimport Layout from '../../common/Layout';\r\nimport { DOCUMENTS } from '../../common/Lbl';\r\nimport { DOCUMENT_INBOX } from '../../common/Url';\r\nimport CommonTable from '../../common/table/Table';\r\nimport { selectFolders } from '../../container/folder/store/selects';\r\n\r\nimport {\r\n  actionDocumentDownloadRequest,\r\n  actionDocumentDetachFolder,\r\n  actionDocumentNext,\r\n  actionDocumentChecked\r\n} from './store/actions';\r\nimport {\r\n  selectList,\r\n  selectLimit,\r\n  selectIsNextLoading,\r\n  selectDownload,\r\n  selectOffset,\r\n  selectIsNext,\r\n  selectSelected,\r\n  selectMode,\r\n  selectLoading\r\n} from './store/selects';\r\nimport { DocumentType, DocumentDetachAction } from './helpers/documents.typings';\r\nimport { routes } from './helpers/documents.routes';\r\nimport { getColumnts, getRowClass } from './helpers/documents.columns';\r\nimport { Tools } from './features/tools';\r\nimport { Table } from './components/table';\r\n\r\ntype DocumentsPageProps = {\r\n  fetchFolders: () => void;\r\n} & RouteComponentProps;\r\n\r\nexport const DocumentsPage: React.FC<DocumentsPageProps> = ({ location: { pathname } }) => {\r\n  const dispatch = useDispatch();\r\n  const mode = useSelector(selectMode);\r\n  const rows = useSelector(selectList);\r\n  const limit = useSelector(selectLimit);\r\n  const offset = useSelector(selectOffset);\r\n  const selected = useSelector(selectSelected);\r\n  const isNext = useSelector(selectIsNext);\r\n  const isDownload = useSelector(selectDownload);\r\n  const isNextLoading = useSelector(selectIsNextLoading);\r\n  const folders = useSelector(selectFolders);\r\n  const isLoading = useSelector(selectLoading);\r\n\r\n  const [sticky, setSticky] = React.useState(false);\r\n\r\n  const visible = React.useMemo(() => {\r\n    return SecurityService.hasDocumentRole();\r\n  }, []);\r\n\r\n  React.useEffect(() => {\r\n    const calculateSticky = () => {\r\n      const { top } = document.body.getBoundingClientRect();\r\n      const scrollTop = top * -1;\r\n\r\n      if (!sticky && scrollTop >= 10) {\r\n        setSticky(true);\r\n      } else if (sticky && scrollTop < 10) {\r\n        setSticky(false);\r\n      }\r\n    };\r\n\r\n    window.addEventListener('scroll', calculateSticky);\r\n    window.addEventListener('resize', calculateSticky);\r\n\r\n    return () => {\r\n      window.removeEventListener('scroll', calculateSticky);\r\n      window.removeEventListener('resize', calculateSticky);\r\n    };\r\n  });\r\n\r\n  // Handle\r\n  // -----------------------------------------------------------\r\n\r\n  const onCheck = ({ packageId, checked }: DocumentType) => {\r\n    const actionType = checked ? 'remove' : 'append';\r\n    dispatch(actionDocumentChecked({ type: actionType, values: [packageId] }));\r\n  };\r\n\r\n  const onCheckAll = () => {\r\n    dispatch(actionDocumentChecked({ type: 'checkedAll' }));\r\n  };\r\n\r\n  const onNextLoading = () => {\r\n    if (!isNext) return;\r\n    dispatch(actionDocumentNext());\r\n  };\r\n\r\n  const onDetachFolder = (data: DocumentDetachAction) => {\r\n    dispatch(actionDocumentDetachFolder(data));\r\n  };\r\n\r\n  const onClickDownload = (ids?: string[]) => {\r\n    dispatch(actionDocumentDownloadRequest({ ids }));\r\n  };\r\n\r\n  const columns = React.useMemo(() => {\r\n    const isAllSelected = !!(rows.length && rows.length === selected.length);\r\n\r\n    return getColumnts({\r\n      rows,\r\n      folders,\r\n      pathname,\r\n      isAllSelected,\r\n      isDownload,\r\n      onCheck,\r\n      onCheckAll,\r\n      onDetachFolder,\r\n      onClickDownload\r\n    });\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [rows, folders, isDownload]);\r\n\r\n  // Render\r\n  // -----------------------------------------------------------\r\n  const renderBody = () => {\r\n    if (!visible) {\r\n      return <p>Недостаточно прав для отображения документов.</p>;\r\n    }\r\n\r\n    return (\r\n      <>\r\n        <Tools fixed={sticky} />\r\n        <Table\r\n          rows={rows}\r\n          limit={limit}\r\n          offset={offset}\r\n          onMore={onNextLoading}\r\n          columns={columns}\r\n          classNameRow={getRowClass}\r\n          hasMore={isNext}\r\n          isLoading={isLoading}\r\n          isNextLoading={isNextLoading}\r\n          emptyTitle={'Список документов пуст.'}\r\n        />\r\n        <CommonTable />\r\n      </>\r\n    );\r\n  };\r\n\r\n  if (mode === 'redirect') {\r\n    return <Redirect to={DOCUMENT_INBOX} />;\r\n  }\r\n\r\n  return (\r\n    <Layout config={routes} pageMenuHeader={DOCUMENTS}>\r\n      {renderBody()}\r\n    </Layout>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}