{"ast":null,"code":"import _objectSpread from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import{isObject}from'../../../../../utils/ObjectUtil';/**\r\n * Преобразует формат \"сервера\" в формат \"фронтенда\".\r\n * Возвращает данные таблицы коррекционного документа.\r\n *\r\n * @param UCD Данные полученные от сервера\r\n */export var transformerDTOUCDTable=function transformerDTOUCDTable(UCD){var table=UCD.formData?UCD.formData.document.table:UCD.parameters.table;return parseTable(table);};var parseTable=function parseTable(table){if(!Array.isArray(table.goods)){table.goods=[];}var reducerGoods=function reducerGoods(prev,good,index){var _good$information,_good$information2,_good$information3,_good$information4,_good$information5,_good$information6,_good$information7;var row=String(index+1);prev.push({row:row,title:good.title,infoFields:good.infoFields,count:createBeforeAfter(good.count),price:createBeforeAfter(good.price,true),excise:createBeforeAfter(good.excise,true),taxRate:createBeforeAfter(good.taxRate),amountOfTax:createBeforeAfter(good.amountOfTax,true),costAfterTax:createBeforeAfter(good.costAfterTax,true),costBeforeTax:createBeforeAfter(good.costBeforeTax,true),measurement:getMeasurement(good),identificationNumbers:parseNumbers(good===null||good===void 0?void 0:(_good$information=good.information)===null||_good$information===void 0?void 0:_good$information.identificationNumbers),information:{sort:good===null||good===void 0?void 0:(_good$information2=good.information)===null||_good$information2===void 0?void 0:_good$information2.sort,code:good===null||good===void 0?void 0:(_good$information3=good.information)===null||_good$information3===void 0?void 0:_good$information3.code,article:good===null||good===void 0?void 0:(_good$information4=good.information)===null||_good$information4===void 0?void 0:_good$information4.article,tracking:good===null||good===void 0?void 0:(_good$information5=good.information)===null||_good$information5===void 0?void 0:_good$information5.tracking,kindCode:good===null||good===void 0?void 0:(_good$information6=good.information)===null||_good$information6===void 0?void 0:_good$information6.kindCode,description:good===null||good===void 0?void 0:(_good$information7=good.information)===null||_good$information7===void 0?void 0:_good$information7.description}});return prev;};return{goods:table.goods.reduce(reducerGoods,[]),totalIncrease:_objectSpread({beforeTax:'0.00',amountOfTax:'0.00',afterTax:'0.00'},table.totalIncrease),totalDecrease:_objectSpread({beforeTax:'0.00',amountOfTax:'0.00',afterTax:'0.00'},table.totalDecrease)};};function createBeforeAfter(val){var float=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(isObject(val)&&val.hasOwnProperty('before')&&val.hasOwnProperty('after')){val.after=parseValue(val.after,float);val.before=parseValue(val.before,float);if(val.hasOwnProperty('increase')&&val.increase===null){val.increase=parseValue(val.increase,float);}if(val.hasOwnProperty('decrease')&&val.decrease===null){val.decrease=parseValue(val.decrease,float);}return val;}else if(isObject(val)){return{before:val,after:val};}return{before:parseValue(val,float),after:parseValue(val,float)};}function parseValue(value){var float=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(value===null){return'0.00';}if(float){return Number.parseFloat(String(value)).toFixed(2);}return String(value);}function parseNumbers(numbers){if(!Array.isArray(numbers)||!numbers){return null;}return numbers.map(function(_ref){var _ref$numbers=_ref.numbers,type=_ref$numbers.type,collection=_ref$numbers.collection,packNumber=_ref.packNumber;var data={};switch(type){case'1':var label1=[];label1.push('Уникальный идентификатор вторичной (потребительской)/третичной');label1.push('(заводской, транспортной) упаковки');data.idetificationNumbers=createBeforeAfter(collection);data.type=createBeforeAfter({value:'2',label:label1.join(' ')});break;case'2':var label2=['Контрольный идентификационный знак'];data.packNumbers=createBeforeAfter(collection);data.type=createBeforeAfter({value:'1',label:label2.join(' ')});break;}return _objectSpread(_objectSpread({},data),{},{packageIdentifier:createBeforeAfter(packNumber)});});}function getMeasurement(_ref2){var measurement=_ref2.measurement,measurementCode=_ref2.measurementCode,measurementTitle=_ref2.information.measurementTitle;if(isObject(measurement)&&isObject(measurementTitle)&&measurement.hasOwnProperty('before')&&measurementTitle.hasOwnProperty('before')){return{before:{value:measurement.befor,label:measurementTitle.before},after:{value:measurement.after,label:measurementTitle.after}};}return createBeforeAfter({value:measurementCode,label:measurementTitle});}","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/upd/helpers/transformers/ucd/dto-to-ucd-table.ts"],"names":["isObject","transformerDTOUCDTable","UCD","table","formData","document","parameters","parseTable","Array","isArray","goods","reducerGoods","prev","good","index","row","String","push","title","infoFields","count","createBeforeAfter","price","excise","taxRate","amountOfTax","costAfterTax","costBeforeTax","measurement","getMeasurement","identificationNumbers","parseNumbers","information","sort","code","article","tracking","kindCode","description","reduce","totalIncrease","beforeTax","afterTax","totalDecrease","val","float","hasOwnProperty","after","parseValue","before","increase","decrease","value","Number","parseFloat","toFixed","numbers","map","type","collection","packNumber","data","label1","idetificationNumbers","label","join","label2","packNumbers","packageIdentifier","measurementCode","measurementTitle","befor"],"mappings":"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","sourcesContent":["import {\r\n  DTOUCDDocument,\r\n  UCDTableGoodsSchema,\r\n  UCDTableGoodSchema,\r\n  UCDTableSchema,\r\n  BeforeAfter\r\n} from './types';\r\nimport { isObject } from '../../../../../utils/ObjectUtil';\r\n\r\n/**\r\n * Преобразует формат \"сервера\" в формат \"фронтенда\".\r\n * Возвращает данные таблицы коррекционного документа.\r\n *\r\n * @param UCD Данные полученные от сервера\r\n */\r\nexport const transformerDTOUCDTable = (UCD: DTOUCDDocument) => {\r\n  const table = UCD.formData ? UCD.formData.document.table : UCD.parameters.table;\r\n  return parseTable(table);\r\n};\r\n\r\nconst parseTable = (table: any): UCDTableSchema => {\r\n  if (!Array.isArray(table.goods)) {\r\n    table.goods = [];\r\n  }\r\n\r\n  const reducerGoods = (\r\n    prev: UCDTableGoodSchema[],\r\n    good: Record<string, any>,\r\n    index: number\r\n  ): UCDTableGoodsSchema => {\r\n    const row = String(index + 1);\r\n\r\n    prev.push({\r\n      row,\r\n      title: good.title,\r\n      infoFields: good.infoFields,\r\n      count: createBeforeAfter(good.count),\r\n      price: createBeforeAfter(good.price, true),\r\n      excise: createBeforeAfter(good.excise, true),\r\n      taxRate: createBeforeAfter(good.taxRate),\r\n      amountOfTax: createBeforeAfter(good.amountOfTax, true),\r\n      costAfterTax: createBeforeAfter(good.costAfterTax, true),\r\n      costBeforeTax: createBeforeAfter(good.costBeforeTax, true),\r\n      measurement: getMeasurement(good),\r\n      identificationNumbers: parseNumbers(good?.information?.identificationNumbers),\r\n      information: {\r\n        sort: good?.information?.sort,\r\n        code: good?.information?.code,\r\n        article: good?.information?.article,\r\n        tracking: good?.information?.tracking,\r\n        kindCode: good?.information?.kindCode,\r\n        description: good?.information?.description\r\n      }\r\n    });\r\n\r\n    return prev;\r\n  };\r\n\r\n  return {\r\n    goods: table.goods.reduce(reducerGoods, []),\r\n    totalIncrease: {\r\n      beforeTax: '0.00',\r\n      amountOfTax: '0.00',\r\n      afterTax: '0.00',\r\n      ...table.totalIncrease\r\n    },\r\n    totalDecrease: {\r\n      beforeTax: '0.00',\r\n      amountOfTax: '0.00',\r\n      afterTax: '0.00',\r\n      ...table.totalDecrease\r\n    }\r\n  };\r\n};\r\n\r\nfunction createBeforeAfter(val: any, float = false): BeforeAfter {\r\n  if (isObject(val) && val.hasOwnProperty('before') && val.hasOwnProperty('after')) {\r\n    val.after = parseValue(val.after, float);\r\n    val.before = parseValue(val.before, float);\r\n\r\n    if (val.hasOwnProperty('increase') && val.increase === null) {\r\n      val.increase = parseValue(val.increase, float);\r\n    }\r\n\r\n    if (val.hasOwnProperty('decrease') && val.decrease === null) {\r\n      val.decrease = parseValue(val.decrease, float);\r\n    }\r\n\r\n    return val as BeforeAfter;\r\n  } else if (isObject(val)) {\r\n    return { before: val, after: val };\r\n  }\r\n\r\n  return { before: parseValue(val, float), after: parseValue(val, float) };\r\n}\r\n\r\nfunction parseValue(value: any, float = false): string {\r\n  if (value === null) {\r\n    return '0.00';\r\n  }\r\n\r\n  if (float) {\r\n    return Number.parseFloat(String(value)).toFixed(2);\r\n  }\r\n\r\n  return String(value);\r\n}\r\n\r\nfunction parseNumbers(numbers: any[]) {\r\n  if (!Array.isArray(numbers) || !numbers) {\r\n    return null;\r\n  }\r\n\r\n  return numbers.map(({ numbers: { type, collection }, packNumber }) => {\r\n    const data: Record<string, unknown> = {};\r\n    switch (type) {\r\n      case '1':\r\n        const label1 = [];\r\n        label1.push('Уникальный идентификатор вторичной (потребительской)/третичной');\r\n        label1.push('(заводской, транспортной) упаковки');\r\n\r\n        data.idetificationNumbers = createBeforeAfter(collection);\r\n        data.type = createBeforeAfter({ value: '2', label: label1.join(' ') });\r\n        break;\r\n      case '2':\r\n        const label2 = ['Контрольный идентификационный знак'];\r\n\r\n        data.packNumbers = createBeforeAfter(collection);\r\n        data.type = createBeforeAfter({ value: '1', label: label2.join(' ') });\r\n        break;\r\n    }\r\n\r\n    return {\r\n      ...data,\r\n      packageIdentifier: createBeforeAfter(packNumber)\r\n    };\r\n  });\r\n}\r\n\r\nfunction getMeasurement({\r\n  measurement,\r\n  measurementCode,\r\n  information: { measurementTitle }\r\n}: Record<string, any>) {\r\n  if (\r\n    isObject(measurement) &&\r\n    isObject(measurementTitle) &&\r\n    measurement.hasOwnProperty('before') &&\r\n    measurementTitle.hasOwnProperty('before')\r\n  ) {\r\n    return {\r\n      before: { value: measurement.befor, label: measurementTitle.before },\r\n      after: { value: measurement.after, label: measurementTitle.after }\r\n    };\r\n  }\r\n\r\n  return createBeforeAfter({ value: measurementCode, label: measurementTitle });\r\n}\r\n"]},"metadata":{},"sourceType":"module"}