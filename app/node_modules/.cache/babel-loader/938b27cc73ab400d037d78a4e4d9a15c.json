{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _objectSpread from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import _applyDecoratedDescriptor from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/applyDecoratedDescriptor\";var _class;import React from'react';import FormBase from'../../../common/form/FormBase';import FormBuilder from'../../../common/form/documents/DocumentFormBuilder';import Invoice from'@distate/core/dist/domain/documents/invoice/vo/Invoice';import DateInvoice from'@distate/core/dist/domain/documents/invoice/vo/invoice/Date';import NumInvoice from'@distate/core/dist/domain/documents/invoice/vo/invoice/Num';import Currency from'@distate/core/dist/domain/documents/invoice/vo/Currency';import Recipient from'@distate/core/dist/domain/documents/invoice/vo/recipient/Recipient';import EconomicSubjectName from'@distate/core/dist/domain/documents/invoice/vo/EconomicSubjectName';import ExchangeRate from'@distate/core/dist/domain/documents/invoice/vo/currency/ExchangeRate';import Flash from'../../../common/flash/Flash';import Core from'@distate/core/dist/application/Core';import AutocompleteService from'@distate/core/dist/application/autocomplete/AutocompleteService';import{SAVE,SUCCESS_SAVE_FORM}from'../../../common/Lbl';import PaymentDocument from'@distate/core/dist/domain/documents/invoice/vo/invoice/payment_document/PaymentDocument';import CargoFrom from'@distate/core/dist/domain/documents/invoice/vo/invoice/CargoFrom';import CargoTo from'@distate/core/dist/domain/documents/upd/vo/invoice/CargoTo';import InvoicePurpose from'@distate/core/dist/domain/documents/invoice/vo/purpose/Invoice';import InformationBasisType from'@distate/core/dist/domain/documents/invoice/vo/invoice/InformationBasisType';import BasisDocName from'@distate/core/dist/domain/documents/invoice/standard_element/basis/DocName';import BasisDocNumber from'@distate/core/dist/domain/documents/invoice/standard_element/basis/DocNumber';import BasisDocDate from'@distate/core/dist/domain/documents/invoice/standard_element/basis/DocDate';import BasisInformation from'@distate/core/dist/domain/documents/invoice/standard_element/basis/Information';import BasisDocId from'@distate/core/dist/domain/documents/invoice/standard_element/basis/DocId';import InfoFieldFact1 from'@distate/core/dist/domain/documents/invoice/vo/invoice/InfoFieldFact1';import styles from'../../../common/form/documents/DocumentFormBuilder.module.css';import{TOP}from'../../../common/Placement';import Behavior from'../../../common/form/parameters/Behavior';import Appearance from'../../../common/form/parameters/Appearance';import createError from'@distate/core/dist/application/error/ErrorFactory';import autobind from'autobind-decorator';import{DOCUMENT_VIEW}from'../../../common/Url';import{DOCUMENT as DOCUMENT_ERROR}from'@distate/core/dist/application/error/Error';import PropTypes from'prop-types';import InvoiceService from'@distate/core/dist/application/documents/invoice/InvoiceService';import get from'get-value';import set from'set-value';import setObject from'object-path';import{set as setImmutable}from'object-path-immutable';import{clone,combineMerge,removeEmpty}from'../../../utils/ObjectUtil';import{Loading}from'@distate/components';import ParticipantForm from'../../upd/fields/ParticipantForm';import Factor from'@distate/core/dist/domain/documents/upd/vo/factor/Factor';import InvoiceTableForm from'../../../common/form/InvoiceTableForm';import ArrayGroup from'../../upd/forms/ArrayGroup';import deepmerge from'deepmerge';import skipArgs from'../../../utils/skipArgs';var InvoiceForm=(_class=/*#__PURE__*/function(_FormBase){_inherits(InvoiceForm,_FormBase);var _super=_createSuper(InvoiceForm);function InvoiceForm(props){var _this;_classCallCheck(this,InvoiceForm);_this=_super.call(this,props);_this.state=_objectSpread(_objectSpread({},_this.state),{},{redirectUrl:'',document:null,isLoading:!!props.id,isError:false,showSaveDocumentModal:false,errors:null,paymentDocuments:[],infoFields:[],isExchangeRateFieldHidden:true});_this.isDocumentDuplicate=false;_this.responsePathEntry=null;_this.responcePathFirstSegment=null;return _this;}_createClass(InvoiceForm,[{key:\"createForm\",value:function createForm(){var _builder$buildGroup,_builder$buildGroup2,_builder$buildGroup3,_this2=this,_Core$company,_Core$company$inn,_Core$company2,_Core$company2$inn,_Core$company3,_Core$company3$kpp,_Core$company4,_Core$company4$kpp,_Core$company5,_basisBehaviors,_basisAppearances,_builder$buildGroup4;var BASE_WIDTH=460;var MARGIN=6;var defaultBehavior=new Behavior({value:'invoice_form'});var defaultAppearance=new Appearance({width:BASE_WIDTH+MARGIN});var builder=new FormBuilder(this,defaultBehavior,defaultAppearance);var requiredBehavior=new Behavior({isRequired:true});var serverResponse=this.state.document;this.getCustomData(builder,serverResponse);this.getCustomGoodsData(builder,serverResponse);var getErrors=function getErrors(errorsObjPath){return clone(get(builder._component,\"state.errors.\".concat(errorsObjPath)));};var clearFieldError=function clearFieldError(path){var errors=get(builder._component,\"state.errors.\".concat(path));if(Array.isArray(errors)&&errors.length){setObject(errors,\"state.errors.\".concat(path),[]);builder._component.setState({errors:errors});}if(typeof errors==='string'){errors=get(builder._component,\"state.errors\");var updatedErrors=setImmutable(errors,path,'');builder._component.setState({errors:updatedErrors});}};var getBehavior=function getBehavior(defaultBehavior,path){var scope=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';return serverResponse?Behavior.mixin(defaultBehavior,{initialFieldDomain:{value:scope?set({},scope,get(serverResponse,path)):get(serverResponse,path)}}):defaultBehavior;};var handleArrayGroupErrorsChange=function handleArrayGroupErrorsChange(path){return function(newErrors){var componentStateErrors=get(builder._component,\"state.errors\")||{};var arrayGroupErrors=get(componentStateErrors,path)||{};var updatedArrayGroupErrors=deepmerge(arrayGroupErrors,newErrors,{arrayMerge:combineMerge});var updatedComponentStateErrors=setImmutable(componentStateErrors,path,updatedArrayGroupErrors);builder._component.setState({errors:updatedComponentStateErrors});};};builder.buildGroup(Invoice,(_builder$buildGroup={},_defineProperty(_builder$buildGroup,NumInvoice.field,builder.buildInput),_defineProperty(_builder$buildGroup,DateInvoice.field,builder.buildDateInput),_builder$buildGroup),getBehavior(defaultBehavior,\"\".concat(this.responsePathEntry,\".invoice\")),defaultAppearance,(_builder$buildGroup2={},_defineProperty(_builder$buildGroup2,NumInvoice.field,getBehavior(requiredBehavior,\"\".concat(this.responsePathEntry,\".invoice.number\"))),_defineProperty(_builder$buildGroup2,DateInvoice.field,getBehavior(requiredBehavior,\"\".concat(this.responsePathEntry,\".invoice.date\"))),_builder$buildGroup2),(_builder$buildGroup3={},_defineProperty(_builder$buildGroup3,NumInvoice.field,new Appearance({width:BASE_WIDTH-120,align:TOP})),_defineProperty(_builder$buildGroup3,DateInvoice.field,new Appearance({width:120,customClasses:\"ds-input \".concat(styles.width100),align:TOP})),_builder$buildGroup3));builder.content.push(function(){return/*#__PURE__*/React.createElement(ArrayGroup,{domainVO:PaymentDocument,initialValues:_this2.state.paymentDocuments,returnState:function returnState(paymentDocuments){return _this2.setState({paymentDocuments:paymentDocuments});},hasFixedWidthFields:true,inputGroupWidth:\"466px\",errors:getErrors(PaymentDocument.field),handleErrorsChange:handleArrayGroupErrorsChange(PaymentDocument.field)});});var companyINN=((_Core$company=Core.company)===null||_Core$company===void 0?void 0:(_Core$company$inn=_Core$company.inn)===null||_Core$company$inn===void 0?void 0:_Core$company$inn.value)?\", \\u0418\\u041D\\u041D: \".concat((_Core$company2=Core.company)===null||_Core$company2===void 0?void 0:(_Core$company2$inn=_Core$company2.inn)===null||_Core$company2$inn===void 0?void 0:_Core$company2$inn.value):'';var companyKPP=((_Core$company3=Core.company)===null||_Core$company3===void 0?void 0:(_Core$company3$kpp=_Core$company3.kpp)===null||_Core$company3$kpp===void 0?void 0:_Core$company3$kpp.value)?\", \\u041A\\u041F\\u041F: \".concat((_Core$company4=Core.company)===null||_Core$company4===void 0?void 0:(_Core$company4$kpp=_Core$company4.kpp)===null||_Core$company4$kpp===void 0?void 0:_Core$company4$kpp.value):'';var economicSubjectNameInitialValue=serverResponse?get(serverResponse,\"\".concat(this.responsePathEntry,\".economicSubjectName\")):\"\".concat((_Core$company5=Core.company)===null||_Core$company5===void 0?void 0:_Core$company5.name).concat(companyINN).concat(companyKPP);var economicSubjectNameBehavior=new Behavior({initialFieldDomain:{value:economicSubjectNameInitialValue},isRequired:true});builder.buildInfo(EconomicSubjectName,economicSubjectNameBehavior);/** фильтр для автокомплита */var filterForAutocomlete=function filterForAutocomlete(res){return res.filter(function(item){return item.type==='division'&&item.companyExternalType!=='taxcom';});};builder.buildAutocomplete.apply(builder,[Recipient,getBehavior(new Behavior({value:'invoice_form',isRequired:true,onChange:function onChange(){return clearFieldError(Recipient.field);}}),\"\".concat(Recipient.field,\".title\"))].concat(_toConsumableArray(skipArgs(2)),[filterForAutocomlete]));var setDataToFormState=function setDataToFormState(path){return function(data){set(builder.formState,\"values.\".concat(path),data,{merge:true});};};builder.content.push(function(){return/*#__PURE__*/React.createElement(ParticipantForm,{DomainVO:Factor,setDataToFormState:setDataToFormState('information'),initialValues:{factor:get(serverResponse,\"\".concat(_this2.responsePathEntry,\".invoice.information.factor\"))},errors:{factor:getErrors('information.factor')},clearFieldError:clearFieldError});});var cargoFromInitialValues=get(serverResponse,\"\".concat(this.responsePathEntry,\".invoice.cargoFrom\"));builder.content.push(function(){return/*#__PURE__*/React.createElement(ParticipantForm,{DomainVO:CargoFrom,setDataToFormState:setDataToFormState('invoice.cargoFrom'),scope:'consignor',initialValues:_this2.isDocumentDuplicate?cargoFromInitialValues[0]:cargoFromInitialValues,errors:getErrors('invoice.cargoFrom'),clearFieldError:clearFieldError});});var consigneeInitialValues=get(serverResponse,\"\".concat(this.responsePathEntry,\".invoice.consignee\").concat(this.isDocumentDuplicate?'s':''));builder.content.push(function(){return/*#__PURE__*/React.createElement(ParticipantForm,{DomainVO:CargoTo,setDataToFormState:setDataToFormState('invoice'),scope:'consignee',initialValues:{consignee:_this2.isDocumentDuplicate?consigneeInitialValues[0]:consigneeInitialValues},errors:{consignee:getErrors('consignee')},clearFieldError:clearFieldError});});var handleCurrencyChange=function handleCurrencyChange(_ref){var letter_code=_ref.letter_code;clearFieldError(Currency.field);_this2.setState({isExchangeRateFieldHidden:letter_code===Currency.initialValue.letter_code});};var behaviorCurrency=new Behavior({initialFieldDomain:serverResponse&&serverResponse.currency||Currency.initialValue,isRequired:true,onChange:handleCurrencyChange});builder.buildAutocomplete(Currency,behaviorCurrency);builder.buildInput(ExchangeRate,getBehavior(defaultBehavior,\"\".concat(this.responsePathEntry,\".invoice.information.currencyExchangeRate\")),new Appearance(_objectSpread(_objectSpread({},defaultAppearance),{},{customClasses:this.state.isExchangeRateFieldHidden?styles.hiddenAndZeroHeight:''})));var DATE_WIDTH=120;var basisBehaviors=(_basisBehaviors={},_defineProperty(_basisBehaviors,BasisDocName.field,defaultBehavior),_defineProperty(_basisBehaviors,BasisDocNumber.field,defaultBehavior),_defineProperty(_basisBehaviors,BasisDocDate.field,defaultBehavior),_defineProperty(_basisBehaviors,BasisInformation.field,defaultBehavior),_defineProperty(_basisBehaviors,BasisDocId.field,defaultBehavior),_basisBehaviors);var basisFieldsAppearance=new Appearance({width:(2*BASE_WIDTH-DATE_WIDTH-3*MARGIN)/4,align:TOP,customClasses:\"ds-input \".concat(styles.width100)});var basisAppearances=(_basisAppearances={},_defineProperty(_basisAppearances,BasisDocName.field,basisFieldsAppearance),_defineProperty(_basisAppearances,BasisDocNumber.field,basisFieldsAppearance),_defineProperty(_basisAppearances,BasisDocDate.field,new Appearance({width:DATE_WIDTH,align:TOP,customClasses:\"ds-input \".concat(styles.width100)})),_defineProperty(_basisAppearances,BasisInformation.field,basisFieldsAppearance),_defineProperty(_basisAppearances,BasisDocId.field,basisFieldsAppearance),_basisAppearances);builder.content.push(function(){return/*#__PURE__*/React.createElement(ArrayGroup,{domainVO:InfoFieldFact1,initialValues:_this2.state.infoFields,returnState:function returnState(infoFields){return _this2.setState({infoFields:infoFields});},hasFixedWidthFields:true,inputGroupWidth:\"466px\",errors:getErrors(InfoFieldFact1.field),handleErrorsChange:handleArrayGroupErrorsChange(InfoFieldFact1.field)});});builder.buildGroup(InformationBasisType,(_builder$buildGroup4={},_defineProperty(_builder$buildGroup4,BasisDocName.field,builder.buildInput),_defineProperty(_builder$buildGroup4,BasisDocNumber.field,builder.buildInput),_defineProperty(_builder$buildGroup4,BasisDocDate.field,builder.buildDateInput),_defineProperty(_builder$buildGroup4,BasisInformation.field,builder.buildInput),_defineProperty(_builder$buildGroup4,BasisDocId.field,builder.buildInput),_builder$buildGroup4),getBehavior(defaultBehavior,\"\".concat(this.responsePathEntry,\".invoice.information.basis\")),defaultAppearance,basisBehaviors,basisAppearances);InvoiceTableForm.build(builder,serverResponse,this.responsePathEntry);builder.buildLoader();builder.buildSubmit(SAVE,null,getErrors('global'));builder.buildForm();return builder.getForm();}},{key:\"showServerErrorsInForm\",value:function showServerErrorsInForm(data){var errorCb=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(data[0]){Flash.error(data[0]);}if(errorCb)errorCb(data);}},{key:\"makeSubmitRequest\",value:function makeSubmitRequest(data){return this.state.document&&this.props.isEdit?InvoiceService.edit(this.state.document.id,data):InvoiceService.create(data);}},{key:\"handleError\",value:function handleError(data){var errors={};var document='messages.document';var invoice='messages.document.invoice';var consignee='messages.document.invoice.consignee';var consignor='messages.document.invoice.cargoFrom.consignor';var goods='messages.document.table.goods';var purposeError=get(data,\"messages.purpose.errors\");if(purposeError)errors.purpose=purposeError[0];var toError=get(data,\"messages.to.errors\");if(toError)errors.recipient=toError[0];var economicSubjectNameError=get(data,\"\".concat(document,\".economicSubjectName.errors\"));if(economicSubjectNameError)errors.economicSubjectName=economicSubjectNameError[0];var signorPositionError=get(data,\"\".concat(document,\".signor.position.errors\"));if(signorPositionError){signorPositionError.unshift('Заполните поле Должность в разделе Кабинет');this.showServerErrorsInForm(signorPositionError);errors.global=signorPositionError[0];}var nameError=get(data,\"\".concat(document,\".name.errors\"));if(nameError)errors.name=nameError[0];var numberError=get(data,\"\".concat(invoice,\".number.errors\"));if(numberError)errors.number=numberError[0];var dateError=get(data,\"\".concat(invoice,\".date.errors\"));if(dateError)errors.date=dateError[0];var paymentDocumentsError=get(data,\"\".concat(invoice,\".paymentDocuments.errors\"));if(paymentDocumentsError){set(errors,'invoice.paymentDocuments',paymentDocumentsError[0]);}var paymentDocumentsElementsErrors=get(data,\"\".concat(invoice,\".paymentDocuments\"));if(paymentDocumentsElementsErrors){set(errors,'invoice.paymentDocuments',paymentDocumentsElementsErrors);}var consignorErrors=get(data,consignor);if(consignorErrors){set(errors,'cargoFrom.consignor',consignorErrors);}var consigneeErrors=get(data,consignee);if(consigneeErrors){set(errors,'consignee',consigneeErrors);}var factorErrors=get(data,\"\".concat(invoice,\".information.factor\"));if(factorErrors){set(errors,'information.factor',factorErrors);}var currencyCodeError=get(data,\"\".concat(invoice,\".currencyCode.errors\"));if(currencyCodeError)errors.currency=currencyCodeError[0];var currencyNameError=get(data,\"\".concat(invoice,\".information.currencyName.errors\"));if(currencyNameError)errors.currency=currencyNameError[0];var exchangeRateError=get(data,\"\".concat(invoice,\".information.currencyExchangeRate.errors\"));if(exchangeRateError)errors.exchangeRate=exchangeRateError[0];var informationFieldsElementsErrors=get(data,\"\".concat(invoice,\".informationField.attributeValues\"));if(informationFieldsElementsErrors){if(errors.invoice){errors.invoice.informationField={attributeValues:informationFieldsElementsErrors};}else{errors.invoice={};errors.invoice.informationField={attributeValues:informationFieldsElementsErrors};}}var informationBasisError=get(data,\"\".concat(invoice,\".information.basis.errors\"));if(informationBasisError){set(errors,'information.basis',informationBasisError[0]);}var goodsErrors=get(data,\"\".concat(goods));if(goodsErrors){for(var item in goodsErrors){if(goodsErrors[item].measurementCode){goodsErrors[item].measurement=goodsErrors[item].measurementCode;}}errors.goods=goodsErrors;}this.setState({showSaveDocumentModal:true,errors:errors});}},{key:\"handleSubmitSuccess\",value:function handleSubmitSuccess(res){if(res.data&&res.data.success){var redirectUrl=DOCUMENT_VIEW.replace(':id',res.data.id);this.setState({isFormSentSuccessfully:true,isBusy:false,redirectUrl:redirectUrl,errors:null,showSaveDocumentModal:false});}}},{key:\"getAutocompleteValue\",value:function getAutocompleteValue(DomainVO,formData){var value=formData[DomainVO.field];if(!value)return Promise.resolve(null);if(this.fieldValueIsNotChosenFromDropdown(value)){return AutocompleteService[DomainVO.field].request(value).then(AutocompleteService.handleUserInput(DomainVO));}else{return Promise.resolve(new DomainVO(value));}}},{key:\"sortArrayGroupData\",value:function sortArrayGroupData(data){var sortedData=Object.values(data).reduce(function(itemsStore,item,index){itemsStore[index]=item;return itemsStore;},{});return sortedData;}},{key:\"processFormData\",value:function(){var _processFormData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(rawFormData){var paymentDocumentsSorted,infoFieldsSorted,formData,outputObj,division,recipient,invoice,information,currency,goods,total;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;delete rawFormData.paymentDocuments;paymentDocumentsSorted=this.sortArrayGroupData(this.state.paymentDocuments);set(rawFormData,'invoice.paymentDocuments',paymentDocumentsSorted);delete rawFormData.infoFields;infoFieldsSorted=this.sortArrayGroupData(this.state.infoFields);set(rawFormData,'invoice.informationField.attributeValues',infoFieldsSorted);formData=removeEmpty(rawFormData);outputObj={};outputObj.purpose=InvoicePurpose.value;outputObj.force=formData.force;outputObj.from={division:Core.company.mainDepartment.id};if(!formData.recipient){_context.next=21;break;}division=undefined;if(!(typeof formData.recipient==='string')){_context.next=19;break;}_context.next=17;return this.getRecipientByTitle(formData.recipient);case 17:recipient=_context.sent;if(recipient){division=Number(recipient.id);}case 19:if(typeof formData.recipient==='object'&&formData.recipient.id){division=Number(formData.recipient.id);}if(division){outputObj.to={division:division};}case 21:outputObj.document={economicSubjectName:formData.economicSubjectName};invoice=formData.invoice||{};information=formData.information||{};_context.prev=24;_context.next=27;return this.getAutocompleteValue(Currency,formData);case 27:currency=_context.sent;if(currency){invoice.currencyCode=currency.code.value;information.currencyName=currency.title;if(formData.exchangeRate&&!this.state.isExchangeRateFieldHidden){information.currencyExchangeRate=formData.exchangeRate;}}_context.next=34;break;case 31:_context.prev=31;_context.t0=_context[\"catch\"](24);console.log(_context.t0);case 34:if(Object.keys(information).length)invoice.information=information;outputObj.document.invoice=invoice;goods=formData.goods;if(goods){total={};total.totalCostBeforeTax=formData.totalCostBeforeTax;total.totalCostAfterTax=formData.totalCostAfterTax;total.totalAmountOfTax=formData.totalAmountOfTax;outputObj.document.table={goods:goods,total:total};}return _context.abrupt(\"return\",outputObj);case 41:_context.prev=41;_context.t1=_context[\"catch\"](0);throw createError(DOCUMENT_ERROR,'Ошибка processFormData для формы создания УПД.',_context.t1);case 44:case\"end\":return _context.stop();}}},_callee,this,[[0,41],[24,31]]);}));function processFormData(_x){return _processFormData.apply(this,arguments);}return processFormData;}()},{key:\"renderRedirect\",value:function renderRedirect(url){window.location=url;}},{key:\"showSuccessMsg\",value:function showSuccessMsg(){Flash.success(SUCCESS_SAVE_FORM);}},{key:\"decorateCurrency\",value:function(){var _decorateCurrency=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(serverResponse){var _serverResponse$param,_serverResponse$formD,_serverResponse$formD2;var invoice,currencyCode,serverResponseCurrency;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:invoice=this.isDocumentDuplicate?serverResponse===null||serverResponse===void 0?void 0:(_serverResponse$param=serverResponse.parameters)===null||_serverResponse$param===void 0?void 0:_serverResponse$param.invoice:serverResponse===null||serverResponse===void 0?void 0:(_serverResponse$formD=serverResponse.formData)===null||_serverResponse$formD===void 0?void 0:(_serverResponse$formD2=_serverResponse$formD.document)===null||_serverResponse$formD2===void 0?void 0:_serverResponse$formD2.invoice;currencyCode=invoice.currencyCode;if(!currencyCode){_context2.next=7;break;}_context2.next=5;return AutocompleteService.currencyByCode.request(currencyCode);case 5:serverResponseCurrency=_context2.sent;if(serverResponseCurrency.rows.length===1){serverResponse.currency=new Currency(serverResponseCurrency.rows[0]);}case 7:case\"end\":return _context2.stop();}}},_callee2,this);}));function decorateCurrency(_x2){return _decorateCurrency.apply(this,arguments);}return decorateCurrency;}()},{key:\"getRecipientByTitle\",value:function(){var _getRecipientByTitle=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(title){var recipient;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(title){_context3.next=2;break;}return _context3.abrupt(\"return\",Promise.resolve(null));case 2:_context3.next=4;return AutocompleteService.recipient.request(title).then(function(recipients){return recipients.rows.filter(function(item){return item.title.toLowerCase().includes(title.toLowerCase());});}).then(function(filteredRecipients){if(filteredRecipients.length===1)return filteredRecipients[0];var exactMatch=filteredRecipients.find(function(item){return item.title.toLowerCase()===title.toLowerCase();});return exactMatch||null;});case 4:recipient=_context3.sent;return _context3.abrupt(\"return\",recipient);case 6:case\"end\":return _context3.stop();}}},_callee3);}));function getRecipientByTitle(_x3){return _getRecipientByTitle.apply(this,arguments);}return getRecipientByTitle;}()},{key:\"decorateRecipient\",value:function(){var _decorateRecipient=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(serverResponse){var _serverResponse$this$;var _serverResponse$param2,name,inn,recipients,division,_recipients;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if((_serverResponse$this$=serverResponse[this.responcePathFirstSegment])===null||_serverResponse$this$===void 0?void 0:_serverResponse$this$.to){_context4.next=2;break;}return _context4.abrupt(\"return\");case 2:if(!this.isDocumentDuplicate){_context4.next=10;break;}// TODO check buyers\n_serverResponse$param2=serverResponse.parameters.invoice.buyers[0],name=_serverResponse$param2.name,inn=_serverResponse$param2.inn;_context4.next=6;return AutocompleteService.recipient.request();case 6:recipients=_context4.sent;serverResponse[Recipient.field]=recipients.rows.find(function(value){return value.title.includes(name)||value.title.includes(inn);});_context4.next=16;break;case 10:// TODO process person\ndivision=serverResponse.formData.to.division;if(!division){_context4.next=16;break;}_context4.next=14;return AutocompleteService.recipient.request();case 14:_recipients=_context4.sent;serverResponse[Recipient.field]=_recipients.rows.find(function(value){return value.id===division;});case 16:case\"end\":return _context4.stop();}}},_callee4,this);}));function decorateRecipient(_x4){return _decorateRecipient.apply(this,arguments);}return decorateRecipient;}()},{key:\"decorateMeasurement\",value:function(){var _decorateMeasurement=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(serverResponse){var _this3=this;var goods,newServerResponse;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:goods=get(serverResponse,\"\".concat(this.responsePathEntry,\".table.goods\"));if(goods){_context5.next=3;break;}return _context5.abrupt(\"return\");case 3:newServerResponse=serverResponse;goods.forEach(function(good,index){var measurementTitle=get(good,'information.measurementTitle');newServerResponse=setImmutable(newServerResponse,\"\".concat(_this3.responsePathEntry,\".table.goods.\").concat(index,\".measurementCode\"),measurementTitle);});return _context5.abrupt(\"return\",newServerResponse);case 6:case\"end\":return _context5.stop();}}},_callee5,this);}));function decorateMeasurement(_x5){return _decorateMeasurement.apply(this,arguments);}return decorateMeasurement;}()},{key:\"getCustomGoodsData\",value:function getCustomGoodsData(builder,serverResponse){var _this4=this;var serverResponseGoods=get(serverResponse,\"\".concat(this.responsePathEntry,\".table.goods\"));var localStateGoods=get(builder._component.state,'goods');if(serverResponseGoods&&!localStateGoods){var newValuesForState={};serverResponseGoods.forEach(function(good,index){var measurementTitle=get(builder._component.state,\"goods.\".concat(index,\".information.measurementTitle\"));if(!measurementTitle){var newMeasurementTitle=get(good,'information.measurementTitle');if(newMeasurementTitle){var newMeasurementData={information:{measurementTitle:newMeasurementTitle},measurementCode:get(_this4.serverResponse,\"\".concat(_this4.responsePathEntry,\".table.goods.\").concat(index,\".measurementCode\"))};newValuesForState=setImmutable(newValuesForState,\"goods.\".concat(index),newMeasurementData);}}var currentInfoFields=get(builder._component.state,\"goods.\".concat(index,\".infoFields\"));if(!currentInfoFields||!Object.entries(currentInfoFields).length){var newInfoFields=get(good,\"infoFields\");if(newInfoFields&&newInfoFields.length){newValuesForState=setImmutable(newValuesForState,\"goods.\".concat(index,\".infoFields\"),newInfoFields);}}var currentInformation=get(builder._component.state,\"goods.\".concat(index,\".information\"));if(!currentInformation||!Object.entries(currentInformation).length){var newInformation=get(good,\"information\");if(newInformation){newValuesForState=setImmutable(newValuesForState,\"goods.\".concat(index,\".information\"),newInformation);}}var currentIdentificationNumbers=get(builder._component.state,\"goods.\".concat(index,\".information.identificationNumbers\"));if(!currentIdentificationNumbers||!Object.entries(currentIdentificationNumbers).length){var newIdentificationNumbers=get(good,\"information.identificationNumbers\");if(newIdentificationNumbers&&newIdentificationNumbers.length){newValuesForState=setImmutable(newValuesForState,\"goods.\".concat(index,\".information.identificationNumbers\"),newIdentificationNumbers);}}var currentTracking=get(builder._component.state,\"goods.\".concat(index,\".information.tracking\"));if(!currentTracking||!Object.entries(currentTracking).length){var newTracking=get(good,\"information.tracking\");if(newTracking&&newTracking.length){newValuesForState=setImmutable(newValuesForState,\"goods.\".concat(index,\".information.tracking\"),newTracking);}}});if(Object.entries(newValuesForState).length){builder.setDataToComponentState(_objectSpread({},newValuesForState));}}}},{key:\"getCustomData\",value:function getCustomData(builder,serverResponse){var newValuesForState={};var paymentDocuments=get(serverResponse,\"\".concat(this.responsePathEntry,\".invoice.paymentDocuments\"));if(paymentDocuments)paymentDocuments=Object.entries(paymentDocuments);if(paymentDocuments&&paymentDocuments.length&&Object.entries(this.state.paymentDocuments).length===0){newValuesForState.paymentDocuments=paymentDocuments;}var infoFields=get(serverResponse,\"\".concat(this.responsePathEntry,\".invoice.informationField.attributeValues\"));if(infoFields)infoFields=Object.entries(infoFields);if(infoFields&&infoFields.length&&Object.entries(this.state.infoFields).length===0){newValuesForState.infoFields=infoFields;}if(Object.keys(newValuesForState).length){this.setState(_objectSpread({},newValuesForState));}}},{key:\"getData\",value:function(){var _getData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var _this$serverResponse,_this$serverResponse$,_this$serverResponse$2,document;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;_context6.next=3;return InvoiceService.get(this.props.id);case 3:this.serverResponse=_context6.sent;if(this.serverResponse.formData===null)this.isDocumentDuplicate=true;this.responsePathEntry=this.isDocumentDuplicate?'parameters':'formData.document';this.responcePathFirstSegment=this.isDocumentDuplicate?'parameters':'formData';_context6.next=9;return this.decorateCurrency(this.serverResponse);case 9:_context6.next=11;return this.decorateRecipient(this.serverResponse);case 11:_context6.next=13;return this.decorateMeasurement(this.serverResponse);case 13:document=_context6.sent;this.setState({isLoading:false,isError:false,document:document,paymentDocuments:get(this.serverResponse,\"\".concat(this.responsePathEntry,\".invoice.paymentDocuments\")),infoFields:get(this.serverResponse,\"\".concat(this.responsePathEntry,\".invoice.informationField.attributeValues\")),isExchangeRateFieldHidden:((_this$serverResponse=this.serverResponse)===null||_this$serverResponse===void 0?void 0:(_this$serverResponse$=_this$serverResponse.currency)===null||_this$serverResponse$===void 0?void 0:(_this$serverResponse$2=_this$serverResponse$.letterCode)===null||_this$serverResponse$2===void 0?void 0:_this$serverResponse$2.value)===Currency.initialValue.letterCode.value});_context6.next=21;break;case 17:_context6.prev=17;_context6.t0=_context6[\"catch\"](0);console.log('error',_context6.t0);this.setState({isLoading:false,isError:true});case 21:case\"end\":return _context6.stop();}}},_callee6,this,[[0,17]]);}));function getData(){return _getData.apply(this,arguments);}return getData;}()},{key:\"componentDidMount\",value:function componentDidMount(){if(this.props.id){this.getData();}}},{key:\"componentDidCatch\",value:function componentDidCatch(error,errorInfo){console.log('React error:',error);}},{key:\"render\",value:function render(){if(this.state.redirectUrl){return this.renderRedirect(this.state.redirectUrl);}if(this.state.isLoading)return/*#__PURE__*/React.createElement(Loading,{height:\"75vh\"});if(this.state.isError)return/*#__PURE__*/React.createElement(\"span\",null,\"\\u0412\\u043E\\u0437\\u043D\\u0438\\u043A\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430\");return this.createForm();}}]);return InvoiceForm;}(FormBase),(_applyDecoratedDescriptor(_class.prototype,\"showServerErrorsInForm\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"showServerErrorsInForm\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"handleError\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"handleError\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"handleSubmitSuccess\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"handleSubmitSuccess\"),_class.prototype)),_class);InvoiceForm.defaultValues={id:null};InvoiceForm.propsTypes={id:PropTypes.string};export default InvoiceForm;","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/invoice/forms/InvoiceForm.js"],"names":["React","FormBase","FormBuilder","Invoice","DateInvoice","NumInvoice","Currency","Recipient","EconomicSubjectName","ExchangeRate","Flash","Core","AutocompleteService","SAVE","SUCCESS_SAVE_FORM","PaymentDocument","CargoFrom","CargoTo","InvoicePurpose","InformationBasisType","BasisDocName","BasisDocNumber","BasisDocDate","BasisInformation","BasisDocId","InfoFieldFact1","styles","TOP","Behavior","Appearance","createError","autobind","DOCUMENT_VIEW","DOCUMENT","DOCUMENT_ERROR","PropTypes","InvoiceService","get","set","setObject","setImmutable","clone","combineMerge","removeEmpty","Loading","ParticipantForm","Factor","InvoiceTableForm","ArrayGroup","deepmerge","skipArgs","InvoiceForm","props","state","redirectUrl","document","isLoading","id","isError","showSaveDocumentModal","errors","paymentDocuments","infoFields","isExchangeRateFieldHidden","isDocumentDuplicate","responsePathEntry","responcePathFirstSegment","BASE_WIDTH","MARGIN","defaultBehavior","value","defaultAppearance","width","builder","requiredBehavior","isRequired","serverResponse","getCustomData","getCustomGoodsData","getErrors","errorsObjPath","_component","clearFieldError","path","Array","isArray","length","setState","updatedErrors","getBehavior","scope","mixin","initialFieldDomain","handleArrayGroupErrorsChange","newErrors","componentStateErrors","arrayGroupErrors","updatedArrayGroupErrors","arrayMerge","updatedComponentStateErrors","buildGroup","field","buildInput","buildDateInput","align","customClasses","width100","content","push","companyINN","company","inn","companyKPP","kpp","economicSubjectNameInitialValue","name","economicSubjectNameBehavior","buildInfo","filterForAutocomlete","res","filter","item","type","companyExternalType","buildAutocomplete","onChange","setDataToFormState","data","formState","merge","factor","cargoFromInitialValues","consigneeInitialValues","consignee","handleCurrencyChange","letter_code","initialValue","behaviorCurrency","currency","hiddenAndZeroHeight","DATE_WIDTH","basisBehaviors","basisFieldsAppearance","basisAppearances","build","buildLoader","buildSubmit","buildForm","getForm","errorCb","error","isEdit","edit","create","invoice","consignor","goods","purposeError","purpose","toError","recipient","economicSubjectNameError","economicSubjectName","signorPositionError","unshift","showServerErrorsInForm","global","nameError","numberError","number","dateError","date","paymentDocumentsError","paymentDocumentsElementsErrors","consignorErrors","consigneeErrors","factorErrors","currencyCodeError","currencyNameError","exchangeRateError","exchangeRate","informationFieldsElementsErrors","informationField","attributeValues","informationBasisError","goodsErrors","measurementCode","measurement","success","replace","isFormSentSuccessfully","isBusy","DomainVO","formData","Promise","resolve","fieldValueIsNotChosenFromDropdown","request","then","handleUserInput","sortedData","Object","values","reduce","itemsStore","index","rawFormData","paymentDocumentsSorted","sortArrayGroupData","infoFieldsSorted","outputObj","force","from","division","mainDepartment","undefined","getRecipientByTitle","Number","to","information","getAutocompleteValue","currencyCode","code","currencyName","title","currencyExchangeRate","console","log","keys","total","totalCostBeforeTax","totalCostAfterTax","totalAmountOfTax","table","url","window","location","parameters","currencyByCode","serverResponseCurrency","rows","recipients","toLowerCase","includes","filteredRecipients","exactMatch","find","buyers","newServerResponse","forEach","good","measurementTitle","serverResponseGoods","localStateGoods","newValuesForState","newMeasurementTitle","newMeasurementData","currentInfoFields","entries","newInfoFields","currentInformation","newInformation","currentIdentificationNumbers","newIdentificationNumbers","currentTracking","newTracking","setDataToComponentState","decorateCurrency","decorateRecipient","decorateMeasurement","letterCode","getData","errorInfo","renderRedirect","createForm","defaultValues","propsTypes","string"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport FormBase from '../../../common/form/FormBase';\r\nimport FormBuilder from '../../../common/form/documents/DocumentFormBuilder';\r\n\r\nimport Invoice from '@distate/core/dist/domain/documents/invoice/vo/Invoice';\r\nimport DateInvoice from '@distate/core/dist/domain/documents/invoice/vo/invoice/Date';\r\nimport NumInvoice from '@distate/core/dist/domain/documents/invoice/vo/invoice/Num';\r\n\r\nimport Currency from '@distate/core/dist/domain/documents/invoice/vo/Currency';\r\nimport Recipient from '@distate/core/dist/domain/documents/invoice/vo/recipient/Recipient';\r\nimport EconomicSubjectName from '@distate/core/dist/domain/documents/invoice/vo/EconomicSubjectName';\r\nimport ExchangeRate from '@distate/core/dist/domain/documents/invoice/vo/currency/ExchangeRate';\r\n\r\nimport Flash from '../../../common/flash/Flash';\r\nimport Core from '@distate/core/dist/application/Core';\r\nimport AutocompleteService from '@distate/core/dist/application/autocomplete/AutocompleteService';\r\nimport { SAVE, SUCCESS_SAVE_FORM } from '../../../common/Lbl';\r\n\r\nimport PaymentDocument from '@distate/core/dist/domain/documents/invoice/vo/invoice/payment_document/PaymentDocument';\r\nimport CargoFrom from '@distate/core/dist/domain/documents/invoice/vo/invoice/CargoFrom';\r\nimport CargoTo from '@distate/core/dist/domain/documents/upd/vo/invoice/CargoTo';\r\nimport InvoicePurpose from '@distate/core/dist/domain/documents/invoice/vo/purpose/Invoice';\r\n\r\nimport InformationBasisType from '@distate/core/dist/domain/documents/invoice/vo/invoice/InformationBasisType';\r\nimport BasisDocName from '@distate/core/dist/domain/documents/invoice/standard_element/basis/DocName';\r\nimport BasisDocNumber from '@distate/core/dist/domain/documents/invoice/standard_element/basis/DocNumber';\r\nimport BasisDocDate from '@distate/core/dist/domain/documents/invoice/standard_element/basis/DocDate';\r\nimport BasisInformation from '@distate/core/dist/domain/documents/invoice/standard_element/basis/Information';\r\nimport BasisDocId from '@distate/core/dist/domain/documents/invoice/standard_element/basis/DocId';\r\n\r\nimport InfoFieldFact1 from '@distate/core/dist/domain/documents/invoice/vo/invoice/InfoFieldFact1';\r\n\r\nimport styles from '../../../common/form/documents/DocumentFormBuilder.module.css';\r\nimport { TOP } from '../../../common/Placement';\r\nimport Behavior from '../../../common/form/parameters/Behavior';\r\nimport Appearance from '../../../common/form/parameters/Appearance';\r\nimport createError from '@distate/core/dist/application/error/ErrorFactory';\r\nimport autobind from 'autobind-decorator';\r\nimport { DOCUMENT_VIEW } from '../../../common/Url';\r\nimport { DOCUMENT as DOCUMENT_ERROR } from '@distate/core/dist/application/error/Error';\r\nimport PropTypes from 'prop-types';\r\nimport InvoiceService from '@distate/core/dist/application/documents/invoice/InvoiceService';\r\nimport get from 'get-value';\r\nimport set from 'set-value';\r\nimport setObject from 'object-path';\r\nimport { set as setImmutable } from 'object-path-immutable';\r\nimport { clone, combineMerge, removeEmpty } from '../../../utils/ObjectUtil';\r\nimport { Loading } from '@distate/components';\r\nimport ParticipantForm from '../../upd/fields/ParticipantForm';\r\nimport Factor from '@distate/core/dist/domain/documents/upd/vo/factor/Factor';\r\nimport InvoiceTableForm from '../../../common/form/InvoiceTableForm';\r\nimport ArrayGroup from '../../upd/forms/ArrayGroup';\r\nimport deepmerge from 'deepmerge';\r\nimport skipArgs from '../../../utils/skipArgs';\r\n\r\nclass InvoiceForm extends FormBase {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      ...this.state,\r\n      redirectUrl: '',\r\n      document: null,\r\n      isLoading: !!props.id,\r\n      isError: false,\r\n      showSaveDocumentModal: false,\r\n      errors: null,\r\n      paymentDocuments: [],\r\n      infoFields: [],\r\n      isExchangeRateFieldHidden: true\r\n    };\r\n\r\n    this.isDocumentDuplicate = false;\r\n    this.responsePathEntry = null;\r\n    this.responcePathFirstSegment = null;\r\n  }\r\n\r\n  createForm() {\r\n    const BASE_WIDTH = 460;\r\n    const MARGIN = 6;\r\n    const defaultBehavior = new Behavior({value: 'invoice_form'});\r\n    const defaultAppearance = new Appearance({ width: BASE_WIDTH + MARGIN });\r\n\r\n    const builder = new FormBuilder(this, defaultBehavior, defaultAppearance);\r\n\r\n    const requiredBehavior = new Behavior({ isRequired: true });\r\n\r\n    const serverResponse = this.state.document;\r\n\r\n    this.getCustomData(builder, serverResponse);\r\n    this.getCustomGoodsData(builder, serverResponse);\r\n    const getErrors = errorsObjPath => {\r\n      return clone(get(builder._component, `state.errors.${errorsObjPath}`));\r\n    };\r\n    const clearFieldError = path => {\r\n      let errors = get(builder._component, `state.errors.${path}`);\r\n      if (Array.isArray(errors) && errors.length) {\r\n        setObject(errors, `state.errors.${path}`, []);\r\n        builder._component.setState({ errors });\r\n      }\r\n      if (typeof errors === 'string') {\r\n        errors = get(builder._component, `state.errors`);\r\n        const updatedErrors = setImmutable(errors, path, '');\r\n        builder._component.setState({ errors: updatedErrors });\r\n      }\r\n    };\r\n    const getBehavior = (defaultBehavior, path, scope = '') => {\r\n      return serverResponse\r\n        ? Behavior.mixin(defaultBehavior, {\r\n            initialFieldDomain: {\r\n              value: scope ? set({}, scope, get(serverResponse, path)) : get(serverResponse, path)\r\n            }\r\n          })\r\n        : defaultBehavior;\r\n    };\r\n\r\n    const handleArrayGroupErrorsChange = path => newErrors => {\r\n      const componentStateErrors = get(builder._component, `state.errors`) || {};\r\n      const arrayGroupErrors = get(componentStateErrors, path) || {};\r\n      const updatedArrayGroupErrors = deepmerge(arrayGroupErrors, newErrors, {\r\n        arrayMerge: combineMerge\r\n      });\r\n      const updatedComponentStateErrors = setImmutable(\r\n        componentStateErrors,\r\n        path,\r\n        updatedArrayGroupErrors\r\n      );\r\n      builder._component.setState({ errors: updatedComponentStateErrors });\r\n    };\r\n\r\n    builder.buildGroup(\r\n      Invoice,\r\n      {\r\n        [NumInvoice.field]: builder.buildInput,\r\n        [DateInvoice.field]: builder.buildDateInput\r\n      },\r\n      getBehavior(defaultBehavior, `${this.responsePathEntry}.invoice`),\r\n      defaultAppearance,\r\n      {\r\n        [NumInvoice.field]: getBehavior(\r\n          requiredBehavior,\r\n          `${this.responsePathEntry}.invoice.number`\r\n        ),\r\n        [DateInvoice.field]: getBehavior(requiredBehavior, `${this.responsePathEntry}.invoice.date`)\r\n      },\r\n      {\r\n        [NumInvoice.field]: new Appearance({\r\n          width: BASE_WIDTH - 120,\r\n          align: TOP\r\n        }),\r\n        [DateInvoice.field]: new Appearance({\r\n          width: 120,\r\n          customClasses: `ds-input ${styles.width100}`,\r\n          align: TOP\r\n        })\r\n      }\r\n    );\r\n\r\n    builder.content.push(() => (\r\n      <ArrayGroup\r\n        domainVO={PaymentDocument}\r\n        initialValues={this.state.paymentDocuments}\r\n        returnState={paymentDocuments => this.setState({ paymentDocuments })}\r\n        hasFixedWidthFields\r\n        inputGroupWidth=\"466px\"\r\n        errors={getErrors(PaymentDocument.field)}\r\n        handleErrorsChange={handleArrayGroupErrorsChange(PaymentDocument.field)}\r\n      />\r\n    ));\r\n\r\n    const companyINN = Core.company?.inn?.value ? `, ИНН: ${Core.company?.inn?.value}` : '';\r\n    const companyKPP = Core.company?.kpp?.value ? `, КПП: ${Core.company?.kpp?.value}` : '';\r\n    const economicSubjectNameInitialValue = serverResponse\r\n      ? get(serverResponse, `${this.responsePathEntry}.economicSubjectName`)\r\n      : `${Core.company?.name}${companyINN}${companyKPP}`;\r\n\r\n    const economicSubjectNameBehavior = new Behavior({\r\n      initialFieldDomain: {\r\n        value: economicSubjectNameInitialValue\r\n      },\r\n      isRequired: true\r\n    });\r\n    builder.buildInfo(EconomicSubjectName, economicSubjectNameBehavior);\r\n\r\n    /** фильтр для автокомплита */\r\n    const filterForAutocomlete = res => res.filter(item => ((item.type === 'division') && item.companyExternalType !== 'taxcom'));\r\n    builder.buildAutocomplete(\r\n      Recipient,\r\n      getBehavior(\r\n        new Behavior({ value: 'invoice_form', isRequired: true, onChange: () => clearFieldError(Recipient.field) }),\r\n        `${Recipient.field}.title`\r\n      ),\r\n      ...skipArgs(2),\r\n      filterForAutocomlete\r\n    );\r\n\r\n    const setDataToFormState = path => data => {\r\n      set(builder.formState, `values.${path}`, data, { merge: true });\r\n    };\r\n    builder.content.push(() => (\r\n      <ParticipantForm\r\n        DomainVO={Factor}\r\n        setDataToFormState={setDataToFormState('information')}\r\n        initialValues={{\r\n          factor: get(serverResponse, `${this.responsePathEntry}.invoice.information.factor`)\r\n        }}\r\n        errors={{ factor: getErrors('information.factor') }}\r\n        clearFieldError={clearFieldError}\r\n      />\r\n    ));\r\n\r\n    const cargoFromInitialValues = get(\r\n      serverResponse,\r\n      `${this.responsePathEntry}.invoice.cargoFrom`\r\n    );\r\n    builder.content.push(() => (\r\n      <ParticipantForm\r\n        DomainVO={CargoFrom}\r\n        setDataToFormState={setDataToFormState('invoice.cargoFrom')}\r\n        scope={'consignor'}\r\n        initialValues={\r\n          this.isDocumentDuplicate ? cargoFromInitialValues[0] : cargoFromInitialValues\r\n        }\r\n        errors={getErrors('invoice.cargoFrom')}\r\n        clearFieldError={clearFieldError}\r\n      />\r\n    ));\r\n\r\n    const consigneeInitialValues = get(\r\n      serverResponse,\r\n      `${this.responsePathEntry}.invoice.consignee${this.isDocumentDuplicate ? 's' : ''}`\r\n    );\r\n    builder.content.push(() => (\r\n      <ParticipantForm\r\n        DomainVO={CargoTo}\r\n        setDataToFormState={setDataToFormState('invoice')}\r\n        scope={'consignee'}\r\n        initialValues={{\r\n          consignee: this.isDocumentDuplicate ? consigneeInitialValues[0] : consigneeInitialValues\r\n        }}\r\n        errors={{ consignee: getErrors('consignee') }}\r\n        clearFieldError={clearFieldError}\r\n      />\r\n    ));\r\n\r\n    const handleCurrencyChange = ({ letter_code }) => {\r\n      clearFieldError(Currency.field);\r\n      this.setState({\r\n        isExchangeRateFieldHidden: letter_code === Currency.initialValue.letter_code\r\n      });\r\n    };\r\n    const behaviorCurrency = new Behavior({\r\n      initialFieldDomain: (serverResponse && serverResponse.currency) || Currency.initialValue,\r\n      isRequired: true,\r\n      onChange: handleCurrencyChange\r\n    });\r\n    builder.buildAutocomplete(Currency, behaviorCurrency);\r\n\r\n    builder.buildInput(\r\n      ExchangeRate,\r\n      getBehavior(\r\n        defaultBehavior,\r\n        `${this.responsePathEntry}.invoice.information.currencyExchangeRate`\r\n      ),\r\n      new Appearance({\r\n        ...defaultAppearance,\r\n        customClasses: this.state.isExchangeRateFieldHidden ? styles.hiddenAndZeroHeight : ''\r\n      })\r\n    );\r\n\r\n    const DATE_WIDTH = 120;\r\n    const basisBehaviors = {\r\n      [BasisDocName.field]: defaultBehavior,\r\n      [BasisDocNumber.field]: defaultBehavior,\r\n      [BasisDocDate.field]: defaultBehavior,\r\n      [BasisInformation.field]: defaultBehavior,\r\n      [BasisDocId.field]: defaultBehavior\r\n    };\r\n    const basisFieldsAppearance = new Appearance({\r\n      width: (2 * BASE_WIDTH - DATE_WIDTH - 3 * MARGIN) / 4,\r\n      align: TOP,\r\n      customClasses: `ds-input ${styles.width100}`\r\n    });\r\n    const basisAppearances = {\r\n      [BasisDocName.field]: basisFieldsAppearance,\r\n      [BasisDocNumber.field]: basisFieldsAppearance,\r\n      [BasisDocDate.field]: new Appearance({\r\n        width: DATE_WIDTH,\r\n        align: TOP,\r\n        customClasses: `ds-input ${styles.width100}`\r\n      }),\r\n      [BasisInformation.field]: basisFieldsAppearance,\r\n      [BasisDocId.field]: basisFieldsAppearance\r\n    };\r\n\r\n    builder.content.push(() => (\r\n      <ArrayGroup\r\n        domainVO={InfoFieldFact1}\r\n        initialValues={this.state.infoFields}\r\n        returnState={infoFields => this.setState({ infoFields })}\r\n        hasFixedWidthFields\r\n        inputGroupWidth=\"466px\"\r\n        errors={getErrors(InfoFieldFact1.field)}\r\n        handleErrorsChange={handleArrayGroupErrorsChange(InfoFieldFact1.field)}\r\n      />\r\n    ));\r\n\r\n    builder.buildGroup(\r\n      InformationBasisType,\r\n      {\r\n        [BasisDocName.field]: builder.buildInput,\r\n        [BasisDocNumber.field]: builder.buildInput,\r\n        [BasisDocDate.field]: builder.buildDateInput,\r\n        [BasisInformation.field]: builder.buildInput,\r\n        [BasisDocId.field]: builder.buildInput\r\n      },\r\n      getBehavior(defaultBehavior, `${this.responsePathEntry}.invoice.information.basis`),\r\n      defaultAppearance,\r\n      basisBehaviors,\r\n      basisAppearances\r\n    );\r\n\r\n    InvoiceTableForm.build(builder, serverResponse, this.responsePathEntry);\r\n    builder.buildLoader();\r\n    builder.buildSubmit(SAVE, null, getErrors('global'));\r\n    builder.buildForm();\r\n\r\n    return builder.getForm();\r\n  }\r\n  @autobind\r\n  showServerErrorsInForm(data, errorCb = null) {\r\n    if (data[0]) {\r\n      Flash.error(data[0]);\r\n    }\r\n    if (errorCb) errorCb(data);\r\n  }\r\n  makeSubmitRequest(data) {\r\n    return this.state.document && this.props.isEdit\r\n      ? InvoiceService.edit(this.state.document.id, data)\r\n      : InvoiceService.create(data);\r\n  }\r\n  @autobind\r\n  handleError(data) {\r\n    const errors = {};\r\n    const document = 'messages.document';\r\n    const invoice = 'messages.document.invoice';\r\n    const consignee = 'messages.document.invoice.consignee';\r\n    const consignor = 'messages.document.invoice.cargoFrom.consignor';\r\n    const goods = 'messages.document.table.goods';\r\n\r\n    const purposeError = get(data, `messages.purpose.errors`);\r\n    if (purposeError) errors.purpose = purposeError[0];\r\n\r\n    const toError = get(data, `messages.to.errors`);\r\n    if (toError) errors.recipient = toError[0];\r\n\r\n    const economicSubjectNameError = get(data, `${document}.economicSubjectName.errors`);\r\n    if (economicSubjectNameError) errors.economicSubjectName = economicSubjectNameError[0];\r\n\r\n    const signorPositionError = get(data, `${document}.signor.position.errors`);\r\n    if (signorPositionError) {\r\n      signorPositionError.unshift('Заполните поле Должность в разделе Кабинет');\r\n      this.showServerErrorsInForm(signorPositionError);\r\n      errors.global = signorPositionError[0];\r\n    }\r\n    const nameError = get(data, `${document}.name.errors`);\r\n    if (nameError) errors.name = nameError[0];\r\n\r\n    const numberError = get(data, `${invoice}.number.errors`);\r\n    if (numberError) errors.number = numberError[0];\r\n\r\n    const dateError = get(data, `${invoice}.date.errors`);\r\n    if (dateError) errors.date = dateError[0];\r\n\r\n    const paymentDocumentsError = get(data, `${invoice}.paymentDocuments.errors`);\r\n    if (paymentDocumentsError) {\r\n      set(errors, 'invoice.paymentDocuments', paymentDocumentsError[0]);\r\n    }\r\n\r\n    const paymentDocumentsElementsErrors = get(data, `${invoice}.paymentDocuments`);\r\n    if (paymentDocumentsElementsErrors) {\r\n      set(errors, 'invoice.paymentDocuments', paymentDocumentsElementsErrors);\r\n    }\r\n\r\n    const consignorErrors = get(data, consignor);\r\n    if (consignorErrors) {\r\n      set(errors, 'cargoFrom.consignor', consignorErrors);\r\n    }\r\n\r\n    const consigneeErrors = get(data, consignee);\r\n    if (consigneeErrors) {\r\n      set(errors, 'consignee', consigneeErrors);\r\n    }\r\n\r\n    const factorErrors = get(data, `${invoice}.information.factor`);\r\n    if (factorErrors) {\r\n      set(errors, 'information.factor', factorErrors);\r\n    }\r\n\r\n    const currencyCodeError = get(data, `${invoice}.currencyCode.errors`);\r\n    if (currencyCodeError) errors.currency = currencyCodeError[0];\r\n\r\n    const currencyNameError = get(data, `${invoice}.information.currencyName.errors`);\r\n    if (currencyNameError) errors.currency = currencyNameError[0];\r\n\r\n    const exchangeRateError = get(data, `${invoice}.information.currencyExchangeRate.errors`);\r\n    if (exchangeRateError) errors.exchangeRate = exchangeRateError[0];\r\n\r\n    const informationFieldsElementsErrors = get(\r\n      data,\r\n      `${invoice}.informationField.attributeValues`\r\n    );\r\n    if (informationFieldsElementsErrors) {\r\n      if (errors.invoice) {\r\n        errors.invoice.informationField = {\r\n          attributeValues: informationFieldsElementsErrors\r\n        };\r\n      } else {\r\n        errors.invoice = {};\r\n        errors.invoice.informationField = {\r\n          attributeValues: informationFieldsElementsErrors\r\n        };\r\n      }\r\n    }\r\n\r\n    const informationBasisError = get(data, `${invoice}.information.basis.errors`);\r\n    if (informationBasisError) {\r\n      set(errors, 'information.basis', informationBasisError[0]);\r\n    }\r\n\r\n    const goodsErrors = get(data, `${goods}`);\r\n    if (goodsErrors) {\r\n      for (let item in goodsErrors) {\r\n        if (goodsErrors[item].measurementCode) {\r\n          goodsErrors[item].measurement = goodsErrors[item].measurementCode;\r\n        }\r\n      }\r\n      errors.goods = goodsErrors;\r\n    }\r\n    this.setState({ showSaveDocumentModal: true, errors });\r\n  }\r\n  @autobind\r\n  handleSubmitSuccess(res) {\r\n    if (res.data && res.data.success) {\r\n      const redirectUrl = DOCUMENT_VIEW.replace(':id', res.data.id);\r\n      this.setState({\r\n        isFormSentSuccessfully: true,\r\n        isBusy: false,\r\n        redirectUrl,\r\n        errors: null,\r\n        showSaveDocumentModal: false\r\n      });\r\n    }\r\n  }\r\n  getAutocompleteValue(DomainVO, formData) {\r\n    const value = formData[DomainVO.field];\r\n    if (!value) return Promise.resolve(null);\r\n    if (this.fieldValueIsNotChosenFromDropdown(value)) {\r\n      return AutocompleteService[DomainVO.field]\r\n        .request(value)\r\n        .then(AutocompleteService.handleUserInput(DomainVO));\r\n    } else {\r\n      return Promise.resolve(new DomainVO(value));\r\n    }\r\n  }\r\n\r\n  sortArrayGroupData(data) {\r\n    const sortedData = Object.values(data).reduce((itemsStore, item, index) => {\r\n      itemsStore[index] = item;\r\n      return itemsStore;\r\n    }, {});\r\n    return sortedData;\r\n  }\r\n\r\n  async processFormData(rawFormData) {\r\n    try {\r\n      delete rawFormData.paymentDocuments;\r\n      const paymentDocumentsSorted = this.sortArrayGroupData(this.state.paymentDocuments);\r\n      set(rawFormData, 'invoice.paymentDocuments', paymentDocumentsSorted);\r\n\r\n      delete rawFormData.infoFields;\r\n      const infoFieldsSorted = this.sortArrayGroupData(this.state.infoFields);\r\n      set(rawFormData, 'invoice.informationField.attributeValues', infoFieldsSorted);\r\n      const formData = removeEmpty(rawFormData);\r\n      const outputObj = {};\r\n\r\n      outputObj.purpose = InvoicePurpose.value;\r\n      outputObj.force = formData.force;\r\n      outputObj.from = {\r\n        division: Core.company.mainDepartment.id\r\n      };\r\n      if (formData.recipient) {\r\n        let division = undefined;\r\n\r\n        if (typeof formData.recipient === 'string') {\r\n          const recipient = await this.getRecipientByTitle(formData.recipient);\r\n          if (recipient) {\r\n            division = Number(recipient.id);\r\n          }\r\n        }\r\n        if (typeof formData.recipient === 'object' && formData.recipient.id) {\r\n          division = Number(formData.recipient.id);\r\n        }\r\n        if (division) {\r\n          outputObj.to = { division };\r\n        }\r\n      }\r\n      outputObj.document = {\r\n        economicSubjectName: formData.economicSubjectName\r\n      };\r\n      const invoice = formData.invoice || {};\r\n\r\n      const information = formData.information || {};\r\n      try {\r\n        const currency = await this.getAutocompleteValue(Currency, formData);\r\n        if (currency) {\r\n          invoice.currencyCode = currency.code.value;\r\n          information.currencyName = currency.title;\r\n          if (formData.exchangeRate && !this.state.isExchangeRateFieldHidden) {\r\n            information.currencyExchangeRate = formData.exchangeRate;\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.log(error);\r\n      }\r\n      if (Object.keys(information).length) invoice.information = information;\r\n\r\n      outputObj.document.invoice = invoice;\r\n\r\n      const goods = formData.goods;\r\n      if (goods) {\r\n        const total = {};\r\n        total.totalCostBeforeTax = formData.totalCostBeforeTax;\r\n        total.totalCostAfterTax = formData.totalCostAfterTax;\r\n        total.totalAmountOfTax = formData.totalAmountOfTax;\r\n        outputObj.document.table = { goods, total };\r\n      }\r\n\r\n      return outputObj;\r\n    } catch (error) {\r\n      throw createError(DOCUMENT_ERROR, 'Ошибка processFormData для формы создания УПД.', error);\r\n    }\r\n  }\r\n\r\n  renderRedirect(url) {\r\n    window.location = url;\r\n  }\r\n\r\n  showSuccessMsg() {\r\n    Flash.success(SUCCESS_SAVE_FORM);\r\n  }\r\n  async decorateCurrency(serverResponse) {\r\n    const invoice = this.isDocumentDuplicate\r\n      ? serverResponse?.parameters?.invoice\r\n      : serverResponse?.formData?.document?.invoice;\r\n    const currencyCode = invoice.currencyCode;\r\n\r\n    if (currencyCode) {\r\n      let serverResponseCurrency = await AutocompleteService.currencyByCode.request(currencyCode);\r\n      if (serverResponseCurrency.rows.length === 1) {\r\n        serverResponse.currency = new Currency(serverResponseCurrency.rows[0]);\r\n      }\r\n    }\r\n  }\r\n  async getRecipientByTitle(title) {\r\n    if (!title) return Promise.resolve(null);\r\n    const recipient = await AutocompleteService.recipient\r\n      .request(title)\r\n      .then(recipients => {\r\n        return recipients.rows.filter(item =>\r\n          item.title.toLowerCase().includes(title.toLowerCase())\r\n        );\r\n      })\r\n      .then(filteredRecipients => {\r\n        if (filteredRecipients.length === 1) return filteredRecipients[0];\r\n        const exactMatch = filteredRecipients.find(\r\n          item => item.title.toLowerCase() === title.toLowerCase()\r\n        );\r\n        return exactMatch || null;\r\n      });\r\n    return recipient;\r\n  }\r\n  async decorateRecipient(serverResponse) {\r\n    if (!serverResponse[this.responcePathFirstSegment]?.to) return;\r\n\r\n    if (this.isDocumentDuplicate) {\r\n      // TODO check buyers\r\n      const { name, inn } = serverResponse.parameters.invoice.buyers[0];\r\n      const recipients = await AutocompleteService.recipient.request();\r\n      serverResponse[Recipient.field] = recipients.rows.find(\r\n        value => value.title.includes(name) || value.title.includes(inn)\r\n      );\r\n    } else {\r\n      // TODO process person\r\n      const { division } = serverResponse.formData.to;\r\n      if (division) {\r\n        const recipients = await AutocompleteService.recipient.request();\r\n        serverResponse[Recipient.field] = recipients.rows.find(value => value.id === division);\r\n      }\r\n    }\r\n  }\r\n  async decorateMeasurement(serverResponse) {\r\n    const goods = get(serverResponse, `${this.responsePathEntry}.table.goods`);\r\n    if (!goods) return;\r\n    let newServerResponse = serverResponse;\r\n    goods.forEach((good, index) => {\r\n      const measurementTitle = get(good, 'information.measurementTitle');\r\n      newServerResponse = setImmutable(\r\n        newServerResponse,\r\n        `${this.responsePathEntry}.table.goods.${index}.measurementCode`,\r\n        measurementTitle\r\n      );\r\n    });\r\n    return newServerResponse;\r\n  }\r\n  getCustomGoodsData(builder, serverResponse) {\r\n    const serverResponseGoods = get(serverResponse, `${this.responsePathEntry}.table.goods`);\r\n    const localStateGoods = get(builder._component.state, 'goods');\r\n    if (serverResponseGoods && !localStateGoods) {\r\n      let newValuesForState = {};\r\n      serverResponseGoods.forEach((good, index) => {\r\n        const measurementTitle = get(\r\n          builder._component.state,\r\n          `goods.${index}.information.measurementTitle`\r\n        );\r\n        if (!measurementTitle) {\r\n          const newMeasurementTitle = get(good, 'information.measurementTitle');\r\n          if (newMeasurementTitle) {\r\n            const newMeasurementData = {\r\n              information: {\r\n                measurementTitle: newMeasurementTitle\r\n              },\r\n              measurementCode: get(\r\n                this.serverResponse,\r\n                `${this.responsePathEntry}.table.goods.${index}.measurementCode`\r\n              )\r\n            };\r\n            newValuesForState = setImmutable(\r\n              newValuesForState,\r\n              `goods.${index}`,\r\n              newMeasurementData\r\n            );\r\n          }\r\n        }\r\n\r\n        const currentInfoFields = get(builder._component.state, `goods.${index}.infoFields`);\r\n        if (!currentInfoFields || !Object.entries(currentInfoFields).length) {\r\n          const newInfoFields = get(good, `infoFields`);\r\n          if (newInfoFields && newInfoFields.length) {\r\n            newValuesForState = setImmutable(\r\n              newValuesForState,\r\n              `goods.${index}.infoFields`,\r\n              newInfoFields\r\n            );\r\n          }\r\n        }\r\n\r\n        const currentInformation = get(builder._component.state, `goods.${index}.information`);\r\n        if (!currentInformation || !Object.entries(currentInformation).length) {\r\n          const newInformation = get(good, `information`);\r\n          if (newInformation) {\r\n            newValuesForState = setImmutable(\r\n              newValuesForState,\r\n              `goods.${index}.information`,\r\n              newInformation\r\n            );\r\n          }\r\n        }\r\n\r\n        const currentIdentificationNumbers = get(\r\n          builder._component.state,\r\n          `goods.${index}.information.identificationNumbers`\r\n        );\r\n        if (!currentIdentificationNumbers || !Object.entries(currentIdentificationNumbers).length) {\r\n          const newIdentificationNumbers = get(good, `information.identificationNumbers`);\r\n          if (newIdentificationNumbers && newIdentificationNumbers.length) {\r\n            newValuesForState = setImmutable(\r\n              newValuesForState,\r\n              `goods.${index}.information.identificationNumbers`,\r\n              newIdentificationNumbers\r\n            );\r\n          }\r\n        }\r\n\r\n        const currentTracking = get(\r\n          builder._component.state,\r\n          `goods.${index}.information.tracking`\r\n        );\r\n        if (!currentTracking || !Object.entries(currentTracking).length) {\r\n          const newTracking = get(good, `information.tracking`);\r\n          if (newTracking && newTracking.length) {\r\n            newValuesForState = setImmutable(\r\n              newValuesForState,\r\n              `goods.${index}.information.tracking`,\r\n              newTracking\r\n            );\r\n          }\r\n        }\r\n      });\r\n      if (Object.entries(newValuesForState).length) {\r\n        builder.setDataToComponentState({ ...newValuesForState });\r\n      }\r\n    }\r\n  }\r\n  getCustomData(builder, serverResponse) {\r\n    const newValuesForState = {};\r\n    let paymentDocuments = get(\r\n      serverResponse,\r\n      `${this.responsePathEntry}.invoice.paymentDocuments`\r\n    );\r\n    if (paymentDocuments) paymentDocuments = Object.entries(paymentDocuments);\r\n    if (\r\n      paymentDocuments &&\r\n      paymentDocuments.length &&\r\n      Object.entries(this.state.paymentDocuments).length === 0\r\n    ) {\r\n      newValuesForState.paymentDocuments = paymentDocuments;\r\n    }\r\n    let infoFields = get(\r\n      serverResponse,\r\n      `${this.responsePathEntry}.invoice.informationField.attributeValues`\r\n    );\r\n    if (infoFields) infoFields = Object.entries(infoFields);\r\n    if (infoFields && infoFields.length && Object.entries(this.state.infoFields).length === 0) {\r\n      newValuesForState.infoFields = infoFields;\r\n    }\r\n    if (Object.keys(newValuesForState).length) {\r\n      this.setState({ ...newValuesForState });\r\n    }\r\n  }\r\n  async getData() {\r\n    try {\r\n      this.serverResponse = await InvoiceService.get(this.props.id);\r\n      if (this.serverResponse.formData === null) this.isDocumentDuplicate = true;\r\n      this.responsePathEntry = this.isDocumentDuplicate ? 'parameters' : 'formData.document';\r\n      this.responcePathFirstSegment = this.isDocumentDuplicate ? 'parameters' : 'formData';\r\n      await this.decorateCurrency(this.serverResponse);\r\n      await this.decorateRecipient(this.serverResponse);\r\n      let document = await this.decorateMeasurement(this.serverResponse);\r\n      this.setState({\r\n        isLoading: false,\r\n        isError: false,\r\n        document,\r\n        paymentDocuments: get(\r\n          this.serverResponse,\r\n          `${this.responsePathEntry}.invoice.paymentDocuments`\r\n        ),\r\n        infoFields: get(\r\n          this.serverResponse,\r\n          `${this.responsePathEntry}.invoice.informationField.attributeValues`\r\n        ),\r\n        isExchangeRateFieldHidden:\r\n          this.serverResponse?.currency?.letterCode?.value ===\r\n          Currency.initialValue.letterCode.value\r\n      });\r\n    } catch (error) {\r\n      console.log('error', error);\r\n      this.setState({ isLoading: false, isError: true });\r\n    }\r\n  }\r\n  componentDidMount() {\r\n    if (this.props.id) {\r\n      this.getData();\r\n    }\r\n  }\r\n  componentDidCatch(error, errorInfo) {\r\n    console.log('React error:', error);\r\n  }\r\n\r\n  render() {\r\n    if (this.state.redirectUrl) {\r\n      return this.renderRedirect(this.state.redirectUrl);\r\n    }\r\n    if (this.state.isLoading) return <Loading height=\"75vh\" />;\r\n    if (this.state.isError) return <span>Возникла ошибка</span>;\r\n    return this.createForm();\r\n  }\r\n}\r\n\r\nInvoiceForm.defaultValues = {\r\n  id: null\r\n};\r\n\r\nInvoiceForm.propsTypes = {\r\n  id: PropTypes.string\r\n};\r\n\r\nexport default InvoiceForm;\r\n"]},"metadata":{},"sourceType":"module"}