{"ast":null,"code":"import _classCallCheck from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _get from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/get\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\nimport SignHandlerBase from '../SignHandlerBase';\nimport SignRequest from '../../SignRequest';\nimport Core from '../../../Core';\nimport SecurityService from '../../../security/SecurityService';\n\nvar RolesHandler = /*#__PURE__*/function (_SignHandlerBase) {\n  _inherits(RolesHandler, _SignHandlerBase);\n\n  var _super = _createSuper(RolesHandler);\n\n  function RolesHandler() {\n    _classCallCheck(this, RolesHandler);\n\n    return _super.apply(this, arguments);\n  }\n\n  _createClass(RolesHandler, [{\n    key: \"sign\",\n    value: function sign(request) {\n      _get(_getPrototypeOf(RolesHandler.prototype), \"sign\", this).call(this, request);\n\n      if (this.canHandle(request)) {\n        var isGrantedToSign = SecurityService.hasSignRole();\n\n        if (isGrantedToSign) {\n          isGrantedToSign = Core.company && Core.company.isComplete || Core.user;\n        }\n\n        if (isGrantedToSign) {\n          var signRequest = SignRequest.clone(request);\n          signRequest.isGrantedToSign = isGrantedToSign;\n          return this.doNextHandler(signRequest);\n        } else {\n          var errorRequest = SignRequest.clone(request);\n          errorRequest.error = _get(_getPrototypeOf(RolesHandler.prototype), \"createSignError\", this).call(this, \"\\u041D\\u0435\\u0442 \\u043F\\u0440\\u0430\\u0432 \\u0434\\u043B\\u044F \\u043F\\u043E\\u0434\\u043F\\u0438\\u0441\\u0430\\u043D\\u0438\\u044F\");\n          return this.doNextHandler(errorRequest);\n        }\n      }\n\n      return this.doNextHandler(request);\n    }\n  }, {\n    key: \"canHandle\",\n    value: function canHandle(request) {\n      _get(_getPrototypeOf(RolesHandler.prototype), \"canHandle\", this).call(this, request);\n\n      return !!request.certificate;\n    }\n  }]);\n\n  return RolesHandler;\n}(SignHandlerBase);\n\nexport default RolesHandler;","map":{"version":3,"sources":["../../../../../src/application/sign/handlers/sign/RolesHandler.js"],"names":[],"mappings":";;;;;;AAAA,OAAO,eAAP,MAA4B,oBAA5B;AACA,OAAO,WAAP,MAAwB,mBAAxB;AACA,OAAO,IAAP,MAAiB,eAAjB;AACA,OAAO,eAAP,MAA4B,mCAA5B;;IAEM,Y;;;;;;;;;;;;;yBACC,O,EAAO;AACV,6EAAW,OAAX;;AACA,UAAI,KAAK,SAAL,CAAe,OAAf,CAAJ,EAA6B;AAC3B,YAAI,eAAe,GAAG,eAAe,CAAC,WAAhB,EAAtB;;AACA,YAAI,eAAJ,EAAqB;AACnB,UAAA,eAAe,GAAI,IAAI,CAAC,OAAL,IAAgB,IAAI,CAAC,OAAL,CAAa,UAA9B,IAA6C,IAAI,CAAC,IAApE;AACD;;AAED,YAAI,eAAJ,EAAqB;AACnB,cAAM,WAAW,GAAG,WAAW,CAAC,KAAZ,CAAkB,OAAlB,CAApB;AACA,UAAA,WAAW,CAAC,eAAZ,GAA8B,eAA9B;AACA,iBAAO,KAAK,aAAL,CAAmB,WAAnB,CAAP;AACD,SAJD,MAIO;AACL,cAAM,YAAY,GAAG,WAAW,CAAC,KAAZ,CAAkB,OAAlB,CAArB;AACA,UAAA,YAAY,CAAC,KAAb;AACA,iBAAO,KAAK,aAAL,CAAmB,YAAnB,CAAP;AACD;AACF;;AACD,aAAO,KAAK,aAAL,CAAmB,OAAnB,CAAP;AACD;;;8BAES,O,EAAO;AACf,kFAAgB,OAAhB;;AACA,aAAO,CAAC,CAAC,OAAO,CAAC,WAAjB;AACD;;;;EAzBwB,e;;AA4B3B,eAAe,YAAf","sourceRoot":"","sourcesContent":["import SignHandlerBase from '../SignHandlerBase';\r\nimport SignRequest from '../../SignRequest';\r\nimport Core from '../../../Core';\r\nimport SecurityService from '../../../security/SecurityService';\r\nclass RolesHandler extends SignHandlerBase {\r\n    sign(request) {\r\n        super.sign(request);\r\n        if (this.canHandle(request)) {\r\n            let isGrantedToSign = SecurityService.hasSignRole();\r\n            if (isGrantedToSign) {\r\n                isGrantedToSign = (Core.company && Core.company.isComplete) || Core.user;\r\n            }\r\n            if (isGrantedToSign) {\r\n                const signRequest = SignRequest.clone(request);\r\n                signRequest.isGrantedToSign = isGrantedToSign;\r\n                return this.doNextHandler(signRequest);\r\n            }\r\n            else {\r\n                const errorRequest = SignRequest.clone(request);\r\n                errorRequest.error = super.createSignError(`Нет прав для подписания`);\r\n                return this.doNextHandler(errorRequest);\r\n            }\r\n        }\r\n        return this.doNextHandler(request);\r\n    }\r\n    canHandle(request) {\r\n        super.canHandle(request);\r\n        return !!request.certificate;\r\n    }\r\n}\r\nexport default RolesHandler;\r\n//# sourceMappingURL=RolesHandler.js.map"]},"metadata":{},"sourceType":"module"}