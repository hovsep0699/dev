{"ast":null,"code":"import _defineProperty from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _classCallCheck from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import _applyDecoratedDescriptor from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/applyDecoratedDescriptor\";var _class,_temp;import autobind from'autobind-decorator';import classNames from'classnames';import deepmerge from'deepmerge';import get from'get-value';import{set}from'object-path-immutable';import React,{Component}from'react';import Button,{PRIMARY}from'../../../common/Button';import Select from'../../../common/form/components/select/Select';import Text from'../../../common/form/components/Text';import style from'../../../common/form/documents/DocumentFormBuilder.module.css';import styles from'./GoodInformationModal.module.css';import{ICON}from'@distate/components';import{CLEAR,SAVE}from'../../../common/Lbl';import Modal from'../../../common/modal/Modal';import{TOP}from'../../../common/Placement';import{combineMerge}from'../../../utils/ObjectUtil';var GoodInformationModal=(_class=(_temp=/*#__PURE__*/function(_Component){_inherits(GoodInformationModal,_Component);var _super=_createSuper(GoodInformationModal);function GoodInformationModal(props){var _this;_classCallCheck(this,GoodInformationModal);_this=_super.call(this,props);_this.handleFieldValue=function(Domain){return function(value){var currentFieldsValues=_this.state.fieldsValues;var path=_this.getDomainPath(Domain);var oldValue=get(currentFieldsValues,path);var fieldsValues=set(currentFieldsValues,path,value);if(oldValue!==value){_this.validateField(Domain,value);}_this.setState({fieldsValues:fieldsValues});};};_this.validateField=function(Domain,value){var errorPath=_this.getDomainPath(Domain);var newFieldError=[];var errorMsg=Domain.validate(value);if(errorMsg){newFieldError.push(errorMsg);}_this.setState({errors:set(_this.state.errors,\"\".concat(errorPath,\".errors\"),newFieldError)});};_this.getFieldErrorMsg=function(Domain){var path=_this.getDomainPath(Domain);var error=get(_this.state.errors,\"\".concat(path,\".errors\"));if(Array.isArray(error)&&error.length>0){return error[error.length-1];}};_this.state={isModalVisible:false,fieldsValues:{},errors:{}};_this.formScope=props.scope?\"\".concat(props.scope,\".\").concat(props.DomainVO.field):props.DomainVO.field;_this.errors=_this.props.errors||{};return _this;}_createClass(GoodInformationModal,[{key:\"componentDidMount\",value:function componentDidMount(){this.setInitialValues();}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){if(JSON.stringify(prevProps.errors)!==JSON.stringify(this.props.errors)){this.updateServerErrors();}}},{key:\"updateServerErrors\",value:function updateServerErrors(){var serverErrors=get(this.props,'errors');var errors=deepmerge(this.state.errors,set({},this.formScope,serverErrors),{arrayMerge:combineMerge});this.setState({errors:errors});}},{key:\"setInitialValues\",value:function setInitialValues(){var _this2=this;this.setState(function(state,props){var initialValues=set(_this2.state.fieldsValues,_this2.formScope,props.initialFieldDomain.value);return{fieldsValues:initialValues||{}};});}},{key:\"showModal\",value:function showModal(){this.setState({isModalVisible:true});}},{key:\"hideModal\",value:function hideModal(){this.setState({isModalVisible:false});}},{key:\"handleShowModalBtnClick\",value:function handleShowModalBtnClick(){this.showModal();}},{key:\"getDomainPath\",value:function getDomainPath(Domain){return this.formScope?\"\".concat(this.formScope,\".\").concat(Domain.field):\"\".concat(Domain.field);}},{key:\"getFieldValue\",value:function getFieldValue(Domain){var fieldsValues=this.state.fieldsValues;return get(fieldsValues,this.getDomainPath(Domain));}},{key:\"saveData\",value:function saveData(){var fieldsValues=this.state.fieldsValues;var setDataToComponentState=this.props.setDataToComponentState;setDataToComponentState(fieldsValues,'',true);}},{key:\"handleSaveBtnClick\",value:function handleSaveBtnClick(){this.saveData();this.hideModal();}},{key:\"handleClearBtnClick\",value:function handleClearBtnClick(){var DomainVO=this.props.DomainVO;var fiedsToClear=get(this.state.fieldsValues,this.formScope);var domainFields=DomainVO.VOs.map(function(VO){return VO.field;});var clearedFields;if(fiedsToClear){clearedFields=Object.keys(fiedsToClear).reduce(function(obj,key){if(domainFields.includes(key)){obj[key]='';}else{obj[key]=fiedsToClear[key];}return obj;},{});}var fieldsValues=set(this.state.fieldsValues,this.formScope,clearedFields);this.setState({fieldsValues:fieldsValues});}},{key:\"render\",value:function render(){var _this3=this;var _this$state=this.state,isModalVisible=_this$state.isModalVisible,errors=_this$state.errors;var DomainVO=this.props.DomainVO;var errorsObj=get(errors,this.formScope);this.hasErrors=false;if(errorsObj){this.hasErrors=Object.values(errorsObj).some(function(field){var _field$errors;return((_field$errors=field.errors)===null||_field$errors===void 0?void 0:_field$errors.length)>0;});}return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Button,{type:\"button\",title:DomainVO.hint,iconClass:ICON.tiPencilAlt,className:classNames(_defineProperty({},style.btnError,this.hasErrors)),onClick:this.handleShowModalBtnClick}),/*#__PURE__*/React.createElement(Modal,{hide:this.hideModal,isVisible:isModalVisible,width:\"600px\",key:\"\".concat(this.formScope,\"_goodInformationModal\")},/*#__PURE__*/React.createElement(Modal.Header,{title:DomainVO.name,className:style.center}),/*#__PURE__*/React.createElement(Modal.Body,null,/*#__PURE__*/React.createElement(\"ul\",{className:classNames('form',style.modalForm,style.center,styles.centered)},DomainVO.VOs.map(function(VO){if(VO.field==='kind'){return/*#__PURE__*/React.createElement(\"li\",null,/*#__PURE__*/React.createElement(Select,{DomainVO:VO,labelAlign:TOP,initialValue:_this3.getFieldValue(VO),onValueChange:_this3.handleFieldValue(VO),errorMsg:_this3.getFieldErrorMsg(VO),isRequired:true}));}else{return/*#__PURE__*/React.createElement(\"li\",null,/*#__PURE__*/React.createElement(Text,{DomainVO:VO,labelAlign:TOP,initialValue:_this3.getFieldValue(VO),onValueChange:_this3.handleFieldValue(VO),errorMsg:_this3.getFieldErrorMsg(VO)}));}}))),/*#__PURE__*/React.createElement(Modal.Footer,null,/*#__PURE__*/React.createElement(Button,{type:\"button\",className:\"center\",iconClass:ICON.accept,colorClass:PRIMARY,onClick:this.handleSaveBtnClick},SAVE),/*#__PURE__*/React.createElement(Button,{type:\"button\",className:\"center\",iconClass:ICON.cancel,onClick:this.handleClearBtnClick},CLEAR))));}}]);return GoodInformationModal;}(Component),_temp),(_applyDecoratedDescriptor(_class.prototype,\"showModal\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"showModal\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"hideModal\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"hideModal\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"handleShowModalBtnClick\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"handleShowModalBtnClick\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"getFieldValue\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"getFieldValue\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"saveData\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"saveData\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"handleSaveBtnClick\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"handleSaveBtnClick\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"handleClearBtnClick\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"handleClearBtnClick\"),_class.prototype)),_class);export default GoodInformationModal;","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/upd/forms/GoodInformationModal.js"],"names":["autobind","classNames","deepmerge","get","set","React","Component","Button","PRIMARY","Select","Text","style","styles","ICON","CLEAR","SAVE","Modal","TOP","combineMerge","GoodInformationModal","props","handleFieldValue","Domain","value","currentFieldsValues","state","fieldsValues","path","getDomainPath","oldValue","validateField","setState","errorPath","newFieldError","errorMsg","validate","push","errors","getFieldErrorMsg","error","Array","isArray","length","isModalVisible","formScope","scope","DomainVO","field","setInitialValues","prevProps","JSON","stringify","updateServerErrors","serverErrors","arrayMerge","initialValues","initialFieldDomain","showModal","setDataToComponentState","saveData","hideModal","fiedsToClear","domainFields","VOs","map","VO","clearedFields","Object","keys","reduce","obj","key","includes","errorsObj","hasErrors","values","some","hint","tiPencilAlt","btnError","handleShowModalBtnClick","name","center","modalForm","centered","getFieldValue","accept","handleSaveBtnClick","cancel","handleClearBtnClick"],"mappings":"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","sourcesContent":["import autobind from 'autobind-decorator';\r\nimport classNames from 'classnames';\r\nimport deepmerge from 'deepmerge';\r\nimport get from 'get-value';\r\nimport { set } from 'object-path-immutable';\r\nimport PropTypes from 'prop-types';\r\nimport React, { Component } from 'react';\r\nimport Button, { PRIMARY } from '../../../common/Button';\r\nimport Select from '../../../common/form/components/select/Select';\r\nimport Text from '../../../common/form/components/Text';\r\nimport style from '../../../common/form/documents/DocumentFormBuilder.module.css';\r\nimport styles from './GoodInformationModal.module.css';\r\nimport { ICON } from '@distate/components';\r\nimport { CLEAR, SAVE } from '../../../common/Lbl';\r\nimport Modal from '../../../common/modal/Modal';\r\nimport { TOP } from '../../../common/Placement';\r\nimport { combineMerge } from '../../../utils/ObjectUtil';\r\n\r\nclass GoodInformationModal extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      isModalVisible: false,\r\n      fieldsValues: {},\r\n      errors: {}\r\n    };\r\n\r\n    this.formScope = props.scope ? `${props.scope}.${props.DomainVO.field}` : props.DomainVO.field;\r\n    this.errors = this.props.errors || {};\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.setInitialValues();\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    if (JSON.stringify(prevProps.errors) !== JSON.stringify(this.props.errors)) {\r\n      this.updateServerErrors();\r\n    }\r\n  }\r\n\r\n  updateServerErrors() {\r\n    const serverErrors = get(this.props, 'errors');\r\n    const errors = deepmerge(this.state.errors, set({}, this.formScope, serverErrors), {\r\n      arrayMerge: combineMerge\r\n    });\r\n    this.setState({ errors });\r\n  }\r\n\r\n  setInitialValues() {\r\n    this.setState((state, props) => {\r\n      const initialValues = set(\r\n        this.state.fieldsValues,\r\n        this.formScope,\r\n        props.initialFieldDomain.value\r\n      );\r\n      return { fieldsValues: initialValues || {} };\r\n    });\r\n  }\r\n\r\n  @autobind\r\n  showModal() {\r\n    this.setState({ isModalVisible: true });\r\n  }\r\n\r\n  @autobind\r\n  hideModal() {\r\n    this.setState({ isModalVisible: false });\r\n  }\r\n\r\n  @autobind\r\n  handleShowModalBtnClick() {\r\n    this.showModal();\r\n  }\r\n\r\n  getDomainPath(Domain) {\r\n    return this.formScope ? `${this.formScope}.${Domain.field}` : `${Domain.field}`;\r\n  }\r\n\r\n  @autobind\r\n  getFieldValue(Domain) {\r\n    const { fieldsValues } = this.state;\r\n    return get(fieldsValues, this.getDomainPath(Domain));\r\n  }\r\n\r\n  handleFieldValue = Domain => value => {\r\n    const currentFieldsValues = this.state.fieldsValues;\r\n    const path = this.getDomainPath(Domain);\r\n    const oldValue = get(currentFieldsValues, path);\r\n    const fieldsValues = set(currentFieldsValues, path, value);\r\n\r\n    if (oldValue !== value) {\r\n      this.validateField(Domain, value);\r\n    }\r\n\r\n    this.setState({ fieldsValues });\r\n  };\r\n\r\n  validateField = (Domain, value) => {\r\n    const errorPath = this.getDomainPath(Domain);\r\n    const newFieldError = [];\r\n    const errorMsg = Domain.validate(value);\r\n\r\n    if (errorMsg) {\r\n      newFieldError.push(errorMsg);\r\n    }\r\n\r\n    this.setState({ errors: set(this.state.errors, `${errorPath}.errors`, newFieldError) });\r\n  };\r\n\r\n  getFieldErrorMsg = Domain => {\r\n    const path = this.getDomainPath(Domain);\r\n    const error = get(this.state.errors, `${path}.errors`);\r\n    if (Array.isArray(error) && error.length > 0) {\r\n      return error[error.length - 1];\r\n    }\r\n  };\r\n\r\n  @autobind\r\n  saveData() {\r\n    const { fieldsValues } = this.state;\r\n    const { setDataToComponentState } = this.props;\r\n\r\n    setDataToComponentState(fieldsValues, '', true);\r\n  }\r\n\r\n  @autobind\r\n  handleSaveBtnClick() {\r\n    this.saveData();\r\n    this.hideModal();\r\n  }\r\n\r\n  @autobind\r\n  handleClearBtnClick() {\r\n    const { DomainVO } = this.props;\r\n    const fiedsToClear = get(this.state.fieldsValues, this.formScope);\r\n    const domainFields = DomainVO.VOs.map(VO => VO.field);\r\n    let clearedFields;\r\n\r\n    if (fiedsToClear) {\r\n      clearedFields = Object.keys(fiedsToClear).reduce((obj, key) => {\r\n        if (domainFields.includes(key)) {\r\n          obj[key] = '';\r\n        } else {\r\n          obj[key] = fiedsToClear[key];\r\n        }\r\n\r\n        return obj;\r\n      }, {});\r\n    }\r\n\r\n    const fieldsValues = set(this.state.fieldsValues, this.formScope, clearedFields);\r\n\r\n    this.setState({ fieldsValues });\r\n  }\r\n\r\n  render() {\r\n    const { isModalVisible, errors } = this.state;\r\n    const { DomainVO } = this.props;\r\n    const errorsObj = get(errors, this.formScope);\r\n    this.hasErrors = false;\r\n\r\n    if (errorsObj) {\r\n      this.hasErrors = Object.values(errorsObj).some(field => {\r\n        return field.errors?.length > 0;\r\n      });\r\n    }\r\n\r\n    return (\r\n      <>\r\n        <Button\r\n          type=\"button\"\r\n          title={DomainVO.hint}\r\n          iconClass={ICON.tiPencilAlt}\r\n          className={classNames({ [style.btnError]: this.hasErrors })}\r\n          onClick={this.handleShowModalBtnClick}\r\n        ></Button>\r\n\r\n        <Modal\r\n          hide={this.hideModal}\r\n          isVisible={isModalVisible}\r\n          width=\"600px\"\r\n          key={`${this.formScope}_goodInformationModal`}\r\n        >\r\n          <Modal.Header title={DomainVO.name} className={style.center} />\r\n\r\n          <Modal.Body>\r\n            <ul className={classNames('form', style.modalForm, style.center, styles.centered)}>\r\n              {DomainVO.VOs.map(VO => {\r\n                if (VO.field === 'kind') {\r\n                  return (\r\n                    <li>\r\n                      <Select\r\n                        DomainVO={VO}\r\n                        labelAlign={TOP}\r\n                        initialValue={this.getFieldValue(VO)}\r\n                        onValueChange={this.handleFieldValue(VO)}\r\n                        errorMsg={this.getFieldErrorMsg(VO)}\r\n                        isRequired\r\n                      />\r\n                    </li>\r\n                  );\r\n                } else {\r\n                  return (\r\n                    <li>\r\n                      <Text\r\n                        DomainVO={VO}\r\n                        labelAlign={TOP}\r\n                        initialValue={this.getFieldValue(VO)}\r\n                        onValueChange={this.handleFieldValue(VO)}\r\n                        errorMsg={this.getFieldErrorMsg(VO)}\r\n                      />\r\n                    </li>\r\n                  );\r\n                }\r\n              })}\r\n            </ul>\r\n          </Modal.Body>\r\n\r\n          <Modal.Footer>\r\n            <Button\r\n              type=\"button\"\r\n              className=\"center\"\r\n              iconClass={ICON.accept}\r\n              colorClass={PRIMARY}\r\n              onClick={this.handleSaveBtnClick}\r\n            >\r\n              {SAVE}\r\n            </Button>\r\n\r\n            <Button\r\n              type=\"button\"\r\n              className=\"center\"\r\n              iconClass={ICON.cancel}\r\n              onClick={this.handleClearBtnClick}\r\n            >\r\n              {CLEAR}\r\n            </Button>\r\n          </Modal.Footer>\r\n        </Modal>\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nGoodInformationModal.propTypes = {\r\n  DomainVO: PropTypes.func,\r\n  scope: PropTypes.string\r\n};\r\n\r\nexport default GoodInformationModal;\r\n"]},"metadata":{},"sourceType":"module"}