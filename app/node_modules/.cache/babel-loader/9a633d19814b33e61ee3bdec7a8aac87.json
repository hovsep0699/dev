{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{useDispatch,useSelector}from'react-redux';import{Button,ButtonKinds,Icons}from'@distate/components';import Core from'@distate/core/dist/application/Core';import{getStaff,getEmployee,deactivateEmployee,activeEmployee}from'../../store/actions';import{selectStaff,selectStaffNumber,selectStaffFilter}from'../../store/selectors';import{joinNoEmptyValues}from'../../../../helpers/heplers';import{Pagination,PaginationLimit}from'../../../../common/pagination';import{StaffTools}from'./StaffTools';import{EmployeeCard}from'./EmployeeCard';export var Staff=function Staff(){var _Core$company;var _useState=useState(10),_useState2=_slicedToArray(_useState,2),limit=_useState2[0],setLimit=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),offset=_useState4[0],setOffset=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),companyId=_useState6[0],setCompanyId=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),cardVisible=_useState8[0],setCardVisible=_useState8[1];var dispatch=useDispatch();var staff=useSelector(selectStaff);var staffNumber=useSelector(selectStaffNumber)||0;var staffFilter=useSelector(selectStaffFilter);var currentEmployeeId=Core===null||Core===void 0?void 0:(_Core$company=Core.company)===null||_Core$company===void 0?void 0:_Core$company._currentEmployeeId;useEffect(function(){var _Core$company2;var id=Core===null||Core===void 0?void 0:(_Core$company2=Core.company)===null||_Core$company2===void 0?void 0:_Core$company2.localId;setCompanyId(id);dispatch(getStaff({id:id,params:{offset:offset,limit:limit,statusSystemName:'active',hash:'staff'}}));},[dispatch,limit,offset]);var onOpenCard=function onOpenCard(id){dispatch(getEmployee(id));setCardVisible(true);};/** деактивация сотрудника */var onDeactivate=function onDeactivate(employeeId){var _Core$company3;dispatch(deactivateEmployee({employeeId:employeeId,companyId:Core===null||Core===void 0?void 0:(_Core$company3=Core.company)===null||_Core$company3===void 0?void 0:_Core$company3.localId,params:staffFilter||{offset:offset,limit:limit,statusSystemName:'active',hash:'staff'}}));};/** активация сотрудника */var onActivation=function onActivation(employeeId){var _Core$company4;dispatch(activeEmployee({employeeId:employeeId,companyId:Core===null||Core===void 0?void 0:(_Core$company4=Core.company)===null||_Core$company4===void 0?void 0:_Core$company4.localId,params:staffFilter||{offset:offset,limit:limit,statusSystemName:'waiting_for_approval'}}));onOpenCard(employeeId);};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{style:{display:'flex',justifyContent:'space-between'}},/*#__PURE__*/React.createElement(StaffTools,{id:companyId,limit:limit,hasStatus:true}),/*#__PURE__*/React.createElement(PaginationLimit,{setLimit:setLimit,limit:limit})),/*#__PURE__*/React.createElement(\"table\",{className:\"table\"},/*#__PURE__*/React.createElement(\"thead\",{className:\"common-table-head\"},/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",{colSpan:2},\"\\u0424\\u0418\\u041E \\u0441\\u043E\\u0442\\u0440\\u0443\\u0434\\u043D\\u0438\\u043A\\u0430\"),/*#__PURE__*/React.createElement(\"td\",null,\"\\u0434\\u043E\\u043B\\u0436\\u043D\\u043E\\u0441\\u0442\\u044C\"),/*#__PURE__*/React.createElement(\"td\",null,\"e-mail\"),/*#__PURE__*/React.createElement(\"td\",{colSpan:2}))),/*#__PURE__*/React.createElement(\"tbody\",null,staff===null||staff===void 0?void 0:staff.map(function(employee){var id=employee.id,surname=employee.surname,name=employee.name,patronymic=employee.patronymic,position=employee.position,email=employee.email,status_system_name=employee.status_system_name;var fio=joinNoEmptyValues([surname,name,patronymic]);/** если id пренадленижт главному сотруднику, то его нельзя удалить */var isMainEmployee=currentEmployeeId===id;/** флаг активированности */var isActive=status_system_name==='active';/** флаг ожидания подтверждения */var isWaiting=status_system_name==='waiting_for_approval';return/*#__PURE__*/React.createElement(\"tr\",{key:id},/*#__PURE__*/React.createElement(\"td\",{colSpan:2},fio),/*#__PURE__*/React.createElement(\"td\",null,position),/*#__PURE__*/React.createElement(\"td\",null,email),/*#__PURE__*/React.createElement(\"td\",{align:\"right\",colSpan:2},!isActive&&/*#__PURE__*/React.createElement(Button,{kind:ButtonKinds.LightGreen,onClick:function onClick(){return onActivation(id);},icon:/*#__PURE__*/React.createElement(Icons.IconCheck,{fill:\"currentColor\"})},\"\\u0410\\u043A\\u0442\\u0438\\u0432\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C\"),!isMainEmployee&&(isActive||isWaiting)&&/*#__PURE__*/React.createElement(Button,{kind:ButtonKinds.Danger,onClick:function onClick(){return onDeactivate(id);},icon:/*#__PURE__*/React.createElement(Icons.IconClose,{fill:\"currentColor\"})},\"\\u0414\\u0435\\u0430\\u043A\\u0442\\u0438\\u0432\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C\"),' ',/*#__PURE__*/React.createElement(Button,{kind:ButtonKinds.Secondary,onClick:function onClick(){return onOpenCard(id);}},\"\\u041A\\u0430\\u0440\\u0442\\u043E\\u0447\\u043A\\u0430 \\u0441\\u043E\\u0442\\u0440\\u0443\\u0434\\u043D\\u0438\\u043A\\u0430\")));})),/*#__PURE__*/React.createElement(\"tfoot\",null,/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",{colSpan:3},\"\\u0412\\u0421\\u0415\\u0413\\u041E \\u0417\\u0410\\u041F\\u0418\\u0421\\u0415\\u0419: \",staffNumber),/*#__PURE__*/React.createElement(\"td\",{colSpan:3,align:\"right\"},/*#__PURE__*/React.createElement(\"div\",{className:\"pagination-right\"},/*#__PURE__*/React.createElement(Pagination,{listLength:staffNumber,setOffset:setOffset})))))),/*#__PURE__*/React.createElement(EmployeeCard,{hide:function hide(){return setCardVisible(false);},isVisible:cardVisible}));};","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/company/components/staff/Staff.tsx"],"names":["React","useEffect","useState","useDispatch","useSelector","Button","ButtonKinds","Icons","Core","getStaff","getEmployee","deactivateEmployee","activeEmployee","selectStaff","selectStaffNumber","selectStaffFilter","joinNoEmptyValues","Pagination","PaginationLimit","StaffTools","EmployeeCard","Staff","limit","setLimit","offset","setOffset","companyId","setCompanyId","cardVisible","setCardVisible","dispatch","staff","staffNumber","staffFilter","currentEmployeeId","company","_currentEmployeeId","id","localId","params","statusSystemName","hash","onOpenCard","onDeactivate","employeeId","onActivation","display","justifyContent","map","employee","surname","name","patronymic","position","email","status_system_name","fio","isMainEmployee","isActive","isWaiting","LightGreen","Danger","Secondary"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { Button, ButtonKinds, Icons } from '@distate/components';\r\nimport Core from '@distate/core/dist/application/Core';\r\nimport { getStaff, getEmployee, deactivateEmployee, activeEmployee } from '../../store/actions';\r\nimport { selectStaff, selectStaffNumber, selectStaffFilter } from '../../store/selectors';\r\nimport { joinNoEmptyValues } from '../../../../helpers/heplers';\r\nimport { Pagination, PaginationLimit } from '../../../../common/pagination';\r\nimport { StaffTools } from './StaffTools';\r\nimport { EmployeeCard } from './EmployeeCard';\r\n\r\nexport const Staff = () => {\r\n  const [limit, setLimit] = useState(10);\r\n  const [offset, setOffset] = useState(0);\r\n  const [companyId, setCompanyId] = useState();\r\n  const [cardVisible, setCardVisible] = useState(false);\r\n  const dispatch = useDispatch();\r\n\r\n  const staff = useSelector(selectStaff);\r\n  const staffNumber = useSelector(selectStaffNumber) || 0;\r\n  const staffFilter = useSelector(selectStaffFilter);\r\n\r\n  const currentEmployeeId = Core?.company?._currentEmployeeId;\r\n\r\n  useEffect(() => {\r\n    const id = Core?.company?.localId;\r\n    setCompanyId(id);\r\n    dispatch(\r\n      getStaff({ id, params: { offset, limit, statusSystemName: 'active', hash: 'staff' } })\r\n    );\r\n  }, [dispatch, limit, offset]);\r\n\r\n  const onOpenCard = (id: number) => {\r\n    dispatch(getEmployee(id));\r\n    setCardVisible(true);\r\n  };\r\n\r\n  /** деактивация сотрудника */\r\n  const onDeactivate = (employeeId: number) => {\r\n    dispatch(\r\n      deactivateEmployee({\r\n        employeeId,\r\n        companyId: Core?.company?.localId,\r\n        params: staffFilter || { offset, limit, statusSystemName: 'active', hash: 'staff' }\r\n      })\r\n    );\r\n  };\r\n\r\n  /** активация сотрудника */\r\n  const onActivation = (employeeId: number) => {\r\n    dispatch(\r\n      activeEmployee({\r\n        employeeId,\r\n        companyId: Core?.company?.localId,\r\n        params: staffFilter || { offset, limit, statusSystemName: 'waiting_for_approval' }\r\n      })\r\n    );\r\n    onOpenCard(employeeId);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div style={{ display: 'flex', justifyContent: 'space-between' }}>\r\n        <StaffTools id={companyId!} limit={limit} hasStatus />\r\n        <PaginationLimit setLimit={setLimit} limit={limit} />\r\n      </div>\r\n\r\n      <table className=\"table\">\r\n        <thead className=\"common-table-head\">\r\n          <tr>\r\n            <td colSpan={2}>ФИО сотрудника</td>\r\n            <td>должность</td>\r\n            <td>e-mail</td>\r\n            <td colSpan={2}></td>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {staff?.map(employee => {\r\n            const { id, surname, name, patronymic, position, email, status_system_name } = employee;\r\n            const fio = joinNoEmptyValues([surname, name, patronymic]);\r\n\r\n            /** если id пренадленижт главному сотруднику, то его нельзя удалить */\r\n            const isMainEmployee = currentEmployeeId === id;\r\n            /** флаг активированности */\r\n            const isActive = status_system_name === 'active';\r\n            /** флаг ожидания подтверждения */\r\n            const isWaiting = status_system_name === 'waiting_for_approval';\r\n\r\n            return (\r\n              <tr key={id}>\r\n                <td colSpan={2}>{fio}</td>\r\n                <td>{position}</td>\r\n                <td>{email}</td>\r\n                <td align=\"right\" colSpan={2}>\r\n                  {!isActive && (\r\n                    <Button\r\n                      kind={ButtonKinds.LightGreen}\r\n                      onClick={() => onActivation(id)}\r\n                      icon={<Icons.IconCheck fill=\"currentColor\" />}\r\n                    >\r\n                      Активировать\r\n                    </Button>\r\n                  )}\r\n                  {/** если не главный сотрудник и имеет статус активирован или ожидает решения */}\r\n                  {!isMainEmployee && (isActive || isWaiting) && (\r\n                    <Button\r\n                      kind={ButtonKinds.Danger}\r\n                      onClick={() => onDeactivate(id)}\r\n                      icon={<Icons.IconClose fill=\"currentColor\" />}\r\n                    >\r\n                      Деактивировать\r\n                    </Button>\r\n                  )}{' '}\r\n                  <Button kind={ButtonKinds.Secondary} onClick={() => onOpenCard(id)}>\r\n                    Карточка сотрудника\r\n                  </Button>\r\n                </td>\r\n              </tr>\r\n            );\r\n          })}\r\n        </tbody>\r\n        <tfoot>\r\n          <tr>\r\n            <td colSpan={3}>ВСЕГО ЗАПИСЕЙ: {staffNumber}</td>\r\n            <td colSpan={3} align=\"right\">\r\n              <div className=\"pagination-right\">\r\n                <Pagination listLength={staffNumber} setOffset={setOffset} />\r\n              </div>\r\n            </td>\r\n          </tr>\r\n        </tfoot>\r\n      </table>\r\n\r\n      <EmployeeCard hide={() => setCardVisible(false)} isVisible={cardVisible} />\r\n    </>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}