{"ast":null,"code":"import _toConsumableArray from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import React from'react';import AdminSection from'./AdminSection';import GlobalVariadicForm from'../GlobalVariadicForm';import{useDialog}from\"../../../pages/dashboard/modals/useDialog\";import{principaloptionsvalues}from\"../../../constants/options/options\";import{PrincipaltypeOptions}from\"../../../constants/initialValues/PrincipalFormInitialValues\";import ObservableComponent from\"../../../observableComponent/observableComponent\";import ModalFormFooter from\"../../../widgets/ModlFormFooter\";import GeneralSectionOptions from\"../../../pages/Sections/page/GeneralSectionOptions\";import{serviceLocator}from\"../../../../di/app_component\";var PrincipalSection=function PrincipalSection(_ref){var principals=_ref.principals,principalManager=_ref.principalManager,presenter=_ref.presenter,baseWidth=_ref.baseWidth;var _useDialog=useDialog(),hideDialog=_useDialog.hideDialog,openDialog=_useDialog.openDialog;var _handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(formData,index,isEditMode){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(isEditMode){principalManager.editPrincipal(index,formData);}else principalManager.addPrincipal(formData);presenter.update();hideDialog();case 3:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(_x,_x2,_x3){return _ref2.apply(this,arguments);};}();var showForm=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e,index,isSubmitting,isEditMode){var _selelctedPrincipal$g;var selelctedPrincipal;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return principalManager.getPrincipals()[index];case 2:selelctedPrincipal=_context2.sent;openDialog({alignment:\"center\",content:/*#__PURE__*/React.createElement(GlobalVariadicForm,{isSubmitting:isSubmitting,onStateChange:presenter.onFormStateChange,defaultValues:(_selelctedPrincipal$g=selelctedPrincipal===null||selelctedPrincipal===void 0?void 0:selelctedPrincipal.getFields())!==null&&_selelctedPrincipal$g!==void 0?_selelctedPrincipal$g:'',initialFields:principaloptionsvalues,formTypes:PrincipaltypeOptions,handleSubmit:function handleSubmit(e){return _handleSubmit(e,index,isEditMode);},close:hideDialog}),position:\"fixed\",width:\"704px\",maxHeight:\"90%\",footer:/*#__PURE__*/React.createElement(ObservableComponent,{builder:function builder(state){return/*#__PURE__*/React.createElement(ModalFormFooter,{state:state,onSave:function onSave(){return presenter.onFormStateChange(null,true,null);}});},create:function create(){return presenter;}}),title:'Поиск по МЧД'},e);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function showForm(_x4,_x5,_x6,_x7){return _ref3.apply(this,arguments);};}();var handleRemovePrincipal=function handleRemovePrincipal(index){var updatedPrincipals=_toConsumableArray(presenter.getState().principals);updatedPrincipals.splice(index,1);principalManager.removePrincipal(index);presenter.update();};return/*#__PURE__*/React.createElement(ObservableComponent,{builder:function builder(state){return/*#__PURE__*/React.createElement(GeneralSectionOptions,{presenter:serviceLocator.get(\"SectionPresenter\"),sectionData:state.principals,onShowForm:function onShowForm(e,index){return showForm(e,index,state.isSubmitting,false);},onRemove:handleRemovePrincipal,onEdit:function onEdit(e,index){return showForm(e,index,state.isSubmitting,true);},baseWidth:baseWidth// expandedWidth={expandedWidth}\n,isRequired:true,sectionTitle:\"Доверитель\",getInn:function getInn(section){var _section$getFields$in;return(_section$getFields$in=section===null||section===void 0?void 0:section.getFields()[\"inn\"])!==null&&_section$getFields$in!==void 0?_section$getFields$in:\"\";},builder:function builder(index,principal){var fields=principal===null||principal===void 0?void 0:principal.getFields();if(fields!=null&&fields.hasOwnProperty(\"type\")&&fields.hasOwnProperty(\"type\")){var _principal$getAdmins;return fields.type!=='IP'&&/*#__PURE__*/React.createElement(AdminSection,{subAdminManager:serviceLocator.get(\"SubAdminManager\"),formPresenter:serviceLocator.get(\"FormPresenter\"),presenter:presenter,principalManager:serviceLocator.get(\"PrincipalManager\"),admin:(_principal$getAdmins=principal===null||principal===void 0?void 0:principal.getAdmins())!==null&&_principal$getAdmins!==void 0?_principal$getAdmins:new Array(),principalIndex:index});}else{return null;}}});},create:function create(){return presenter;},buildWhen:function buildWhen(oldState,newState){return!oldState.compare(newState);}});};export default PrincipalSection;","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/POA/MCHD_ROOT/presentation/components/forms/sections/PrincipalSection.tsx"],"names":["React","AdminSection","GlobalVariadicForm","useDialog","principaloptionsvalues","PrincipaltypeOptions","ObservableComponent","ModalFormFooter","GeneralSectionOptions","serviceLocator","PrincipalSection","principals","principalManager","presenter","baseWidth","hideDialog","openDialog","handleSubmit","formData","index","isEditMode","editPrincipal","addPrincipal","update","showForm","e","isSubmitting","getPrincipals","selelctedPrincipal","alignment","content","onFormStateChange","getFields","position","width","maxHeight","footer","state","title","handleRemovePrincipal","updatedPrincipals","getState","splice","removePrincipal","get","section","principal","fields","hasOwnProperty","type","getAdmins","Array","oldState","newState","compare"],"mappings":"sgBAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,YAAP,KAAyB,gBAAzB,CACA,MAAOC,CAAAA,kBAAP,KAA+B,uBAA/B,CAIA,OAAQC,SAAR,KAAwB,2CAAxB,CACA,OAAQC,sBAAR,KAAqC,oCAArC,CACA,OAAQC,oBAAR,KAAmC,6DAAnC,CACA,MAAOC,CAAAA,mBAAP,KAAgC,kDAAhC,CAEA,MAAOC,CAAAA,eAAP,KAA4B,iCAA5B,CACA,MAAOC,CAAAA,qBAAP,KAAkC,oDAAlC,CACA,OAAQC,cAAR,KAA6B,8BAA7B,CAcA,GAAMC,CAAAA,gBAAiD,CAAG,QAApDA,CAAAA,gBAAoD,MAK8B,IAJzBC,CAAAA,UAIyB,MAJzBA,UAIyB,CAHzBC,gBAGyB,MAHzBA,gBAGyB,CAFzBC,SAEyB,MAFzBA,SAEyB,CADzBC,SACyB,MADzBA,SACyB,gBAInDX,SAAS,EAJ0C,CAI7EY,UAJ6E,YAI7EA,UAJ6E,CAIjEC,UAJiE,YAIjEA,UAJiE,CAMpF,GAAMC,CAAAA,aAAY,2FAAG,iBAAOC,QAAP,CAAsBC,KAAtB,CAAqCC,UAArC,kHACjB,GAAIA,UAAJ,CAAgB,CACZR,gBAAgB,CAACS,aAAjB,CAA+BF,KAA/B,CAAsCD,QAAtC,EACH,CAFD,IAGIN,CAAAA,gBAAgB,CAACU,YAAjB,CAA8BJ,QAA9B,EAEJL,SAAS,CAACU,MAAV,GAEAR,UAAU,GARO,sDAAH,kBAAZE,CAAAA,YAAY,qDAAlB,CAYA,GAAMO,CAAAA,QAAQ,2FAAG,kBAAOC,CAAP,CAAeN,KAAf,CAA8BO,YAA9B,CAAqDN,UAArD,8LACoBR,CAAAA,gBAAgB,CAACe,aAAjB,GAAiCR,KAAjC,CADpB,QACPS,kBADO,gBAGbZ,UAAU,CAAC,CACPa,SAAS,CAAE,QADJ,CAEPC,OAAO,cAAE,oBAAC,kBAAD,EACL,YAAY,CAAEJ,YADT,CAEL,aAAa,CAAEb,SAAS,CAACkB,iBAFpB,CAGL,aAAa,wBAAEH,kBAAF,SAAEA,kBAAF,iBAAEA,kBAAkB,CAAEI,SAApB,EAAF,+DAAqC,EAH7C,CAIL,aAAa,CAAE5B,sBAJV,CAKL,SAAS,CAAEC,oBALN,CAML,YAAY,CAAE,sBAACoB,CAAD,QAAYR,CAAAA,aAAY,CAACQ,CAAD,CAAIN,KAAJ,CAAWC,UAAX,CAAxB,EANT,CAOL,KAAK,CAAEL,UAPF,EAFF,CAWPkB,QAAQ,CAAE,OAXH,CAYPC,KAAK,CAAE,OAZA,CAaPC,SAAS,CAAE,KAbJ,CAcPC,MAAM,cAAE,oBAAC,mBAAD,EACJ,OAAO,CAAE,iBAACC,KAAD,qBACL,oBAAC,eAAD,EACI,KAAK,CAAEA,KADX,CAEI,MAAM,CAAE,wBAAMxB,CAAAA,SAAS,CAACkB,iBAAV,CAA4B,IAA5B,CAAkC,IAAlC,CAAwC,IAAxC,CAAN,EAFZ,EADK,EADL,CAOJ,MAAM,CAAE,wBAAMlB,CAAAA,SAAN,EAPJ,EAdD,CAwBPyB,KAAK,CAAE,cAxBA,CAAD,CAyBPb,CAzBO,CAAV,CAHa,wDAAH,kBAARD,CAAAA,QAAQ,0DAAd,CA+BA,GAAMe,CAAAA,qBAAqB,CAAG,QAAxBA,CAAAA,qBAAwB,CAACpB,KAAD,CAAmB,CAC7C,GAAMqB,CAAAA,iBAAiB,oBAAO3B,SAAS,CAAC4B,QAAV,GAAqB9B,UAA5B,CAAvB,CACA6B,iBAAiB,CAACE,MAAlB,CAAyBvB,KAAzB,CAAgC,CAAhC,EACAP,gBAAgB,CAAC+B,eAAjB,CAAiCxB,KAAjC,EACAN,SAAS,CAACU,MAAV,GAEH,CAND,CAUA,mBACI,oBAAC,mBAAD,EACI,OAAO,CAAE,iBAACc,KAAD,CAAiC,CACtC,mBACI,oBAAC,qBAAD,EACI,SAAS,CAAE5B,cAAc,CAACmC,GAAf,CAAqC,kBAArC,CADf,CAEI,WAAW,CAAEP,KAAK,CAAC1B,UAFvB,CAGI,UAAU,CAAE,oBAACc,CAAD,CAASN,KAAT,QAA2BK,CAAAA,QAAQ,CAACC,CAAD,CAAIN,KAAJ,CAAWkB,KAAK,CAACX,YAAjB,CAA+B,KAA/B,CAAnC,EAHhB,CAII,QAAQ,CAAEa,qBAJd,CAKI,MAAM,CAAE,gBAACd,CAAD,CAASN,KAAT,QAA2BK,CAAAA,QAAQ,CAACC,CAAD,CAAIN,KAAJ,CAAWkB,KAAK,CAACX,YAAjB,CAA+B,IAA/B,CAAnC,EALZ,CAMI,SAAS,CAAEZ,SACX;AAPJ,CAQI,UAAU,CAAE,IARhB,CAUI,YAAY,CAAE,YAVlB,CAWI,MAAM,CAAE,gBAAC+B,OAAD,yDAAaA,OAAb,SAAaA,OAAb,iBAAaA,OAAO,CAAEb,SAAT,GAAqB,KAArB,CAAb,+DAA4C,EAA5C,EAXZ,CAYI,OAAO,CAAE,iBAACb,KAAD,CAAgB2B,SAAhB,CAA0C,CAC/C,GAAMC,CAAAA,MAAW,CAAGD,SAAH,SAAGA,SAAH,iBAAGA,SAAS,CAAEd,SAAX,EAApB,CACA,GAAIe,MAAM,EAAI,IAAV,EAAkBA,MAAM,CAACC,cAAP,CAAsB,MAAtB,CAAlB,EAAmDD,MAAM,CAACC,cAAP,CAAsB,MAAtB,CAAvD,CAAsF,0BAClF,MAAOD,CAAAA,MAAM,CAACE,IAAP,GAAgB,IAAhB,eACH,oBAAC,YAAD,EACI,eAAe,CAAExC,cAAc,CAACmC,GAAf,CAAoC,iBAApC,CADrB,CAEI,aAAa,CAAEnC,cAAc,CAACmC,GAAf,CAAkC,eAAlC,CAFnB,CAGI,SAAS,CAAE/B,SAHf,CAII,gBAAgB,CAAEJ,cAAc,CAACmC,GAAf,CAAqC,kBAArC,CAJtB,CAKI,KAAK,uBAAEE,SAAF,SAAEA,SAAF,iBAAEA,SAAS,CAAEI,SAAX,EAAF,6DAA4B,GAAIC,CAAAA,KAAJ,EALrC,CAMI,cAAc,CAAEhC,KANpB,EADJ,CASH,CAVD,IAUO,CACH,MAAO,KAAP,CACH,CACJ,CA3BL,EADJ,CAgCH,CAlCL,CAmCI,MAAM,CAAE,wBAAMN,CAAAA,SAAN,EAnCZ,CAoCI,SAAS,CAAE,mBAACuC,QAAD,CAAWC,QAAX,CAAwB,CAC/B,MAAO,CAACD,QAAQ,CAACE,OAAT,CAAiBD,QAAjB,CAAR,CACH,CAtCL,EADJ,CA0CH,CA1GD,CA4GA,cAAe3C,CAAAA,gBAAf","sourcesContent":["import React from 'react';\r\nimport AdminSection from './AdminSection';\r\nimport GlobalVariadicForm from '../GlobalVariadicForm';\r\nimport {CreatePresenter} from \"../../../pages/CreatePoa/presenter/createPresenter\";\r\nimport {PrincipalManager} from \"../../../../core/PrincipalManager\";\r\nimport {Principal} from \"../../../../domain/model/Principal\";\r\nimport {useDialog} from \"../../../pages/dashboard/modals/useDialog\";\r\nimport {principaloptionsvalues} from \"../../../constants/options/options\";\r\nimport {PrincipaltypeOptions} from \"../../../constants/initialValues/PrincipalFormInitialValues\";\r\nimport ObservableComponent from \"../../../observableComponent/observableComponent\";\r\nimport {CreatePresenterState} from \"../../../pages/CreatePoa/presenter/createPresenterState\";\r\nimport ModalFormFooter from \"../../../widgets/ModlFormFooter\";\r\nimport GeneralSectionOptions from \"../../../pages/Sections/page/GeneralSectionOptions\";\r\nimport {serviceLocator} from \"../../../../di/app_component\";\r\nimport {SectionPresenter} from \"../../../pages/Sections/presenter/SectionPresenter\";\r\nimport {FormPresenter} from \"../presenter/FormPresenter\";\r\nimport {SubAdminManager} from \"../../../../core/SubAdminManager\";\r\nimport {CreatePresenterViewModel} from \"../../../pages/CreatePoa/presenter/createPresenterViewModel\";\r\nimport {PrincipalAdmin} from \"../../../../domain/model/PrincipalAdmin\";\r\n\r\ninterface PrincipalSectionProps {\r\n    presenter: CreatePresenter;\r\n    principalManager: PrincipalManager;\r\n    principals: Principal[];\r\n    baseWidth?: string;\r\n}\r\n\r\nconst PrincipalSection: React.FC<PrincipalSectionProps> = ({\r\n                                                               principals,\r\n                                                               principalManager,\r\n                                                               presenter,\r\n                                                               baseWidth\r\n                                                           }: PrincipalSectionProps) => {\r\n\r\n\r\n\r\n    const {hideDialog, openDialog} = useDialog();\r\n\r\n    const handleSubmit = async (formData: any, index: number, isEditMode: boolean) => {\r\n        if (isEditMode) {\r\n            principalManager.editPrincipal(index, formData);\r\n        } else\r\n            principalManager.addPrincipal(formData);\r\n\r\n        presenter.update();\r\n\r\n        hideDialog();\r\n\r\n    };\r\n\r\n    const showForm = async (e: any, index: number, isSubmitting: boolean, isEditMode: boolean) => {\r\n        const selelctedPrincipal = await principalManager.getPrincipals()[index];\r\n\r\n        openDialog({\r\n            alignment: \"center\",\r\n            content: <GlobalVariadicForm\r\n                isSubmitting={isSubmitting}\r\n                onStateChange={presenter.onFormStateChange}\r\n                defaultValues={selelctedPrincipal?.getFields() ?? ''}\r\n                initialFields={principaloptionsvalues}\r\n                formTypes={PrincipaltypeOptions}\r\n                handleSubmit={(e: any) => handleSubmit(e, index, isEditMode)}\r\n                close={hideDialog}\r\n            />,\r\n            position: \"fixed\",\r\n            width: \"704px\",\r\n            maxHeight: \"90%\",\r\n            footer: <ObservableComponent<CreatePresenterViewModel, CreatePresenterState, CreatePresenter>\r\n                builder={(state) => (\r\n                    <ModalFormFooter\r\n                        state={state}\r\n                        onSave={() => presenter.onFormStateChange(null, true, null)}\r\n                    />\r\n                )}\r\n                create={() => presenter}\r\n            />,\r\n\r\n            title: 'Поиск по МЧД',\r\n        }, e)\r\n    }\r\n\r\n    const handleRemovePrincipal = (index: number) => {\r\n        const updatedPrincipals = [...presenter.getState().principals];\r\n        updatedPrincipals.splice(index, 1);\r\n        principalManager.removePrincipal(index);\r\n        presenter.update();\r\n\r\n    };\r\n\r\n\r\n\r\n    return (\r\n        <ObservableComponent<CreatePresenterViewModel, CreatePresenterState, CreatePresenter>\r\n            builder={(state: CreatePresenterState) => {\r\n                return (\r\n                    <GeneralSectionOptions\r\n                        presenter={serviceLocator.get<SectionPresenter>(\"SectionPresenter\")}\r\n                        sectionData={state.principals}\r\n                        onShowForm={(e: any, index: number) => showForm(e, index, state.isSubmitting, false)}\r\n                        onRemove={handleRemovePrincipal}\r\n                        onEdit={(e: any, index: number) => showForm(e, index, state.isSubmitting, true)}\r\n                        baseWidth={baseWidth}\r\n                        // expandedWidth={expandedWidth}\r\n                        isRequired={true}\r\n\r\n                        sectionTitle={\"Доверитель\"}\r\n                        getInn={(section) => section?.getFields()[\"inn\"] ?? \"\"}\r\n                        builder={(index: number, principal?: Principal) => {\r\n                            const fields: any = principal?.getFields();\r\n                            if (fields != null && fields.hasOwnProperty(\"type\") && fields.hasOwnProperty(\"type\")) {\r\n                                return fields.type !== 'IP' && (\r\n                                    <AdminSection\r\n                                        subAdminManager={serviceLocator.get<SubAdminManager>(\"SubAdminManager\")}\r\n                                        formPresenter={serviceLocator.get<FormPresenter>(\"FormPresenter\")}\r\n                                        presenter={presenter}\r\n                                        principalManager={serviceLocator.get<PrincipalManager>(\"PrincipalManager\")}\r\n                                        admin={principal?.getAdmins() ?? new Array<PrincipalAdmin>()}\r\n                                        principalIndex={index}/>\r\n                                )\r\n                            } else {\r\n                                return null;\r\n                            }\r\n                        }\r\n                        }\r\n                    />\r\n                );\r\n            }}\r\n            create={() => presenter}\r\n            buildWhen={(oldState, newState) => {\r\n                return !oldState.compare(newState)\r\n            }}\r\n        />\r\n    );\r\n}\r\n\r\nexport default PrincipalSection;\r\n\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}