{"ast":null,"code":"import _objectSpread from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(companyRolesEffect),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(getStaffRolesWorker),_marked3=/*#__PURE__*/_regeneratorRuntime.mark(changeStaffRoleTitleWorker),_marked4=/*#__PURE__*/_regeneratorRuntime.mark(createStaffRoleWorker),_marked5=/*#__PURE__*/_regeneratorRuntime.mark(getStaffForRoleWorker),_marked6=/*#__PURE__*/_regeneratorRuntime.mark(deleteStaffForRoleWorker),_marked7=/*#__PURE__*/_regeneratorRuntime.mark(getNoStaffForRoleWorker),_marked8=/*#__PURE__*/_regeneratorRuntime.mark(addStaffForRoleWorker),_marked9=/*#__PURE__*/_regeneratorRuntime.mark(getDocumentFlowRolesWorker),_marked10=/*#__PURE__*/_regeneratorRuntime.mark(saveDocumentFlowRolesWorker),_marked11=/*#__PURE__*/_regeneratorRuntime.mark(deleteRoleWorker);import{takeLatest,put}from'redux-saga/effects';import{Flash}from'../../../../common/flash/Flash';import{getStaffRoles,setStaffRoles,changeStaffRoleTitle,createStaffRole,getStaffForRole,setStaffForRole,deleteStaffForRole,getNoStaffForRole,setNoStaffForRole,addStaffForRole,getDocumentFlowRoles,setDocumentFlowRoles,saveDocumentFlowRoles,deleteRole}from'../actions';import CompanyGateway from'@distate/core/dist/application/company/CompanyGateway';import{CompanyApiServices}from'../../services/company.api';/** Роли сотрудников */export function companyRolesEffect(){return _regeneratorRuntime.wrap(function companyRolesEffect$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return takeLatest(getStaffRoles,getStaffRolesWorker);case 2:_context.next=4;return takeLatest(changeStaffRoleTitle,changeStaffRoleTitleWorker);case 4:_context.next=6;return takeLatest(createStaffRole,createStaffRoleWorker);case 6:_context.next=8;return takeLatest(getStaffForRole,getStaffForRoleWorker);case 8:_context.next=10;return takeLatest(deleteStaffForRole,deleteStaffForRoleWorker);case 10:_context.next=12;return takeLatest(getNoStaffForRole,getNoStaffForRoleWorker);case 12:_context.next=14;return takeLatest(addStaffForRole,addStaffForRoleWorker);case 14:_context.next=16;return takeLatest(getDocumentFlowRoles,getDocumentFlowRolesWorker);case 16:_context.next=18;return takeLatest(saveDocumentFlowRoles,saveDocumentFlowRolesWorker);case 18:_context.next=20;return takeLatest(deleteRole,deleteRoleWorker);case 20:case\"end\":return _context.stop();}}},_marked);}/** получение ролей сотрудников */function getStaffRolesWorker(_ref){var payload,props,companyGateway,roles;return _regeneratorRuntime.wrap(function getStaffRolesWorker$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:payload=_ref.payload;_context2.prev=1;props=payload.props;companyGateway=new CompanyGateway();_context2.next=6;return companyGateway.getStaffRoles(props);case 6:roles=_context2.sent;_context2.next=9;return put(setStaffRoles(roles));case 9:_context2.next=15;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](1);_context2.next=15;return Flash.error('Возникла ошибка');case 15:case\"end\":return _context2.stop();}}},_marked2,null,[[1,11]]);}/** изменение заголовка роли */function changeStaffRoleTitleWorker(_ref2){var payload;return _regeneratorRuntime.wrap(function changeStaffRoleTitleWorker$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:payload=_ref2.payload;_context3.prev=1;_context3.next=4;return CompanyApiServices.changeStaffRoleTitle(payload);case 4:_context3.next=6;return put(getStaffRoles({}));case 6:_context3.next=12;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](1);_context3.next=12;return Flash.error('Возникла ошибка');case 12:case\"end\":return _context3.stop();}}},_marked3,null,[[1,8]]);}/** создать роль сотрудника */function createStaffRoleWorker(_ref3){var payload;return _regeneratorRuntime.wrap(function createStaffRoleWorker$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:payload=_ref3.payload;_context4.prev=1;_context4.next=4;return CompanyApiServices.createStaffRole(payload);case 4:_context4.next=6;return put(getStaffRoles({}));case 6:_context4.next=8;return Flash.success('Роль добавлена');case 8:_context4.next=14;break;case 10:_context4.prev=10;_context4.t0=_context4[\"catch\"](1);_context4.next=14;return Flash.error('Возникла ошибка');case 14:case\"end\":return _context4.stop();}}},_marked4,null,[[1,10]]);}/** получение сотрудников роли */function getStaffForRoleWorker(_ref4){var payload,id,props,companyGateway,staff;return _regeneratorRuntime.wrap(function getStaffForRoleWorker$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:payload=_ref4.payload;_context5.prev=1;id=payload.id,props=payload.props;companyGateway=new CompanyGateway();_context5.next=6;return companyGateway.getStaffForRole(id,props);case 6:staff=_context5.sent;_context5.next=9;return put(setStaffForRole(staff));case 9:_context5.next=15;break;case 11:_context5.prev=11;_context5.t0=_context5[\"catch\"](1);_context5.next=15;return Flash.error('Возникла ошибка');case 15:case\"end\":return _context5.stop();}}},_marked5,null,[[1,11]]);}/** удаление сотрудника из роли */function deleteStaffForRoleWorker(_ref5){var payload,groupId,employeeId,props,companyGateway;return _regeneratorRuntime.wrap(function deleteStaffForRoleWorker$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:payload=_ref5.payload;_context6.prev=1;groupId=payload.groupId,employeeId=payload.employeeId,props=payload.props;companyGateway=new CompanyGateway();_context6.next=6;return companyGateway.deleteRoleToEmployee(groupId,employeeId);case 6:_context6.next=8;return put(getStaffForRole({id:groupId,props:props}));case 8:_context6.next=10;return put(getNoStaffForRole({groupId:groupId,props:props}));case 10:_context6.next=16;break;case 12:_context6.prev=12;_context6.t0=_context6[\"catch\"](1);_context6.next=16;return Flash.error('Возникла ошибка');case 16:case\"end\":return _context6.stop();}}},_marked6,null,[[1,12]]);}/** получение сотрудников, которых можно добавить в роль */function getNoStaffForRoleWorker(_ref6){var payload,groupId,props,companyGateway,staff;return _regeneratorRuntime.wrap(function getNoStaffForRoleWorker$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:payload=_ref6.payload;_context7.prev=1;groupId=payload.groupId,props=payload.props;companyGateway=new CompanyGateway();_context7.next=6;return companyGateway.getStaffForRole(groupId,_objectSpread(_objectSpread({},props),{},{inverseJoin:1,statusSystemName:'active'}));case 6:staff=_context7.sent;_context7.next=9;return put(setNoStaffForRole(staff));case 9:_context7.next=15;break;case 11:_context7.prev=11;_context7.t0=_context7[\"catch\"](1);_context7.next=15;return Flash.error('Возникла ошибка');case 15:case\"end\":return _context7.stop();}}},_marked7,null,[[1,11]]);}/** добавление сотрудника в роль */function addStaffForRoleWorker(_ref7){var payload,groupId,employeeId,props,companyGateway;return _regeneratorRuntime.wrap(function addStaffForRoleWorker$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:payload=_ref7.payload;_context8.prev=1;groupId=payload.groupId,employeeId=payload.employeeId,props=payload.props;companyGateway=new CompanyGateway();_context8.next=6;return companyGateway.addRoleToEmployee(groupId,employeeId);case 6:_context8.next=8;return put(getNoStaffForRole({groupId:groupId,props:props}));case 8:_context8.next=10;return put(getStaffForRole({id:groupId,props:props}));case 10:_context8.next=16;break;case 12:_context8.prev=12;_context8.t0=_context8[\"catch\"](1);_context8.next=16;return Flash.error('Возникла ошибка');case 16:case\"end\":return _context8.stop();}}},_marked8,null,[[1,12]]);}/** получение правил документооборота */function getDocumentFlowRolesWorker(_ref8){var payload,groupId,companyGateway,roles;return _regeneratorRuntime.wrap(function getDocumentFlowRolesWorker$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:payload=_ref8.payload;_context9.prev=1;groupId=payload.groupId;companyGateway=new CompanyGateway();_context9.next=6;return companyGateway.getDocumentFlowRoles(groupId);case 6:roles=_context9.sent;_context9.next=9;return put(setDocumentFlowRoles(roles));case 9:_context9.next=15;break;case 11:_context9.prev=11;_context9.t0=_context9[\"catch\"](1);_context9.next=15;return Flash.error('Возникла ошибка');case 15:case\"end\":return _context9.stop();}}},_marked9,null,[[1,11]]);}/** сохранить изменения правил документооборота */function saveDocumentFlowRolesWorker(_ref9){var payload,groupId,roolsId,_response$data,response;return _regeneratorRuntime.wrap(function saveDocumentFlowRolesWorker$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:payload=_ref9.payload;_context10.prev=1;groupId=payload.groupId,roolsId=payload.roolsId;_context10.next=5;return CompanyApiServices.updateDocumentFlowRoles({groupId:groupId,roolsId:roolsId});case 5:_context10.next=7;return put(getDocumentFlowRoles({groupId:groupId}));case 7:_context10.next=9;return Flash.success('Роли успешно обновлены');case 9:_context10.next=16;break;case 11:_context10.prev=11;_context10.t0=_context10[\"catch\"](1);response=_context10.t0.response;_context10.next=16;return Flash.error((response===null||response===void 0?void 0:(_response$data=response.data)===null||_response$data===void 0?void 0:_response$data.messages[0])||'Возникла ошибка');case 16:case\"end\":return _context10.stop();}}},_marked10,null,[[1,11]]);}/** удаление роли */function deleteRoleWorker(_ref11){var payload,groupId,companyGateway;return _regeneratorRuntime.wrap(function deleteRoleWorker$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:payload=_ref11.payload;_context11.prev=1;groupId=payload.groupId;companyGateway=new CompanyGateway();_context11.next=6;return companyGateway.deleteRole(groupId);case 6:_context11.next=8;return put(getStaffRoles({}));case 8:_context11.next=10;return Flash.success('Роль удалена');case 10:_context11.next=16;break;case 12:_context11.prev=12;_context11.t0=_context11[\"catch\"](1);_context11.next=16;return Flash.error('Возникла ошибка');case 16:case\"end\":return _context11.stop();}}},_marked11,null,[[1,12]]);}","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/company/store/sagas/companyRoles.effect.ts"],"names":["companyRolesEffect","getStaffRolesWorker","changeStaffRoleTitleWorker","createStaffRoleWorker","getStaffForRoleWorker","deleteStaffForRoleWorker","getNoStaffForRoleWorker","addStaffForRoleWorker","getDocumentFlowRolesWorker","saveDocumentFlowRolesWorker","deleteRoleWorker","takeLatest","put","Flash","getStaffRoles","setStaffRoles","changeStaffRoleTitle","createStaffRole","getStaffForRole","setStaffForRole","deleteStaffForRole","getNoStaffForRole","setNoStaffForRole","addStaffForRole","getDocumentFlowRoles","setDocumentFlowRoles","saveDocumentFlowRoles","deleteRole","CompanyGateway","CompanyApiServices","payload","props","companyGateway","roles","error","success","id","staff","groupId","employeeId","deleteRoleToEmployee","inverseJoin","statusSystemName","addRoleToEmployee","roolsId","updateDocumentFlowRoles","response","data","messages"],"mappings":"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","sourcesContent":["import { takeLatest, put } from 'redux-saga/effects';\r\nimport { Flash } from '../../../../common/flash/Flash';\r\nimport {\r\n  getStaffRoles,\r\n  setStaffRoles,\r\n  changeStaffRoleTitle,\r\n  createStaffRole,\r\n  getStaffForRole,\r\n  setStaffForRole,\r\n  deleteStaffForRole,\r\n  getNoStaffForRole,\r\n  setNoStaffForRole,\r\n  addStaffForRole,\r\n  getDocumentFlowRoles,\r\n  setDocumentFlowRoles,\r\n  saveDocumentFlowRoles,\r\n  deleteRole\r\n} from '../actions';\r\nimport CompanyGateway from '@distate/core/dist/application/company/CompanyGateway';\r\nimport { CompanyApiServices } from '../../services/company.api';\r\n\r\n/** Роли сотрудников */\r\nexport function* companyRolesEffect() {\r\n  yield takeLatest(getStaffRoles, getStaffRolesWorker);\r\n  yield takeLatest(changeStaffRoleTitle, changeStaffRoleTitleWorker);\r\n  yield takeLatest(createStaffRole, createStaffRoleWorker);\r\n  yield takeLatest(getStaffForRole, getStaffForRoleWorker);\r\n  yield takeLatest(deleteStaffForRole, deleteStaffForRoleWorker);\r\n  yield takeLatest(getNoStaffForRole, getNoStaffForRoleWorker);\r\n  yield takeLatest(addStaffForRole, addStaffForRoleWorker);\r\n  yield takeLatest(getDocumentFlowRoles, getDocumentFlowRolesWorker);\r\n  yield takeLatest(saveDocumentFlowRoles, saveDocumentFlowRolesWorker);\r\n  yield takeLatest(deleteRole, deleteRoleWorker);\r\n}\r\n\r\ntype GetStaffRoles = {\r\n  props: {};\r\n};\r\n/** получение ролей сотрудников */\r\nfunction* getStaffRolesWorker({ payload }: { payload: GetStaffRoles }) {\r\n  try {\r\n    const { props } = payload;\r\n    const companyGateway = new CompanyGateway();\r\n    const roles = yield companyGateway.getStaffRoles(props);\r\n    yield put(setStaffRoles(roles));\r\n  } catch (err) {\r\n    yield Flash.error('Возникла ошибка');\r\n  }\r\n}\r\n\r\ntype ChangeStaffRoleTitle = {\r\n  id: number;\r\n  title: string;\r\n};\r\n/** изменение заголовка роли */\r\nfunction* changeStaffRoleTitleWorker({ payload }: { payload: ChangeStaffRoleTitle }) {\r\n  try {\r\n    yield CompanyApiServices.changeStaffRoleTitle(payload);\r\n    yield put(getStaffRoles({}));\r\n  } catch (err) {\r\n    yield Flash.error('Возникла ошибка');\r\n  }\r\n}\r\n\r\ntype CreateStaffRole = {\r\n  title: string;\r\n};\r\n/** создать роль сотрудника */\r\nfunction* createStaffRoleWorker({ payload }: { payload: CreateStaffRole }) {\r\n  try {\r\n    yield CompanyApiServices.createStaffRole(payload);\r\n    yield put(getStaffRoles({}));\r\n    yield Flash.success('Роль добавлена');\r\n  } catch (err) {\r\n    yield Flash.error('Возникла ошибка');\r\n  }\r\n}\r\n\r\ntype GetStaffForRole = {\r\n  id: number;\r\n  props: {};\r\n};\r\n/** получение сотрудников роли */\r\nfunction* getStaffForRoleWorker({ payload }: { payload: GetStaffForRole }) {\r\n  try {\r\n    const { id, props } = payload;\r\n    const companyGateway = new CompanyGateway();\r\n    const staff = yield companyGateway.getStaffForRole(id, props);\r\n    yield put(setStaffForRole(staff));\r\n  } catch (err) {\r\n    yield Flash.error('Возникла ошибка');\r\n  }\r\n}\r\n\r\ntype DeleteStaffForRole = {\r\n  groupId: number;\r\n  employeeId: number;\r\n  props: {};\r\n};\r\n/** удаление сотрудника из роли */\r\nfunction* deleteStaffForRoleWorker({ payload }: { payload: DeleteStaffForRole }) {\r\n  try {\r\n    const { groupId, employeeId, props } = payload;\r\n    const companyGateway = new CompanyGateway();\r\n    yield companyGateway.deleteRoleToEmployee(groupId, employeeId);\r\n    yield put(getStaffForRole({ id: groupId, props }));\r\n    yield put(getNoStaffForRole({ groupId, props }));\r\n  } catch (err) {\r\n    yield Flash.error('Возникла ошибка');\r\n  }\r\n}\r\n\r\ntype GetNoStaffForRole = {\r\n  groupId: number;\r\n  props: {};\r\n};\r\n/** получение сотрудников, которых можно добавить в роль */\r\nfunction* getNoStaffForRoleWorker({ payload }: { payload: GetNoStaffForRole }) {\r\n  try {\r\n    const { groupId, props } = payload;\r\n    const companyGateway = new CompanyGateway();\r\n    const staff = yield companyGateway.getStaffForRole(groupId, {\r\n      ...props,\r\n      inverseJoin: 1,\r\n      statusSystemName: 'active'\r\n    });\r\n    yield put(setNoStaffForRole(staff));\r\n  } catch (err) {\r\n    yield Flash.error('Возникла ошибка');\r\n  }\r\n}\r\n\r\ntype AddStaffForRole = {\r\n  groupId: number;\r\n  employeeId: number;\r\n  props: {};\r\n};\r\n/** добавление сотрудника в роль */\r\nfunction* addStaffForRoleWorker({ payload }: { payload: AddStaffForRole }) {\r\n  try {\r\n    const { groupId, employeeId, props } = payload;\r\n    const companyGateway = new CompanyGateway();\r\n    yield companyGateway.addRoleToEmployee(groupId, employeeId);\r\n    yield put(getNoStaffForRole({ groupId, props }));\r\n    yield put(getStaffForRole({ id: groupId, props }));\r\n  } catch (err) {\r\n    yield Flash.error('Возникла ошибка');\r\n  }\r\n}\r\n\r\ntype GetDocumentFlowRoles = {\r\n  groupId: number;\r\n};\r\n/** получение правил документооборота */\r\nfunction* getDocumentFlowRolesWorker({ payload }: { payload: GetDocumentFlowRoles }) {\r\n  try {\r\n    const { groupId } = payload;\r\n    const companyGateway = new CompanyGateway();\r\n    const roles = yield companyGateway.getDocumentFlowRoles(groupId);\r\n    yield put(setDocumentFlowRoles(roles));\r\n  } catch (err) {\r\n    yield Flash.error('Возникла ошибка');\r\n  }\r\n}\r\n\r\ntype SaveDocumentFlowRoles = {\r\n  groupId: number;\r\n  roolsId: number[];\r\n};\r\n/** сохранить изменения правил документооборота */\r\nfunction* saveDocumentFlowRolesWorker({ payload }: { payload: SaveDocumentFlowRoles }) {\r\n  try {\r\n    const { groupId, roolsId } = payload;\r\n    yield CompanyApiServices.updateDocumentFlowRoles({ groupId, roolsId });\r\n    yield put(getDocumentFlowRoles({ groupId }));\r\n    yield Flash.success('Роли успешно обновлены');\r\n  } catch ({ response }) {\r\n    yield Flash.error(response?.data?.messages[0] || 'Возникла ошибка');\r\n  }\r\n}\r\n\r\ntype DeleteRole = {\r\n  groupId: number;\r\n};\r\n/** удаление роли */\r\nfunction* deleteRoleWorker({ payload }: { payload: DeleteRole }) {\r\n  try {\r\n    const { groupId } = payload;\r\n    const companyGateway = new CompanyGateway();\r\n    yield companyGateway.deleteRole(groupId);\r\n    yield put(getStaffRoles({}));\r\n    yield Flash.success('Роль удалена');\r\n  } catch (err) {\r\n    yield Flash.error('Возникла ошибка');\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}