{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{useDispatch}from'react-redux';import{Button,ButtonKinds,Input,Select,Autocomplete}from'@distate/components';import Core from'@distate/core/dist/application/Core';import{dateFormat}from'@distate/components/dist/FormSchema';import CompanyGateway from'@distate/core/dist/application/company/CompanyGateway';import{documentFromFileGateway}from'@distate/core/dist/application/create-document/DocumentFromFileGateway';import{createDocumentFromFile}from'../../../store/actions';import{DatePickerNew}from'../../../../../common/date-picker-new';import'./style.css';import{AutocompleteRecipient}from'../../common/AutocompleteRecipient';/** Неформализованный документ */export var Universal=function Universal(props){var id=props.id,formTitle=props.title,enableTitle=props.enableTitle;var dispatch=useDispatch();var companyGateway=new CompanyGateway();var _useState=useState(),_useState2=_slicedToArray(_useState,2),number=_useState2[0],setNumber=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),date=_useState4[0],setDate=_useState4[1];var _useState5=useState(enableTitle),_useState6=_slicedToArray(_useState5,2),title=_useState6[0],setTitle=_useState6[1];/** получатель */var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),recipient=_useState8[0],setRecipient=_useState8[1];/** подразделение отправителя */var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),sender=_useState10[0],setSender=_useState10[1];/** опции селекта подразделений отправителя */var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),senderOptions=_useState12[0],setSenderOptions=_useState12[1];/** вид документа */var _useState13=useState(),_useState14=_slicedToArray(_useState13,2),flowType=_useState14[0],setFlowType=_useState14[1];/** тип документа */var _useState15=useState(),_useState16=_slicedToArray(_useState15,2),documentType=_useState16[0],setDocumentType=_useState16[1];/** id типа - передается если существует */var _useState17=useState(),_useState18=_slicedToArray(_useState17,2),customTypeId=_useState18[0],setCustomTypeId=_useState18[1];/** title типа - передается если новый тип */var _useState19=useState(),_useState20=_slicedToArray(_useState19,2),customTypeTitle=_useState20[0],setCustomTypeTitle=_useState20[1];var _useState21=useState(),_useState22=_slicedToArray(_useState21,2),numberError=_useState22[0],setNumberError=_useState22[1];var _useState23=useState(),_useState24=_slicedToArray(_useState23,2),dateError=_useState24[0],setDateError=_useState24[1];var _useState25=useState(),_useState26=_slicedToArray(_useState25,2),titleError=_useState26[0],setTitleError=_useState26[1];var _useState27=useState(),_useState28=_slicedToArray(_useState27,2),senderError=_useState28[0],setSenderError=_useState28[1];var _useState29=useState(),_useState30=_slicedToArray(_useState29,2),recipientError=_useState30[0],setRecipientError=_useState30[1];var _useState31=useState(),_useState32=_slicedToArray(_useState31,2),flowTypeError=_useState32[0],setFlowTypeError=_useState32[1];var _useState33=useState(),_useState34=_slicedToArray(_useState33,2),documentTypeError=_useState34[0],setDocumentTypeError=_useState34[1];useEffect(function(){var getSender=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _Core$user,_Core$user$employee;var userId,_yield$companyGateway,_yield$companyGateway2,rows;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:userId=(_Core$user=Core.user)===null||_Core$user===void 0?void 0:(_Core$user$employee=_Core$user.employee)===null||_Core$user$employee===void 0?void 0:_Core$user$employee.id;_context.next=3;return companyGateway.getEmployeeDivision(userId,{isActive:1});case 3:_yield$companyGateway=_context.sent;_yield$companyGateway2=_yield$companyGateway.rows;rows=_yield$companyGateway2===void 0?[]:_yield$companyGateway2;setSenderOptions(contractorDataToOptions(rows));case 7:case\"end\":return _context.stop();}}},_callee);}));return function getSender(){return _ref.apply(this,arguments);};}();getSender();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useEffect(function(){var prepareTitle=enableTitle.substr(0,enableTitle.lastIndexOf('.'))||enableTitle;setTitle(prepareTitle);},[enableTitle]);var flowTypeOptions=[{value:'unformalized_unilateral',label:'Односторонний неформализованный документ'},{value:'unformalized_bilateral',label:'Двусторонний неформализованный документ'}];/** преобразование ответа сервера в массив для опций селекта контрагента */function contractorDataToOptions(data){return data.map(function(item){return{value:item.id,label:item.title};});}/** загрузка подходящих типов документа */var documentTypeLoad=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(title,callback){var res,_res$rows,rows,hasResult;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return documentFromFileGateway.getDocumentType({title:title});case 2:res=_context2.sent;_res$rows=res.rows,rows=_res$rows===void 0?[]:_res$rows;hasResult=rows.length>0;/** если пустой результат - выводим введенное значение */callback(contractorDataToOptions(hasResult?rows:[{title:title,id:undefined}]));case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function documentTypeLoad(_x,_x2){return _ref2.apply(this,arguments);};}();/** изменение типа документа */var onChangeDocumentType=function onChangeDocumentType(e){setDocumentType(e);if(e.value){setCustomTypeId(e.value);setCustomTypeTitle(undefined);}else{setCustomTypeTitle(e.label);setCustomTypeId(undefined);}};/** проверка валидации */var validation=function validation(){var isValid=true;if(!number){setNumberError(true);isValid=false;}else{setNumberError(false);}if(!date){setDateError(true);isValid=false;}else{setDateError(false);}if(!title){setTitleError(true);isValid=false;}else{setTitleError(false);}if(!sender){setSenderError(true);isValid=false;}else{setSenderError(false);}if(!recipient){setRecipientError(true);isValid=false;}else{setRecipientError(false);}if(!flowType){setFlowTypeError(true);isValid=false;}else{setFlowTypeError(false);}if(!documentType){setDocumentTypeError(true);isValid=false;}else{setDocumentTypeError(false);}return isValid;};/** создать документ */var onCreateDocument=function onCreateDocument(){if(!validation()){return false;}var formatedDate=date&&dateFormat(date,'dd.MM.yyyy');var params={from:{division:sender===null||sender===void 0?void 0:sender.value},to:{division:recipient===null||recipient===void 0?void 0:recipient.value},flowType:flowType===null||flowType===void 0?void 0:flowType.value,unformalizedData:{date:formatedDate,title:title,number:number,customTypeId:customTypeId,customTypeTitle:customTypeTitle}};dispatch(createDocumentFromFile({id:id,params:params}));};return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h2\",{className:\"header\"},formTitle),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center\"},/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_name required\"},\"\\u041D\\u043E\\u043C\\u0435\\u0440\"),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_value\"},/*#__PURE__*/React.createElement(Input,{value:number,onChange:function onChange(e){return setNumber(e.target.value);},width:400,error:numberError}))),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_name required\"},\"\\u0414\\u0430\\u0442\\u0430\"),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_value\"},/*#__PURE__*/React.createElement(\"div\",{style:{width:400}},/*#__PURE__*/React.createElement(DatePickerNew,{onChange:function onChange(e){return setDate(e);},value:date,error:dateError})))),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_name required\"},\"\\u0417\\u0430\\u0433\\u043E\\u043B\\u043E\\u0432\\u043E\\u043A\"),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_value\"},' ',/*#__PURE__*/React.createElement(Input,{value:title,onChange:function onChange(e){return setTitle(e.target.value);},width:400,error:titleError}))),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_name required\"},\"\\u041F\\u043E\\u0434\\u0440\\u0430\\u0437\\u0434\\u0435\\u043B\\u0435\\u043D\\u0438\\u0435 \\u043E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u0435\\u043B\\u044F\"),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_value\"},/*#__PURE__*/React.createElement(Select,{value:sender,options:senderOptions,onChange:function onChange(e){return setSender(e);},placeholder:\"\",width:400,error:senderError,touched:senderError}))),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_name required\"},\"\\u041F\\u043E\\u043B\\u0443\\u0447\\u0430\\u0442\\u0435\\u043B\\u044C\"),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_value\",style:{width:400}},/*#__PURE__*/React.createElement(AutocompleteRecipient,{setItem:setRecipient,item:recipient,error:recipientError,placeholder:\"\",qParams:{isActive:1,type:'division'}}))),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_name required\"},\"\\u0412\\u0438\\u0434 \\u0434\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u0430\"),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_value\"},/*#__PURE__*/React.createElement(Select,{value:flowType,options:flowTypeOptions,onChange:function onChange(e){return setFlowType(e);},placeholder:\"\",width:400,error:flowTypeError,touched:flowTypeError}))),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_name required\"},\"\\u0422\\u0438\\u043F \\u0434\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u0430\"),/*#__PURE__*/React.createElement(\"div\",{className:\"two-columns-center_value\"},/*#__PURE__*/React.createElement(Autocomplete,{value:documentType,loadOptions:documentTypeLoad,onChange:onChangeDocumentType,placeholder:\"\",width:400,error:documentTypeError})))),/*#__PURE__*/React.createElement(Button,{kind:ButtonKinds.Orange,onClick:onCreateDocument},\"\\u0421\\u043E\\u0437\\u0434\\u0430\\u0442\\u044C \\u0434\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\"));};","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/create-document/components/create-from-file/forms/Universal.tsx"],"names":["React","useEffect","useState","useDispatch","Button","ButtonKinds","Input","Select","Autocomplete","Core","dateFormat","CompanyGateway","documentFromFileGateway","createDocumentFromFile","DatePickerNew","AutocompleteRecipient","Universal","props","id","formTitle","title","enableTitle","dispatch","companyGateway","number","setNumber","date","setDate","setTitle","recipient","setRecipient","sender","setSender","senderOptions","setSenderOptions","flowType","setFlowType","documentType","setDocumentType","customTypeId","setCustomTypeId","customTypeTitle","setCustomTypeTitle","numberError","setNumberError","dateError","setDateError","titleError","setTitleError","senderError","setSenderError","recipientError","setRecipientError","flowTypeError","setFlowTypeError","documentTypeError","setDocumentTypeError","getSender","userId","user","employee","getEmployeeDivision","isActive","rows","contractorDataToOptions","prepareTitle","substr","lastIndexOf","flowTypeOptions","value","label","data","map","item","documentTypeLoad","callback","getDocumentType","res","hasResult","length","undefined","onChangeDocumentType","e","validation","isValid","onCreateDocument","formatedDate","params","from","division","to","unformalizedData","target","width","type","Orange"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, ChangeEvent } from 'react';\r\nimport { useDispatch } from 'react-redux';\r\nimport { Button, ButtonKinds, Input, Select, Autocomplete } from '@distate/components';\r\nimport Core from '@distate/core/dist/application/Core';\r\nimport { dateFormat } from '@distate/components/dist/FormSchema';\r\nimport CompanyGateway from '@distate/core/dist/application/company/CompanyGateway';\r\nimport { documentFromFileGateway } from '@distate/core/dist/application/create-document/DocumentFromFileGateway';\r\nimport { createDocumentFromFile } from '../../../store/actions';\r\nimport { DatePickerNew } from '../../../../../common/date-picker-new';\r\nimport './style.css'\r\nimport { AutocompleteRecipient } from '../../common/AutocompleteRecipient';\r\n\r\n\r\ntype Props = {\r\n  id: string;\r\n  title?: string;\r\n  enableTitle: string;\r\n};\r\n\r\n/** Неформализованный документ */\r\nexport const Universal = (props: Props) => {\r\n  const { id, title: formTitle, enableTitle } = props;\r\n  const dispatch = useDispatch();\r\n\r\n  const companyGateway = new CompanyGateway();\r\n\r\n  const [number, setNumber] = useState<string>();\r\n  const [date, setDate] = useState();\r\n  const [title, setTitle] = useState<string>(enableTitle);\r\n  /** получатель */\r\n  const [recipient, setRecipient] = useState<any>();\r\n  /** подразделение отправителя */\r\n  const [sender, setSender] = useState<HTMLSelectElement>();\r\n  /** опции селекта подразделений отправителя */\r\n  const [senderOptions, setSenderOptions] = useState<any>();\r\n  /** вид документа */\r\n  const [flowType, setFlowType] = useState<HTMLSelectElement>();\r\n  /** тип документа */\r\n  const [documentType, setDocumentType] = useState<any>();\r\n  /** id типа - передается если существует */\r\n  const [customTypeId, setCustomTypeId] = useState<string>();\r\n  /** title типа - передается если новый тип */\r\n  const [customTypeTitle, setCustomTypeTitle] = useState<string>();\r\n\r\n  const [numberError, setNumberError] = useState<boolean>();\r\n  const [dateError, setDateError] = useState<boolean>();\r\n  const [titleError, setTitleError] = useState<boolean>();\r\n  const [senderError, setSenderError] = useState<boolean>();\r\n  const [recipientError, setRecipientError] = useState<boolean>();\r\n  const [flowTypeError, setFlowTypeError] = useState<boolean>();\r\n  const [documentTypeError, setDocumentTypeError] = useState<boolean>();\r\n\r\n  useEffect(() => {\r\n    const getSender = async () => {\r\n      const userId = Core.user?.employee?.id;\r\n      const { rows = [] } = await companyGateway.getEmployeeDivision(userId, {\r\n        isActive: 1\r\n      });\r\n      setSenderOptions(contractorDataToOptions(rows));\r\n    };\r\n    getSender();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const prepareTitle = enableTitle.substr(0, enableTitle.lastIndexOf('.')) || enableTitle;\r\n    setTitle(prepareTitle);\r\n  }, [enableTitle]);\r\n\r\n  const flowTypeOptions = [\r\n    { value: 'unformalized_unilateral', label: 'Односторонний неформализованный документ' },\r\n    { value: 'unformalized_bilateral', label: 'Двусторонний неформализованный документ' }\r\n  ];\r\n\r\n  /** преобразование ответа сервера в массив для опций селекта контрагента */\r\n  function contractorDataToOptions(data: any[]) {\r\n    return data.map(item => {\r\n      return {\r\n        value: item.id,\r\n        label: item.title\r\n      };\r\n    });\r\n  }\r\n\r\n  /** загрузка подходящих типов документа */\r\n  const documentTypeLoad = async (title: string, callback: any) => {\r\n    const res = await documentFromFileGateway.getDocumentType({ title });\r\n    const { rows = [] } = res;\r\n\r\n    const hasResult = rows.length > 0;\r\n    /** если пустой результат - выводим введенное значение */\r\n    callback(contractorDataToOptions(hasResult ? rows : [{ title, id: undefined }]));\r\n  };\r\n\r\n  /** изменение типа документа */\r\n  const onChangeDocumentType = (e: any) => {\r\n    setDocumentType(e);\r\n    if (e.value) {\r\n      setCustomTypeId(e.value);\r\n      setCustomTypeTitle(undefined);\r\n    } else {\r\n      setCustomTypeTitle(e.label);\r\n      setCustomTypeId(undefined);\r\n    }\r\n  };\r\n\r\n  /** проверка валидации */\r\n  const validation = () => {\r\n    let isValid = true;\r\n\r\n    if (!number) {\r\n      setNumberError(true);\r\n      isValid = false;\r\n    } else {\r\n      setNumberError(false);\r\n    }\r\n\r\n    if (!date) {\r\n      setDateError(true);\r\n      isValid = false;\r\n    } else {\r\n      setDateError(false);\r\n    }\r\n\r\n    if (!title) {\r\n      setTitleError(true);\r\n      isValid = false;\r\n    } else {\r\n      setTitleError(false);\r\n    }\r\n\r\n    if (!sender) {\r\n      setSenderError(true);\r\n      isValid = false;\r\n    } else {\r\n      setSenderError(false);\r\n    }\r\n\r\n    if (!recipient) {\r\n      setRecipientError(true);\r\n      isValid = false;\r\n    } else {\r\n      setRecipientError(false);\r\n    }\r\n\r\n    if (!flowType) {\r\n      setFlowTypeError(true);\r\n      isValid = false;\r\n    } else {\r\n      setFlowTypeError(false);\r\n    }\r\n\r\n    if (!documentType) {\r\n      setDocumentTypeError(true);\r\n      isValid = false;\r\n    } else {\r\n      setDocumentTypeError(false);\r\n    }\r\n\r\n    return isValid;\r\n  };\r\n\r\n  /** создать документ */\r\n  const onCreateDocument = () => {\r\n    if (!validation()) {\r\n      return false;\r\n    }\r\n\r\n    const formatedDate = date && dateFormat(date!, 'dd.MM.yyyy');\r\n    const params = {\r\n      from: { division: sender?.value },\r\n      to: { division: recipient?.value },\r\n      flowType: flowType?.value,\r\n      unformalizedData: {\r\n        date: formatedDate,\r\n        title,\r\n        number,\r\n        customTypeId,\r\n        customTypeTitle\r\n      }\r\n    };\r\n    dispatch(createDocumentFromFile({ id, params }));\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <h2 className=\"header\">{formTitle}</h2>\r\n      <div className=\"two-columns-center\">\r\n        <div className=\"two-columns-center_row\">\r\n          <div className=\"two-columns-center_name required\">Номер</div>\r\n          <div className=\"two-columns-center_value\">\r\n            <Input\r\n              value={number}\r\n              onChange={(e: ChangeEvent<HTMLInputElement>) => setNumber(e.target.value)}\r\n              width={400}\r\n              error={numberError}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className=\"two-columns-center_row\">\r\n          <div className=\"two-columns-center_name required\">Дата</div>\r\n          <div className=\"two-columns-center_value\">\r\n            <div style={{ width: 400 }}>\r\n              <DatePickerNew\r\n                onChange={e => setDate(e)}\r\n                value={date}\r\n                error={dateError}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"two-columns-center_row\">\r\n          <div className=\"two-columns-center_name required\">Заголовок</div>\r\n          <div className=\"two-columns-center_value\">\r\n            {' '}\r\n            <Input\r\n              value={title}\r\n              onChange={(e: ChangeEvent<HTMLInputElement>) => setTitle(e.target.value)}\r\n              width={400}\r\n              error={titleError}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className=\"two-columns-center_row\">\r\n          <div className=\"two-columns-center_name required\">Подразделение отправителя</div>\r\n          <div className=\"two-columns-center_value\">\r\n            <Select\r\n              value={sender}\r\n              options={senderOptions}\r\n              onChange={(e: HTMLSelectElement) => setSender(e)}\r\n              placeholder=\"\"\r\n              width={400}\r\n              error={senderError}\r\n              touched={senderError}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className=\"two-columns-center_row\">\r\n          <div className=\"two-columns-center_name required\">Получатель</div>\r\n          <div className=\"two-columns-center_value\" style={{ width: 400 }}>\r\n            <AutocompleteRecipient\r\n              setItem={setRecipient}\r\n              item={recipient}\r\n              error={recipientError}\r\n              placeholder=\"\"\r\n              qParams={{ isActive: 1, type: 'division' }}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className=\"two-columns-center_row\">\r\n          <div className=\"two-columns-center_name required\">Вид документа</div>\r\n          <div className=\"two-columns-center_value\">\r\n            <Select\r\n              value={flowType}\r\n              options={flowTypeOptions}\r\n              onChange={(e: HTMLSelectElement) => setFlowType(e)}\r\n              placeholder=\"\"\r\n              width={400}\r\n              error={flowTypeError}\r\n              touched={flowTypeError}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className=\"two-columns-center_row\">\r\n          <div className=\"two-columns-center_name required\">Тип документа</div>\r\n          <div className=\"two-columns-center_value\">\r\n            <Autocomplete\r\n              value={documentType}\r\n              loadOptions={documentTypeLoad}\r\n              onChange={onChangeDocumentType}\r\n              placeholder=\"\"\r\n              width={400}\r\n              error={documentTypeError}\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <Button kind={ButtonKinds.Orange} onClick={onCreateDocument}>\r\n        Создать документ\r\n      </Button>\r\n    </div>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}