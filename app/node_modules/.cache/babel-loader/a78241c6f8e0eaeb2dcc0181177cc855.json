{"ast":null,"code":"import React from'react';import{Loading}from'@distate/components';import{Body}from'./body';import{isElementVisible}from'./utils';import{TableContextProvider}from'./context';import{HTMLTableHeader,HTMLTableFooter,HTMLContainer,HTMLTableRow,HTMLTableCell,HTMLTable,HTMLFooter,HTMLFooterItem,HTMLFooterButton}from'./table.style';var timeout=null;export var Table=function Table(_ref){var _ref$isLoading=_ref.isLoading,isLoading=_ref$isLoading===void 0?false:_ref$isLoading,_ref$isNextLoading=_ref.isNextLoading,isNextLoading=_ref$isNextLoading===void 0?false:_ref$isNextLoading,_ref$hasMore=_ref.hasMore,hasMore=_ref$hasMore===void 0?false:_ref$hasMore,rows=_ref.rows,limit=_ref.limit,offset=_ref.offset,columns=_ref.columns,emptyTitle=_ref.emptyTitle,classNameRow=_ref.classNameRow,_ref$onMore=_ref.onMore,onMore=_ref$onMore===void 0?function(){}:_ref$onMore;var node=React.useRef(null);React.useLayoutEffect(function(){var current=node.current;if(!current)return;var callback=function callback(){var visible=isElementVisible(node.current);if(visible&&hasMore&&!isNextLoading){onMore();}timeout=null;};var onVisibilityChange=function onVisibilityChange(){if(timeout===null){timeout=setTimeout(callback,100);}};onVisibilityChange();window.addEventListener('resize',onVisibilityChange);window.addEventListener('scroll',onVisibilityChange);return function(){timeout=null;window.removeEventListener('resize',onVisibilityChange);window.removeEventListener('scroll',onVisibilityChange);};},[hasMore,isNextLoading,onMore]);return/*#__PURE__*/React.createElement(TableContextProvider,{value:{rows:rows,limit:limit,isLoading:isLoading,isNextLoading:isNextLoading,hasMore:!!hasMore,offset:offset,onMore:onMore,columns:columns,emptyTitle:emptyTitle,classNameRow:classNameRow}},/*#__PURE__*/React.createElement(HTMLContainer,null,/*#__PURE__*/React.createElement(HTMLTable,null,/*#__PURE__*/React.createElement(\"colgroup\",null,columns.map(function(_ref2){var property=_ref2.property,width=_ref2.width;return/*#__PURE__*/React.createElement(\"col\",{key:property,width:width});})),/*#__PURE__*/React.createElement(HTMLTableHeader,null,/*#__PURE__*/React.createElement(HTMLTableRow,null,columns.map(function(_ref3){var property=_ref3.property,header=_ref3.header,align=_ref3.align;return/*#__PURE__*/React.createElement(HTMLTableCell,{key:property,alignBlock:align},header);}))),/*#__PURE__*/React.createElement(Body,null),/*#__PURE__*/React.createElement(HTMLTableFooter,null,/*#__PURE__*/React.createElement(HTMLTableRow,null,/*#__PURE__*/React.createElement(HTMLTableCell,{ref:node,colSpan:columns.length},/*#__PURE__*/React.createElement(HTMLFooter,null,/*#__PURE__*/React.createElement(HTMLFooterItem,null,\"\\u0412\\u0441\\u0435\\u0433\\u043E \\u0437\\u0430\\u043F\\u0438\\u0441\\u0435\\u0439: \",rows.length),/*#__PURE__*/React.createElement(HTMLFooterItem,{style:{width:'100%'}},isNextLoading&&/*#__PURE__*/React.createElement(Loading,{isRelative:true,height:\"18px\"})),/*#__PURE__*/React.createElement(HTMLFooterItem,null,hasMore&&/*#__PURE__*/React.createElement(HTMLFooterButton,{onClick:onMore},\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u0435\\u0449\\u0435\")))))))));};","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/documents/components/table/table.tsx"],"names":["React","Loading","Body","isElementVisible","TableContextProvider","HTMLTableHeader","HTMLTableFooter","HTMLContainer","HTMLTableRow","HTMLTableCell","HTMLTable","HTMLFooter","HTMLFooterItem","HTMLFooterButton","timeout","Table","isLoading","isNextLoading","hasMore","rows","limit","offset","columns","emptyTitle","classNameRow","onMore","node","useRef","useLayoutEffect","current","callback","visible","onVisibilityChange","setTimeout","window","addEventListener","removeEventListener","map","property","width","header","align","length"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { Loading } from '@distate/components';\r\n\r\nimport { ITable } from './types';\r\nimport { Body } from './body';\r\nimport { isElementVisible } from './utils';\r\nimport { TableContextProvider } from './context';\r\nimport {\r\n  HTMLTableHeader,\r\n  HTMLTableFooter,\r\n  HTMLContainer,\r\n  HTMLTableRow,\r\n  HTMLTableCell,\r\n  HTMLTable,\r\n  HTMLFooter,\r\n  HTMLFooterItem,\r\n  HTMLFooterButton\r\n} from './table.style';\r\n\r\nlet timeout: any = null;\r\n\r\nexport const Table: React.FC<ITable> = ({\r\n  isLoading = false,\r\n  isNextLoading = false,\r\n  hasMore = false,\r\n  rows,\r\n  limit,\r\n  offset,\r\n  columns,\r\n  emptyTitle,\r\n  classNameRow,\r\n  onMore = () => {}\r\n}) => {\r\n  const node = React.useRef<HTMLTableCellElement>(null);\r\n\r\n  React.useLayoutEffect(() => {\r\n    const { current } = node;\r\n    if (!current) return;\r\n\r\n    const callback = () => {\r\n      const visible = isElementVisible(node.current);\r\n      if (visible && hasMore && !isNextLoading) {\r\n        onMore();\r\n      }\r\n      timeout = null;\r\n    };\r\n\r\n    const onVisibilityChange = () => {\r\n      if (timeout === null) {\r\n        timeout = setTimeout(callback, 100);\r\n      }\r\n    };\r\n\r\n    onVisibilityChange();\r\n\r\n    window.addEventListener('resize', onVisibilityChange);\r\n    window.addEventListener('scroll', onVisibilityChange);\r\n\r\n    return () => {\r\n      timeout = null;\r\n      window.removeEventListener('resize', onVisibilityChange);\r\n      window.removeEventListener('scroll', onVisibilityChange);\r\n    };\r\n  }, [hasMore, isNextLoading, onMore]);\r\n\r\n  return (\r\n    <TableContextProvider\r\n      value={{\r\n        rows,\r\n        limit,\r\n        isLoading,\r\n        isNextLoading,\r\n        hasMore: !!hasMore,\r\n        offset,\r\n        onMore,\r\n        columns,\r\n        emptyTitle,\r\n        classNameRow\r\n      }}\r\n    >\r\n      <HTMLContainer>\r\n        <HTMLTable>\r\n          <colgroup>\r\n            {columns.map(({ property, width }) => (\r\n              <col key={property} width={width} />\r\n            ))}\r\n          </colgroup>\r\n          <HTMLTableHeader>\r\n            <HTMLTableRow>\r\n              {columns.map(({ property, header, align }) => {\r\n                return (\r\n                  <HTMLTableCell key={property} alignBlock={align}>\r\n                    {header}\r\n                  </HTMLTableCell>\r\n                );\r\n              })}\r\n            </HTMLTableRow>\r\n          </HTMLTableHeader>\r\n          <Body />\r\n          <HTMLTableFooter>\r\n            <HTMLTableRow>\r\n              <HTMLTableCell ref={node} colSpan={columns.length}>\r\n                <HTMLFooter>\r\n                  <HTMLFooterItem>Всего записей: {rows.length}</HTMLFooterItem>\r\n                  <HTMLFooterItem style={{ width: '100%' }}>\r\n                    {isNextLoading && <Loading isRelative={true} height=\"18px\" />}\r\n                  </HTMLFooterItem>\r\n                  <HTMLFooterItem>\r\n                    {hasMore && <HTMLFooterButton onClick={onMore}>Загрузить еще</HTMLFooterButton>}\r\n                  </HTMLFooterItem>\r\n                </HTMLFooter>\r\n              </HTMLTableCell>\r\n            </HTMLTableRow>\r\n          </HTMLTableFooter>\r\n        </HTMLTable>\r\n      </HTMLContainer>\r\n    </TableContextProvider>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}