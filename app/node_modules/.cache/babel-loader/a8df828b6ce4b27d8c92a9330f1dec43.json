{"ast":null,"code":"import _objectSpread from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import get from'lodash.get';import set from'lodash.set';export function isArray(value){return Array.isArray(value);}// TODO: удалить\nexport var getIncreaseDecrease=function getIncreaseDecrease(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _data$before=data.before,before=_data$before===void 0?0:_data$before,_data$after=data.after,after=_data$after===void 0?0:_data$after;var increase=+Number(after)-+Number(before);var decrease=0;if(increase<=0){increase=0;decrease=Number(before)-Number(after);}return{after:String(after),before:String(before),increase:String(increase),decrease:String(decrease)};};// ------- the end --------\nexport var inBlurCalculator=function inBlurCalculator(name){var changeFields=['count.after','count.before','price.after','price.before','excise.after','excise.before','taxRate.after','taxRate.before','costBeforeTax.after','costBeforeTax.before'];return changeFields.indexOf(name)!==-1;};export var isChangeCalculator=function isChangeCalculator(name){var changeFields=['count.after','count.before','price.after','price.before','excise.after','excise.before','taxRate.after','taxRate.before','costBeforeTax.after','costBeforeTax.before'];return changeFields.indexOf(name)!==-1;};export var getSummary=function getSummary(val1,val2){return Number.parseFloat(String(Number(val1)+Number(val2))).toFixed(2);};export var getFloat=function getFloat(data,fieldName){var value=get(data,fieldName,'0.00');return Number.parseFloat(String(value)).toFixed(2);};var checkIsBeforeAfter=function checkIsBeforeAfter(val){return!Array.isArray(val)&&typeof val==='object'&&val!==null&&val.hasOwnProperty('before')&&val.hasOwnProperty('after');};var updateIncreaseDecrease=function updateIncreaseDecrease(prop){if(!checkIsBeforeAfter(prop)){return;}var before=parseFloat(prop.before)||0;var after=parseFloat(prop.after)||0;var increase=+after-+before;var decrease=0;if(increase>0){prop.increase=Number.parseFloat(String(increase)).toFixed(2);prop.decrease=Number.parseFloat(String(decrease)).toFixed(2);}else{prop.increase=Number.parseFloat('0').toFixed(2);prop.decrease=Number.parseFloat(String(before-after)).toFixed(2);}};/**\r\n * Получить цену без НДС\r\n */export function getPriceWithoutVAT(good,type){var count=parseFloat(good.count[type])||0;var price=parseFloat(good.price[type])||0;return(count*price).toFixed(2)||Number(0).toFixed(2);}/**\r\n * Получить сумму НДС\r\n */export function getVAT(good,type){var cost=parseFloat(good.costBeforeTax[type])||0;var taxRate=good.taxRate;var vat=0;var tax=!taxRate[type]||Number(taxRate[type])<0?0:parseInt(taxRate[type]);if(tax>100){vat=cost/tax*(tax-100);}else{vat=cost*tax/100;}return Number(vat).toFixed(2);}/**\r\n * Получить общую сумму с НДС\r\n */export function getAllPrice(good,type){var taxRate=Number(good.taxRate[type])<0?0:parseInt(good.taxRate[type]);if(['110','118','120'].indexOf(String(taxRate))===-1){var price=parseFloat(good.costBeforeTax[type])||0;var tax=parseFloat(good.amountOfTax[type])||0;return(price+tax).toFixed(2);}return Number(good.costBeforeTax[type]||0).toFixed(2);}/**\r\n * Автоматический подсчет строки\r\n */export function getAutoGoods(goods){var reducer=function reducer(prev,good){// стоимость без НДС\nset(good,'costBeforeTax.before',getPriceWithoutVAT(good,'before'));set(good,'costBeforeTax.after',getPriceWithoutVAT(good,'after'));// НДС\nset(good,'amountOfTax.before',getVAT(good,'before'));set(good,'amountOfTax.after',getVAT(good,'after'));// Всего\nset(good,'costAfterTax.before',getAllPrice(good,'before'));set(good,'costAfterTax.after',getAllPrice(good,'after'));// Увеличение и Уменьшение\nupdateIncreaseDecrease(good.costBeforeTax);updateIncreaseDecrease(good.costAfterTax);updateIncreaseDecrease(good.amountOfTax);updateIncreaseDecrease(good.excise);prev.push(good);return prev;};return goods.reduce(reducer,[]);}// -------------------------------\n/**\r\n * Суммирование итогов\r\n * в таблице\r\n */export function getAutoTotal(goods){var defaultValue=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var goodsDefault=defaultValue.goods;var fields={beforeTax:'0.00',afterTax:'0.00',amountOfTax:'0.00',excise:'0.00'};var commonGoods=mergeGoods(goods,goodsDefault);var reducer=function reducer(prev,curr){var totalDecrease=prev.totalDecrease,totalIncrease=prev.totalIncrease;totalDecrease.beforeTax=getSummary(totalDecrease.beforeTax,curr.costBeforeTax.decrease);totalDecrease.amountOfTax=getSummary(totalDecrease.amountOfTax,curr.amountOfTax.decrease);totalDecrease.afterTax=getSummary(totalDecrease.afterTax,curr.costAfterTax.decrease);totalIncrease.beforeTax=getSummary(totalIncrease.beforeTax,curr.costBeforeTax.increase);totalIncrease.amountOfTax=getSummary(totalIncrease.amountOfTax,curr.amountOfTax.increase);totalIncrease.afterTax=getSummary(totalIncrease.afterTax,curr.costAfterTax.increase);return prev;};var totalGoods=commonGoods.reduce(reducer,{totalIncrease:_objectSpread({},fields),totalDecrease:_objectSpread({},fields)});var totalIncrease=totalGoods.totalIncrease,totalDecrease=totalGoods.totalDecrease;var amountOfTax=getTotal(totalIncrease.amountOfTax,totalDecrease.amountOfTax);var beforeTax=getTotal(totalIncrease.beforeTax,totalDecrease.beforeTax);var afterTax=getTotal(totalIncrease.afterTax,totalDecrease.afterTax);return{totalIncrease:{amountOfTax:amountOfTax.increase,beforeTax:beforeTax.increase,afterTax:afterTax.increase},totalDecrease:{amountOfTax:amountOfTax.decrease,beforeTax:beforeTax.decrease,afterTax:afterTax.decrease}};}// --------------------------------\nexport var mergeGoods=function mergeGoods(){var common=[];for(var _len=arguments.length,goods=new Array(_len),_key=0;_key<_len;_key++){goods[_key]=arguments[_key];}var _goods$=goods[0],currents=_goods$===void 0?[]:_goods$,_goods$2=goods[1],defaults=_goods$2===void 0?[]:_goods$2;currents.forEach(function(current){return common.push(current);});// проверяем были удалены товары или нет\ndefaults.forEach(function(productDefault){var productCurrent=currents.findIndex(function(product){var row=productDefault.row,costBeforeTax=productDefault.costBeforeTax,costAfterTax=productDefault.costAfterTax,amountOfTax=productDefault.amountOfTax;return row===product.row&&costBeforeTax.before===product.costBeforeTax.before&&costAfterTax.before===product.costAfterTax.before&&amountOfTax.before===product.amountOfTax.before;});if(productCurrent===-1){// Если продукт не найден то добавляем его в общий список\nproductDefault.costBeforeTax.decrease=productDefault.costBeforeTax.before;productDefault.costAfterTax.decrease=productDefault.costAfterTax.before;productDefault.amountOfTax.decrease=productDefault.amountOfTax.before;common.push(productDefault);}});return common;};export var getTotal=function getTotal(increase,decrease){var a=Number.parseFloat(increase);var b=Number.parseFloat(decrease);if(a>b&&b>0){increase=(a-b).toFixed(2);decrease='0.00';}else if(b>a&&a>0){increase='0.00';decrease=(b-a).toFixed(2);}return{increase:increase,decrease:decrease};};","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/common/TableUniversalCorrection/utils.tsx"],"names":["get","set","isArray","value","Array","getIncreaseDecrease","data","before","after","increase","Number","decrease","String","inBlurCalculator","name","changeFields","indexOf","isChangeCalculator","getSummary","val1","val2","parseFloat","toFixed","getFloat","fieldName","checkIsBeforeAfter","val","hasOwnProperty","updateIncreaseDecrease","prop","getPriceWithoutVAT","good","type","count","price","getVAT","cost","costBeforeTax","taxRate","vat","tax","parseInt","getAllPrice","amountOfTax","getAutoGoods","goods","reducer","prev","costAfterTax","excise","push","reduce","getAutoTotal","defaultValue","goodsDefault","fields","beforeTax","afterTax","commonGoods","mergeGoods","curr","totalDecrease","totalIncrease","totalGoods","getTotal","common","currents","defaults","forEach","current","productDefault","productCurrent","findIndex","product","row","a","b"],"mappings":"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","sourcesContent":["import get from 'lodash.get';\r\nimport set from 'lodash.set';\r\n\r\nexport function isArray(value: unknown): value is [] {\r\n  return Array.isArray(value);\r\n}\r\n// TODO: удалить\r\nexport type IncreaseDecreaseData = {\r\n  before?: string | number;\r\n  after?: string | number;\r\n};\r\n\r\nexport type IncreaseDecreaseResult = {\r\n  increase: string;\r\n  decrease: string;\r\n} & IncreaseDecreaseData;\r\n\r\nexport const getIncreaseDecrease = (data: IncreaseDecreaseData = {}): IncreaseDecreaseResult => {\r\n  let { before = 0, after = 0 } = data;\r\n\r\n  let increase = +Number(after) - +Number(before);\r\n  let decrease = 0;\r\n\r\n  if (increase <= 0) {\r\n    increase = 0;\r\n    decrease = Number(before) - Number(after);\r\n  }\r\n\r\n  return {\r\n    after: String(after),\r\n    before: String(before),\r\n    increase: String(increase),\r\n    decrease: String(decrease)\r\n  };\r\n};\r\n// ------- the end --------\r\n\r\nexport const inBlurCalculator = (name: string) => {\r\n  const changeFields = [\r\n    'count.after',\r\n    'count.before',\r\n    'price.after',\r\n    'price.before',\r\n    'excise.after',\r\n    'excise.before',\r\n    'taxRate.after',\r\n    'taxRate.before',\r\n    'costBeforeTax.after',\r\n    'costBeforeTax.before'\r\n  ];\r\n\r\n  return changeFields.indexOf(name) !== -1;\r\n};\r\n\r\nexport const isChangeCalculator = (name: string) => {\r\n  const changeFields = [\r\n    'count.after',\r\n    'count.before',\r\n    'price.after',\r\n    'price.before',\r\n    'excise.after',\r\n    'excise.before',\r\n    'taxRate.after',\r\n    'taxRate.before',\r\n    'costBeforeTax.after',\r\n    'costBeforeTax.before'\r\n  ];\r\n\r\n  return changeFields.indexOf(name) !== -1;\r\n};\r\n\r\nexport const getSummary = (val1: string | number, val2: string | number): string => {\r\n  return Number.parseFloat(String(Number(val1) + Number(val2))).toFixed(2);\r\n};\r\n\r\nexport const getFloat = (data: Record<string, unknown>, fieldName: string) => {\r\n  const value = get(data, fieldName, '0.00');\r\n  return Number.parseFloat(String(value)).toFixed(2);\r\n};\r\n\r\nconst checkIsBeforeAfter = (val: unknown): val is BeforeAfter => {\r\n  return (\r\n    !Array.isArray(val) &&\r\n    typeof val === 'object' &&\r\n    val !== null &&\r\n    val.hasOwnProperty('before') &&\r\n    val.hasOwnProperty('after')\r\n  );\r\n};\r\n\r\nconst updateIncreaseDecrease = (prop: IncreaseDecrease): void => {\r\n  if (!checkIsBeforeAfter(prop)) {\r\n    return;\r\n  }\r\n\r\n  const before = parseFloat(prop.before) || 0;\r\n  const after = parseFloat(prop.after) || 0;\r\n\r\n  let increase = +after - +before;\r\n  let decrease = 0;\r\n\r\n  if (increase > 0) {\r\n    prop.increase = Number.parseFloat(String(increase)).toFixed(2);\r\n    prop.decrease = Number.parseFloat(String(decrease)).toFixed(2);\r\n  } else {\r\n    prop.increase = Number.parseFloat('0').toFixed(2);\r\n    prop.decrease = Number.parseFloat(String(before - after)).toFixed(2);\r\n  }\r\n};\r\n\r\nexport type TotalFields = {\r\n  beforeTax: string;\r\n  afterTax: string;\r\n  amountOfTax: string;\r\n  excise: string;\r\n};\r\n\r\nexport type AutoSumma<T> = {\r\n  totalIncrease: TotalFields;\r\n  totalDecrease: TotalFields;\r\n  goods: T[];\r\n};\r\n\r\nexport type BeforeAfter = {\r\n  after: string;\r\n  before: string;\r\n};\r\n\r\nexport type IncreaseDecrease = {\r\n  decrease?: string;\r\n  increase?: string;\r\n} & BeforeAfter;\r\n\r\nexport type AutoGood = {\r\n  excise: IncreaseDecrease;\r\n  amountOfTax: IncreaseDecrease;\r\n  costAfterTax: IncreaseDecrease;\r\n  costBeforeTax: IncreaseDecrease;\r\n  count: BeforeAfter;\r\n  price: BeforeAfter;\r\n  taxRate: BeforeAfter;\r\n  title: string;\r\n  row: string;\r\n  rowType?: 'edit';\r\n};\r\n\r\n/**\r\n * Получить цену без НДС\r\n */\r\nexport function getPriceWithoutVAT(good: AutoGood, type: keyof BeforeAfter): string {\r\n  const count = parseFloat(good.count[type]) || 0;\r\n  const price = parseFloat(good.price[type]) || 0;\r\n  return (count * price).toFixed(2) || Number(0).toFixed(2);\r\n}\r\n\r\n/**\r\n * Получить сумму НДС\r\n */\r\nexport function getVAT(good: AutoGood, type: keyof BeforeAfter): string {\r\n  const cost = parseFloat(good.costBeforeTax[type]) || 0;\r\n  const taxRate = good.taxRate;\r\n\r\n  let vat = 0;\r\n  let tax = !taxRate[type] || Number(taxRate[type]) < 0 ? 0 : parseInt(taxRate[type]);\r\n\r\n  if (tax > 100) {\r\n    vat = (cost / tax) * (tax - 100);\r\n  } else {\r\n    vat = (cost * tax) / 100;\r\n  }\r\n\r\n  return Number(vat).toFixed(2);\r\n}\r\n\r\n/**\r\n * Получить общую сумму с НДС\r\n */\r\nexport function getAllPrice(good: AutoGood, type: keyof BeforeAfter): string {\r\n  const taxRate = Number(good.taxRate[type]) < 0 ? 0 : parseInt(good.taxRate[type]);\r\n  if (['110', '118', '120'].indexOf(String(taxRate)) === -1) {\r\n    const price = parseFloat(good.costBeforeTax[type]) || 0;\r\n    const tax = parseFloat(good.amountOfTax[type]) || 0;\r\n    return (price + tax).toFixed(2);\r\n  }\r\n\r\n  return Number(good.costBeforeTax[type] || 0).toFixed(2);\r\n}\r\n\r\n/**\r\n * Автоматический подсчет строки\r\n */\r\nexport function getAutoGoods(goods: AutoGood[]): AutoGood[] {\r\n  const reducer = (prev: AutoGood[], good: AutoGood) => {\r\n    // стоимость без НДС\r\n    set(good, 'costBeforeTax.before', getPriceWithoutVAT(good, 'before'));\r\n    set(good, 'costBeforeTax.after', getPriceWithoutVAT(good, 'after'));\r\n\r\n    // НДС\r\n    set(good, 'amountOfTax.before', getVAT(good, 'before'));\r\n    set(good, 'amountOfTax.after', getVAT(good, 'after'));\r\n\r\n    // Всего\r\n    set(good, 'costAfterTax.before', getAllPrice(good, 'before'));\r\n    set(good, 'costAfterTax.after', getAllPrice(good, 'after'));\r\n\r\n    // Увеличение и Уменьшение\r\n    updateIncreaseDecrease(good.costBeforeTax);\r\n    updateIncreaseDecrease(good.costAfterTax);\r\n    updateIncreaseDecrease(good.amountOfTax);\r\n    updateIncreaseDecrease(good.excise);\r\n\r\n    prev.push(good);\r\n    return prev;\r\n  };\r\n\r\n  return goods.reduce(reducer, []);\r\n}\r\n// -------------------------------\r\n\r\n/**\r\n * Суммирование итогов\r\n * в таблице\r\n */\r\nexport type AutoTotal = {\r\n  totalIncrease: TotalFields;\r\n  totalDecrease: TotalFields;\r\n};\r\n\r\nexport function getAutoTotal(goods: any[], defaultValue: any = {}): AutoTotal {\r\n  const { goods: goodsDefault } = defaultValue;\r\n  const fields: TotalFields = {\r\n    beforeTax: '0.00',\r\n    afterTax: '0.00',\r\n    amountOfTax: '0.00',\r\n    excise: '0.00'\r\n  };\r\n\r\n  const commonGoods = mergeGoods(goods, goodsDefault);\r\n\r\n  const reducer = (prev: AutoTotal, curr: any) => {\r\n    const { totalDecrease, totalIncrease } = prev;\r\n\r\n    totalDecrease.beforeTax = getSummary(totalDecrease.beforeTax, curr.costBeforeTax.decrease);\r\n    totalDecrease.amountOfTax = getSummary(totalDecrease.amountOfTax, curr.amountOfTax.decrease);\r\n    totalDecrease.afterTax = getSummary(totalDecrease.afterTax, curr.costAfterTax.decrease);\r\n\r\n    totalIncrease.beforeTax = getSummary(totalIncrease.beforeTax, curr.costBeforeTax.increase);\r\n    totalIncrease.amountOfTax = getSummary(totalIncrease.amountOfTax, curr.amountOfTax.increase);\r\n    totalIncrease.afterTax = getSummary(totalIncrease.afterTax, curr.costAfterTax.increase);\r\n\r\n    return prev;\r\n  };\r\n\r\n  const totalGoods = commonGoods.reduce<AutoTotal>(reducer, {\r\n    totalIncrease: { ...fields },\r\n    totalDecrease: { ...fields }\r\n  });\r\n\r\n  const { totalIncrease, totalDecrease } = totalGoods;\r\n  const amountOfTax = getTotal(totalIncrease.amountOfTax, totalDecrease.amountOfTax);\r\n  const beforeTax = getTotal(totalIncrease.beforeTax, totalDecrease.beforeTax);\r\n  const afterTax = getTotal(totalIncrease.afterTax, totalDecrease.afterTax);\r\n\r\n  return {\r\n    totalIncrease: {\r\n      amountOfTax: amountOfTax.increase,\r\n      beforeTax: beforeTax.increase,\r\n      afterTax: afterTax.increase\r\n    },\r\n    totalDecrease: {\r\n      amountOfTax: amountOfTax.decrease,\r\n      beforeTax: beforeTax.decrease,\r\n      afterTax: afterTax.decrease\r\n    }\r\n  } as AutoTotal;\r\n}\r\n// --------------------------------\r\n\r\nexport const mergeGoods = (...goods: any[]): any[] => {\r\n  const common: any[] = [];\r\n  const [currents = [], defaults = []] = goods;\r\n\r\n  currents.forEach((current: any) => common.push(current));\r\n\r\n  // проверяем были удалены товары или нет\r\n  defaults.forEach((productDefault: any) => {\r\n    const productCurrent = currents.findIndex((product: any) => {\r\n      const { row, costBeforeTax, costAfterTax, amountOfTax } = productDefault;\r\n      return (\r\n        row === product.row &&\r\n        costBeforeTax.before === product.costBeforeTax.before &&\r\n        costAfterTax.before === product.costAfterTax.before &&\r\n        amountOfTax.before === product.amountOfTax.before\r\n      );\r\n    });\r\n\r\n    if (productCurrent === -1) {\r\n      // Если продукт не найден то добавляем его в общий список\r\n      productDefault.costBeforeTax.decrease = productDefault.costBeforeTax.before;\r\n      productDefault.costAfterTax.decrease = productDefault.costAfterTax.before;\r\n      productDefault.amountOfTax.decrease = productDefault.amountOfTax.before;\r\n\r\n      common.push(productDefault);\r\n    }\r\n  });\r\n\r\n  return common;\r\n};\r\n\r\nexport const getTotal = (\r\n  increase: string,\r\n  decrease: string\r\n): { increase: string; decrease: string } => {\r\n  const a = Number.parseFloat(increase);\r\n  const b = Number.parseFloat(decrease);\r\n\r\n  if (a > b && b > 0) {\r\n    increase = (a - b).toFixed(2);\r\n    decrease = '0.00';\r\n  } else if (b > a && a > 0) {\r\n    increase = '0.00';\r\n    decrease = (b - a).toFixed(2);\r\n  }\r\n\r\n  return { increase, decrease };\r\n};\r\n"]},"metadata":{},"sourceType":"module"}