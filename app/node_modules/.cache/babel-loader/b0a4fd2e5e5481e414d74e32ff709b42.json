{"ast":null,"code":"import _defineProperty from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _classCallCheck from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import _applyDecoratedDescriptor from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/applyDecoratedDescriptor\";var _class,_temp;import React,{Component}from'react';import Modal from'../../../common/modal/Modal';import Button,{PRIMARY}from'../../../common/Button';import{CLEAR,SAVE,CHANGE}from'../../../common/Lbl';import{ICON}from'@distate/components';import formBuilderStyles from'../../../common/form/documents/DocumentFormBuilder.module.css';import styles from'./TransportationAndCargoModal.module.css';import classNames from'classnames';import autobind from'autobind-decorator';import Text from'../../../common/form/components/Text';import{TOP}from'../../../common/Placement';import get from'get-value';import set from'set-value';import{clone}from'../../../utils/ObjectUtil';import OperationInformation from'@distate/core/dist/domain/documents/upd/vo/transfer/OperationInformation';import TransferBasisType from'@distate/core/dist/domain/documents/upd/vo/transfer/TransferBasisType';import ArrayGroup from'./ArrayGroup';var TransportationAndCargoModal=(_class=(_temp=/*#__PURE__*/function(_Component){_inherits(TransportationAndCargoModal,_Component);var _super=_createSuper(TransportationAndCargoModal);function TransportationAndCargoModal(props){var _this;_classCallCheck(this,TransportationAndCargoModal);_this=_super.call(this,props);_this.handleFieldValue=function(Domain,scope){return function(value){var fieldsValues=clone(_this.state.fieldsValues);var path=scope?\"\".concat(scope,\".\").concat(Domain.field):Domain.field;set(fieldsValues,path,value);if(Domain.field===OperationInformation.field){var operationInformationErrors=Domain.validate(value);_this.setState({operationInformationErrors:operationInformationErrors});}_this.setState({fieldsValues:fieldsValues});};};_this.renderInputField=function(DomainVO,scope){return/*#__PURE__*/React.createElement(\"li\",{className:styles.textControl},/*#__PURE__*/React.createElement(Text,{DomainVO:DomainVO,initialValue:_this.getFieldValue(DomainVO,scope),onValueChange:_this.handleFieldValue(DomainVO,scope),labelAlign:TOP,isRequired:_this.isFieldRequired(DomainVO,scope),errorMsg:_this.state.operationInformationErrors}));};_this.renderArrayGroup=function(DomainVO,scope){return/*#__PURE__*/React.createElement(ArrayGroup,{domainVO:DomainVO,initialValues:_this.getFieldValue(DomainVO,scope),returnState:_this.handleFieldValue(DomainVO,scope),isFirstRowNameHidden:true,requiredFields:[false,false,false,false,false],handleErrorsChange:function handleErrorsChange(errors){return _this.handleBasisErrorsChange(errors,false);},errors:_this.state.basisErrors});};_this.state={isShowModal:false,chosenData:'',fieldsValues:{},basisErrors:[],operationInformationErrors:null};_this.formScope=props.scope||props.DomainVO.field;_this.requiredFields=[\"\".concat(_this.formScope,\".\").concat(OperationInformation.field)];return _this;}_createClass(TransportationAndCargoModal,[{key:\"componentDidMount\",value:function componentDidMount(){this.setInitialValues(true);}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){if(prevProps!==this.props){this.setInitialValues();}if(prevProps.errors!==this.props.errors){this.updateServerErrors();}}},{key:\"updateServerErrors\",value:function updateServerErrors(){var serverErrors=get(this.props,'errors');if(serverErrors===null||serverErrors===void 0?void 0:serverErrors.operationInformation){var operationInformationErrors=serverErrors.operationInformation.errors[0];this.setState({operationInformationErrors:operationInformationErrors});}if(serverErrors===null||serverErrors===void 0?void 0:serverErrors.basis){this.handleBasisErrorsChange(serverErrors.basis,true);}}},{key:\"handleBasisErrorsChange\",value:function handleBasisErrorsChange(errors,server){this.setState({basisErrors:errors});}},{key:\"hasErrors\",value:function hasErrors(){var _this$state=this.state,basisErrors=_this$state.basisErrors,operationInformationErrors=_this$state.operationInformationErrors;var hasOperationInformationErrors=operationInformationErrors||null;var hasBasisErrors=Object.keys(basisErrors).some(function(itemNum){for(var item in basisErrors[itemNum]){var _basisErrors$itemNum$;if(((_basisErrors$itemNum$=basisErrors[itemNum][item].errors)===null||_basisErrors$itemNum$===void 0?void 0:_basisErrors$itemNum$.length)>0){return true;}}return false;});return hasBasisErrors||hasOperationInformationErrors;}},{key:\"setInitialValues\",value:function setInitialValues(isFormStateNeedUpdate){var _this$props=this.props,_this$props$initialVa=_this$props.initialValues,operationInformation=_this$props$initialVa.operationInformation,basis=_this$props$initialVa.basis,setDataToFormState=_this$props.setDataToFormState;var fieldsValues={};set(fieldsValues,\"\".concat(this.formScope,\".\").concat(OperationInformation.field),operationInformation);set(fieldsValues,\"\".concat(this.formScope,\".\").concat(TransferBasisType.field),basis);if(isFormStateNeedUpdate)setDataToFormState({operationInformation:operationInformation,basis:basis});if(operationInformation)this.setState({chosenData:operationInformation});if(basis)this.setState({fieldsValues:fieldsValues});}},{key:\"editModalFields\",value:function editModalFields(){this.props.clearFieldError('waybill');this.props.clearFieldError('transferDetails');this.showModal();}},{key:\"showModal\",value:function showModal(){this.setState({isShowModal:true});}},{key:\"hideModal\",value:function hideModal(){this.setState({isShowModal:false});}},{key:\"getFieldValue\",value:function getFieldValue(Domain,scope){var path=scope?\"\".concat(scope,\".\").concat(Domain.field):Domain.field;var fieldValue=get(this.state.fieldsValues,path);return fieldValue;}},{key:\"handleSaveBtnClick\",value:function handleSaveBtnClick(){var setDataToFormState=this.props.setDataToFormState;var fieldsValues=this.state.fieldsValues;var operationInformation=get(fieldsValues,\"\".concat(this.formScope,\".\").concat(OperationInformation.field));var sortedInitialBasis=[];var sortedBasis=Object.values(get(fieldsValues,\"\".concat(this.formScope,\".\").concat(TransferBasisType.field))).reduce(function(obj,item,index){obj[index]=item;sortedInitialBasis.push(item);return obj;},{});this.handleFieldValue(TransferBasisType,this.formScope)(sortedInitialBasis);setDataToFormState({operationInformation:operationInformation,basis:sortedBasis});if(operationInformation){this.setState({chosenData:operationInformation});}else{this.setState({chosenData:''});}this.hideModal();}},{key:\"handleClearBtnClick\",value:function handleClearBtnClick(){var clearParentState=this.props.clearParentState;var initialArrayGroupField=Object.keys(get(this.state.fieldsValues,\"\".concat(this.formScope,\".\").concat(TransferBasisType.field,\".0\"))).reduce(function(obj,prop){obj[prop]='';return obj;},{});var fieldsValues=clone(this.state.fieldsValues);set(fieldsValues,\"\".concat(this.formScope,\".\").concat(OperationInformation.field),'');set(fieldsValues,\"\".concat(this.formScope,\".\").concat(TransferBasisType.field),[initialArrayGroupField]);this.setState({fieldsValues:fieldsValues});clearParentState();}},{key:\"isFieldRequired\",value:function isFieldRequired(Domain,scope){var fieldName=scope?\"\".concat(scope,\".\").concat(Domain.field):\"\".concat(this.formScope,\".\").concat(Domain.field);return this.requiredFields.includes(fieldName);}},{key:\"render\",value:function render(){var _this$props2=this.props,DomainVO=_this$props2.DomainVO,waybillError=_this$props2.waybillError;var _this$state2=this.state,isShowModal=_this$state2.isShowModal,chosenData=_this$state2.chosenData;var formClasses=classNames('form',formBuilderStyles.modalForm);return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"li\",{className:this.props.customClasses},/*#__PURE__*/React.createElement(\"label\",{className:\"ds-field-name leftside required\"},DomainVO.name),/*#__PURE__*/React.createElement(\"div\",{className:\"group\"},/*#__PURE__*/React.createElement(\"div\",{className:\"ds-input-group\"},!!chosenData&&/*#__PURE__*/React.createElement(\"p\",{className:\"ds-field-value predefined\",style:{width:'472px'}},/*#__PURE__*/React.createElement(\"span\",null,this.state.chosenData)),/*#__PURE__*/React.createElement(Button,{type:\"button\",className:classNames(_defineProperty({},formBuilderStyles.btnError,this.hasErrors()||waybillError)),iconClass:ICON.edit,onClick:this.editModalFields},CHANGE))),waybillError&&/*#__PURE__*/React.createElement(\"span\",{class:classNames('ds-field-name','bottom','error',styles.errorMessage)},waybillError)),/*#__PURE__*/React.createElement(Modal,{hide:this.hideModal,width:\"880px\",isVisible:isShowModal,key:\"\".concat(this.formScope,\"_transportationAndCargoModal\")},/*#__PURE__*/React.createElement(Modal.Header,{title:DomainVO.name,className:formBuilderStyles.center}),/*#__PURE__*/React.createElement(Modal.Body,null,/*#__PURE__*/React.createElement(\"ul\",{className:formClasses},this.renderInputField(OperationInformation,this.formScope),/*#__PURE__*/React.createElement(\"h3\",null,TransferBasisType.name),this.renderArrayGroup(TransferBasisType,this.formScope))),/*#__PURE__*/React.createElement(Modal.Footer,null,/*#__PURE__*/React.createElement(Button,{type:\"button\",className:\"center\",iconClass:ICON.accept,colorClass:PRIMARY,onClick:this.handleSaveBtnClick},SAVE),/*#__PURE__*/React.createElement(Button,{type:\"button\",className:\"center\",iconClass:ICON.cancel,onClick:this.handleClearBtnClick},CLEAR))));}}]);return TransportationAndCargoModal;}(Component),_temp),(_applyDecoratedDescriptor(_class.prototype,\"handleBasisErrorsChange\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"handleBasisErrorsChange\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"editModalFields\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"editModalFields\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"showModal\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"showModal\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"hideModal\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"hideModal\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"handleSaveBtnClick\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"handleSaveBtnClick\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"handleClearBtnClick\",[autobind],Object.getOwnPropertyDescriptor(_class.prototype,\"handleClearBtnClick\"),_class.prototype)),_class);export default TransportationAndCargoModal;","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/upd/forms/TransportationAndCargoModal.js"],"names":["React","Component","Modal","Button","PRIMARY","CLEAR","SAVE","CHANGE","ICON","formBuilderStyles","styles","classNames","autobind","Text","TOP","get","set","clone","OperationInformation","TransferBasisType","ArrayGroup","TransportationAndCargoModal","props","handleFieldValue","Domain","scope","value","fieldsValues","state","path","field","operationInformationErrors","validate","setState","renderInputField","DomainVO","textControl","getFieldValue","isFieldRequired","renderArrayGroup","errors","handleBasisErrorsChange","basisErrors","isShowModal","chosenData","formScope","requiredFields","setInitialValues","prevProps","updateServerErrors","serverErrors","operationInformation","basis","server","hasOperationInformationErrors","hasBasisErrors","Object","keys","some","itemNum","item","length","isFormStateNeedUpdate","initialValues","setDataToFormState","clearFieldError","showModal","fieldValue","sortedInitialBasis","sortedBasis","values","reduce","obj","index","push","hideModal","clearParentState","initialArrayGroupField","prop","fieldName","includes","waybillError","formClasses","modalForm","customClasses","name","width","btnError","hasErrors","edit","editModalFields","errorMessage","center","accept","handleSaveBtnClick","cancel","handleClearBtnClick"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport Modal from '../../../common/modal/Modal';\r\nimport Button, { PRIMARY } from '../../../common/Button';\r\nimport PropTypes from 'prop-types';\r\nimport { CLEAR, SAVE, CHANGE } from '../../../common/Lbl';\r\nimport { ICON } from '@distate/components';\r\nimport formBuilderStyles from '../../../common/form/documents/DocumentFormBuilder.module.css';\r\nimport styles from './TransportationAndCargoModal.module.css';\r\nimport classNames from 'classnames';\r\nimport autobind from 'autobind-decorator';\r\nimport Text from '../../../common/form/components/Text';\r\nimport { TOP } from '../../../common/Placement';\r\nimport get from 'get-value';\r\nimport set from 'set-value';\r\nimport { clone } from '../../../utils/ObjectUtil';\r\nimport OperationInformation from '@distate/core/dist/domain/documents/upd/vo/transfer/OperationInformation';\r\nimport TransferBasisType from '@distate/core/dist/domain/documents/upd/vo/transfer/TransferBasisType';\r\nimport ArrayGroup from './ArrayGroup';\r\n\r\nclass TransportationAndCargoModal extends Component {\r\n  static propTypes = {\r\n    DomainVO: PropTypes.func.isRequired,\r\n    setDataToFormState: PropTypes.func.isRequired,\r\n    initialValues: PropTypes.object,\r\n    customClasses: PropTypes.string.isRequired,\r\n    waybillError: PropTypes.string,\r\n    clearFieldError: PropTypes.func.isRequired,\r\n    errors: PropTypes.array,\r\n    clearParentState: PropTypes.func.isRequired\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      isShowModal: false,\r\n      chosenData: '',\r\n      fieldsValues: {},\r\n      basisErrors: [],\r\n      operationInformationErrors: null\r\n    };\r\n\r\n    this.formScope = props.scope || props.DomainVO.field;\r\n    this.requiredFields = [`${this.formScope}.${OperationInformation.field}`];\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.setInitialValues(true);\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    if (prevProps !== this.props) {\r\n      this.setInitialValues();\r\n    }\r\n\r\n    if (prevProps.errors !== this.props.errors) {\r\n      this.updateServerErrors();\r\n    }\r\n  }\r\n\r\n  updateServerErrors() {\r\n    const serverErrors = get(this.props, 'errors');\r\n\r\n    if (serverErrors?.operationInformation) {\r\n      const operationInformationErrors = serverErrors.operationInformation.errors[0];\r\n      this.setState({ operationInformationErrors });\r\n    }\r\n\r\n    if (serverErrors?.basis) {\r\n      this.handleBasisErrorsChange(serverErrors.basis, true);\r\n    }\r\n  }\r\n\r\n  @autobind\r\n  handleBasisErrorsChange(errors, server) {\r\n    this.setState({ basisErrors: errors });\r\n  }\r\n\r\n  hasErrors() {\r\n    const { basisErrors, operationInformationErrors } = this.state;\r\n\r\n    const hasOperationInformationErrors = operationInformationErrors || null;\r\n    const hasBasisErrors = Object.keys(basisErrors).some(itemNum => {\r\n      for (const item in basisErrors[itemNum]) {\r\n        if (basisErrors[itemNum][item].errors?.length > 0) {\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    });\r\n\r\n    return hasBasisErrors || hasOperationInformationErrors;\r\n  }\r\n\r\n  setInitialValues(isFormStateNeedUpdate) {\r\n    const {\r\n      initialValues: { operationInformation, basis },\r\n      setDataToFormState\r\n    } = this.props;\r\n    const fieldsValues = {};\r\n\r\n    set(fieldsValues, `${this.formScope}.${OperationInformation.field}`, operationInformation);\r\n    set(fieldsValues, `${this.formScope}.${TransferBasisType.field}`, basis);\r\n\r\n    if (isFormStateNeedUpdate) setDataToFormState({ operationInformation, basis });\r\n    if (operationInformation) this.setState({ chosenData: operationInformation });\r\n    if (basis) this.setState({ fieldsValues });\r\n  }\r\n\r\n  @autobind\r\n  editModalFields() {\r\n    this.props.clearFieldError('waybill');\r\n    this.props.clearFieldError('transferDetails');\r\n    this.showModal();\r\n  }\r\n\r\n  @autobind\r\n  showModal() {\r\n    this.setState({ isShowModal: true });\r\n  }\r\n\r\n  @autobind\r\n  hideModal() {\r\n    this.setState({ isShowModal: false });\r\n  }\r\n\r\n  getFieldValue(Domain, scope) {\r\n    const path = scope ? `${scope}.${Domain.field}` : Domain.field;\r\n    const fieldValue = get(this.state.fieldsValues, path);\r\n    return fieldValue;\r\n  }\r\n\r\n  handleFieldValue = (Domain, scope) => value => {\r\n    const fieldsValues = clone(this.state.fieldsValues);\r\n    const path = scope ? `${scope}.${Domain.field}` : Domain.field;\r\n    set(fieldsValues, path, value);\r\n    if (Domain.field === OperationInformation.field) {\r\n      const operationInformationErrors = Domain.validate(value);\r\n      this.setState({ operationInformationErrors });\r\n    }\r\n    this.setState({ fieldsValues });\r\n  };\r\n\r\n  @autobind\r\n  handleSaveBtnClick() {\r\n    const { setDataToFormState } = this.props;\r\n    const { fieldsValues } = this.state;\r\n\r\n    const operationInformation = get(\r\n      fieldsValues,\r\n      `${this.formScope}.${OperationInformation.field}`\r\n    );\r\n    const sortedInitialBasis = [];\r\n    const sortedBasis = Object.values(\r\n      get(fieldsValues, `${this.formScope}.${TransferBasisType.field}`)\r\n    ).reduce((obj, item, index) => {\r\n      obj[index] = item;\r\n      sortedInitialBasis.push(item);\r\n      return obj;\r\n    }, {});\r\n    this.handleFieldValue(TransferBasisType, this.formScope)(sortedInitialBasis);\r\n    setDataToFormState({ operationInformation, basis: sortedBasis });\r\n\r\n    if (operationInformation) {\r\n      this.setState({ chosenData: operationInformation });\r\n    } else {\r\n      this.setState({ chosenData: '' });\r\n    }\r\n    this.hideModal();\r\n  }\r\n\r\n  @autobind\r\n  handleClearBtnClick() {\r\n    const { clearParentState } = this.props;\r\n\r\n    const initialArrayGroupField = Object.keys(\r\n      get(this.state.fieldsValues, `${this.formScope}.${TransferBasisType.field}.0`)\r\n    ).reduce((obj, prop) => {\r\n      obj[prop] = '';\r\n      return obj;\r\n    }, {});\r\n\r\n    const fieldsValues = clone(this.state.fieldsValues);\r\n    set(fieldsValues, `${this.formScope}.${OperationInformation.field}`, '');\r\n    set(fieldsValues, `${this.formScope}.${TransferBasisType.field}`, [initialArrayGroupField]);\r\n\r\n    this.setState({ fieldsValues });\r\n    clearParentState();\r\n  }\r\n\r\n  isFieldRequired(Domain, scope) {\r\n    const fieldName = scope ? `${scope}.${Domain.field}` : `${this.formScope}.${Domain.field}`;\r\n    return this.requiredFields.includes(fieldName);\r\n  }\r\n\r\n  renderInputField = (DomainVO, scope) => (\r\n    <li className={styles.textControl}>\r\n      <Text\r\n        DomainVO={DomainVO}\r\n        initialValue={this.getFieldValue(DomainVO, scope)}\r\n        onValueChange={this.handleFieldValue(DomainVO, scope)}\r\n        labelAlign={TOP}\r\n        isRequired={this.isFieldRequired(DomainVO, scope)}\r\n        errorMsg={this.state.operationInformationErrors}\r\n      />\r\n    </li>\r\n  );\r\n\r\n  renderArrayGroup = (DomainVO, scope) => (\r\n    <ArrayGroup\r\n      domainVO={DomainVO}\r\n      initialValues={this.getFieldValue(DomainVO, scope)}\r\n      returnState={this.handleFieldValue(DomainVO, scope)}\r\n      isFirstRowNameHidden\r\n      requiredFields={[false, false, false, false, false]}\r\n      handleErrorsChange={errors => this.handleBasisErrorsChange(errors, false)}\r\n      errors={this.state.basisErrors}\r\n    />\r\n  );\r\n\r\n  render() {\r\n    const { DomainVO, waybillError } = this.props;\r\n    const { isShowModal, chosenData } = this.state;\r\n\r\n    const formClasses = classNames('form', formBuilderStyles.modalForm);\r\n    return (\r\n      <>\r\n        <li className={this.props.customClasses}>\r\n          <label className=\"ds-field-name leftside required\">{DomainVO.name}</label>\r\n          <div className=\"group\">\r\n            <div className=\"ds-input-group\">\r\n              {!!chosenData && (\r\n                <p className=\"ds-field-value predefined\" style={{ width: '472px' }}>\r\n                  <span>{this.state.chosenData}</span>\r\n                </p>\r\n              )}\r\n              <Button\r\n                type=\"button\"\r\n                className={classNames({\r\n                  [formBuilderStyles.btnError]: this.hasErrors() || waybillError\r\n                })}\r\n                iconClass={ICON.edit}\r\n                onClick={this.editModalFields}\r\n              >\r\n                {CHANGE}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n          {waybillError && (\r\n            <span class={classNames('ds-field-name', 'bottom', 'error', styles.errorMessage)}>\r\n              {waybillError}\r\n            </span>\r\n          )}\r\n        </li>\r\n\r\n        <Modal\r\n          hide={this.hideModal}\r\n          width=\"880px\"\r\n          isVisible={isShowModal}\r\n          key={`${this.formScope}_transportationAndCargoModal`}\r\n        >\r\n          <Modal.Header title={DomainVO.name} className={formBuilderStyles.center} />\r\n          <Modal.Body>\r\n            <ul className={formClasses}>\r\n              {this.renderInputField(OperationInformation, this.formScope)}\r\n              <h3>{TransferBasisType.name}</h3>\r\n              {this.renderArrayGroup(TransferBasisType, this.formScope)}\r\n            </ul>\r\n          </Modal.Body>\r\n          <Modal.Footer>\r\n            <Button\r\n              type=\"button\"\r\n              className=\"center\"\r\n              iconClass={ICON.accept}\r\n              colorClass={PRIMARY}\r\n              onClick={this.handleSaveBtnClick}\r\n            >\r\n              {SAVE}\r\n            </Button>\r\n            <Button\r\n              type=\"button\"\r\n              className=\"center\"\r\n              iconClass={ICON.cancel}\r\n              onClick={this.handleClearBtnClick}\r\n            >\r\n              {CLEAR}\r\n            </Button>\r\n          </Modal.Footer>\r\n        </Modal>\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default TransportationAndCargoModal;\r\n"]},"metadata":{},"sourceType":"module"}