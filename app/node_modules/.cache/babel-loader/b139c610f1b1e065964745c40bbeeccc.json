{"ast":null,"code":"import _objectWithoutProperties from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectWithoutProperties\";import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(companyDetailsEffect),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(getCompanyDetailsWorker),_marked3=/*#__PURE__*/_regeneratorRuntime.mark(editDetailsWorker);import{takeLatest,put}from'redux-saga/effects';import AuthGateway from'@distate/core/dist/application/auth/AuthGateway';import{Flash}from'../../../../common/flash/Flash';import{getCompanyDetails,setCompanyDetails,editDetails,setDetailErrors,clearErrors}from'../actions';import{history}from'../../../../App';import{COMPANY_ADDRESS}from'../../../../common/Url';import CompanyGateway from'@distate/core/dist/application/company/CompanyGateway';/** Реквизиты компании */export function companyDetailsEffect(){return _regeneratorRuntime.wrap(function companyDetailsEffect$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return takeLatest(getCompanyDetails,getCompanyDetailsWorker);case 2:_context.next=4;return takeLatest(editDetails,editDetailsWorker);case 4:case\"end\":return _context.stop();}}},_marked);}/** получение реквизитов компании */function getCompanyDetailsWorker(){var authGateway,details;return _regeneratorRuntime.wrap(function getCompanyDetailsWorker$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;authGateway=new AuthGateway();_context2.next=4;return authGateway.currentCompany();case 4:details=_context2.sent;_context2.next=7;return put(setCompanyDetails(details));case 7:_context2.next=13;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);_context2.next=13;return Flash.error('Возникла ошибка');case 13:case\"end\":return _context2.stop();}}},_marked2,null,[[0,9]]);}/** редактирование реквизитов */function editDetailsWorker(_ref){var payload,hasIncopleteRole,props,okpo,accountNumber,bik,kpp,taxAuthority,companyGateway,formData,request,response;return _regeneratorRuntime.wrap(function editDetailsWorker$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:payload=_ref.payload;_context3.prev=1;hasIncopleteRole=payload.hasIncopleteRole,props=_objectWithoutProperties(payload,[\"hasIncopleteRole\"]);okpo=props.okpo,accountNumber=props.accountNumber,bik=props.bik,kpp=props.kpp,taxAuthority=props.taxAuthority;companyGateway=new CompanyGateway();formData=new FormData();accountNumber&&formData.set('accountNumber',accountNumber);bik&&formData.set('bik',bik);okpo&&formData.set('division[classificationNumber]',okpo);taxAuthority&&formData.set('taxAuthority',taxAuthority);kpp&&formData.set('division[kpp]',kpp);_context3.next=13;return companyGateway.setCompanyDetails(formData);case 13:_context3.next=15;return put(getCompanyDetails());case 15:_context3.next=17;return put(clearErrors());case 17:_context3.next=19;return Flash.success('Данные сохранены');case 19:_context3.next=21;return hasIncopleteRole&&history.push(COMPANY_ADDRESS);case 21:_context3.next=33;break;case 23:_context3.prev=23;_context3.t0=_context3[\"catch\"](1);request=_context3.t0.request;_context3.next=28;return request&&JSON.parse(request.response);case 28:response=_context3.sent;_context3.next=31;return put(setDetailErrors(response));case 31:_context3.next=33;return Flash.error('Возникла ошибка');case 33:case\"end\":return _context3.stop();}}},_marked3,null,[[1,23]]);}","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/company/store/sagas/companyDetails.effect.ts"],"names":["companyDetailsEffect","getCompanyDetailsWorker","editDetailsWorker","takeLatest","put","AuthGateway","Flash","getCompanyDetails","setCompanyDetails","editDetails","setDetailErrors","clearErrors","history","COMPANY_ADDRESS","CompanyGateway","authGateway","currentCompany","details","error","payload","hasIncopleteRole","props","okpo","accountNumber","bik","kpp","taxAuthority","companyGateway","formData","FormData","set","success","push","request","JSON","parse","response"],"mappings":"mZAeiBA,oB,iDAMPC,uB,iDAWAC,iB,EAhCV,OAASC,UAAT,CAAqBC,GAArB,KAAgC,oBAAhC,CACA,MAAOC,CAAAA,WAAP,KAAwB,iDAAxB,CACA,OAASC,KAAT,KAAsB,gCAAtB,CACA,OACEC,iBADF,CAEEC,iBAFF,CAGEC,WAHF,CAIEC,eAJF,CAKEC,WALF,KAMO,YANP,CAOA,OAASC,OAAT,KAAwB,iBAAxB,CACA,OAASC,eAAT,KAAgC,wBAAhC,CACA,MAAOC,CAAAA,cAAP,KAA2B,uDAA3B,CAEA,yBACA,MAAO,SAAUd,CAAAA,oBAAV,gJACL,MAAMG,CAAAA,UAAU,CAACI,iBAAD,CAAoBN,uBAApB,CAAhB,CADK,uBAEL,MAAME,CAAAA,UAAU,CAACM,WAAD,CAAcP,iBAAd,CAAhB,CAFK,sDAKP,oCACA,QAAUD,CAAAA,uBAAV,+KAEUc,WAFV,CAEwB,GAAIV,CAAAA,WAAJ,EAFxB,kBAGoB,MAAMU,CAAAA,WAAW,CAACC,cAAZ,EAAN,CAHpB,OAGUC,OAHV,iCAII,MAAMb,CAAAA,GAAG,CAACI,iBAAiB,CAACS,OAAD,CAAlB,CAAT,CAJJ,4GAMI,MAAMX,CAAAA,KAAK,CAACY,KAAN,CAAY,iBAAZ,CAAN,CANJ,sEAUA,gCACA,QAAUhB,CAAAA,iBAAV,wPAA8BiB,OAA9B,MAA8BA,OAA9B,kBAEYC,gBAFZ,CAE2CD,OAF3C,CAEYC,gBAFZ,CAEiCC,KAFjC,0BAE2CF,OAF3C,uBAGYG,IAHZ,CAG4DD,KAH5D,CAGYC,IAHZ,CAGkBC,aAHlB,CAG4DF,KAH5D,CAGkBE,aAHlB,CAGiCC,GAHjC,CAG4DH,KAH5D,CAGiCG,GAHjC,CAGsCC,GAHtC,CAG4DJ,KAH5D,CAGsCI,GAHtC,CAG2CC,YAH3C,CAG4DL,KAH5D,CAG2CK,YAH3C,CAKUC,cALV,CAK2B,GAAIb,CAAAA,cAAJ,EAL3B,CAMUc,QANV,CAMqB,GAAIC,CAAAA,QAAJ,EANrB,CAQIN,aAAa,EAAIK,QAAQ,CAACE,GAAT,CAAa,eAAb,CAA8BP,aAA9B,CAAjB,CACAC,GAAG,EAAII,QAAQ,CAACE,GAAT,CAAa,KAAb,CAAoBN,GAApB,CAAP,CACAF,IAAI,EAAIM,QAAQ,CAACE,GAAT,CAAa,gCAAb,CAA+CR,IAA/C,CAAR,CACAI,YAAY,EAAIE,QAAQ,CAACE,GAAT,CAAa,cAAb,CAA6BJ,YAA7B,CAAhB,CACAD,GAAG,EAAIG,QAAQ,CAACE,GAAT,CAAa,eAAb,CAA8BL,GAA9B,CAAP,CAZJ,kBAcI,MAAME,CAAAA,cAAc,CAACnB,iBAAf,CAAiCoB,QAAjC,CAAN,CAdJ,0BAeI,MAAMxB,CAAAA,GAAG,CAACG,iBAAiB,EAAlB,CAAT,CAfJ,0BAiBI,MAAMH,CAAAA,GAAG,CAACO,WAAW,EAAZ,CAAT,CAjBJ,0BAkBI,MAAML,CAAAA,KAAK,CAACyB,OAAN,CAAc,kBAAd,CAAN,CAlBJ,0BAoBI,MAAMX,CAAAA,gBAAgB,EAAIR,OAAO,CAACoB,IAAR,CAAanB,eAAb,CAA1B,CApBJ,6FAsBYoB,OAtBZ,cAsBYA,OAtBZ,mBAuBqB,MAAMA,CAAAA,OAAO,EAAIC,IAAI,CAACC,KAAL,CAAWF,OAAO,CAACG,QAAnB,CAAjB,CAvBrB,QAuBUA,QAvBV,kCAwBI,MAAMhC,CAAAA,GAAG,CAACM,eAAe,CAAC0B,QAAD,CAAhB,CAAT,CAxBJ,0BAyBI,MAAM9B,CAAAA,KAAK,CAACY,KAAN,CAAY,iBAAZ,CAAN,CAzBJ","sourcesContent":["import { takeLatest, put } from 'redux-saga/effects';\r\nimport AuthGateway from '@distate/core/dist/application/auth/AuthGateway';\r\nimport { Flash } from '../../../../common/flash/Flash';\r\nimport {\r\n  getCompanyDetails,\r\n  setCompanyDetails,\r\n  editDetails,\r\n  setDetailErrors,\r\n  clearErrors\r\n} from '../actions';\r\nimport { history } from '../../../../App';\r\nimport { COMPANY_ADDRESS } from '../../../../common/Url';\r\nimport CompanyGateway from '@distate/core/dist/application/company/CompanyGateway';\r\n\r\n/** Реквизиты компании */\r\nexport function* companyDetailsEffect() {\r\n  yield takeLatest(getCompanyDetails, getCompanyDetailsWorker);\r\n  yield takeLatest(editDetails, editDetailsWorker);\r\n}\r\n\r\n/** получение реквизитов компании */\r\nfunction* getCompanyDetailsWorker() {\r\n  try {\r\n    const authGateway = new AuthGateway();\r\n    const details = yield authGateway.currentCompany();\r\n    yield put(setCompanyDetails(details));\r\n  } catch (err) {\r\n    yield Flash.error('Возникла ошибка');\r\n  }\r\n}\r\n\r\n/** редактирование реквизитов */\r\nfunction* editDetailsWorker({ payload }: { payload: any }) {\r\n  try {\r\n    const { hasIncopleteRole, ...props } = payload;\r\n    const { okpo, accountNumber, bik, kpp, taxAuthority } = props;\r\n\r\n    const companyGateway = new CompanyGateway();\r\n    const formData = new FormData();\r\n\r\n    accountNumber && formData.set('accountNumber', accountNumber);\r\n    bik && formData.set('bik', bik);\r\n    okpo && formData.set('division[classificationNumber]', okpo);\r\n    taxAuthority && formData.set('taxAuthority', taxAuthority);\r\n    kpp && formData.set('division[kpp]', kpp);\r\n\r\n    yield companyGateway.setCompanyDetails(formData);\r\n    yield put(getCompanyDetails());\r\n\r\n    yield put(clearErrors());\r\n    yield Flash.success('Данные сохранены');\r\n    /** редирект если это первое заполнение данные при регистрации */\r\n    yield hasIncopleteRole && history.push(COMPANY_ADDRESS);\r\n  } catch (err) {\r\n    const { request } = err;\r\n    const response = yield request && JSON.parse(request.response);\r\n    yield put(setDetailErrors(response));\r\n    yield Flash.error('Возникла ошибка');\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}