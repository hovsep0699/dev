{"ast":null,"code":"import _createForOfIteratorHelper from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createForOfIteratorHelper\";import _objectSpread from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(tariffEffect),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(getActiveTariffsWorker),_marked3=/*#__PURE__*/_regeneratorRuntime.mark(getArchivedTariffsWorker),_marked4=/*#__PURE__*/_regeneratorRuntime.mark(getTariffWorker),_marked5=/*#__PURE__*/_regeneratorRuntime.mark(getSelectedTariffFlowWorker),_marked6=/*#__PURE__*/_regeneratorRuntime.mark(getTariffTypesWorker),_marked7=/*#__PURE__*/_regeneratorRuntime.mark(getTariffStatusesWorker),_marked8=/*#__PURE__*/_regeneratorRuntime.mark(editTariffWorker),_marked9=/*#__PURE__*/_regeneratorRuntime.mark(updateTariffFlowWorker),_marked10=/*#__PURE__*/_regeneratorRuntime.mark(setTariffStatusWorker),_marked11=/*#__PURE__*/_regeneratorRuntime.mark(createTariffWorker);import{takeLatest,put}from'redux-saga/effects';import{financeGateway}from'@distate/core/dist/application/finance/FinanceGateway';import{getActiveTariffs,setActiveTariffs,getArchivedTariffs,setArchivedTariffs,getTariff,setTariff,getSelectedTariffFlow,setSelectedTariffFlow,getTariffTypes,setTariffTypes,getTariffStatuses,setTariffStatuses,editTariff,updateTariffFlow,createTariff,setViewTariffId,setIsOpenTariffCreate,setIsOpenTariffCard,setTariffErrors,setIsTariffEditing,setTariffStatus}from'../actions';import{Flash}from'../../../../common/flash';export function tariffEffect(){return _regeneratorRuntime.wrap(function tariffEffect$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return takeLatest(getActiveTariffs,getActiveTariffsWorker);case 2:_context.next=4;return takeLatest(getArchivedTariffs,getArchivedTariffsWorker);case 4:_context.next=6;return takeLatest(getTariff,getTariffWorker);case 6:_context.next=8;return takeLatest(getSelectedTariffFlow,getSelectedTariffFlowWorker);case 8:_context.next=10;return takeLatest(getTariffTypes,getTariffTypesWorker);case 10:_context.next=12;return takeLatest(getTariffStatuses,getTariffStatusesWorker);case 12:_context.next=14;return takeLatest(editTariff,editTariffWorker);case 14:_context.next=16;return takeLatest(updateTariffFlow,updateTariffFlowWorker);case 16:_context.next=18;return takeLatest(setTariffStatus,setTariffStatusWorker);case 18:_context.next=20;return takeLatest(createTariff,createTariffWorker);case 20:case\"end\":return _context.stop();}}},_marked);}/** получение активных тарифов */function getActiveTariffsWorker(_ref){var payload,activeTariffs;return _regeneratorRuntime.wrap(function getActiveTariffsWorker$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:payload=_ref.payload;_context2.prev=1;_context2.next=4;return financeGateway.getTariffs(_objectSpread(_objectSpread({},payload),{},{notStatusSystemName:'archive'}));case 4:activeTariffs=_context2.sent;_context2.next=7;return put(setActiveTariffs({activeTariffs:activeTariffs}));case 7:_context2.next=13;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](1);_context2.next=13;return Flash.error('Произошла ошибка');case 13:case\"end\":return _context2.stop();}}},_marked2,null,[[1,9]]);}/** получение архивированнх тарифов */function getArchivedTariffsWorker(_ref2){var payload,archivedTariffs;return _regeneratorRuntime.wrap(function getArchivedTariffsWorker$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:payload=_ref2.payload;_context3.prev=1;_context3.next=4;return financeGateway.getTariffs(_objectSpread(_objectSpread({},payload),{},{statusSystemName:'archive'}));case 4:archivedTariffs=_context3.sent;_context3.next=7;return put(setArchivedTariffs({archivedTariffs:archivedTariffs}));case 7:_context3.next=13;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](1);_context3.next=13;return Flash.error('Произошла ошибка');case 13:case\"end\":return _context3.stop();}}},_marked3,null,[[1,9]]);}/** получение тарифа */function getTariffWorker(_ref3){var payload,currentTariff;return _regeneratorRuntime.wrap(function getTariffWorker$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:payload=_ref3.payload;_context4.prev=1;_context4.next=4;return financeGateway.getTariff(payload);case 4:currentTariff=_context4.sent;_context4.next=7;return put(setTariff({currentTariff:currentTariff}));case 7:_context4.next=13;break;case 9:_context4.prev=9;_context4.t0=_context4[\"catch\"](1);_context4.next=13;return Flash.error('Произошла ошибка');case 13:case\"end\":return _context4.stop();}}},_marked4,null,[[1,9]]);}/** получение документооборота тарифа */function getSelectedTariffFlowWorker(_ref4){var payload,selectedTariffFlow;return _regeneratorRuntime.wrap(function getSelectedTariffFlowWorker$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:payload=_ref4.payload;_context5.prev=1;_context5.next=4;return financeGateway.getTariffFlow(payload);case 4:selectedTariffFlow=_context5.sent;_context5.next=7;return put(setSelectedTariffFlow({selectedTariffFlow:selectedTariffFlow}));case 7:_context5.next=13;break;case 9:_context5.prev=9;_context5.t0=_context5[\"catch\"](1);_context5.next=13;return Flash.error('Произошла ошибка');case 13:case\"end\":return _context5.stop();}}},_marked5,null,[[1,9]]);}/** получение типов тарифов */function getTariffTypesWorker(){var tariffTypes;return _regeneratorRuntime.wrap(function getTariffTypesWorker$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;_context6.next=3;return financeGateway.getTariffTypes();case 3:tariffTypes=_context6.sent;_context6.next=6;return put(setTariffTypes({tariffTypes:tariffTypes.rows}));case 6:_context6.next=12;break;case 8:_context6.prev=8;_context6.t0=_context6[\"catch\"](0);_context6.next=12;return Flash.error('Произошла ошибка');case 12:case\"end\":return _context6.stop();}}},_marked6,null,[[0,8]]);}/** получение статусов тарифов */function getTariffStatusesWorker(){var tariffStatuses;return _regeneratorRuntime.wrap(function getTariffStatusesWorker$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.prev=0;_context7.next=3;return financeGateway.getTariffStatuses();case 3:tariffStatuses=_context7.sent;_context7.next=6;return put(setTariffStatuses({tariffStatuses:tariffStatuses.rows}));case 6:_context7.next=12;break;case 8:_context7.prev=8;_context7.t0=_context7[\"catch\"](0);_context7.next=12;return Flash.error('Произошла ошибка');case 12:case\"end\":return _context7.stop();}}},_marked7,null,[[0,8]]);}/** изменение тарифа */function editTariffWorker(_ref5){var payload,id,formData,_error$response,_error$response$data;return _regeneratorRuntime.wrap(function editTariffWorker$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:payload=_ref5.payload;_context8.prev=1;_context8.next=4;return put(setTariffErrors({tariffErrors:undefined}));case 4:id=payload.id,formData=payload.formData;_context8.next=7;return financeGateway.editTariff(id,formData);case 7:_context8.next=9;return put(getTariff(id));case 9:_context8.next=11;return put(getActiveTariffs({limit:10}));case 11:_context8.next=13;return put(setIsTariffEditing({isTariffEditing:false}));case 13:_context8.next=15;return Flash.success('Изменения сохранены');case 15:_context8.next=23;break;case 17:_context8.prev=17;_context8.t0=_context8[\"catch\"](1);_context8.next=21;return put(setTariffErrors({tariffErrors:_context8.t0===null||_context8.t0===void 0?void 0:(_error$response=_context8.t0.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.messages}));case 21:_context8.next=23;return Flash.error('Произошла ошибка');case 23:case\"end\":return _context8.stop();}}},_marked8,null,[[1,17]]);}/** Обновить данные по виду документооборота для тарифа */function updateTariffFlowWorker(_ref6){var payload,_iterator,_step,item,formData;return _regeneratorRuntime.wrap(function updateTariffFlowWorker$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:payload=_ref6.payload;_context9.prev=1;_iterator=_createForOfIteratorHelper(payload);_context9.prev=3;_iterator.s();case 5:if((_step=_iterator.n()).done){_context9.next=15;break;}item=_step.value;formData=new FormData();formData.append('cost',item.cost.toString());_context9.next=11;return financeGateway.updateTariffFlow(item.tariffId,item.flowId,formData);case 11:_context9.next=13;return put(getSelectedTariffFlow(item.tariffId));case 13:_context9.next=5;break;case 15:_context9.next=20;break;case 17:_context9.prev=17;_context9.t0=_context9[\"catch\"](3);_iterator.e(_context9.t0);case 20:_context9.prev=20;_iterator.f();return _context9.finish(20);case 23:_context9.next=29;break;case 25:_context9.prev=25;_context9.t1=_context9[\"catch\"](1);_context9.next=29;return Flash.error('Произошла ошибка');case 29:case\"end\":return _context9.stop();}}},_marked9,null,[[1,25],[3,17,20,23]]);}/** изменить статус тарифа */function setTariffStatusWorker(_ref7){var payload,tariffId,statusSystemName;return _regeneratorRuntime.wrap(function setTariffStatusWorker$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:payload=_ref7.payload;_context10.prev=1;tariffId=payload.tariffId,statusSystemName=payload.statusSystemName;_context10.next=5;return financeGateway.setTariffStatus(tariffId,statusSystemName);case 5:_context10.next=7;return put(getTariff(tariffId));case 7:_context10.next=9;return put(getActiveTariffs({limit:10}));case 9:_context10.next=11;return put(getArchivedTariffs({limit:10}));case 11:_context10.next=17;break;case 13:_context10.prev=13;_context10.t0=_context10[\"catch\"](1);_context10.next=17;return Flash.error('Произошла ошибка');case 17:case\"end\":return _context10.stop();}}},_marked10,null,[[1,13]]);}/** создать тариф */function createTariffWorker(_ref8){var payload,response,_error$response2,_error$response2$data;return _regeneratorRuntime.wrap(function createTariffWorker$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:payload=_ref8.payload;_context11.prev=1;_context11.next=4;return put(setTariffErrors({tariffErrors:undefined}));case 4:_context11.next=6;return financeGateway.createTariff(payload);case 6:response=_context11.sent;_context11.next=9;return put(getActiveTariffs({limit:10}));case 9:_context11.next=11;return put(setViewTariffId({viewTariffId:response.data.id}));case 11:_context11.next=13;return put(setIsOpenTariffCreate({isOpenTariffCreate:false}));case 13:_context11.next=15;return put(setIsOpenTariffCard({isOpenTariffCard:true}));case 15:_context11.next=23;break;case 17:_context11.prev=17;_context11.t0=_context11[\"catch\"](1);_context11.next=21;return put(setTariffErrors({tariffErrors:_context11.t0===null||_context11.t0===void 0?void 0:(_error$response2=_context11.t0.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.messages}));case 21:_context11.next=23;return Flash.error('Произошла ошибка');case 23:case\"end\":return _context11.stop();}}},_marked11,null,[[1,17]]);}","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/tariff/store/sagas/tariff.saga.ts"],"names":["tariffEffect","getActiveTariffsWorker","getArchivedTariffsWorker","getTariffWorker","getSelectedTariffFlowWorker","getTariffTypesWorker","getTariffStatusesWorker","editTariffWorker","updateTariffFlowWorker","setTariffStatusWorker","createTariffWorker","takeLatest","put","financeGateway","getActiveTariffs","setActiveTariffs","getArchivedTariffs","setArchivedTariffs","getTariff","setTariff","getSelectedTariffFlow","setSelectedTariffFlow","getTariffTypes","setTariffTypes","getTariffStatuses","setTariffStatuses","editTariff","updateTariffFlow","createTariff","setViewTariffId","setIsOpenTariffCreate","setIsOpenTariffCard","setTariffErrors","setIsTariffEditing","setTariffStatus","Flash","payload","getTariffs","notStatusSystemName","activeTariffs","error","statusSystemName","archivedTariffs","currentTariff","getTariffFlow","selectedTariffFlow","tariffTypes","rows","tariffStatuses","tariffErrors","undefined","id","formData","limit","isTariffEditing","success","response","data","messages","item","FormData","append","cost","toString","tariffId","flowId","viewTariffId","isOpenTariffCreate","isOpenTariffCard"],"mappings":"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","sourcesContent":["import { takeLatest, put } from 'redux-saga/effects';\r\nimport { financeGateway } from '@distate/core/dist/application/finance/FinanceGateway';\r\n\r\nimport {\r\n  getActiveTariffs,\r\n  setActiveTariffs,\r\n  getArchivedTariffs,\r\n  setArchivedTariffs,\r\n  getTariff,\r\n  setTariff,\r\n  getSelectedTariffFlow,\r\n  setSelectedTariffFlow,\r\n  getTariffTypes,\r\n  setTariffTypes,\r\n  getTariffStatuses,\r\n  setTariffStatuses,\r\n  editTariff,\r\n  updateTariffFlow,\r\n  createTariff,\r\n  setViewTariffId,\r\n  setIsOpenTariffCreate,\r\n  setIsOpenTariffCard,\r\n  setTariffErrors,\r\n  setIsTariffEditing,\r\n  setTariffStatus\r\n} from '../actions';\r\nimport { Flash } from '../../../../common/flash';\r\n\r\nexport function* tariffEffect() {\r\n  yield takeLatest(getActiveTariffs, getActiveTariffsWorker);\r\n  yield takeLatest(getArchivedTariffs, getArchivedTariffsWorker);\r\n  yield takeLatest(getTariff, getTariffWorker);\r\n  yield takeLatest(getSelectedTariffFlow, getSelectedTariffFlowWorker);\r\n  yield takeLatest(getTariffTypes, getTariffTypesWorker);\r\n  yield takeLatest(getTariffStatuses, getTariffStatusesWorker);\r\n  yield takeLatest(editTariff, editTariffWorker);\r\n  yield takeLatest(updateTariffFlow, updateTariffFlowWorker);\r\n  yield takeLatest(setTariffStatus, setTariffStatusWorker);\r\n  yield takeLatest(createTariff, createTariffWorker);\r\n}\r\n\r\n/** получение активных тарифов */\r\nfunction* getActiveTariffsWorker({ payload }: any) {\r\n  try {\r\n    const activeTariffs = yield financeGateway.getTariffs({\r\n      ...payload,\r\n      notStatusSystemName: 'archive'\r\n    });\r\n    yield put(setActiveTariffs({ activeTariffs }));\r\n  } catch (error) {\r\n    yield Flash.error('Произошла ошибка');\r\n  }\r\n}\r\n\r\n/** получение архивированнх тарифов */\r\nfunction* getArchivedTariffsWorker({ payload }: any) {\r\n  try {\r\n    const archivedTariffs = yield financeGateway.getTariffs({\r\n      ...payload,\r\n      statusSystemName: 'archive'\r\n    });\r\n    yield put(setArchivedTariffs({ archivedTariffs }));\r\n  } catch (error) {\r\n    yield Flash.error('Произошла ошибка');\r\n  }\r\n}\r\n\r\n/** получение тарифа */\r\nfunction* getTariffWorker({ payload }: { payload: number }) {\r\n  try {\r\n    const currentTariff = yield financeGateway.getTariff(payload);\r\n    yield put(setTariff({ currentTariff }));\r\n  } catch (error) {\r\n    yield Flash.error('Произошла ошибка');\r\n  }\r\n}\r\n\r\n/** получение документооборота тарифа */\r\nfunction* getSelectedTariffFlowWorker({ payload }: { payload: number }) {\r\n  try {\r\n    const selectedTariffFlow = yield financeGateway.getTariffFlow(payload);\r\n    yield put(setSelectedTariffFlow({ selectedTariffFlow }));\r\n  } catch (error) {\r\n    yield Flash.error('Произошла ошибка');\r\n  }\r\n}\r\n\r\n/** получение типов тарифов */\r\nfunction* getTariffTypesWorker() {\r\n  try {\r\n    const tariffTypes = yield financeGateway.getTariffTypes();\r\n    yield put(setTariffTypes({ tariffTypes: tariffTypes.rows }));\r\n  } catch (error) {\r\n    yield Flash.error('Произошла ошибка');\r\n  }\r\n}\r\n\r\n/** получение статусов тарифов */\r\nfunction* getTariffStatusesWorker() {\r\n  try {\r\n    const tariffStatuses = yield financeGateway.getTariffStatuses();\r\n    yield put(setTariffStatuses({ tariffStatuses: tariffStatuses.rows }));\r\n  } catch (error) {\r\n    yield Flash.error('Произошла ошибка');\r\n  }\r\n}\r\n\r\ntype EditTariffPayload = {\r\n  id: number;\r\n  formData: {};\r\n};\r\n/** изменение тарифа */\r\nfunction* editTariffWorker({ payload }: { payload: EditTariffPayload }) {\r\n  try {\r\n    yield put(setTariffErrors({ tariffErrors: undefined }));\r\n    const { id, formData } = payload;\r\n\r\n    yield financeGateway.editTariff(id, formData);\r\n    yield put(getTariff(id));\r\n    yield put(getActiveTariffs({ limit: 10 }));\r\n    yield put(setIsTariffEditing({ isTariffEditing: false }));\r\n    yield Flash.success('Изменения сохранены');\r\n  } catch (error) {\r\n    yield put(setTariffErrors({ tariffErrors: error?.response?.data?.messages }));\r\n    yield Flash.error('Произошла ошибка');\r\n  }\r\n}\r\n\r\ntype UpdateTariffFlowPayload = {\r\n  tariffId: number;\r\n  flowId: number;\r\n  cost: number;\r\n};\r\n/** Обновить данные по виду документооборота для тарифа */\r\nfunction* updateTariffFlowWorker({ payload }: { payload: UpdateTariffFlowPayload[] }) {\r\n  try {\r\n    for (const item of payload) {\r\n      const formData = new FormData();\r\n      formData.append('cost', item.cost.toString());\r\n      yield financeGateway.updateTariffFlow(item.tariffId, item.flowId, formData);\r\n      yield put(getSelectedTariffFlow(item.tariffId));\r\n    }\r\n  } catch (error) {\r\n    yield Flash.error('Произошла ошибка');\r\n  }\r\n}\r\n\r\ntype SetTariffStatusType = {\r\n  tariffId: number;\r\n  statusSystemName: string;\r\n};\r\n/** изменить статус тарифа */\r\nfunction* setTariffStatusWorker({ payload }: { payload: SetTariffStatusType }) {\r\n  try {\r\n    const { tariffId, statusSystemName } = payload;\r\n    yield financeGateway.setTariffStatus(tariffId, statusSystemName);\r\n    yield put(getTariff(tariffId));\r\n    yield put(getActiveTariffs({ limit: 10 }));\r\n    yield put(getArchivedTariffs({ limit: 10 }));\r\n  } catch (error) {\r\n    yield Flash.error('Произошла ошибка');\r\n  }\r\n}\r\n\r\n/** создать тариф */\r\nfunction* createTariffWorker({ payload }: { payload: any }) {\r\n  try {\r\n    yield put(setTariffErrors({ tariffErrors: undefined }));\r\n\r\n    const response = yield financeGateway.createTariff(payload);\r\n    yield put(getActiveTariffs({ limit: 10 }));\r\n    yield put(setViewTariffId({ viewTariffId: response.data.id }));\r\n    yield put(setIsOpenTariffCreate({ isOpenTariffCreate: false }));\r\n    yield put(setIsOpenTariffCard({ isOpenTariffCard: true }));\r\n  } catch (error) {\r\n    yield put(setTariffErrors({ tariffErrors: error?.response?.data?.messages }));\r\n    yield Flash.error('Произошла ошибка');\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}