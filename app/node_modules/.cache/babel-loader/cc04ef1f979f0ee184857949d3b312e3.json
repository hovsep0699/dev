{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(unformalized),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(getUnformalizedDictonariesWorker),_marked3=/*#__PURE__*/_regeneratorRuntime.mark(createUnformalizedWorker),_marked4=/*#__PURE__*/_regeneratorRuntime.mark(getDocumentJsonWorker),_marked5=/*#__PURE__*/_regeneratorRuntime.mark(editUnformalizedWorker);import{takeLatest,put}from'redux-saga/effects';import CompanyGateway from'@distate/core/dist/application/company/CompanyGateway';import DictionaryGateway from'@distate/core/dist/application/dictionary/common/DictionaryGateway';import{documentsGateway}from'@distate/core/dist/application/documents/DocumentsGateway';import{Flash}from'../../../../common/flash/Flash';import{getUnformalizedDictonaries,setUnformalizedDivisionEmployee,setUnformalizedFlow,createUnformalized,setUnformalizedError,getDocumentJson,setDocumentJson,editUnformalized}from'../actions';import{history}from'../../../../App';var companyGateway=new CompanyGateway();var dictionaryGateway=new DictionaryGateway();/** Создание неформализованного документа */export function unformalized(){return _regeneratorRuntime.wrap(function unformalized$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return takeLatest(getUnformalizedDictonaries,getUnformalizedDictonariesWorker);case 2:_context.next=4;return takeLatest(createUnformalized,createUnformalizedWorker);case 4:_context.next=6;return takeLatest(getDocumentJson,getDocumentJsonWorker);case 6:_context.next=8;return takeLatest(editUnformalized,editUnformalizedWorker);case 8:case\"end\":return _context.stop();}}},_marked);}/** получение справочников */function getUnformalizedDictonariesWorker(){var _yield$dictionaryGate,flow,_yield$companyGateway,divisionsEmployee,_response$data,response;return _regeneratorRuntime.wrap(function getUnformalizedDictonariesWorker$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return dictionaryGateway.getUnformalizedFlow();case 3:_yield$dictionaryGate=_context2.sent;flow=_yield$dictionaryGate.rows;_context2.next=7;return put(setUnformalizedFlow({flow:flow}));case 7:_context2.next=9;return companyGateway.getDivisions();case 9:_yield$companyGateway=_context2.sent;divisionsEmployee=_yield$companyGateway.rows;_context2.next=13;return put(setUnformalizedDivisionEmployee({divisionsEmployee:divisionsEmployee}));case 13:_context2.next=20;break;case 15:_context2.prev=15;_context2.t0=_context2[\"catch\"](0);response=_context2.t0.response;_context2.next=20;return Flash.error((response===null||response===void 0?void 0:(_response$data=response.data)===null||_response$data===void 0?void 0:_response$data.messages[0])||'Возникла ошибка');case 20:case\"end\":return _context2.stop();}}},_marked2,null,[[0,15]]);}/** создание нового неформализованного документа */function createUnformalizedWorker(_ref2){var payload,_yield$documentsGatew,data,_response$data2,_response$data3,response;return _regeneratorRuntime.wrap(function createUnformalizedWorker$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:payload=_ref2.payload;_context3.prev=1;_context3.next=4;return documentsGateway.createUnformalized(payload);case 4:_yield$documentsGatew=_context3.sent;data=_yield$documentsGatew.data;history.push(\"/document/\".concat(data===null||data===void 0?void 0:data.id));_context3.next=16;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](1);response=_context3.t0.response;_context3.next=14;return put(setUnformalizedError({errors:response===null||response===void 0?void 0:(_response$data2=response.data)===null||_response$data2===void 0?void 0:_response$data2.messages}));case 14:_context3.next=16;return Flash.error((response===null||response===void 0?void 0:(_response$data3=response.data)===null||_response$data3===void 0?void 0:_response$data3.messages[0])||'Возникла ошибка');case 16:case\"end\":return _context3.stop();}}},_marked3,null,[[1,9]]);}/** получить информацию о документе */function getDocumentJsonWorker(_ref4){var payload,documentJson,response;return _regeneratorRuntime.wrap(function getDocumentJsonWorker$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:payload=_ref4.payload;_context4.prev=1;_context4.next=4;return documentsGateway.getDocumentJson(payload);case 4:documentJson=_context4.sent;_context4.next=7;return put(setDocumentJson({documentJson:documentJson}));case 7:_context4.next=14;break;case 9:_context4.prev=9;_context4.t0=_context4[\"catch\"](1);response=_context4.t0.response;_context4.next=14;return Flash.error('Возникла ошибка');case 14:case\"end\":return _context4.stop();}}},_marked4,null,[[1,9]]);}/** редакутировать неформализованный документ */function editUnformalizedWorker(_ref6){var payload,documentId,formData,_yield$documentsGatew2,data,response;return _regeneratorRuntime.wrap(function editUnformalizedWorker$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:payload=_ref6.payload;_context5.prev=1;documentId=payload.documentId,formData=payload.formData;_context5.next=5;return documentsGateway.editUnformalized(documentId,formData);case 5:_yield$documentsGatew2=_context5.sent;data=_yield$documentsGatew2.data;history.push(\"/document/\".concat(data===null||data===void 0?void 0:data.id));_context5.next=15;break;case 10:_context5.prev=10;_context5.t0=_context5[\"catch\"](1);response=_context5.t0.response;_context5.next=15;return Flash.error('Возникла ошибка');case 15:case\"end\":return _context5.stop();}}},_marked5,null,[[1,10]]);}","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/create-document/store/sagas/unformalized.effect.ts"],"names":["unformalized","getUnformalizedDictonariesWorker","createUnformalizedWorker","getDocumentJsonWorker","editUnformalizedWorker","takeLatest","put","CompanyGateway","DictionaryGateway","documentsGateway","Flash","getUnformalizedDictonaries","setUnformalizedDivisionEmployee","setUnformalizedFlow","createUnformalized","setUnformalizedError","getDocumentJson","setDocumentJson","editUnformalized","history","companyGateway","dictionaryGateway","getUnformalizedFlow","flow","rows","getDivisions","divisionsEmployee","response","error","data","messages","payload","push","id","errors","documentJson","documentId","formData"],"mappings":"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","sourcesContent":["import { takeLatest, put } from 'redux-saga/effects';\r\nimport CompanyGateway from '@distate/core/dist/application/company/CompanyGateway';\r\nimport DictionaryGateway from '@distate/core/dist/application/dictionary/common/DictionaryGateway';\r\nimport { documentsGateway } from '@distate/core/dist/application/documents/DocumentsGateway';\r\n\r\nimport { Flash } from '../../../../common/flash/Flash';\r\nimport {\r\n  getUnformalizedDictonaries,\r\n  setUnformalizedDivisionEmployee,\r\n  setUnformalizedFlow,\r\n  createUnformalized,\r\n  setUnformalizedError,\r\n  getDocumentJson,\r\n  setDocumentJson,\r\n  editUnformalized\r\n} from '../actions';\r\nimport { history } from '../../../../App';\r\n\r\nconst companyGateway = new CompanyGateway();\r\nconst dictionaryGateway = new DictionaryGateway();\r\n\r\n/** Создание неформализованного документа */\r\nexport function* unformalized() {\r\n  yield takeLatest(getUnformalizedDictonaries, getUnformalizedDictonariesWorker);\r\n  yield takeLatest(createUnformalized, createUnformalizedWorker);\r\n  yield takeLatest(getDocumentJson, getDocumentJsonWorker);\r\n  yield takeLatest(editUnformalized, editUnformalizedWorker);\r\n}\r\n\r\n/** получение справочников */\r\nfunction* getUnformalizedDictonariesWorker() {\r\n  try {\r\n    const { rows: flow } = yield dictionaryGateway.getUnformalizedFlow();\r\n    yield put(setUnformalizedFlow({ flow }));\r\n\r\n    const { rows: divisionsEmployee } = yield companyGateway.getDivisions();\r\n    yield put(setUnformalizedDivisionEmployee({ divisionsEmployee }));\r\n  } catch ({ response }) {\r\n    yield Flash.error(response?.data?.messages[0] || 'Возникла ошибка');\r\n  }\r\n}\r\n\r\n/** создание нового неформализованного документа */\r\nfunction* createUnformalizedWorker({ payload }: { payload: any }) {\r\n  try {\r\n    const { data } = yield documentsGateway.createUnformalized(payload);\r\n    history.push(`/document/${data?.id}`);\r\n  } catch ({ response }) {\r\n    yield put(setUnformalizedError({ errors: response?.data?.messages }));\r\n    yield Flash.error(response?.data?.messages[0] || 'Возникла ошибка');\r\n  }\r\n}\r\n\r\n/** получить информацию о документе */\r\nfunction* getDocumentJsonWorker({ payload }: { payload: number }) {\r\n  try {\r\n    const documentJson = yield documentsGateway.getDocumentJson(payload);\r\n    yield put(setDocumentJson({ documentJson }));\r\n  } catch ({ response }) {\r\n    yield Flash.error('Возникла ошибка');\r\n  }\r\n}\r\n\r\ntype EditUnformalizedPayload = {\r\n  documentId: number;\r\n  formData: any;\r\n};\r\n/** редакутировать неформализованный документ */\r\nfunction* editUnformalizedWorker({ payload }: { payload: EditUnformalizedPayload }) {\r\n  try {\r\n    const { documentId, formData } = payload;\r\n    const { data } = yield documentsGateway.editUnformalized(documentId, formData);\r\n    history.push(`/document/${data?.id}`);\r\n  } catch ({ response }) {\r\n    yield Flash.error('Возникла ошибка');\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}