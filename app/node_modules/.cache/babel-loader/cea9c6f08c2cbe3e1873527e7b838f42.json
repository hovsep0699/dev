{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{useDispatch,useSelector}from'react-redux';import{CustomTable}from'../../../../common/custom-table';import{Input,DatePicker,Select,Autocomplete,Button,ButtonKinds,Icons}from'@distate/components';import{documentFromFileGateway}from'@distate/core/dist/application/create-document/DocumentFromFileGateway';import{getUnformalizedDictonaries,setUnformalizedError,getDocumentJson,editUnformalized}from'../../store/actions';import{selectDivisionEmployee,selectErrors,selectDocumentJson}from'../../store/selectors';import ReactQuill from'react-quill';import'react-quill/dist/quill.snow.css';import{AutocompleteRecipient}from'../common/AutocompleteRecipient';export var EditUnformalized=function EditUnformalized(_ref){var _match$params,_documentJson$formDat6;var match=_ref.match;var dispatch=useDispatch();var documentId=match===null||match===void 0?void 0:(_match$params=match.params)===null||_match$params===void 0?void 0:_match$params.id;useEffect(function(){documentId&&dispatch(getDocumentJson(documentId));dispatch(getUnformalizedDictonaries());return function(){dispatch(setUnformalizedError({}));};},[dispatch,documentId]);var divisionEmployeeRows=useSelector(selectDivisionEmployee);var errors=useSelector(selectErrors);var documentJson=useSelector(selectDocumentJson);useEffect(function(){var _documentJson$package,_documentJson$package2,_documentJson$package3,_documentJson$package4,_documentJson$package5,_documentJson$package6,_documentJson$package7,_documentJson$package8,_documentJson$package9,_documentJson$package10,_documentJson$package11,_documentJson$package12,_documentJson$package13,_documentJson$package14,_documentJson$package15,_documentJson$package16,_documentJson$package17,_documentJson$package18,_documentJson$package19,_documentJson$package20,_documentJson$package21,_documentJson$type,_documentJson$type2,_documentJson$formDat,_documentJson$formDat2;if(!documentJson)return;setNumber(documentJson===null||documentJson===void 0?void 0:documentJson.formData.number);setDate(new Date(documentJson===null||documentJson===void 0?void 0:documentJson.formData.date));setTitle(documentJson===null||documentJson===void 0?void 0:documentJson.formData.title);/** подразделение отправителя */setFromDivision({value:documentJson===null||documentJson===void 0?void 0:(_documentJson$package=documentJson.package)===null||_documentJson$package===void 0?void 0:(_documentJson$package2=_documentJson$package.from)===null||_documentJson$package2===void 0?void 0:(_documentJson$package3=_documentJson$package2.division)===null||_documentJson$package3===void 0?void 0:_documentJson$package3.id,label:documentJson===null||documentJson===void 0?void 0:(_documentJson$package4=documentJson.package)===null||_documentJson$package4===void 0?void 0:(_documentJson$package5=_documentJson$package4.from)===null||_documentJson$package5===void 0?void 0:(_documentJson$package6=_documentJson$package5.division)===null||_documentJson$package6===void 0?void 0:_documentJson$package6.title});/** получатель */setToDivision({value:documentJson===null||documentJson===void 0?void 0:(_documentJson$package7=documentJson.package)===null||_documentJson$package7===void 0?void 0:(_documentJson$package8=_documentJson$package7.to)===null||_documentJson$package8===void 0?void 0:(_documentJson$package9=_documentJson$package8.division)===null||_documentJson$package9===void 0?void 0:_documentJson$package9.id,label:getExtendedTitle(documentJson===null||documentJson===void 0?void 0:(_documentJson$package10=documentJson.package)===null||_documentJson$package10===void 0?void 0:(_documentJson$package11=_documentJson$package10.to.company)===null||_documentJson$package11===void 0?void 0:_documentJson$package11.name,documentJson===null||documentJson===void 0?void 0:(_documentJson$package12=documentJson.package)===null||_documentJson$package12===void 0?void 0:(_documentJson$package13=_documentJson$package12.to.company)===null||_documentJson$package13===void 0?void 0:_documentJson$package13.inn,documentJson===null||documentJson===void 0?void 0:(_documentJson$package14=documentJson.package)===null||_documentJson$package14===void 0?void 0:(_documentJson$package15=_documentJson$package14.to.division)===null||_documentJson$package15===void 0?void 0:_documentJson$package15.kpp,documentJson===null||documentJson===void 0?void 0:(_documentJson$package16=documentJson.package)===null||_documentJson$package16===void 0?void 0:(_documentJson$package17=_documentJson$package16.to.company)===null||_documentJson$package17===void 0?void 0:_documentJson$package17.ogrn,documentJson===null||documentJson===void 0?void 0:(_documentJson$package18=documentJson.package)===null||_documentJson$package18===void 0?void 0:(_documentJson$package19=_documentJson$package18.to.division)===null||_documentJson$package19===void 0?void 0:_documentJson$package19.head)});/** вид документа */setFlow(documentJson===null||documentJson===void 0?void 0:(_documentJson$package20=documentJson.package)===null||_documentJson$package20===void 0?void 0:(_documentJson$package21=_documentJson$package20.flow)===null||_documentJson$package21===void 0?void 0:_documentJson$package21.title);/** тип документа */setType({value:documentJson===null||documentJson===void 0?void 0:(_documentJson$type=documentJson.type)===null||_documentJson$type===void 0?void 0:_documentJson$type.id,label:documentJson===null||documentJson===void 0?void 0:(_documentJson$type2=documentJson.type)===null||_documentJson$type2===void 0?void 0:_documentJson$type2.title});/** редактор текста */setConvertedText(documentJson===null||documentJson===void 0?void 0:(_documentJson$formDat=documentJson.formData)===null||_documentJson$formDat===void 0?void 0:(_documentJson$formDat2=_documentJson$formDat.wysiwyg)===null||_documentJson$formDat2===void 0?void 0:_documentJson$formDat2.text);},[documentJson]);/** номер */var _useState=useState(),_useState2=_slicedToArray(_useState,2),number=_useState2[0],setNumber=_useState2[1];/** дата */var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),date=_useState4[0],setDate=_useState4[1];/** заголовок */var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),title=_useState6[0],setTitle=_useState6[1];/** подразделение отправителя */var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),fromDivision=_useState8[0],setFromDivision=_useState8[1];/** получатель */var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),toDivision=_useState10[0],setToDivision=_useState10[1];/** вид документа */var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),flow=_useState12[0],setFlow=_useState12[1];/** тип документа */var _useState13=useState(),_useState14=_slicedToArray(_useState13,2),type=_useState14[0],setType=_useState14[1];/** новый тип документа */var _useState15=useState(),_useState16=_slicedToArray(_useState15,2),newType=_useState16[0],setNewType=_useState16[1];var _useState17=useState(''),_useState18=_slicedToArray(_useState17,2),convertedText=_useState18[0],setConvertedText=_useState18[1];var fromDivisionOptions=divisionEmployeeRows===null||divisionEmployeeRows===void 0?void 0:divisionEmployeeRows.map(function(item){return{value:item.id,label:item.title};});/** дополнительные параметры к названию компании */function getExtendedTitle(title,inn,kpp,ogrn,head){var prepareTitle=title&&title;var prepareInn=inn&&\"\\u0418\\u041D\\u041D: \".concat(inn);var prepareKpp=kpp&&\"\\u041A\\u041F\\u041F: \".concat(kpp);var prepareOgrn=ogrn&&\"\\u041E\\u0413\\u0420\\u041D: \".concat(ogrn);var prepareHead=head?'(Основной офис)':undefined;return[prepareTitle,prepareInn,prepareKpp,prepareOgrn,prepareHead].filter(function(hasValue){return hasValue;}).join(', ');}function typeDataToOptions(data){return data.map(function(item){return{value:item.id,label:item.title};});}/** загрузка подходящих типов документа */var documentTypeLoad=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(title,callback){var res,_res$rows,rows,hasResult;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return documentFromFileGateway.getDocumentType({title:title});case 2:res=_context.sent;_res$rows=res.rows,rows=_res$rows===void 0?[]:_res$rows;hasResult=rows.length>0;/** если пустой результат - выводим введенное значение */callback(typeDataToOptions(hasResult?rows:[{title:title,id:undefined}]));case 6:case\"end\":return _context.stop();}}},_callee);}));return function documentTypeLoad(_x,_x2){return _ref2.apply(this,arguments);};}();/** изменение типа документа */var onChangeDocumentType=function onChangeDocumentType(e){if(e.value){setType(e);setNewType(undefined);}else{setType(e);setNewType(e.label);}};var rows=[{title:'Неформализованный документ',value:/*#__PURE__*/React.createElement(\"div\",{style:{display:'flex',justifyContent:'space-between'}},/*#__PURE__*/React.createElement(Input,{label:\"\\u041D\\u043E\\u043C\\u0435\\u0440\",placeholder:\"\\u041D\\u043E\\u043C\\u0435\\u0440\",required:true,value:number,onChange:function onChange(e){return setNumber(e.target.value);},width:190,error:errors===null||errors===void 0?void 0:errors.number,errors:errors===null||errors===void 0?void 0:errors.number}),/*#__PURE__*/React.createElement(\"div\",{style:{width:160}},date&&/*#__PURE__*/React.createElement(DatePicker,{label:\"\\u0414\\u0430\\u0442\\u0430\",placeholder:\"\\u0414\\u0430\\u0442\\u0430\",required:true,onChange:function onChange(e){return setDate(e);},value:date,error:errors===null||errors===void 0?void 0:errors.date}))),required:true},{title:'Заголовок',value:/*#__PURE__*/React.createElement(Input,{placeholder:\"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u0437\\u0430\\u0433\\u043E\\u043B\\u043E\\u0432\\u043E\\u043A\",value:title,onChange:function onChange(e){return setTitle(e.target.value);},error:errors===null||errors===void 0?void 0:errors.title,errors:errors===null||errors===void 0?void 0:errors.title}),required:true},{title:'Подразделение отправителя',value:/*#__PURE__*/React.createElement(Select,{value:fromDivision,options:fromDivisionOptions,onChange:function onChange(e){return setFromDivision(e);}}),required:true},{title:'Получатель',value:/*#__PURE__*/React.createElement(AutocompleteRecipient,{setItem:setToDivision,item:toDivision,error:errors===null||errors===void 0?void 0:errors.to,errors:errors===null||errors===void 0?void 0:errors.to,placeholder:\"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u043F\\u043E\\u043B\\u0443\\u0447\\u0430\\u0442\\u0435\\u043B\\u044F\",qParams:{isActive:1,type:'division'}}),required:true},{title:'Вид документа',value:flow},{title:'Тип документа',value:/*#__PURE__*/React.createElement(Autocomplete,{value:type,loadOptions:documentTypeLoad,onChange:onChangeDocumentType,placeholder:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0442\\u0438\\u043F\",required:true,error:errors===null||errors===void 0?void 0:errors.type,errors:errors===null||errors===void 0?void 0:errors.type}),required:true,info:'Выберите тип документа из выпадающего списка или оставьте свой '+'вариант, если хотите создать новый тип документа.'}];var onSave=function onSave(){var _toDivision$value,_fromDivision$value,_documentJson$formDat3,_documentJson$formDat4,_documentJson$formDat5;var formData=new FormData();var preparedDate=new Date(date).getTime()/1000;title&&formData.append('title',title);number&&formData.append('number',number);date&&formData.append('date',preparedDate===null||preparedDate===void 0?void 0:preparedDate.toString());toDivision&&formData.append('to[division]',toDivision===null||toDivision===void 0?void 0:(_toDivision$value=toDivision.value)===null||_toDivision$value===void 0?void 0:_toDivision$value.toString());fromDivision&&formData.append('from[division]',fromDivision===null||fromDivision===void 0?void 0:(_fromDivision$value=fromDivision.value)===null||_fromDivision$value===void 0?void 0:_fromDivision$value.toString());formData.append('flow',documentJson===null||documentJson===void 0?void 0:(_documentJson$formDat3=documentJson.formData)===null||_documentJson$formDat3===void 0?void 0:_documentJson$formDat3.flow.toString());if(newType){formData.append('typeTitle',newType);}else{var _value;formData.append('type',type===null||type===void 0?void 0:(_value=type.value)===null||_value===void 0?void 0:_value.toString());}(documentJson===null||documentJson===void 0?void 0:(_documentJson$formDat4=documentJson.formData)===null||_documentJson$formDat4===void 0?void 0:_documentJson$formDat4.wysiwyg)&&formData.append('wysiwyg[text]',convertedText);(documentJson===null||documentJson===void 0?void 0:(_documentJson$formDat5=documentJson.formData)===null||_documentJson$formDat5===void 0?void 0:_documentJson$formDat5.wysiwyg)&&formData.append('wysiwyg[compiled]',convertedText);dispatch(editUnformalized({documentId:documentId,formData:formData}));};return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(CustomTable,{rows:rows}),(documentJson===null||documentJson===void 0?void 0:(_documentJson$formDat6=documentJson.formData)===null||_documentJson$formDat6===void 0?void 0:_documentJson$formDat6.wysiwyg)&&/*#__PURE__*/React.createElement(ReactQuill,{theme:\"snow\",value:convertedText,onChange:setConvertedText,style:{marginTop:'30px'}}),/*#__PURE__*/React.createElement(\"div\",{style:{marginTop:'30px'}},/*#__PURE__*/React.createElement(Button,{kind:ButtonKinds.Orange,icon:/*#__PURE__*/React.createElement(Icons.IconCheck,{fill:\"currentColor\"}),onClick:onSave,style:{marginRight:10}},\"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C\"),/*#__PURE__*/React.createElement(Button,{icon:/*#__PURE__*/React.createElement(Icons.IconClose,{fill:\"currentColor\"}),onClick:onSave},\"\\u0417\\u0430\\u043A\\u0440\\u044B\\u0442\\u044C\")));};","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/create-document/components/unformalized/EditUnformalized.tsx"],"names":["React","useState","useEffect","useDispatch","useSelector","CustomTable","Input","DatePicker","Select","Autocomplete","Button","ButtonKinds","Icons","documentFromFileGateway","getUnformalizedDictonaries","setUnformalizedError","getDocumentJson","editUnformalized","selectDivisionEmployee","selectErrors","selectDocumentJson","ReactQuill","AutocompleteRecipient","EditUnformalized","match","dispatch","documentId","params","id","divisionEmployeeRows","errors","documentJson","setNumber","formData","number","setDate","Date","date","setTitle","title","setFromDivision","value","package","from","division","label","setToDivision","to","getExtendedTitle","company","name","inn","kpp","ogrn","head","setFlow","flow","setType","type","setConvertedText","wysiwyg","text","fromDivision","toDivision","newType","setNewType","convertedText","fromDivisionOptions","map","item","prepareTitle","prepareInn","prepareKpp","prepareOgrn","prepareHead","undefined","filter","hasValue","join","typeDataToOptions","data","documentTypeLoad","callback","getDocumentType","res","rows","hasResult","length","onChangeDocumentType","e","display","justifyContent","target","width","required","isActive","info","onSave","FormData","preparedDate","getTime","append","toString","marginTop","Orange","marginRight"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { CustomTable } from '../../../../common/custom-table';\r\nimport {\r\n  Input,\r\n  DatePicker,\r\n  Select,\r\n  Autocomplete,\r\n  Button,\r\n  ButtonKinds,\r\n  Icons\r\n} from '@distate/components';\r\nimport { documentFromFileGateway } from '@distate/core/dist/application/create-document/DocumentFromFileGateway';\r\nimport {\r\n  getUnformalizedDictonaries,\r\n  setUnformalizedError,\r\n  getDocumentJson,\r\n  editUnformalized\r\n} from '../../store/actions';\r\nimport { selectDivisionEmployee, selectErrors, selectDocumentJson } from '../../store/selectors';\r\nimport ReactQuill from 'react-quill';\r\nimport 'react-quill/dist/quill.snow.css';\r\nimport { AutocompleteRecipient } from '../common/AutocompleteRecipient';\r\n\r\ntype SelectItemType = {\r\n  value: string | number;\r\n  label: string;\r\n};\r\n\r\nexport const EditUnformalized = ({ match }: { match: any }) => {\r\n  const dispatch = useDispatch();\r\n\r\n  const documentId = match?.params?.id;\r\n\r\n  useEffect((): any => {\r\n    documentId && dispatch(getDocumentJson(documentId));\r\n    dispatch(getUnformalizedDictonaries());\r\n    return () => {\r\n      dispatch(setUnformalizedError({}));\r\n    };\r\n  }, [dispatch, documentId]);\r\n\r\n  const divisionEmployeeRows = useSelector(selectDivisionEmployee);\r\n  const errors = useSelector(selectErrors);\r\n  const documentJson = useSelector(selectDocumentJson);\r\n\r\n  useEffect(() => {\r\n    if (!documentJson) return;\r\n\r\n    setNumber(documentJson?.formData.number);\r\n    setDate(new Date(documentJson?.formData.date));\r\n    setTitle(documentJson?.formData.title);\r\n    /** подразделение отправителя */\r\n    setFromDivision({\r\n      value: documentJson?.package?.from?.division?.id,\r\n      label: documentJson?.package?.from?.division?.title\r\n    });\r\n    /** получатель */\r\n    setToDivision({\r\n      value: documentJson?.package?.to?.division?.id,\r\n      label: getExtendedTitle(\r\n        documentJson?.package?.to.company?.name,\r\n        documentJson?.package?.to.company?.inn,\r\n        documentJson?.package?.to.division?.kpp,\r\n        documentJson?.package?.to.company?.ogrn,\r\n        documentJson?.package?.to.division?.head\r\n      )\r\n    });\r\n    /** вид документа */\r\n    setFlow(documentJson?.package?.flow?.title);\r\n    /** тип документа */\r\n    setType({\r\n      value: documentJson?.type?.id,\r\n      label: documentJson?.type?.title\r\n    });\r\n    /** редактор текста */\r\n    setConvertedText(documentJson?.formData?.wysiwyg?.text);\r\n  }, [documentJson]);\r\n\r\n  /** номер */\r\n  const [number, setNumber] = useState<string>();\r\n  /** дата */\r\n  const [date, setDate] = useState<any>();\r\n  /** заголовок */\r\n  const [title, setTitle] = useState<string>();\r\n  /** подразделение отправителя */\r\n  const [fromDivision, setFromDivision] = useState<SelectItemType>();\r\n  /** получатель */\r\n  const [toDivision, setToDivision] = useState<any>();\r\n  /** вид документа */\r\n  const [flow, setFlow] = useState<string>();\r\n  /** тип документа */\r\n  const [type, setType] = useState<SelectItemType>();\r\n  /** новый тип документа */\r\n  const [newType, setNewType] = useState<string>();\r\n\r\n  const [convertedText, setConvertedText] = useState('');\r\n\r\n  const fromDivisionOptions = divisionEmployeeRows?.map(item => ({\r\n    value: item.id,\r\n    label: item.title\r\n  }));\r\n\r\n  /** дополнительные параметры к названию компании */\r\n  function getExtendedTitle(\r\n    title?: string,\r\n    inn?: string,\r\n    kpp?: string,\r\n    ogrn?: string,\r\n    head?: boolean\r\n  ) {\r\n    const prepareTitle = title && title;\r\n    const prepareInn = inn && `ИНН: ${inn}`;\r\n    const prepareKpp = kpp && `КПП: ${kpp}`;\r\n    const prepareOgrn = ogrn && `ОГРН: ${ogrn}`;\r\n    const prepareHead = head ? '(Основной офис)' : undefined;\r\n    return [prepareTitle, prepareInn, prepareKpp, prepareOgrn, prepareHead]\r\n      .filter(hasValue => hasValue)\r\n      .join(', ');\r\n  }\r\n\r\n  function typeDataToOptions(data: any[]) {\r\n    return data.map(item => {\r\n      return {\r\n        value: item.id,\r\n        label: item.title\r\n      };\r\n    });\r\n  }\r\n\r\n  /** загрузка подходящих типов документа */\r\n  const documentTypeLoad = async (title: string, callback: any) => {\r\n    const res = await documentFromFileGateway.getDocumentType({ title });\r\n    const { rows = [] } = res;\r\n\r\n    const hasResult = rows.length > 0;\r\n    /** если пустой результат - выводим введенное значение */\r\n    callback(typeDataToOptions(hasResult ? rows : [{ title, id: undefined }]));\r\n  };\r\n\r\n  /** изменение типа документа */\r\n  const onChangeDocumentType = (e: any) => {\r\n    if (e.value) {\r\n      setType(e);\r\n      setNewType(undefined);\r\n    } else {\r\n      setType(e);\r\n      setNewType(e.label);\r\n    }\r\n  };\r\n\r\n  const rows = [\r\n    {\r\n      title: 'Неформализованный документ',\r\n      value: (\r\n        <div style={{ display: 'flex', justifyContent: 'space-between' }}>\r\n          <Input\r\n            label=\"Номер\"\r\n            placeholder=\"Номер\"\r\n            required\r\n            value={number}\r\n            onChange={e => setNumber(e.target.value)}\r\n            width={190}\r\n            error={errors?.number}\r\n            errors={errors?.number}\r\n          />\r\n          <div style={{ width: 160 }}>\r\n            {date && (\r\n              <DatePicker\r\n                label=\"Дата\"\r\n                placeholder=\"Дата\"\r\n                required\r\n                onChange={e => setDate(e)}\r\n                value={date}\r\n                error={errors?.date}\r\n              />\r\n            )}\r\n          </div>\r\n        </div>\r\n      ),\r\n      required: true\r\n    },\r\n    {\r\n      title: 'Заголовок',\r\n      value: (\r\n        <Input\r\n          placeholder=\"Введите заголовок\"\r\n          value={title}\r\n          onChange={e => setTitle(e.target.value)}\r\n          error={errors?.title}\r\n          errors={errors?.title}\r\n        />\r\n      ),\r\n      required: true\r\n    },\r\n    {\r\n      title: 'Подразделение отправителя',\r\n      value: (\r\n        <Select\r\n          value={fromDivision}\r\n          options={fromDivisionOptions}\r\n          onChange={(e: SelectItemType) => setFromDivision(e)}\r\n        />\r\n      ),\r\n      required: true\r\n    },\r\n    {\r\n      title: 'Получатель',\r\n      value: (\r\n        <AutocompleteRecipient\r\n          setItem={setToDivision}\r\n          item={toDivision}\r\n          error={errors?.to}\r\n          errors={errors?.to}\r\n          placeholder=\"Введите получателя\"\r\n          qParams={{ isActive: 1, type: 'division' }}\r\n        />\r\n      ),\r\n      required: true\r\n    },\r\n    {\r\n      title: 'Вид документа',\r\n      value: flow\r\n    },\r\n    {\r\n      title: 'Тип документа',\r\n      value: (\r\n        <Autocomplete\r\n          value={type}\r\n          loadOptions={documentTypeLoad}\r\n          onChange={onChangeDocumentType}\r\n          placeholder=\"Выберите тип\"\r\n          required\r\n          error={errors?.type}\r\n          errors={errors?.type}\r\n        />\r\n      ),\r\n      required: true,\r\n      info:\r\n        'Выберите тип документа из выпадающего списка или оставьте свой ' +\r\n        'вариант, если хотите создать новый тип документа.'\r\n    }\r\n  ];\r\n\r\n  const onSave = () => {\r\n    const formData = new FormData();\r\n    const preparedDate = new Date(date!).getTime() / 1000;\r\n\r\n    title && formData.append('title', title);\r\n    number && formData.append('number', number);\r\n    date && formData.append('date', preparedDate?.toString());\r\n    toDivision && formData.append('to[division]', toDivision?.value?.toString());\r\n    fromDivision && formData.append('from[division]', fromDivision?.value?.toString());\r\n\r\n    formData.append('flow', documentJson?.formData?.flow.toString());\r\n\r\n    if (newType) {\r\n      formData.append('typeTitle', newType);\r\n    } else {\r\n      formData.append('type', type!?.value?.toString());\r\n    }\r\n\r\n    documentJson?.formData?.wysiwyg && formData.append('wysiwyg[text]', convertedText);\r\n    documentJson?.formData?.wysiwyg && formData.append('wysiwyg[compiled]', convertedText);\r\n\r\n    dispatch(editUnformalized({ documentId, formData }));\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <CustomTable rows={rows} />\r\n\r\n      {documentJson?.formData?.wysiwyg && (\r\n        <ReactQuill\r\n          theme=\"snow\"\r\n          value={convertedText}\r\n          onChange={setConvertedText}\r\n          style={{ marginTop: '30px' }}\r\n        />\r\n      )}\r\n\r\n      <div style={{ marginTop: '30px' }}>\r\n        <Button\r\n          kind={ButtonKinds.Orange}\r\n          icon={<Icons.IconCheck fill=\"currentColor\" />}\r\n          onClick={onSave}\r\n          style={{ marginRight: 10 }}\r\n        >\r\n          Сохранить\r\n        </Button>\r\n        <Button icon={<Icons.IconClose fill=\"currentColor\" />} onClick={onSave}>\r\n          Закрыть\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}