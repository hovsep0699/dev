{"ast":null,"code":"import React,{useEffect}from'react';import{useSelector,useDispatch}from'react-redux';import{Modal}from'@distate/components';import{root as financeSelector,selectedTariffSelector}from'../../store/selectors';import{getTariffCard}from'../../store/actions';import{dayDeclension,monthDeclension,yearDeclension}from'../../../../helpers/declension';/** Карточка тарифа */export var TariffCard=function TariffCard(props){var _tariff$pricing,_tariff$tariff,_tariff$tariff$type,_tariff$pricing2,_tariff$pricing3,_tariff$pricing4,_tariff$pricing4$peri,_tariff$pricing5,_tariff$pricing5$peri,_tariff$pricing6,_tariff$pricing6$peri,_tariffFlow$rows;var hide=props.hide,isVisible=props.isVisible,tariffId=props.tariffId,title=props.title;var _useSelector=useSelector(financeSelector),_useSelector$balance=_useSelector.balance,balance=_useSelector$balance===void 0?NaN:_useSelector$balance,currentTariff=_useSelector.currentTariff,tariffFlow=_useSelector.tariffFlow;var tariff=useSelector(selectedTariffSelector);var isPromotion=tariff===null||tariff===void 0?void 0:(_tariff$pricing=tariff.pricing)===null||_tariff$pricing===void 0?void 0:_tariff$pricing.isPromotion;/** признак предоплатного тарифа */var isPrepaid=(tariff===null||tariff===void 0?void 0:(_tariff$tariff=tariff.tariff)===null||_tariff$tariff===void 0?void 0:(_tariff$tariff$type=_tariff$tariff.type)===null||_tariff$tariff$type===void 0?void 0:_tariff$tariff$type.systemName)==='prepaid';/** стоимость перехода */var connectionCost=tariff===null||tariff===void 0?void 0:(_tariff$pricing2=tariff.pricing)===null||_tariff$pricing2===void 0?void 0:_tariff$pricing2.connectionCost;/** абонентская плата */var periodicalCost=tariff===null||tariff===void 0?void 0:(_tariff$pricing3=tariff.pricing)===null||_tariff$pricing3===void 0?void 0:_tariff$pricing3.periodicalCost;var periodDay=tariff===null||tariff===void 0?void 0:(_tariff$pricing4=tariff.pricing)===null||_tariff$pricing4===void 0?void 0:(_tariff$pricing4$peri=_tariff$pricing4.period)===null||_tariff$pricing4$peri===void 0?void 0:_tariff$pricing4$peri.day;var periodMonth=tariff===null||tariff===void 0?void 0:(_tariff$pricing5=tariff.pricing)===null||_tariff$pricing5===void 0?void 0:(_tariff$pricing5$peri=_tariff$pricing5.period)===null||_tariff$pricing5$peri===void 0?void 0:_tariff$pricing5$peri.month;var periodYear=tariff===null||tariff===void 0?void 0:(_tariff$pricing6=tariff.pricing)===null||_tariff$pricing6===void 0?void 0:(_tariff$pricing6$peri=_tariff$pricing6.period)===null||_tariff$pricing6$peri===void 0?void 0:_tariff$pricing6$peri.year;var day=periodDay&&dayDeclension(Number(periodDay));var month=periodMonth&&monthDeclension(Number(periodMonth));var year=periodYear&&yearDeclension(Number(periodYear));var period=[year,month,day].filter(function(item){return item;}).join(' ');var dispatch=useDispatch();useEffect(function(){dispatch(getTariffCard(tariffId));},[dispatch,tariffId]);var getPrice=function getPrice(cost){if(cost>0){/** если предоплата - берется баланс тарифа, нет - баланс компании */var number=isPrepaid?Math.trunc(periodicalCost/cost):Math.trunc(balance/cost);return/*#__PURE__*/React.createElement(\"b\",null,' ',\"- \",number,\"\\u0448\\u0442.\",!isPromotion&&\" (\".concat((cost/100).toFixed(2),\" \\u0440.)\"));}return/*#__PURE__*/React.createElement(\"b\",null,\" - \\u043D\\u0435 \\u0442\\u0430\\u0440\\u0438\\u0444\\u0438\\u0446\\u0438\\u0440\\u0443\\u0435\\u0442\\u0441\\u044F\");};return/*#__PURE__*/React.createElement(Modal,{hide:hide,isVisible:isVisible,zIndex:9998,width:\"max-content\"},/*#__PURE__*/React.createElement(Modal.Header,{title:\"\\u041A\\u0430\\u0440\\u0442\\u043E\\u0447\\u043A\\u0430 \\u0442\\u0430\\u0440\\u0438\\u0444\\u0430\"}),/*#__PURE__*/React.createElement(Modal.Body,null,/*#__PURE__*/React.createElement(\"h3\",null,title||(currentTariff===null||currentTariff===void 0?void 0:currentTariff.tariff_title)),/*#__PURE__*/React.createElement(\"div\",{className:\"tariff-price-balance\"},/*#__PURE__*/React.createElement(\"div\",{className:\"tariff-price-balance-title\"},Boolean(connectionCost)&&/*#__PURE__*/React.createElement(\"div\",null,\"\\u0421\\u0442\\u043E\\u0438\\u043C\\u043E\\u0441\\u0442\\u044C \\u043F\\u0435\\u0440\\u0435\\u0445\\u043E\\u0434\\u0430\"),isPrepaid&&/*#__PURE__*/React.createElement(\"div\",null,\"\\u0410\\u0431\\u043E\\u043D\\u0435\\u043D\\u0442\\u0441\\u043A\\u0430\\u044F \\u043F\\u043B\\u0430\\u0442\\u0430\")),/*#__PURE__*/React.createElement(\"div\",null,Boolean(connectionCost)&&/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"b\",null,(connectionCost/100).toFixed(2)),\" \",isPromotion?'док.':'р.'),isPrepaid&&/*#__PURE__*/React.createElement(\"div\",null,(periodicalCost/100).toFixed(2),\" \",isPromotion?'док.':'р.',\" / \",period))),isPrepaid&&/*#__PURE__*/React.createElement(\"div\",{className:\"tariff-price-description\"},\"\\u0421\\u043F\\u0438\\u0441\\u0430\\u043D\\u0438\\u0435 \\u043F\\u0440\\u043E\\u0438\\u0437\\u0432\\u043E\\u0434\\u0438\\u0442\\u0441\\u044F \\u0432 \\u043D\\u0430\\u0447\\u0430\\u043B\\u0435 \\u043F\\u0435\\u0440\\u0438\\u043E\\u0434\\u0430. \\u041E\\u043F\\u043B\\u0430\\u0442\\u0430 \\u0434\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u043E\\u0432 \\u043F\\u0440\\u043E\\u0438\\u0437\\u0432\\u043E\\u0434\\u0438\\u0442\\u0441\\u044F \\u0438\\u0437 \\u0432\\u043D\\u0435\\u0441\\u0435\\u043D\\u043D\\u044B\\u0445 \\u0441\\u0440\\u0435\\u0434\\u0441\\u0442\\u0432. \\u0412\\u0441\\u0435 \\u043D\\u0435\\u0438\\u0437\\u0440\\u0430\\u0441\\u0445\\u043E\\u0434\\u043E\\u0432\\u0430\\u043D\\u043D\\u044B\\u0435 \\u0441\\u0440\\u0435\\u0434\\u0441\\u0442\\u0432\\u0430 \\u0432 \\u043A\\u043E\\u043D\\u0446\\u0435 \\u043F\\u0435\\u0440\\u0438\\u043E\\u0434\\u0430 \\u0441\\u0433\\u043E\\u0440\\u0430\\u044E\\u0442. \\u0417\\u0430 \\u0432\\u043D\\u0435\\u0441\\u0435\\u043D\\u043D\\u044B\\u0435 \\u0441\\u0440\\u0435\\u0434\\u0441\\u0442\\u0432\\u0430 \\u0432\\u044B \\u0441\\u043C\\u043E\\u0436\\u0435\\u0442\\u0435 \\u043E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C:\"),/*#__PURE__*/React.createElement(\"ul\",{className:\"tariff-description-ul\"},tariffFlow===null||tariffFlow===void 0?void 0:(_tariffFlow$rows=tariffFlow.rows)===null||_tariffFlow$rows===void 0?void 0:_tariffFlow$rows.map(function(item){var id=item.id,title=item.title,cost=item.cost;return/*#__PURE__*/React.createElement(\"li\",{key:id},title,getPrice(cost));})),/*#__PURE__*/React.createElement(\"div\",null,\"\\u0415\\u0441\\u043B\\u0438 \\u0441\\u0447\\u0435\\u0442 \\u0441\\u0442\\u0430\\u043D\\u043E\\u0432\\u0438\\u0442\\u0441\\u044F \\u043C\\u0435\\u043D\\u044C\\u0448\\u0435 \\u043F\\u043E\\u0440\\u043E\\u0433\\u0430 \\u043E\\u0442\\u043A\\u043B\\u044E\\u0447\\u0435\\u043D\\u0438\\u044F ( 0.00 \",isPromotion?'док.':'р.',\" ) , \\u0442\\u043E \\u0432\\u044B \\u043D\\u0435 \\u0441\\u043C\\u043E\\u0436\\u0435\\u0442\\u0435 \\u043E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043B\\u044F\\u0442\\u044C \\u0434\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u044B.\")));};","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/finance/components/information/TariffCard.tsx"],"names":["React","useEffect","useSelector","useDispatch","Modal","root","financeSelector","selectedTariffSelector","getTariffCard","dayDeclension","monthDeclension","yearDeclension","TariffCard","props","hide","isVisible","tariffId","title","balance","NaN","currentTariff","tariffFlow","tariff","isPromotion","pricing","isPrepaid","type","systemName","connectionCost","periodicalCost","periodDay","period","day","periodMonth","month","periodYear","year","Number","filter","item","join","dispatch","getPrice","cost","number","Math","trunc","toFixed","tariff_title","Boolean","rows","map","id"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { Modal } from '@distate/components';\r\nimport { TariffFlowItem } from '../../helpers/finance.typings';\r\nimport { root as financeSelector, selectedTariffSelector } from '../../store/selectors';\r\nimport { getTariffCard } from '../../store/actions';\r\nimport { dayDeclension, monthDeclension, yearDeclension } from '../../../../helpers/declension';\r\n\r\ntype Props = {\r\n  hide: () => void;\r\n  isVisible: boolean;\r\n  tariffId: number;\r\n  title?: string;\r\n};\r\n\r\n/** Карточка тарифа */\r\nexport const TariffCard = (props: Props) => {\r\n  const { hide, isVisible, tariffId, title } = props;\r\n\r\n  const { balance = NaN, currentTariff, tariffFlow } = useSelector(financeSelector);\r\n  const tariff = useSelector(selectedTariffSelector);\r\n\r\n  const isPromotion = tariff?.pricing?.isPromotion;\r\n\r\n  /** признак предоплатного тарифа */\r\n  const isPrepaid = tariff?.tariff?.type?.systemName === 'prepaid';\r\n  /** стоимость перехода */\r\n  const connectionCost = tariff?.pricing?.connectionCost;\r\n  /** абонентская плата */\r\n  const periodicalCost = tariff?.pricing?.periodicalCost;\r\n  const periodDay = tariff?.pricing?.period?.day;\r\n  const periodMonth = tariff?.pricing?.period?.month;\r\n  const periodYear = tariff?.pricing?.period?.year;\r\n\r\n  const day = periodDay && dayDeclension(Number(periodDay));\r\n  const month = periodMonth && monthDeclension(Number(periodMonth));\r\n  const year = periodYear && yearDeclension(Number(periodYear));\r\n\r\n  const period = [year, month, day].filter(item => item).join(' ');\r\n\r\n  const dispatch = useDispatch();\r\n\r\n  useEffect(() => {\r\n    dispatch(getTariffCard(tariffId));\r\n  }, [dispatch, tariffId]);\r\n\r\n  const getPrice = (cost: number) => {\r\n    if (cost > 0) {\r\n      /** если предоплата - берется баланс тарифа, нет - баланс компании */\r\n      const number = isPrepaid ? Math.trunc(periodicalCost / cost) : Math.trunc(balance / cost);\r\n      return (\r\n        <b>\r\n          {' '}\r\n          - {number}шт.{!isPromotion && ` (${(cost / 100).toFixed(2)} р.)`}\r\n        </b>\r\n      );\r\n    }\r\n    return <b> - не тарифицируется</b>;\r\n  };\r\n\r\n  return (\r\n    <Modal hide={hide} isVisible={isVisible} zIndex={9998} width=\"max-content\">\r\n      <Modal.Header title=\"Карточка тарифа\" />\r\n\r\n      <Modal.Body>\r\n        <h3>{title || currentTariff?.tariff_title}</h3>\r\n\r\n        <div className=\"tariff-price-balance\">\r\n          <div className=\"tariff-price-balance-title\">\r\n            {Boolean(connectionCost) && <div>Стоимость перехода</div>}\r\n            {isPrepaid && <div>Абонентская плата</div>}\r\n          </div>\r\n          <div>\r\n            {Boolean(connectionCost) && (\r\n              <div>\r\n                <b>{(connectionCost / 100).toFixed(2)}</b> {isPromotion ? 'док.' : 'р.'}\r\n              </div>\r\n            )}\r\n            {isPrepaid && (\r\n              <div>\r\n                {(periodicalCost / 100).toFixed(2)} {isPromotion ? 'док.' : 'р.'} / {period}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n        {isPrepaid && (\r\n          <div className=\"tariff-price-description\">\r\n            Списание производится в начале периода. Оплата документов производится из внесенных\r\n            средств. Все неизрасходованные средства в конце периода сгорают. За внесенные средства\r\n            вы сможете отправить:\r\n          </div>\r\n        )}\r\n\r\n        <ul className=\"tariff-description-ul\">\r\n          {tariffFlow?.rows?.map((item: TariffFlowItem) => {\r\n            const { id, title, cost } = item;\r\n            return (\r\n              <li key={id}>\r\n                {title}\r\n                {getPrice(cost)}\r\n              </li>\r\n            );\r\n          })}\r\n        </ul>\r\n\r\n        <div>\r\n          Если счет становится меньше порога отключения ( 0.00 {isPromotion ? 'док.' : 'р.'} ) , то\r\n          вы не сможете отправлять документы.\r\n        </div>\r\n      </Modal.Body>\r\n    </Modal>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}