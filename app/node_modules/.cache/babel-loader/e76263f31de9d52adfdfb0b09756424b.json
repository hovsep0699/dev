{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(documentFromFileEffect),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(sendFileWorker),_marked3=/*#__PURE__*/_regeneratorRuntime.mark(createDocumentFromFileWorker);import{takeLatest,put}from'redux-saga/effects';import{documentFromFileGateway}from'@distate/core/dist/application/create-document/DocumentFromFileGateway';import{Flash}from'../../../../common/flash/Flash';import{sendFile,setFlowType,createDocumentFromFile}from'../actions';import{history}from'../../../../App';/** Создание документа из файла */export function documentFromFileEffect(){return _regeneratorRuntime.wrap(function documentFromFileEffect$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return takeLatest(sendFile,sendFileWorker);case 2:_context.next=4;return takeLatest(createDocumentFromFile,createDocumentFromFileWorker);case 4:case\"end\":return _context.stop();}}},_marked);}/** отправить файл на сервер */function sendFileWorker(_ref){var payload,formData,response,_response$data,_response;return _regeneratorRuntime.wrap(function sendFileWorker$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:payload=_ref.payload;_context2.prev=1;formData=new FormData();formData.append('file',payload);_context2.next=6;return documentFromFileGateway.loadFile(formData);case 6:response=_context2.sent;_context2.next=9;return put(setFlowType({fileResponse:response===null||response===void 0?void 0:response.data}));case 9:_context2.next=16;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](1);_response=_context2.t0.response;_context2.next=16;return Flash.error((_response===null||_response===void 0?void 0:(_response$data=_response.data)===null||_response$data===void 0?void 0:_response$data.messages[0])||'Возникла ошибка');case 16:case\"end\":return _context2.stop();}}},_marked2,null,[[1,11]]);}/** создать документ из файла */function createDocumentFromFileWorker(_ref3){var payload,id,params,response,_response2$data,_response2;return _regeneratorRuntime.wrap(function createDocumentFromFileWorker$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:payload=_ref3.payload;_context3.prev=1;id=payload.id,params=payload.params;_context3.next=5;return documentFromFileGateway.createDocumentFromFile(id,params);case 5:response=_context3.sent;_context3.next=8;return history.push(\"/document/\".concat(response.data.id));case 8:_context3.next=15;break;case 10:_context3.prev=10;_context3.t0=_context3[\"catch\"](1);_response2=_context3.t0.response;_context3.next=15;return Flash.error((_response2===null||_response2===void 0?void 0:(_response2$data=_response2.data)===null||_response2$data===void 0?void 0:_response2$data.messages[0])||'Возникла ошибка');case 15:case\"end\":return _context3.stop();}}},_marked3,null,[[1,10]]);}","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/create-document/store/sagas/documentFromFile.effect.ts"],"names":["documentFromFileEffect","sendFileWorker","createDocumentFromFileWorker","takeLatest","put","documentFromFileGateway","Flash","sendFile","setFlowType","createDocumentFromFile","history","payload","formData","FormData","append","loadFile","response","fileResponse","data","error","messages","id","params","push"],"mappings":"oNAQiBA,sB,iDAMPC,c,iDA4BAC,4B,EA1CV,OAASC,UAAT,CAAqBC,GAArB,KAAgC,oBAAhC,CACA,OAASC,uBAAT,KAAwC,wEAAxC,CAEA,OAASC,KAAT,KAAsB,gCAAtB,CACA,OAASC,QAAT,CAAmBC,WAAnB,CAAgCC,sBAAhC,KAA8D,YAA9D,CACA,OAASC,OAAT,KAAwB,iBAAxB,CAEA,kCACA,MAAO,SAAUV,CAAAA,sBAAV,kJACL,MAAMG,CAAAA,UAAU,CAACI,QAAD,CAAWN,cAAX,CAAhB,CADK,uBAEL,MAAME,CAAAA,UAAU,CAACM,sBAAD,CAAyBP,4BAAzB,CAAhB,CAFK,sDAKP,+BACA,QAAUD,CAAAA,cAAV,wLAA2BU,OAA3B,MAA2BA,OAA3B,kBAEQC,QAFR,CAEmB,GAAIC,CAAAA,QAAJ,EAFnB,CAGID,QAAQ,CAACE,MAAT,CAAgB,MAAhB,CAAwBH,OAAxB,EAHJ,iBAKqB,MAAMN,CAAAA,uBAAuB,CAACU,QAAxB,CAAiCH,QAAjC,CAAN,CALrB,OAKUI,QALV,iCAMI,MAAMZ,CAAAA,GAAG,CAACI,WAAW,CAAC,CAAES,YAAY,CAAED,QAAF,SAAEA,QAAF,iBAAEA,QAAQ,CAAEE,IAA1B,CAAD,CAAZ,CAAT,CANJ,4FAOaF,SAPb,cAOaA,QAPb,mBAQI,MAAMV,CAAAA,KAAK,CAACa,KAAN,CAAY,CAAAH,SAAQ,OAAR,EAAAA,SAAQ,SAAR,wBAAAA,SAAQ,CAAEE,IAAV,wDAAgBE,QAAhB,CAAyB,CAAzB,IAA+B,iBAA3C,CAAN,CARJ,uEA2BA,gCACA,QAAUlB,CAAAA,4BAAV,0MAAyCS,OAAzC,OAAyCA,OAAzC,kBAEYU,EAFZ,CAE2BV,OAF3B,CAEYU,EAFZ,CAEgBC,MAFhB,CAE2BX,OAF3B,CAEgBW,MAFhB,kBAGqB,MAAMjB,CAAAA,uBAAuB,CAACI,sBAAxB,CAA+CY,EAA/C,CAAmDC,MAAnD,CAAN,CAHrB,OAGUN,QAHV,iCAII,MAAMN,CAAAA,OAAO,CAACa,IAAR,qBAA0BP,QAAQ,CAACE,IAAT,CAAcG,EAAxC,EAAN,CAJJ,4FAKaL,UALb,cAKaA,QALb,mBAMI,MAAMV,CAAAA,KAAK,CAACa,KAAN,CAAY,CAAAH,UAAQ,OAAR,EAAAA,UAAQ,SAAR,yBAAAA,UAAQ,CAAEE,IAAV,0DAAgBE,QAAhB,CAAyB,CAAzB,IAA+B,iBAA3C,CAAN,CANJ","sourcesContent":["import { takeLatest, put } from 'redux-saga/effects';\r\nimport { documentFromFileGateway } from '@distate/core/dist/application/create-document/DocumentFromFileGateway';\r\n\r\nimport { Flash } from '../../../../common/flash/Flash';\r\nimport { sendFile, setFlowType, createDocumentFromFile } from '../actions';\r\nimport { history } from '../../../../App';\r\n\r\n/** Создание документа из файла */\r\nexport function* documentFromFileEffect() {\r\n  yield takeLatest(sendFile, sendFileWorker);\r\n  yield takeLatest(createDocumentFromFile, createDocumentFromFileWorker);\r\n}\r\n\r\n/** отправить файл на сервер */\r\nfunction* sendFileWorker({ payload }: { payload: File }) {\r\n  try {\r\n    let formData = new FormData();\r\n    formData.append('file', payload);\r\n\r\n    const response = yield documentFromFileGateway.loadFile(formData);\r\n    yield put(setFlowType({ fileResponse: response?.data }));\r\n  } catch ({ response }) {\r\n    yield Flash.error(response?.data?.messages[0] || 'Возникла ошибка');\r\n  }\r\n}\r\n\r\ntype CreateDocumentFromFile = {\r\n  id: string;\r\n  params: {\r\n    /** Дата докмуента в формате Д.М.Г */\r\n    date: string;\r\n    /** Наименование */\r\n    title: string;\r\n    /** Номер */\r\n    number: string;\r\n    /** Идентификатор пользовательского типа документа типа */\r\n    customTypeId: string;\r\n    /** Наименвоание пользовательского типа документа типа */\r\n    customTypeTitle: string;\r\n  };\r\n};\r\n/** создать документ из файла */\r\nfunction* createDocumentFromFileWorker({ payload }: { payload: CreateDocumentFromFile }) {\r\n  try {\r\n    const { id, params } = payload;\r\n    const response = yield documentFromFileGateway.createDocumentFromFile(id, params);\r\n    yield history.push(`/document/${response.data.id}`);\r\n  } catch ({ response }) {\r\n    yield Flash.error(response?.data?.messages[0] || 'Возникла ошибка');\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}