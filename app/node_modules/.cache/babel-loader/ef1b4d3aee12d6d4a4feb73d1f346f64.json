{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{useDispatch,useSelector}from'react-redux';import fileDownload from'js-file-download';import{Icons}from'@distate/components';import{dateFormat}from'@distate/components/dist/FormSchema';import Core from'@distate/core/dist/application/Core';import{Pagination,PaginationLimit}from'../../../../common/pagination';import{Conventions}from'./Conventions';import{getCertificates,changeUseCertificate}from'../../store/actions';import{certificatesSelector,certificatesRecordsTotalSelector,localThumbprintsSelector}from'../../store/selectors';import{ConfirmationModal}from'./ConfirmationModal';/** Кабинет - Сертификаты */export var Certificate=function Certificate(){var _useState=useState(0),_useState2=_slicedToArray(_useState,2),offset=_useState2[0],setOffset=_useState2[1];var _useState3=useState(10),_useState4=_slicedToArray(_useState3,2),limit=_useState4[0],setLimit=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isVisible=_useState6[0],setIsVisible=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),currentThumbprint=_useState8[0],setCurrentThumbprint=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),selectedCerificate=_useState10[0],setSelectedCerificate=_useState10[1];var certificates=useSelector(certificatesSelector);var recordsTotal=useSelector(certificatesRecordsTotalSelector);var localThumbprints=useSelector(localThumbprintsSelector);var dispatch=useDispatch();useEffect(function(){setCurrentThumbprint(Core.certificate.thumbprint);},[]);useEffect(function(){dispatch(getCertificates({offset:offset,limit:limit}));},[dispatch,limit,offset]);/** обработка нажатия - скачать сертификат */var onDownloadCertificate=function onDownloadCertificate(data){fileDownload(new Blob([data]),'certificate.cer');};/** сменить используемый сертификат */var onChangUseCertificate=function onChangUseCertificate(id,thumbprint){setSelectedCerificate({id:id,thumbprint:thumbprint});setIsVisible(true);};var onConfirmation=function onConfirmation(){dispatch(changeUseCertificate(selectedCerificate===null||selectedCerificate===void 0?void 0:selectedCerificate.id));setCurrentThumbprint(selectedCerificate===null||selectedCerificate===void 0?void 0:selectedCerificate.thumbprint);setIsVisible(false);};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"table\",{className:\"table\"},/*#__PURE__*/React.createElement(\"thead\",{className:\"common-table-head\"},/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null,\"\\u0424.\\u0418.\\u041E.\"),/*#__PURE__*/React.createElement(\"td\",null,\"\\u0434\\u043E\\u043B\\u0436\\u043D\\u043E\\u0441\\u0442\\u044C\"),/*#__PURE__*/React.createElement(\"td\",null,\"\\u0434\\u0435\\u0439\\u0441\\u0442\\u0432\\u0438\\u0442\\u0435\\u043B\\u0435\\u043D \\u0441\"),/*#__PURE__*/React.createElement(\"td\",null,\"\\u0434\\u0435\\u0439\\u0441\\u0442\\u0432\\u0438\\u0442\\u0435\\u043B\\u0435\\u043D \\u0434\\u043E\"),/*#__PURE__*/React.createElement(\"td\",{colSpan:3},\"\\u043E\\u0442\\u043F\\u0435\\u0447\\u0430\\u0442\\u043E\\u043A\"),/*#__PURE__*/React.createElement(\"td\",{align:\"center\"},\"\\u0438\\u0441\\u043F\\u043E\\u043B\\u044C\\u0437\\u0443\\u0435\\u0442\\u0441\\u044F\"),/*#__PURE__*/React.createElement(\"td\",{align:\"center\"},\"\\u0441\\u043A\\u0430\\u0447\\u0430\\u0442\\u044C\"))),/*#__PURE__*/React.createElement(\"tbody\",null,certificates===null||certificates===void 0?void 0:certificates.map(function(item){var id=item.id,fio=item.fio,position=item.position,dateFrom=item.dateFrom,dateTo=item.dateTo,thumbprint=item.thumbprint,data=item.data;var from=dateFormat(dateFrom,'yyyy-MM-dd');var to=dateFormat(dateTo,'yyyy-MM-dd');var now=new Date();var isTimeNotMatch=now<dateFrom||now>dateTo;var isCurrentCertificate=currentThumbprint===thumbprint;/** если сертификат истек или еще не начал действовать - добавляем цвет фону */var rowColor=isTimeNotMatch?'#efefef':'';/** если отпечатка нет среди локальных сертов, то перекрашиваем строку, иначе оставляем предыдущее значение */rowColor=!(localThumbprints===null||localThumbprints===void 0?void 0:localThumbprints.includes(thumbprint))?'#fbe5e4':rowColor;var isCanSelecting=!isTimeNotMatch&&(localThumbprints===null||localThumbprints===void 0?void 0:localThumbprints.includes(thumbprint))&&!isCurrentCertificate;return/*#__PURE__*/React.createElement(\"tr\",{key:id,style:{background:rowColor}},/*#__PURE__*/React.createElement(\"td\",null,fio),/*#__PURE__*/React.createElement(\"td\",null,position),/*#__PURE__*/React.createElement(\"td\",null,from),/*#__PURE__*/React.createElement(\"td\",null,to),/*#__PURE__*/React.createElement(\"td\",{colSpan:3},thumbprint),/*#__PURE__*/React.createElement(\"td\",{align:\"center\"},isCurrentCertificate&&/*#__PURE__*/React.createElement(Icons.IconCheck,{fill:\"currentColor\"}),isCanSelecting&&/*#__PURE__*/React.createElement(Icons.IconMarkerAlt,{fill:\"currentColor\",onClick:function onClick(){return onChangUseCertificate(id,thumbprint);},style:{cursor:'pointer'}})),/*#__PURE__*/React.createElement(\"td\",{align:\"center\"},/*#__PURE__*/React.createElement(Icons.IconDownload,{fill:\"currentColor\",style:{cursor:'pointer'},onClick:function onClick(){return onDownloadCertificate(data);}})));})),/*#__PURE__*/React.createElement(\"tfoot\",null,/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",{colSpan:4},/*#__PURE__*/React.createElement(PaginationLimit,{setLimit:setLimit,limit:limit})),/*#__PURE__*/React.createElement(\"td\",{colSpan:5,align:\"right\"},/*#__PURE__*/React.createElement(\"div\",{className:\"pagination-right\"},/*#__PURE__*/React.createElement(Pagination,{listLength:recordsTotal,setOffset:setOffset,limit:limit})))))),/*#__PURE__*/React.createElement(Conventions,null),/*#__PURE__*/React.createElement(ConfirmationModal,{hide:function hide(){return setIsVisible(false);},isVisible:isVisible,handleCheck:onConfirmation}));};","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/pages/cabinet/components/certificate/Certificate.tsx"],"names":["React","useState","useEffect","useDispatch","useSelector","fileDownload","Icons","dateFormat","Core","Pagination","PaginationLimit","Conventions","getCertificates","changeUseCertificate","certificatesSelector","certificatesRecordsTotalSelector","localThumbprintsSelector","ConfirmationModal","Certificate","offset","setOffset","limit","setLimit","isVisible","setIsVisible","currentThumbprint","setCurrentThumbprint","selectedCerificate","setSelectedCerificate","certificates","recordsTotal","localThumbprints","dispatch","certificate","thumbprint","onDownloadCertificate","data","Blob","onChangUseCertificate","id","onConfirmation","map","item","fio","position","dateFrom","dateTo","from","to","now","Date","isTimeNotMatch","isCurrentCertificate","rowColor","includes","isCanSelecting","background","cursor"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport fileDownload from 'js-file-download';\r\nimport { Icons } from '@distate/components';\r\nimport { dateFormat } from '@distate/components/dist/FormSchema';\r\nimport Core from '@distate/core/dist/application/Core';\r\nimport { Pagination, PaginationLimit } from '../../../../common/pagination';\r\nimport { Conventions } from './Conventions';\r\nimport { getCertificates, changeUseCertificate } from '../../store/actions';\r\nimport {\r\n  certificatesSelector,\r\n  certificatesRecordsTotalSelector,\r\n  localThumbprintsSelector\r\n} from '../../store/selectors';\r\nimport { ConfirmationModal } from './ConfirmationModal';\r\n\r\n/** Кабинет - Сертификаты */\r\nexport const Certificate = () => {\r\n  const [offset, setOffset] = useState(0);\r\n  const [limit, setLimit] = useState(10);\r\n  const [isVisible, setIsVisible] = useState(false);\r\n  const [currentThumbprint, setCurrentThumbprint] = useState<string>();\r\n  const [selectedCerificate, setSelectedCerificate] = useState<{\r\n    id: number;\r\n    thumbprint: string;\r\n  }>();\r\n\r\n  const certificates = useSelector(certificatesSelector);\r\n  const recordsTotal = useSelector(certificatesRecordsTotalSelector);\r\n  const localThumbprints = useSelector(localThumbprintsSelector);\r\n\r\n  const dispatch = useDispatch();\r\n\r\n  useEffect(() => {\r\n    setCurrentThumbprint(Core.certificate.thumbprint);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    dispatch(getCertificates({ offset, limit }));\r\n  }, [dispatch, limit, offset]);\r\n\r\n  /** обработка нажатия - скачать сертификат */\r\n  const onDownloadCertificate = (data: any) => {\r\n    fileDownload(new Blob([data]), 'certificate.cer');\r\n  };\r\n\r\n  /** сменить используемый сертификат */\r\n  const onChangUseCertificate = (id: number, thumbprint: string) => {\r\n    setSelectedCerificate({\r\n      id,\r\n      thumbprint\r\n    });\r\n    setIsVisible(true);\r\n  };\r\n\r\n  const onConfirmation = () => {\r\n    dispatch(changeUseCertificate(selectedCerificate?.id));\r\n    setCurrentThumbprint(selectedCerificate?.thumbprint);\r\n    setIsVisible(false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <table className=\"table\">\r\n        <thead className=\"common-table-head\">\r\n          <tr>\r\n            <td>Ф.И.О.</td>\r\n            <td>должность</td>\r\n            <td>действителен с</td>\r\n            <td>действителен до</td>\r\n            <td colSpan={3}>отпечаток</td>\r\n            <td align=\"center\">используется</td>\r\n            <td align=\"center\">скачать</td>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {certificates?.map((item: any) => {\r\n            const { id, fio, position, dateFrom, dateTo, thumbprint, data } = item;\r\n            const from = dateFormat(dateFrom, 'yyyy-MM-dd');\r\n            const to = dateFormat(dateTo, 'yyyy-MM-dd');\r\n\r\n            const now = new Date();\r\n            const isTimeNotMatch = now < dateFrom || now > dateTo;\r\n\r\n            const isCurrentCertificate = currentThumbprint === thumbprint;\r\n\r\n            /** если сертификат истек или еще не начал действовать - добавляем цвет фону */\r\n            let rowColor = isTimeNotMatch ? '#efefef' : '';\r\n            /** если отпечатка нет среди локальных сертов, то перекрашиваем строку, иначе оставляем предыдущее значение */\r\n            rowColor = !localThumbprints?.includes(thumbprint) ? '#fbe5e4' : rowColor;\r\n\r\n            const isCanSelecting =\r\n              !isTimeNotMatch && localThumbprints?.includes(thumbprint) && !isCurrentCertificate;\r\n\r\n            return (\r\n              <tr key={id} style={{ background: rowColor }}>\r\n                <td>{fio}</td>\r\n                <td>{position}</td>\r\n                <td>{from}</td>\r\n                <td>{to}</td>\r\n                <td colSpan={3}>{thumbprint}</td>\r\n                <td align=\"center\">\r\n                  {isCurrentCertificate && <Icons.IconCheck fill=\"currentColor\" />}\r\n                  {isCanSelecting && (\r\n                    <Icons.IconMarkerAlt\r\n                      fill=\"currentColor\"\r\n                      onClick={() => onChangUseCertificate(id, thumbprint)}\r\n                      style={{ cursor: 'pointer' }}\r\n                    />\r\n                  )}\r\n                </td>\r\n                <td align=\"center\">\r\n                  {\r\n                    <Icons.IconDownload\r\n                      fill=\"currentColor\"\r\n                      style={{ cursor: 'pointer' }}\r\n                      onClick={() => onDownloadCertificate(data)}\r\n                    />\r\n                  }\r\n                </td>\r\n              </tr>\r\n            );\r\n          })}\r\n        </tbody>\r\n        <tfoot>\r\n          <tr>\r\n            <td colSpan={4}>\r\n              <PaginationLimit setLimit={setLimit} limit={limit} />\r\n            </td>\r\n            <td colSpan={5} align=\"right\">\r\n              <div className=\"pagination-right\">\r\n                <Pagination listLength={recordsTotal} setOffset={setOffset} limit={limit} />\r\n              </div>\r\n            </td>\r\n          </tr>\r\n        </tfoot>\r\n      </table>\r\n\r\n      <Conventions />\r\n      <ConfirmationModal\r\n        hide={() => setIsVisible(false)}\r\n        isVisible={isVisible}\r\n        handleCheck={onConfirmation}\r\n      />\r\n    </>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}