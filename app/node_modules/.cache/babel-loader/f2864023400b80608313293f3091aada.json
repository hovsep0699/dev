{"ast":null,"code":"import _defineProperty from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _assertThisInitialized from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _get from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/get\";import _getPrototypeOf from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";import _createClass from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import _objectSpread from\"C:\\\\Users\\\\Hovsep\\\\Desktop\\\\local\\\\diflow_react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import React from'react';import{Option,Select,Text,Scope}from'informed';import FormBuilder from'../FormBuilder';import{TOP,LEFT}from'../../Placement';import{ICON}from'@distate/components';import Button,{PRIMARY}from'../../Button';import DateInput from'../components/DateInput';import formBuilderStyles from'../FormBuilder.module.css';import documentBuilderStyles from'./DocumentFormBuilder.module.css';import DocumentTable from'../components/DocumentTable';import DocumentGroup from'../components/DocumentGroup';import SaveDocumentModal from'../../../pages/documents/modals/SaveDocumentModal';import Appearance from'../parameters/Appearance';import Behavior from'../parameters/Behavior';import Defaults from'../parameters/Defaults';import get from'get-value';import setObject from'object-path';import{set as setImmutable}from'object-path-immutable';import deepmerge from'deepmerge';import classNames from'classnames';import AutocompleteService from'@distate/core/dist/application/autocomplete/AutocompleteService';import Autocomplete from'../../autocomplete/Autocomplete';import{combineMerge}from'../../../utils/ObjectUtil';import{getExternalTypeToString,joinNoEmptyValues}from'../../../helpers/heplers';var styles=_objectSpread(_objectSpread({},formBuilderStyles),documentBuilderStyles);var DocumentFormBuilder=/*#__PURE__*/function(_FormBuilder){_inherits(DocumentFormBuilder,_FormBuilder);var _super=_createSuper(DocumentFormBuilder);_createClass(DocumentFormBuilder,null,[{key:\"createInputClasses\",value:function createInputClasses(){var formApi=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var field=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';var customClasses=arguments.length>2&&arguments[2]!==undefined?arguments[2]:['ds-input'];if(!formApi)return classNames(customClasses);var getError=formApi.getError,getTouched=formApi.getTouched,getValue=formApi.getValue;var res={};if(field){res.error=getError(field);res.success=!getError(field)&&getTouched(field)&&getValue(field);}return classNames(res,customClasses);}}]);function DocumentFormBuilder(component){var _this;var defaultBehavior=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Behavior();var defaultAppearance=arguments.length>2&&arguments[2]!==undefined?arguments[2]:new Appearance();_classCallCheck(this,DocumentFormBuilder);_this=_super.call(this,component);_this.setDataToFormState=function(path){return function(data){var valuePath=path?\"values.\".concat(path):'values';var objToMerge=get(_this.formState,valuePath);var mergedData=deepmerge(objToMerge,data,{arrayMerge:combineMerge});setObject(_this.formState,valuePath,mergedData);};};_this.setStateSynchronous=function(stateUpdate){return new Promise(function(resolve){_this._component.setState(stateUpdate,function(){return resolve();});});};_this.setDataToComponentState=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(data,valuePath){var merge,objToMerge,newData,_args=arguments;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:merge=_args.length>2&&_args[2]!==undefined?_args[2]:true;objToMerge=_this._component.state;if(merge){newData=deepmerge(objToMerge,data,{arrayMerge:combineMerge});}else{newData=setImmutable(objToMerge,valuePath,get(data,valuePath));}_context.next=5;return _this.setStateSynchronous(newData);case 5:case\"end\":return _context.stop();}}},_callee);}));return function(_x,_x2){return _ref.apply(this,arguments);};}();_this._initialValues={};_this._docGroup=new DocumentGroup(_assertThisInitialized(_this),DocumentFormBuilder,styles);_this._defaults=new Defaults(defaultBehavior,defaultAppearance);_this.handleBehavior=_this._defaults.handleBehavior;_this.handleAppearance=_this._defaults.handleAppearance;return _this;}_createClass(DocumentFormBuilder,[{key:\"getLabel\",value:function getLabel(fieldName,behaviorOrIsRequired,appearanceOrAlign){var behavior=behaviorOrIsRequired;if(typeof behaviorOrIsRequired==='boolean'){behavior=new Behavior({isRequired:behaviorOrIsRequired});}var appearance=appearanceOrAlign;if(typeof appearanceOrAlign==='string'){appearance=new Appearance({align:appearanceOrAlign});}var _this$handleBehavior=this.handleBehavior(behavior),isRequired=_this$handleBehavior.isRequired;var _this$handleAppearanc=this.handleAppearance(appearance),align=_this$handleAppearanc.align,withRequiredView=_this$handleAppearanc.withRequiredView;var labelClasses=classNames({'ds-field-name':true,leftside:align===LEFT,top:align===TOP,required:withRequiredView||isRequired});return/*#__PURE__*/React.createElement(\"label\",{className:labelClasses},fieldName);}},{key:\"getErrorMsg\",value:function getErrorMsg(fieldName){var serverErrorMsg=get(this._component,\"state.errors.\".concat(fieldName));var formStateErrorMsg=get(this._formState,\"errors.\".concat(fieldName));return typeof serverErrorMsg==='string'&&serverErrorMsg||typeof formStateErrorMsg==='string'&&formStateErrorMsg;}},{key:\"getInitialFieldSettings\",value:function getInitialFieldSettings(DomainVO,behavior){var _this$handleBehavior2=this.handleBehavior(behavior),initialFieldDomain=_this$handleBehavior2.initialFieldDomain,isRequired=_this$handleBehavior2.isRequired,scope=_this$handleBehavior2.scope,errorPath=_this$handleBehavior2.errorPath;var fieldName=scope?\"\".concat(scope,\".\").concat(DomainVO.field):DomainVO.field;var fieldErrorPath=errorPath?\"\".concat(errorPath,\".\").concat(fieldName):fieldName;var formattedFieldErrorPath=fieldErrorPath.replace(/\\[/g,'.').replace(/]/g,'');var errorMsg=this.getErrorMsg(formattedFieldErrorPath);if(isRequired){this._requiredFields.push(fieldName);}return{fieldName:fieldName,errorMsg:errorMsg,initialValue:initialFieldDomain.value};}},{key:\"buildInfo\",value:function buildInfo(DomainVO,behavior,appearance,isHidden){var _this2=this;var _this$handleBehavior3=this.handleBehavior(behavior),initialFieldDomain=_this$handleBehavior3.initialFieldDomain,isRequired=_this$handleBehavior3.isRequired;var _this$handleAppearanc2=this.handleAppearance(appearance),width=_this$handleAppearanc2.width;var _this$getInitialField=this.getInitialFieldSettings(DomainVO,behavior),errorMsg=_this$getInitialField.errorMsg;this._content.push(function(){return/*#__PURE__*/React.createElement(\"li\",{style:{display:isHidden?'none':'block'}},_this2.getLabel(DomainVO.name,isRequired),/*#__PURE__*/React.createElement(\"div\",{className:\"group\",style:{width:width}},/*#__PURE__*/React.createElement(Text,{className:'ds-field-name leftside',field:DomainVO.field,title:DomainVO.hint,initialValue:initialFieldDomain.value,style:{width:width,border:'none'},placeholder:DomainVO.placeholder,mask:DomainVO.mask,readOnly:true}),/*#__PURE__*/React.createElement(\"span\",{className:\"ds-field-name bottom error\"},errorMsg)));});}},{key:\"buildInput\",value:function buildInput(DomainVO,behavior,appearance){var _this3=this;var _this$handleBehavior4=this.handleBehavior(behavior),isRequired=_this$handleBehavior4.isRequired,scope=_this$handleBehavior4.scope;var _this$handleAppearanc3=this.handleAppearance(appearance),width=_this$handleAppearanc3.width,customClasses=_this$handleAppearanc3.customClasses,align=_this$handleAppearanc3.align,withRequiredView=_this$handleAppearanc3.withRequiredView;var _this$getInitialField2=this.getInitialFieldSettings(DomainVO,behavior),fieldName=_this$getInitialField2.fieldName,errorMsg=_this$getInitialField2.errorMsg,initialValue=_this$getInitialField2.initialValue;var validateOnChange=!DomainVO.maskOnBlur;var validateOnBlur=!DomainVO.maskOnBlur;var onBlur=function onBlur(e){if(!DomainVO.maskOnBlur)return;var value=e.target.value;var maskedValue=DomainVO.maskOnBlur(value);_this3._formApi.setValue(fieldName,maskedValue);_this3._formApi.validateField(fieldName);};var handleEnterKeyDown=function handleEnterKeyDown(e){if(e.key==='Enter'){onBlur(e);}};var createInput=function createInput(){var errorClass=errorMsg?'error':'';var inputClasses=DocumentFormBuilder.createInputClasses(_this3._formApi,fieldName,\"ds-input \".concat(customClasses,\" \").concat(errorClass));var inputField=/*#__PURE__*/React.createElement(\"div\",{className:\"group\",style:{width:width}},/*#__PURE__*/React.createElement(Text,{field:DomainVO.field,title:DomainVO.hint,initialValue:initialValue,className:inputClasses,style:{width:width},placeholder:DomainVO.placeholder,mask:DomainVO.mask,validate:DomainVO.validate,validateOnChange:validateOnChange,validateOnBlur:validateOnBlur,onBlur:onBlur,onKeyDown:handleEnterKeyDown}),/*#__PURE__*/React.createElement(\"span\",{className:\"ds-field-name bottom error\"},errorMsg));var scopedInputField=scope?/*#__PURE__*/React.createElement(Scope,{scope:scope},inputField):inputField;return/*#__PURE__*/React.createElement(\"div\",{className:\"group\",key:\"\".concat(scope,\".\").concat(DomainVO.field)},_this3.getLabel(DomainVO.name,new Behavior({isRequired:isRequired}),new Appearance({align:align,withRequiredView:withRequiredView})),scopedInputField);};this._content.push(function(){return/*#__PURE__*/React.createElement(\"li\",{className:customClasses},createInput());});return createInput();}},{key:\"buildDateInput\",value:function buildDateInput(DomainVO,behavior,appearance){var _this4=this;var _this$handleBehavior5=this.handleBehavior(behavior),isRequired=_this$handleBehavior5.isRequired,scope=_this$handleBehavior5.scope;var _this$handleAppearanc4=this.handleAppearance(appearance),width=_this$handleAppearanc4.width,align=_this$handleAppearanc4.align,customClasses=_this$handleAppearanc4.customClasses;var _this$getInitialField3=this.getInitialFieldSettings(DomainVO,behavior),fieldName=_this$getInitialField3.fieldName,errorMsg=_this$getInitialField3.errorMsg,initialValue=_this$getInitialField3.initialValue;var errorClass=errorMsg?'error':'';var dateInputClasses=DocumentFormBuilder.createInputClasses(this._formApi,fieldName,\"ds-input date \".concat(customClasses,\" \").concat(errorClass));var dateInputField=/*#__PURE__*/React.createElement(\"div\",{className:\"group\",style:{width:width}},/*#__PURE__*/React.createElement(DateInput,{field:DomainVO.field,title:DomainVO.hint,initialValue:initialValue,className:dateInputClasses,placeholder:DomainVO.placeholder,mask:DomainVO.mask,validate:DomainVO.validate,validateOnChange:true,validateOnBlur:true}),/*#__PURE__*/React.createElement(\"span\",{className:\"ds-field-name bottom error\"},errorMsg));var scopedInputField=scope?/*#__PURE__*/React.createElement(Scope,{scope:scope},dateInputField):dateInputField;var createDateInput=function createDateInput(){return/*#__PURE__*/React.createElement(\"div\",{className:\"group\",key:\"\".concat(scope,\".\").concat(DomainVO.field)},_this4.getLabel(DomainVO.name,new Behavior({isRequired:isRequired}),new Appearance({align:align})),scopedInputField);};this._content.push(function(){return/*#__PURE__*/React.createElement(\"li\",null,createDateInput());});return createDateInput();}},{key:\"buildAutocomplete\",value:function buildAutocomplete(DomainVO,behavior,appearance,captionField,filterRes){var _this5=this;var _this$handleBehavior6=this.handleBehavior(behavior),title=_this$handleBehavior6.title,initialFieldDomain=_this$handleBehavior6.initialFieldDomain,_this$handleBehavior7=_this$handleBehavior6.isRequired,isRequired=_this$handleBehavior7===void 0?false:_this$handleBehavior7,_this$handleBehavior8=_this$handleBehavior6.onChange,onChange=_this$handleBehavior8===void 0?function(){}:_this$handleBehavior8,_this$handleBehavior9=_this$handleBehavior6.scope,scope=_this$handleBehavior9===void 0?'':_this$handleBehavior9;var _this$handleAppearanc5=this.handleAppearance(appearance),width=_this$handleAppearanc5.width,align=_this$handleAppearanc5.align,customClasses=_this$handleAppearanc5.customClasses;var scopedField=scope?\"\".concat(scope,\".\").concat(DomainVO.field):DomainVO.field;if(isRequired){this._requiredFields.push(DomainVO.field);}var acService=AutocompleteService[DomainVO.field];var handleItemSelect=function handleItemSelect(ajaxResponseValues){return function(selectedValue){if(!ajaxResponseValues){return;}_this5._formApi.setValue(scopedField,selectedValue);var selectedItem;if(DomainVO.name==='Покупатель'){selectedItem=ajaxResponseValues.rows.find(function(item){return getCustomerString(item)===selectedValue;});}else{selectedItem=ajaxResponseValues.rows.find(function(item){return item.title===selectedValue;});}if(behavior.ajax.request){behavior.ajax.request(selectedItem[behavior.ajax.field]).then(function(res){_this5._component.setState(_defineProperty({},scopedField,res));onChange(res);}).catch(function(error){console.log(error);});}else{_this5._component.setState(_defineProperty({},scopedField,selectedItem));onChange(selectedItem);}};};var handleAutocompleteValidate=function handleAutocompleteValidate(field){return function(res){return function(inputValue){if(res===null){return undefined;}if(!inputValue){_this5._component.setState(_defineProperty({},field,''));return!isRequired?undefined:'Введите значение';}var filteredRes=res.filter(function(item){return item.toLowerCase().includes(inputValue.toLowerCase());});if(filteredRes.length===1){_this5._component.setState(_defineProperty({},field,inputValue));return undefined;}if((filteredRes===null||filteredRes===void 0?void 0:filteredRes.length)>1||(filterRes===null||filterRes===void 0?void 0:filterRes.length)===0){_this5._component.setState(_defineProperty({},field,inputValue));if(filteredRes.some(function(item){return item===inputValue;})){return undefined;}else{return'Выберите значение из выпадающего списка';}}return undefined;};};};var autocompleteState=this._component.state[scopedField];var caption=captionField&&autocompleteState&&autocompleteState[captionField]&&/*#__PURE__*/React.createElement(\"p\",{className:\"caption \".concat(styles.caption)},autocompleteState[captionField]);// function for making customer string value\nfunction getCustomerString(item){var companyName=item===null||item===void 0?void 0:item.companyName;var inn=(item===null||item===void 0?void 0:item.companyInn)&&\"\\u0418\\u041D\\u041D: \".concat(item.companyInn);var kpp=(item===null||item===void 0?void 0:item.companyKpp)&&\"\\u041A\\u041F\\u041F: \".concat(item.companyKpp);var ogrn=(item===null||item===void 0?void 0:item.companyOgrn)&&\"\\u041E\\u0413\\u0420\\u041D: \".concat(item.companyOgrn);var typeToString=getExternalTypeToString(item===null||item===void 0?void 0:item.companyExternalType,item===null||item===void 0?void 0:item.companyExternalOperator,item===null||item===void 0?void 0:item.companyNetwork);var companyProps=joinNoEmptyValues([companyName,inn,kpp,ogrn],', ');return companyProps+typeToString;}var formatAjaxRes=function formatAjaxRes(res){var filteredValues=filterRes&&filterRes(res.rows)||res.rows;if(DomainVO.name==='Покупатель'){return filteredValues.map(function(row){return getCustomerString(row);});}return filteredValues.map(function(row){return row.title;});};var autocomplete=function autocomplete(){var errorMsg=_this5.getErrorMsg(scopedField);var errorClass=errorMsg?'error':'';var inputClasses=DocumentFormBuilder.createInputClasses(_this5._formApi,scopedField,\"ds-input \".concat(customClasses,\" \").concat(errorClass));return/*#__PURE__*/React.createElement(\"li\",{className:customClasses},title!==null&&_this5.getLabel(title||DomainVO.name,isRequired,align),/*#__PURE__*/React.createElement(\"div\",{className:\"group\"},/*#__PURE__*/React.createElement(Autocomplete,{doAjax:acService.request,formatAjaxRes:formatAjaxRes,handleItemSelect:handleItemSelect,handleAutocompleteValidate:handleAutocompleteValidate(scopedField)},/*#__PURE__*/React.createElement(Text,{field:DomainVO.field,title:DomainVO.hint,initialValue:initialFieldDomain&&initialFieldDomain.value,className:inputClasses,style:{width:width},placeholder:DomainVO.placeholder,mask:DomainVO.mask,validateOnChange:true,validateOnBlur:true,onFocus:onChange})),/*#__PURE__*/React.createElement(\"span\",{className:\"ds-field-name bottom error\"},errorMsg),!errorMsg&&caption));};this._content.push(autocomplete);return autocomplete();}},{key:\"buildSelect\",value:function buildSelect(DomainVO,behavior,appearance){var _this6=this;var _this$handleBehavior10=this.handleBehavior(behavior),isRequired=_this$handleBehavior10.isRequired,initialFieldDomain=_this$handleBehavior10.initialFieldDomain,_onChange=_this$handleBehavior10.onChange,scope=_this$handleBehavior10.scope;var _this$handleAppearanc6=this.handleAppearance(appearance),width=_this$handleAppearanc6.width,align=_this$handleAppearanc6.align,isInDiv=_this$handleAppearanc6.isInDiv;var _this$getInitialField4=this.getInitialFieldSettings(DomainVO,behavior),fieldName=_this$getInitialField4.fieldName,errorMsg=_this$getInitialField4.errorMsg;var options=DomainVO.options.map(function(_ref2,index){var value=_ref2.value,title=_ref2.title;return/*#__PURE__*/React.createElement(Option,{value:value,key:\"\".concat(DomainVO.field).concat(index)},title);});var placeholderOption=DomainVO.placeholder&&/*#__PURE__*/React.createElement(Option,{value:\"\",disabled:true,key:\"\".concat(DomainVO.field,\".placeholder\")},DomainVO.placeholder);var initialValue=initialFieldDomain&&initialFieldDomain.value!==''?initialFieldDomain.value:DomainVO.options[0].value;var wrapper=function wrapper(isInDiv,select){return function(){if(isInDiv)return/*#__PURE__*/React.createElement(\"div\",{className:\"group\"},select());return/*#__PURE__*/React.createElement(\"li\",{key:\"\".concat(scope,\".\").concat(DomainVO.field)},select());};};var select=function select(){var errorClass=errorMsg?'error':'';var selectClasses=DocumentFormBuilder.createInputClasses(_this6._formApi,fieldName,\"ds-select \".concat(styles.width100,\" \").concat(errorClass));var selectField=/*#__PURE__*/React.createElement(\"div\",{className:\"group\",style:{width:width}},/*#__PURE__*/React.createElement(Select,{field:DomainVO.field,title:DomainVO.hint,initialValue:initialValue,style:{width:width},className:selectClasses,mask:DomainVO.mask,validate:DomainVO.validate,validateOnChange:true,validateOnBlur:true,onChange:function onChange(){_onChange(_this6._formApi.getValue(fieldName));}},placeholderOption,options),/*#__PURE__*/React.createElement(\"span\",{className:\"ds-field-name bottom error\"},errorMsg));var scopedSelectField=scope?/*#__PURE__*/React.createElement(Scope,{scope:scope},selectField):selectField;return/*#__PURE__*/React.createElement(React.Fragment,null,_this6.getLabel(DomainVO.name,new Behavior({isRequired:isRequired}),new Appearance({align:align})),scopedSelectField);};this._content.push(wrapper(isInDiv,select));return wrapper(isInDiv,select)();}},{key:\"buildGroup\",value:function buildGroup(GroupDomainVO,createElementsMap,behavior,appearance,behaviors,appearances){this._docGroup.buildGroup(GroupDomainVO,createElementsMap,behavior,appearance,behaviors,appearances);}},{key:\"buildArrayGroup\",value:function buildArrayGroup(GroupDomainVO,createElementsMap,behavior,appearance,behaviors,appearances){this._docGroup.buildArrayGroup(GroupDomainVO,createElementsMap,behavior,appearance,behaviors,appearances);}},{key:\"buildArrayGroupInput\",value:function buildArrayGroupInput(GroupDomainVO,DomainVO,groupIndex,behavior,appearance){return this._docGroup.buildArrayGroupInput(GroupDomainVO,DomainVO,groupIndex,behavior,appearance);}},{key:\"buildArrayGroupDateInput\",value:function buildArrayGroupDateInput(GroupDomainVO,DomainVO,groupIndex,behavior,appearance){return this._docGroup.buildArrayGroupDateInput(GroupDomainVO,DomainVO,groupIndex,behavior,appearance);}},{key:\"buildArrayGroupAutocomplete\",value:function buildArrayGroupAutocomplete(GroupDomainVO,DomainVO,groupIndex,behavior,appearance){return this._docGroup.buildArrayGroupAutocomplete(GroupDomainVO,DomainVO,groupIndex,behavior,appearance);}},{key:\"buildArrayGroupSelect\",value:function buildArrayGroupSelect(GroupDomainVO,DomainVO,groupIndex,behavior,appearance){return this._docGroup.buildArrayGroupSelect(GroupDomainVO,DomainVO,groupIndex,behavior,appearance);}},{key:\"buildArrayGroupModal\",value:function buildArrayGroupModal(GroupDomainVO,DomainVO,groupIndex,behavior,appearance){return this._docGroup.buildArrayGroupModal(GroupDomainVO,DomainVO,groupIndex,behavior,appearance);}},{key:\"buildArrayGroupComponent\",value:function buildArrayGroupComponent(component){var _this7=this;return function(GroupDomainVO,DomainVO,groupIndex,behavior,appearance){return _this7._docGroup.buildArrayGroupComponent(component)(GroupDomainVO,DomainVO,groupIndex,behavior,appearance);};}},{key:\"buildTable\",value:function buildTable(GroupDomainVO,createElementsMap,footerConfig,behaviors,appearances,behavior){var _behavior$initialFiel,_this8=this;var groupErrors=get(this._component.state.errors,GroupDomainVO.field);var table=new DocumentTable(GroupDomainVO,styles,behavior,behaviors,appearances,groupErrors);this._initialValues=_objectSpread(_objectSpread({},this._initialValues),{},_defineProperty({},GroupDomainVO.field,((_behavior$initialFiel=behavior.initialFieldDomain)===null||_behavior$initialFiel===void 0?void 0:_behavior$initialFiel.value)?behavior.initialFieldDomain.value[GroupDomainVO.field]:[{}]));this._content.push(function(){return table.create(createElementsMap,footerConfig,appearances,_this8._formState,_this8._formApi,_this8._component);});}},{key:\"buildTableInput\",value:function buildTableInput(DomainVO,behavior,appearance){var _this9=this;var _this$handleBehavior11=this.handleBehavior(behavior),initialFieldDomain=_this$handleBehavior11.initialFieldDomain,isRequired=_this$handleBehavior11.isRequired;if(isRequired){this._requiredFields.push(DomainVO.field);}var validateOnChange=!DomainVO.maskOnBlur;var validateOnBlur=!DomainVO.maskOnBlur;var onBlur=function onBlur(e){if(!DomainVO.maskOnBlur)return;var value=e.target.value;var maskedValue=DomainVO.maskOnBlur(value);_this9._formApi.setValue(DomainVO.field,maskedValue);_this9._formApi.validate();};var handleEnterKeyDown=function handleEnterKeyDown(e){if(e.key==='Enter'){onBlur(e);}};var createInput=function createInput(){return/*#__PURE__*/React.createElement(Text,{type:\"text\",field:DomainVO.field,title:DomainVO.hint,initialValue:initialFieldDomain&&initialFieldDomain.value,placeholder:DomainVO.placeholder,mask:DomainVO.mask,validate:DomainVO.validate,validateOnChange:validateOnChange,validateOnBlur:validateOnBlur,onBlur:onBlur,onKeyDown:handleEnterKeyDown});};this._content.push(function(){return/*#__PURE__*/React.createElement(\"li\",null,createInput());});return createInput();}},{key:\"buildComponent\",value:function buildComponent(component){var _this10=this;return function(DomainVO,behavior,appearance){var _this10$handleBehavio=_this10.handleBehavior(behavior),_this10$handleBehavio2=_this10$handleBehavio.onChange,onChange=_this10$handleBehavio2===void 0?function(){}:_this10$handleBehavio2,scope=_this10$handleBehavio.scope,initialFieldDomain=_this10$handleBehavio.initialFieldDomain,customFieldName=_this10$handleBehavio.customFieldName;var fieldName=customFieldName||DomainVO.field;var errors=get(_this10._component.state,\"errors.\".concat(scope,\".\").concat(fieldName));var createComponent=function createComponent(){return React.cloneElement(component,{DomainVO:DomainVO,onChange:onChange,scope:scope,initialFieldDomain:initialFieldDomain,errors:errors});};_this10._content.push(function(){return/*#__PURE__*/React.createElement(\"li\",null,createComponent());});return createComponent();};}},{key:\"buildSubmit\",value:function buildSubmit(lbl){var _this11=this;var submitCallback=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var errorMsg=arguments.length>2?arguments[2]:undefined;var submitHandler=submitCallback;var hideModal=function hideModal(){_this11._component.setState({showSaveDocumentModal:false});};if(!submitHandler){submitHandler=function submitHandler(submitCb){var force=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return function(){_this11._component.checkCompleteness(_this11._formState,_this11._requiredFields);var combineMerge=function combineMerge(target,source,options){var destination=target.slice();source.forEach(function(item,index){if(typeof destination[index]==='undefined'){destination[index]=options.cloneUnlessOtherwiseSpecified(item,options);}else if(options.isMergeableObject(item)){destination[index]=deepmerge(target[index],item,options);}else if(target.indexOf(item)===-1){destination.push(item);}});return destination;};submitCb(deepmerge.all([_this11._formState.values,_this11._component.state,{force:force}],{arrayMerge:combineMerge}),_this11._component.handleError);};};}var agreeModalCallback=function agreeModalCallback(){hideModal();submitHandler(_this11._component.submit,true)();};this._createFooter=function(){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"ds-toolbar-wrapper\"},/*#__PURE__*/React.createElement(\"div\",{className:\"ds-toolbar\"},/*#__PURE__*/React.createElement(\"span\",{className:\"group\"},/*#__PURE__*/React.createElement(Button,{colorClass:PRIMARY,iconClass:ICON.accept,onClick:submitHandler(_this11._component.submit)},lbl)),/*#__PURE__*/React.createElement(\"span\",{className:\"ds-field-name error top inline group\"},errorMsg))),_this11._component.state.showSaveDocumentModal&&/*#__PURE__*/React.createElement(SaveDocumentModal,{agree:agreeModalCallback,hide:hideModal}));};}},{key:\"getForm\",value:function getForm(){var form=_get(_getPrototypeOf(DocumentFormBuilder.prototype),\"getForm\",this).call(this);return React.cloneElement(form,{initialValues:this._initialValues});}}]);return DocumentFormBuilder;}(FormBuilder);export default DocumentFormBuilder;","map":{"version":3,"sources":["C:/Users/Hovsep/Desktop/local/diflow_react/packages/app/src/common/form/documents/DocumentFormBuilder.js"],"names":["React","Option","Select","Text","Scope","FormBuilder","TOP","LEFT","ICON","Button","PRIMARY","DateInput","formBuilderStyles","documentBuilderStyles","DocumentTable","DocumentGroup","SaveDocumentModal","Appearance","Behavior","Defaults","get","setObject","set","setImmutable","deepmerge","classNames","AutocompleteService","Autocomplete","combineMerge","getExternalTypeToString","joinNoEmptyValues","styles","DocumentFormBuilder","formApi","field","customClasses","getError","getTouched","getValue","res","error","success","component","defaultBehavior","defaultAppearance","setDataToFormState","path","data","valuePath","objToMerge","formState","mergedData","arrayMerge","setStateSynchronous","stateUpdate","Promise","resolve","_component","setState","setDataToComponentState","merge","state","newData","_initialValues","_docGroup","_defaults","handleBehavior","handleAppearance","fieldName","behaviorOrIsRequired","appearanceOrAlign","behavior","isRequired","appearance","align","withRequiredView","labelClasses","leftside","top","required","serverErrorMsg","formStateErrorMsg","_formState","DomainVO","initialFieldDomain","scope","errorPath","fieldErrorPath","formattedFieldErrorPath","replace","errorMsg","getErrorMsg","_requiredFields","push","initialValue","value","isHidden","width","getInitialFieldSettings","_content","display","getLabel","name","hint","border","placeholder","mask","validateOnChange","maskOnBlur","validateOnBlur","onBlur","e","target","maskedValue","_formApi","setValue","validateField","handleEnterKeyDown","key","createInput","errorClass","inputClasses","createInputClasses","inputField","validate","scopedInputField","dateInputClasses","dateInputField","createDateInput","captionField","filterRes","title","onChange","scopedField","acService","handleItemSelect","ajaxResponseValues","selectedValue","selectedItem","rows","find","item","getCustomerString","ajax","request","then","catch","console","log","handleAutocompleteValidate","inputValue","undefined","filteredRes","filter","toLowerCase","includes","length","some","autocompleteState","caption","companyName","inn","companyInn","kpp","companyKpp","ogrn","companyOgrn","typeToString","companyExternalType","companyExternalOperator","companyNetwork","companyProps","formatAjaxRes","filteredValues","map","row","autocomplete","isInDiv","options","index","placeholderOption","wrapper","select","selectClasses","width100","selectField","scopedSelectField","GroupDomainVO","createElementsMap","behaviors","appearances","buildGroup","buildArrayGroup","groupIndex","buildArrayGroupInput","buildArrayGroupDateInput","buildArrayGroupAutocomplete","buildArrayGroupSelect","buildArrayGroupModal","buildArrayGroupComponent","footerConfig","groupErrors","errors","table","create","customFieldName","createComponent","cloneElement","lbl","submitCallback","submitHandler","hideModal","showSaveDocumentModal","submitCb","force","checkCompleteness","source","destination","slice","forEach","cloneUnlessOtherwiseSpecified","isMergeableObject","indexOf","all","values","handleError","agreeModalCallback","submit","_createFooter","accept","form","initialValues"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { Option, Select, Text, Scope } from 'informed';\r\nimport FormBuilder from '../FormBuilder';\r\n\r\nimport { TOP, LEFT } from '../../Placement';\r\nimport { ICON } from '@distate/components';\r\n\r\nimport Button, { PRIMARY } from '../../Button';\r\nimport DateInput from '../components/DateInput';\r\n\r\nimport formBuilderStyles from '../FormBuilder.module.css';\r\nimport documentBuilderStyles from './DocumentFormBuilder.module.css';\r\n\r\nimport DocumentTable from '../components/DocumentTable';\r\nimport DocumentGroup from '../components/DocumentGroup';\r\n\r\nimport SaveDocumentModal from '../../../pages/documents/modals/SaveDocumentModal';\r\n\r\nimport Appearance from '../parameters/Appearance';\r\nimport Behavior from '../parameters/Behavior';\r\nimport Defaults from '../parameters/Defaults';\r\n\r\nimport get from 'get-value';\r\nimport setObject from 'object-path';\r\nimport { set as setImmutable } from 'object-path-immutable';\r\nimport deepmerge from 'deepmerge';\r\nimport classNames from 'classnames';\r\n\r\nimport AutocompleteService from '@distate/core/dist/application/autocomplete/AutocompleteService';\r\nimport Autocomplete from '../../autocomplete/Autocomplete';\r\nimport { combineMerge } from '../../../utils/ObjectUtil';\r\nimport { getExternalTypeToString, joinNoEmptyValues } from '../../../helpers/heplers';\r\n\r\nconst styles = { ...formBuilderStyles, ...documentBuilderStyles };\r\n\r\nclass DocumentFormBuilder extends FormBuilder {\r\n  static createInputClasses(formApi = null, field = '', customClasses = ['ds-input']) {\r\n    if (!formApi) return classNames(customClasses);\r\n    const { getError, getTouched, getValue } = formApi;\r\n    const res = {};\r\n    if (field) {\r\n      res.error = getError(field);\r\n      res.success = !getError(field) && getTouched(field) && getValue(field);\r\n    }\r\n    return classNames(res, customClasses);\r\n  }\r\n  constructor(component, defaultBehavior = new Behavior(), defaultAppearance = new Appearance()) {\r\n    super(component);\r\n    this._initialValues = {};\r\n\r\n    this._docGroup = new DocumentGroup(this, DocumentFormBuilder, styles);\r\n\r\n    this._defaults = new Defaults(defaultBehavior, defaultAppearance);\r\n    this.handleBehavior = this._defaults.handleBehavior;\r\n    this.handleAppearance = this._defaults.handleAppearance;\r\n  }\r\n  getLabel(fieldName, behaviorOrIsRequired, appearanceOrAlign) {\r\n    let behavior = behaviorOrIsRequired;\r\n    if (typeof behaviorOrIsRequired === 'boolean') {\r\n      behavior = new Behavior({ isRequired: behaviorOrIsRequired });\r\n    }\r\n    let appearance = appearanceOrAlign;\r\n    if (typeof appearanceOrAlign === 'string') {\r\n      appearance = new Appearance({ align: appearanceOrAlign });\r\n    }\r\n    const { isRequired } = this.handleBehavior(behavior);\r\n    const { align, withRequiredView } = this.handleAppearance(appearance);\r\n    const labelClasses = classNames({\r\n      'ds-field-name': true,\r\n      leftside: align === LEFT,\r\n      top: align === TOP,\r\n      required: withRequiredView || isRequired\r\n    });\r\n    return <label className={labelClasses}>{fieldName}</label>;\r\n  }\r\n  getErrorMsg(fieldName) {\r\n    const serverErrorMsg = get(this._component, `state.errors.${fieldName}`);\r\n    const formStateErrorMsg = get(this._formState, `errors.${fieldName}`);\r\n    return (\r\n      (typeof serverErrorMsg === 'string' && serverErrorMsg) ||\r\n      (typeof formStateErrorMsg === 'string' && formStateErrorMsg)\r\n    );\r\n  }\r\n  getInitialFieldSettings(DomainVO, behavior) {\r\n    const { initialFieldDomain, isRequired, scope, errorPath } = this.handleBehavior(behavior);\r\n    const fieldName = scope ? `${scope}.${DomainVO.field}` : DomainVO.field;\r\n    const fieldErrorPath = errorPath ? `${errorPath}.${fieldName}` : fieldName;\r\n    const formattedFieldErrorPath = fieldErrorPath.replace(/\\[/g, '.').replace(/]/g, '');\r\n    const errorMsg = this.getErrorMsg(formattedFieldErrorPath);\r\n    if (isRequired) {\r\n      this._requiredFields.push(fieldName);\r\n    }\r\n    return {\r\n      fieldName,\r\n      errorMsg,\r\n      initialValue: initialFieldDomain.value\r\n    };\r\n  }\r\n  setDataToFormState = path => data => {\r\n    const valuePath = path ? `values.${path}` : 'values';\r\n    const objToMerge = get(this.formState, valuePath);\r\n    const mergedData = deepmerge(objToMerge, data, { arrayMerge: combineMerge });\r\n    setObject(this.formState, valuePath, mergedData);\r\n  };\r\n  setStateSynchronous = stateUpdate => {\r\n    return new Promise(resolve => {\r\n      this._component.setState(stateUpdate, () => resolve());\r\n    });\r\n  };\r\n  setDataToComponentState = async (data, valuePath, merge = true) => {\r\n    const objToMerge = this._component.state;\r\n    let newData;\r\n    if (merge) {\r\n      newData = deepmerge(objToMerge, data, { arrayMerge: combineMerge });\r\n    } else {\r\n      newData = setImmutable(objToMerge, valuePath, get(data, valuePath));\r\n    }\r\n    await this.setStateSynchronous(newData);\r\n  };\r\n\r\n  buildInfo(DomainVO, behavior, appearance, isHidden) {\r\n    const { initialFieldDomain, isRequired } = this.handleBehavior(behavior);\r\n    const { width } = this.handleAppearance(appearance);\r\n    const { errorMsg } = this.getInitialFieldSettings(DomainVO, behavior);\r\n    this._content.push(() => (\r\n      <li style={{ display: isHidden ? 'none' : 'block' }}>\r\n        {this.getLabel(DomainVO.name, isRequired)}\r\n        <div className=\"group\" style={{ width }}>\r\n          <Text\r\n            className={'ds-field-name leftside'}\r\n            field={DomainVO.field}\r\n            title={DomainVO.hint}\r\n            initialValue={initialFieldDomain.value}\r\n            style={{ width, border: 'none' }}\r\n            placeholder={DomainVO.placeholder}\r\n            mask={DomainVO.mask}\r\n            readOnly\r\n          />\r\n          <span className=\"ds-field-name bottom error\">{errorMsg}</span>\r\n        </div>\r\n      </li>\r\n    ));\r\n  }\r\n  buildInput(DomainVO, behavior, appearance) {\r\n    const { isRequired, scope } = this.handleBehavior(behavior);\r\n    const { width, customClasses, align, withRequiredView } = this.handleAppearance(appearance);\r\n    const { fieldName, errorMsg, initialValue } = this.getInitialFieldSettings(DomainVO, behavior);\r\n\r\n    const validateOnChange = !DomainVO.maskOnBlur;\r\n    const validateOnBlur = !DomainVO.maskOnBlur;\r\n    const onBlur = e => {\r\n      if (!DomainVO.maskOnBlur) return;\r\n      const value = e.target.value;\r\n      const maskedValue = DomainVO.maskOnBlur(value);\r\n      this._formApi.setValue(fieldName, maskedValue);\r\n      this._formApi.validateField(fieldName);\r\n    };\r\n    const handleEnterKeyDown = e => {\r\n      if (e.key === 'Enter') {\r\n        onBlur(e);\r\n      }\r\n    };\r\n\r\n    const createInput = () => {\r\n      const errorClass = errorMsg ? 'error' : '';\r\n      const inputClasses = DocumentFormBuilder.createInputClasses(\r\n        this._formApi,\r\n        fieldName,\r\n        `ds-input ${customClasses} ${errorClass}`\r\n      );\r\n      const inputField = (\r\n        <div className=\"group\" style={{ width }}>\r\n          <Text\r\n            field={DomainVO.field}\r\n            title={DomainVO.hint}\r\n            initialValue={initialValue}\r\n            className={inputClasses}\r\n            style={{ width }}\r\n            placeholder={DomainVO.placeholder}\r\n            mask={DomainVO.mask}\r\n            validate={DomainVO.validate}\r\n            validateOnChange={validateOnChange}\r\n            validateOnBlur={validateOnBlur}\r\n            onBlur={onBlur}\r\n            onKeyDown={handleEnterKeyDown}\r\n          />\r\n          <span className=\"ds-field-name bottom error\">{errorMsg}</span>\r\n        </div>\r\n      );\r\n      const scopedInputField = scope ? <Scope scope={scope}>{inputField}</Scope> : inputField;\r\n      return (\r\n        <div className=\"group\" key={`${scope}.${DomainVO.field}`}>\r\n          {this.getLabel(\r\n            DomainVO.name,\r\n            new Behavior({ isRequired }),\r\n            new Appearance({ align, withRequiredView })\r\n          )}\r\n          {scopedInputField}\r\n        </div>\r\n      );\r\n    };\r\n\r\n    this._content.push(() => <li className={customClasses}>{createInput()}</li>);\r\n    return createInput();\r\n  }\r\n  buildDateInput(DomainVO, behavior, appearance) {\r\n    const { isRequired, scope } = this.handleBehavior(behavior);\r\n    const { width, align, customClasses } = this.handleAppearance(appearance);\r\n    const { fieldName, errorMsg, initialValue } = this.getInitialFieldSettings(DomainVO, behavior);\r\n    const errorClass = errorMsg ? 'error' : '';\r\n    const dateInputClasses = DocumentFormBuilder.createInputClasses(\r\n      this._formApi,\r\n      fieldName,\r\n      `ds-input date ${customClasses} ${errorClass}`\r\n    );\r\n    const dateInputField = (\r\n      <div className=\"group\" style={{ width }}>\r\n        <DateInput\r\n          field={DomainVO.field}\r\n          title={DomainVO.hint}\r\n          initialValue={initialValue}\r\n          className={dateInputClasses}\r\n          placeholder={DomainVO.placeholder}\r\n          mask={DomainVO.mask}\r\n          validate={DomainVO.validate}\r\n          validateOnChange\r\n          validateOnBlur\r\n        />\r\n        <span className=\"ds-field-name bottom error\">{errorMsg}</span>\r\n      </div>\r\n    );\r\n    const scopedInputField = scope ? <Scope scope={scope}>{dateInputField}</Scope> : dateInputField;\r\n    const createDateInput = () => (\r\n      <div className=\"group\" key={`${scope}.${DomainVO.field}`}>\r\n        {this.getLabel(DomainVO.name, new Behavior({ isRequired }), new Appearance({ align }))}\r\n        {scopedInputField}\r\n      </div>\r\n    );\r\n    this._content.push(() => <li>{createDateInput()}</li>);\r\n    return createDateInput();\r\n  }\r\n  buildAutocomplete(DomainVO, behavior, appearance, captionField, filterRes) {\r\n    const {\r\n      title,\r\n      initialFieldDomain,\r\n      isRequired = false,\r\n      onChange = () => {},\r\n      scope = ''\r\n    } = this.handleBehavior(behavior);\r\n\r\n    const { width, align, customClasses } = this.handleAppearance(appearance);\r\n    const scopedField = scope ? `${scope}.${DomainVO.field}` : DomainVO.field;\r\n\r\n    if (isRequired) {\r\n      this._requiredFields.push(DomainVO.field);\r\n    }\r\n    const acService = AutocompleteService[DomainVO.field];\r\n    const handleItemSelect = ajaxResponseValues => selectedValue => {\r\n      if (!ajaxResponseValues) {\r\n        return;\r\n      }\r\n\r\n      this._formApi.setValue(scopedField, selectedValue);\r\n\r\n      let selectedItem;\r\n      if (DomainVO.name === 'Покупатель') {\r\n        selectedItem = ajaxResponseValues.rows.find(\r\n          item => getCustomerString(item) === selectedValue\r\n        );\r\n      } else {\r\n        selectedItem = ajaxResponseValues.rows.find(\r\n          item => item.title === selectedValue\r\n        );\r\n  \r\n      }\r\n      \r\n      if (behavior.ajax.request) {\r\n        behavior.ajax\r\n          .request(selectedItem[behavior.ajax.field])\r\n          .then(res => {\r\n            this._component.setState({ [scopedField]: res });\r\n            onChange(res);\r\n          })\r\n          .catch(error => {\r\n            console.log(error);\r\n          });\r\n      } else {\r\n        this._component.setState({ [scopedField]: selectedItem });\r\n        onChange(selectedItem);\r\n      }\r\n    };\r\n\r\n    const handleAutocompleteValidate = field => res => inputValue => {\r\n      if (res === null) {\r\n        return undefined;\r\n      }\r\n\r\n      if (!inputValue) {\r\n        this._component.setState({ [field]: '' });\r\n        return !isRequired ? undefined : 'Введите значение';\r\n      }\r\n\r\n      const filteredRes = res.filter(item => {\r\n        return item.toLowerCase().includes(inputValue.toLowerCase());\r\n      });\r\n\r\n      \r\n\r\n\r\n      if (filteredRes.length === 1) {\r\n        this._component.setState({ [field]: inputValue });\r\n        return undefined;\r\n      }\r\n\r\n      if (filteredRes?.length > 1 || filterRes?.length === 0) {\r\n        this._component.setState({ [field]: inputValue });\r\n\r\n        if (filteredRes.some(item => item === inputValue)) {\r\n          return undefined;\r\n        } else {\r\n          return 'Выберите значение из выпадающего списка';\r\n        }\r\n      }\r\n\r\n      return undefined;\r\n    };\r\n\r\n    const autocompleteState = this._component.state[scopedField];\r\n\r\n    const caption = captionField && autocompleteState && autocompleteState[captionField] && (\r\n      <p className={`caption ${styles.caption}`}>{autocompleteState[captionField]}</p>\r\n    );\r\n\r\n    // function for making customer string value\r\n    function getCustomerString(item) {\r\n      const companyName = item?.companyName;\r\n      const inn = item?.companyInn && `ИНН: ${item.companyInn}`;\r\n      const kpp = item?.companyKpp && `КПП: ${item.companyKpp}`;\r\n      const ogrn = item?.companyOgrn && `ОГРН: ${item.companyOgrn}`;\r\n\r\n      const typeToString = getExternalTypeToString(\r\n        item?.companyExternalType,\r\n        item?.companyExternalOperator,\r\n        item?.companyNetwork\r\n      );\r\n\r\n      const companyProps = joinNoEmptyValues([companyName, inn, kpp, ogrn], ', ');\r\n\r\n      return companyProps + typeToString;\r\n    }\r\n\r\n    const formatAjaxRes = res => {\r\n      const filteredValues = (filterRes && filterRes(res.rows)) || res.rows;\r\n      if (DomainVO.name === 'Покупатель') {\r\n        return filteredValues.map(row => getCustomerString(row));\r\n      }\r\n      return filteredValues.map(row => row.title);\r\n    };\r\n\r\n    const autocomplete = () => {\r\n      const errorMsg = this.getErrorMsg(scopedField);\r\n      const errorClass = errorMsg ? 'error' : '';\r\n      const inputClasses = DocumentFormBuilder.createInputClasses(\r\n        this._formApi,\r\n        scopedField,\r\n        `ds-input ${customClasses} ${errorClass}`\r\n      );\r\n      return (\r\n        <li className={customClasses}>\r\n          {title !== null && this.getLabel(title || DomainVO.name, isRequired, align)}\r\n          <div className=\"group\">\r\n            <Autocomplete\r\n              doAjax={acService.request}\r\n              formatAjaxRes={formatAjaxRes}\r\n              handleItemSelect={handleItemSelect}\r\n              handleAutocompleteValidate={handleAutocompleteValidate(scopedField)}\r\n            >\r\n              <Text\r\n                field={DomainVO.field}\r\n                title={DomainVO.hint}\r\n                initialValue={initialFieldDomain && initialFieldDomain.value}\r\n                className={inputClasses}\r\n                style={{ width }}\r\n                placeholder={DomainVO.placeholder}\r\n                mask={DomainVO.mask}\r\n                validateOnChange\r\n                validateOnBlur\r\n                onFocus={onChange}\r\n              />\r\n            </Autocomplete>\r\n            <span className=\"ds-field-name bottom error\">{errorMsg}</span>\r\n\r\n            {!errorMsg && caption}\r\n          </div>\r\n        </li>\r\n      );\r\n    };\r\n    this._content.push(autocomplete);\r\n    return autocomplete();\r\n  }\r\n\r\n  buildSelect(DomainVO, behavior, appearance) {\r\n    const { isRequired, initialFieldDomain, onChange, scope } = this.handleBehavior(behavior);\r\n    const { width, align, isInDiv } = this.handleAppearance(appearance);\r\n    const { fieldName, errorMsg } = this.getInitialFieldSettings(DomainVO, behavior);\r\n\r\n    const options = DomainVO.options.map(({ value, title }, index) => (\r\n      <Option value={value} key={`${DomainVO.field}${index}`}>\r\n        {title}\r\n      </Option>\r\n    ));\r\n\r\n    const placeholderOption = DomainVO.placeholder && (\r\n      <Option value=\"\" disabled key={`${DomainVO.field}.placeholder`}>\r\n        {DomainVO.placeholder}\r\n      </Option>\r\n    );\r\n\r\n    const initialValue =\r\n      initialFieldDomain && initialFieldDomain.value !== ''\r\n        ? initialFieldDomain.value\r\n        : DomainVO.options[0].value;\r\n\r\n    const wrapper = (isInDiv, select) => () => {\r\n      if (isInDiv) return <div className=\"group\">{select()}</div>;\r\n      return <li key={`${scope}.${DomainVO.field}`}>{select()}</li>;\r\n    };\r\n\r\n    const select = () => {\r\n      const errorClass = errorMsg ? 'error' : '';\r\n      const selectClasses = DocumentFormBuilder.createInputClasses(\r\n        this._formApi,\r\n        fieldName,\r\n        `ds-select ${styles.width100} ${errorClass}`\r\n      );\r\n\r\n      const selectField = (\r\n        <div className=\"group\" style={{ width }}>\r\n          <Select\r\n            field={DomainVO.field}\r\n            title={DomainVO.hint}\r\n            initialValue={initialValue}\r\n            style={{ width }}\r\n            className={selectClasses}\r\n            mask={DomainVO.mask}\r\n            validate={DomainVO.validate}\r\n            validateOnChange\r\n            validateOnBlur\r\n            onChange={() => {\r\n              onChange(this._formApi.getValue(fieldName));\r\n            }}\r\n          >\r\n            {placeholderOption}\r\n            {options}\r\n          </Select>\r\n          <span className=\"ds-field-name bottom error\">{errorMsg}</span>\r\n        </div>\r\n      );\r\n\r\n      const scopedSelectField = scope ? <Scope scope={scope}>{selectField}</Scope> : selectField;\r\n\r\n      return (\r\n        <React.Fragment>\r\n          {this.getLabel(DomainVO.name, new Behavior({ isRequired }), new Appearance({ align }))}\r\n          {scopedSelectField}\r\n        </React.Fragment>\r\n      );\r\n    };\r\n\r\n    this._content.push(wrapper(isInDiv, select));\r\n    return wrapper(isInDiv, select)();\r\n  }\r\n\r\n  buildGroup(GroupDomainVO, createElementsMap, behavior, appearance, behaviors, appearances) {\r\n    this._docGroup.buildGroup(\r\n      GroupDomainVO,\r\n      createElementsMap,\r\n      behavior,\r\n      appearance,\r\n      behaviors,\r\n      appearances\r\n    );\r\n  }\r\n\r\n  buildArrayGroup(GroupDomainVO, createElementsMap, behavior, appearance, behaviors, appearances) {\r\n    this._docGroup.buildArrayGroup(\r\n      GroupDomainVO,\r\n      createElementsMap,\r\n      behavior,\r\n      appearance,\r\n      behaviors,\r\n      appearances\r\n    );\r\n  }\r\n\r\n  buildArrayGroupInput(GroupDomainVO, DomainVO, groupIndex, behavior, appearance) {\r\n    return this._docGroup.buildArrayGroupInput(\r\n      GroupDomainVO,\r\n      DomainVO,\r\n      groupIndex,\r\n      behavior,\r\n      appearance\r\n    );\r\n  }\r\n\r\n  buildArrayGroupDateInput(GroupDomainVO, DomainVO, groupIndex, behavior, appearance) {\r\n    return this._docGroup.buildArrayGroupDateInput(\r\n      GroupDomainVO,\r\n      DomainVO,\r\n      groupIndex,\r\n      behavior,\r\n      appearance\r\n    );\r\n  }\r\n\r\n  buildArrayGroupAutocomplete(GroupDomainVO, DomainVO, groupIndex, behavior, appearance) {\r\n    return this._docGroup.buildArrayGroupAutocomplete(\r\n      GroupDomainVO,\r\n      DomainVO,\r\n      groupIndex,\r\n      behavior,\r\n      appearance\r\n    );\r\n  }\r\n\r\n  buildArrayGroupSelect(GroupDomainVO, DomainVO, groupIndex, behavior, appearance) {\r\n    return this._docGroup.buildArrayGroupSelect(\r\n      GroupDomainVO,\r\n      DomainVO,\r\n      groupIndex,\r\n      behavior,\r\n      appearance\r\n    );\r\n  }\r\n\r\n  buildArrayGroupModal(GroupDomainVO, DomainVO, groupIndex, behavior, appearance) {\r\n    return this._docGroup.buildArrayGroupModal(\r\n      GroupDomainVO,\r\n      DomainVO,\r\n      groupIndex,\r\n      behavior,\r\n      appearance\r\n    );\r\n  }\r\n\r\n  buildArrayGroupComponent(component) {\r\n    return (GroupDomainVO, DomainVO, groupIndex, behavior, appearance) => {\r\n      return this._docGroup.buildArrayGroupComponent(component)(\r\n        GroupDomainVO,\r\n        DomainVO,\r\n        groupIndex,\r\n        behavior,\r\n        appearance\r\n      );\r\n    };\r\n  }\r\n\r\n  buildTable(GroupDomainVO, createElementsMap, footerConfig, behaviors, appearances, behavior) {\r\n    const groupErrors = get(this._component.state.errors, GroupDomainVO.field);\r\n    const table = new DocumentTable(\r\n      GroupDomainVO,\r\n      styles,\r\n      behavior,\r\n      behaviors,\r\n      appearances,\r\n      groupErrors\r\n    );\r\n    this._initialValues = {\r\n      ...this._initialValues,\r\n      [GroupDomainVO.field]: behavior.initialFieldDomain?.value\r\n        ? behavior.initialFieldDomain.value[GroupDomainVO.field]\r\n        : [{}]\r\n    };\r\n    this._content.push(() =>\r\n      table.create(\r\n        createElementsMap,\r\n        footerConfig,\r\n        appearances,\r\n        this._formState,\r\n        this._formApi,\r\n        this._component\r\n      )\r\n    );\r\n  }\r\n  buildTableInput(DomainVO, behavior, appearance) {\r\n    const { initialFieldDomain, isRequired } = this.handleBehavior(behavior);\r\n\r\n    if (isRequired) {\r\n      this._requiredFields.push(DomainVO.field);\r\n    }\r\n    const validateOnChange = !DomainVO.maskOnBlur;\r\n    const validateOnBlur = !DomainVO.maskOnBlur;\r\n    const onBlur = e => {\r\n      if (!DomainVO.maskOnBlur) return;\r\n      const value = e.target.value;\r\n      const maskedValue = DomainVO.maskOnBlur(value);\r\n      this._formApi.setValue(DomainVO.field, maskedValue);\r\n      this._formApi.validate();\r\n    };\r\n    const handleEnterKeyDown = e => {\r\n      if (e.key === 'Enter') {\r\n        onBlur(e);\r\n      }\r\n    };\r\n\r\n    const createInput = () => {\r\n      return (\r\n        <Text\r\n          type=\"text\"\r\n          field={DomainVO.field}\r\n          title={DomainVO.hint}\r\n          initialValue={initialFieldDomain && initialFieldDomain.value}\r\n          placeholder={DomainVO.placeholder}\r\n          mask={DomainVO.mask}\r\n          validate={DomainVO.validate}\r\n          validateOnChange={validateOnChange}\r\n          validateOnBlur={validateOnBlur}\r\n          onBlur={onBlur}\r\n          onKeyDown={handleEnterKeyDown}\r\n        />\r\n      );\r\n    };\r\n\r\n    this._content.push(() => <li>{createInput()}</li>);\r\n    return createInput();\r\n  }\r\n\r\n  buildComponent(component) {\r\n    return (DomainVO, behavior, appearance) => {\r\n      const {\r\n        onChange = () => {},\r\n        scope,\r\n        initialFieldDomain,\r\n        customFieldName\r\n      } = this.handleBehavior(behavior);\r\n      const fieldName = customFieldName || DomainVO.field;\r\n      const errors = get(this._component.state, `errors.${scope}.${fieldName}`);\r\n      const createComponent = () => {\r\n        return React.cloneElement(component, {\r\n          DomainVO,\r\n          onChange,\r\n          scope,\r\n          initialFieldDomain,\r\n          errors\r\n        });\r\n      };\r\n      this._content.push(() => <li>{createComponent()}</li>);\r\n      return createComponent();\r\n    };\r\n  }\r\n\r\n  buildSubmit(lbl, submitCallback = null, errorMsg) {\r\n    let submitHandler = submitCallback;\r\n\r\n    const hideModal = () => {\r\n      this._component.setState({ showSaveDocumentModal: false });\r\n    };\r\n    if (!submitHandler) {\r\n      submitHandler = (submitCb, force = false) => () => {\r\n        this._component.checkCompleteness(this._formState, this._requiredFields);\r\n\r\n        const combineMerge = (target, source, options) => {\r\n          const destination = target.slice();\r\n\r\n          source.forEach((item, index) => {\r\n            if (typeof destination[index] === 'undefined') {\r\n              destination[index] = options.cloneUnlessOtherwiseSpecified(item, options);\r\n            } else if (options.isMergeableObject(item)) {\r\n              destination[index] = deepmerge(target[index], item, options);\r\n            } else if (target.indexOf(item) === -1) {\r\n              destination.push(item);\r\n            }\r\n          });\r\n          return destination;\r\n        };\r\n\r\n        submitCb(\r\n          deepmerge.all([this._formState.values, this._component.state, { force }], {\r\n            arrayMerge: combineMerge\r\n          }),\r\n          this._component.handleError\r\n        );\r\n      };\r\n    }\r\n    const agreeModalCallback = () => {\r\n      hideModal();\r\n      submitHandler(this._component.submit, true)();\r\n    };\r\n\r\n    this._createFooter = () => (\r\n      <React.Fragment>\r\n        <div className=\"ds-toolbar-wrapper\">\r\n          <div className=\"ds-toolbar\">\r\n            <span className=\"group\">\r\n              <Button\r\n                colorClass={PRIMARY}\r\n                iconClass={ICON.accept}\r\n                onClick={submitHandler(this._component.submit)}\r\n              >\r\n                {lbl}\r\n              </Button>\r\n            </span>\r\n            <span className=\"ds-field-name error top inline group\">{errorMsg}</span>\r\n          </div>\r\n        </div>\r\n        {this._component.state.showSaveDocumentModal && (\r\n          <SaveDocumentModal agree={agreeModalCallback} hide={hideModal} />\r\n        )}\r\n      </React.Fragment>\r\n    );\r\n  }\r\n  getForm() {\r\n    const form = super.getForm();\r\n    return React.cloneElement(form, {\r\n      initialValues: this._initialValues\r\n    });\r\n  }\r\n}\r\n\r\nexport default DocumentFormBuilder;\r\n"]},"metadata":{},"sourceType":"module"}